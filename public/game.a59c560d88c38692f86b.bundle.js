/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./src/img/3rdcf.png":
/*!***************************!*\
  !*** ./src/img/3rdcf.png ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/3rdcf.png");

/***/ }),

/***/ "./src/img/admin-badge.svg":
/*!*********************************!*\
  !*** ./src/img/admin-badge.svg ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/admin-badge.svg");

/***/ }),

/***/ "./src/img/arrow.svg":
/*!***************************!*\
  !*** ./src/img/arrow.svg ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/arrow.svg");

/***/ }),

/***/ "./src/img/badges/jimbo.png":
/*!**********************************!*\
  !*** ./src/img/badges/jimbo.png ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/jimbo.png");

/***/ }),

/***/ "./src/img/badges/ny24.png":
/*!*********************************!*\
  !*** ./src/img/badges/ny24.png ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/ny24.png");

/***/ }),

/***/ "./src/img/badges/pepe.png":
/*!*********************************!*\
  !*** ./src/img/badges/pepe.png ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/pepe.png");

/***/ }),

/***/ "./src/img/badges/pony.png":
/*!*********************************!*\
  !*** ./src/img/badges/pony.png ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/pony.png");

/***/ }),

/***/ "./src/img/badges/scream.png":
/*!***********************************!*\
  !*** ./src/img/badges/scream.png ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/scream.png");

/***/ }),

/***/ "./src/img/badges/star.png":
/*!*********************************!*\
  !*** ./src/img/badges/star.png ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/star.png");

/***/ }),

/***/ "./src/img/badges/umum.png":
/*!*********************************!*\
  !*** ./src/img/badges/umum.png ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/umum.png");

/***/ }),

/***/ "./src/img/badges/yoba.png":
/*!*********************************!*\
  !*** ./src/img/badges/yoba.png ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/yoba.png");

/***/ }),

/***/ "./src/img/badges/z.png":
/*!******************************!*\
  !*** ./src/img/badges/z.png ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/z.png");

/***/ }),

/***/ "./src/img/chunkPlaceholder.png":
/*!**************************************!*\
  !*** ./src/img/chunkPlaceholder.png ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/chunkPlaceholder.png");

/***/ }),

/***/ "./src/img/cross.svg":
/*!***************************!*\
  !*** ./src/img/cross.svg ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/cross.svg");

/***/ }),

/***/ "./src/img/disabled-color.svg":
/*!************************************!*\
  !*** ./src/img/disabled-color.svg ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/disabled-color.svg");

/***/ }),

/***/ "./src/img/discord-logo-circle.svg":
/*!*****************************************!*\
  !*** ./src/img/discord-logo-circle.svg ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/discord-logo-circle.svg");

/***/ }),

/***/ "./src/img/dots.svg":
/*!**************************!*\
  !*** ./src/img/dots.svg ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/dots.svg");

/***/ }),

/***/ "./src/img/gg-logo.svg":
/*!*****************************!*\
  !*** ./src/img/gg-logo.svg ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/gg-logo.svg");

/***/ }),

/***/ "./src/img/goroxels.png":
/*!******************************!*\
  !*** ./src/img/goroxels.png ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/goroxels.png");

/***/ }),

/***/ "./src/img/icon-desktop.svg":
/*!**********************************!*\
  !*** ./src/img/icon-desktop.svg ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/icon-desktop.svg");

/***/ }),

/***/ "./src/img/icon-phone.svg":
/*!********************************!*\
  !*** ./src/img/icon-phone.svg ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/icon-phone.svg");

/***/ }),

/***/ "./src/img/mod-badge.svg":
/*!*******************************!*\
  !*** ./src/img/mod-badge.svg ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/mod-badge.svg");

/***/ }),

/***/ "./src/img/mouse/mouse-4mb.png":
/*!*************************************!*\
  !*** ./src/img/mouse/mouse-4mb.png ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/mouse-4mb.png");

/***/ }),

/***/ "./src/img/mouse/mouse-5mb.png":
/*!*************************************!*\
  !*** ./src/img/mouse/mouse-5mb.png ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/mouse-5mb.png");

/***/ }),

/***/ "./src/img/mouse/mouse-lmb.png":
/*!*************************************!*\
  !*** ./src/img/mouse/mouse-lmb.png ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/mouse-lmb.png");

/***/ }),

/***/ "./src/img/mouse/mouse-mmb.png":
/*!*************************************!*\
  !*** ./src/img/mouse/mouse-mmb.png ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/mouse-mmb.png");

/***/ }),

/***/ "./src/img/mouse/mouse-rmb.png":
/*!*************************************!*\
  !*** ./src/img/mouse/mouse-rmb.png ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/mouse-rmb.png");

/***/ }),

/***/ "./src/img/move-icon.svg":
/*!*******************************!*\
  !*** ./src/img/move-icon.svg ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/move-icon.svg");

/***/ }),

/***/ "./src/img/old-wipes/01.06.20.png":
/*!****************************************!*\
  !*** ./src/img/old-wipes/01.06.20.png ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/01.06.20.png");

/***/ }),

/***/ "./src/img/old-wipes/02.05.22.png":
/*!****************************************!*\
  !*** ./src/img/old-wipes/02.05.22.png ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/02.05.22.png");

/***/ }),

/***/ "./src/img/old-wipes/03.04.23.png":
/*!****************************************!*\
  !*** ./src/img/old-wipes/03.04.23.png ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/03.04.23.png");

/***/ }),

/***/ "./src/img/old-wipes/03.06.19.png":
/*!****************************************!*\
  !*** ./src/img/old-wipes/03.06.19.png ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/03.06.19.png");

/***/ }),

/***/ "./src/img/old-wipes/09.04.18.png":
/*!****************************************!*\
  !*** ./src/img/old-wipes/09.04.18.png ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/09.04.18.png");

/***/ }),

/***/ "./src/img/old-wipes/09.08.19.png":
/*!****************************************!*\
  !*** ./src/img/old-wipes/09.08.19.png ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/09.08.19.png");

/***/ }),

/***/ "./src/img/old-wipes/10.07.17.png":
/*!****************************************!*\
  !*** ./src/img/old-wipes/10.07.17.png ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/10.07.17.png");

/***/ }),

/***/ "./src/img/old-wipes/16.08.25.png":
/*!****************************************!*\
  !*** ./src/img/old-wipes/16.08.25.png ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/16.08.25.png");

/***/ }),

/***/ "./src/img/old-wipes/18.11.19.png":
/*!****************************************!*\
  !*** ./src/img/old-wipes/18.11.19.png ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/18.11.19.png");

/***/ }),

/***/ "./src/img/old-wipes/22.08.18.png":
/*!****************************************!*\
  !*** ./src/img/old-wipes/22.08.18.png ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/22.08.18.png");

/***/ }),

/***/ "./src/img/old-wipes/22.11.18.png":
/*!****************************************!*\
  !*** ./src/img/old-wipes/22.11.18.png ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/22.11.18.png");

/***/ }),

/***/ "./src/img/old-wipes/25.02.19.png":
/*!****************************************!*\
  !*** ./src/img/old-wipes/25.02.19.png ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/25.02.19.png");

/***/ }),

/***/ "./src/img/old-wipes/26.02.20.png":
/*!****************************************!*\
  !*** ./src/img/old-wipes/26.02.20.png ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/26.02.20.png");

/***/ }),

/***/ "./src/img/old-wipes/26.10.23.png":
/*!****************************************!*\
  !*** ./src/img/old-wipes/26.10.23.png ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/26.10.23.png");

/***/ }),

/***/ "./src/img/protectedPattern.png":
/*!**************************************!*\
  !*** ./src/img/protectedPattern.png ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/protectedPattern.png");

/***/ }),

/***/ "./src/img/stripes.png":
/*!*****************************!*\
  !*** ./src/img/stripes.png ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/stripes.png");

/***/ }),

/***/ "./src/img/telegram.svg":
/*!******************************!*\
  !*** ./src/img/telegram.svg ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/telegram.svg");

/***/ }),

/***/ "./src/img/toolIcons/clicker.png":
/*!***************************************!*\
  !*** ./src/img/toolIcons/clicker.png ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/clicker.png");

/***/ }),

/***/ "./src/img/toolIcons/disable-cur.png":
/*!*******************************************!*\
  !*** ./src/img/toolIcons/disable-cur.png ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/disable-cur.png");

/***/ }),

/***/ "./src/img/toolIcons/disable.png":
/*!***************************************!*\
  !*** ./src/img/toolIcons/disable.png ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/disable.png");

/***/ }),

/***/ "./src/img/toolIcons/floodfill.png":
/*!*****************************************!*\
  !*** ./src/img/toolIcons/floodfill.png ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/floodfill.png");

/***/ }),

/***/ "./src/img/toolIcons/line.png":
/*!************************************!*\
  !*** ./src/img/toolIcons/line.png ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/line.png");

/***/ }),

/***/ "./src/img/toolIcons/move.png":
/*!************************************!*\
  !*** ./src/img/toolIcons/move.png ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/move.png");

/***/ }),

/***/ "./src/img/toolIcons/protect.png":
/*!***************************************!*\
  !*** ./src/img/toolIcons/protect.png ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/protect.png");

/***/ }),

/***/ "./src/img/toolIcons/revert.png":
/*!**************************************!*\
  !*** ./src/img/toolIcons/revert.png ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/revert.png");

/***/ }),

/***/ "./src/img/toolIcons/wand-cur.png":
/*!****************************************!*\
  !*** ./src/img/toolIcons/wand-cur.png ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/wand-cur.png");

/***/ }),

/***/ "./src/img/unavailable.png":
/*!*********************************!*\
  !*** ./src/img/unavailable.png ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/unavailable.png");

/***/ }),

/***/ "./src/img/user.svg":
/*!**************************!*\
  !*** ./src/img/user.svg ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/user.svg");

/***/ }),

/***/ "./src/img/user2.png":
/*!***************************!*\
  !*** ./src/img/user2.png ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/user2.png");

/***/ }),

/***/ "./src/img/vk-logo.svg":
/*!*****************************!*\
  !*** ./src/img/vk-logo.svg ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/vk-logo.svg");

/***/ }),

/***/ "./src/img/winamp/bg.png":
/*!*******************************!*\
  !*** ./src/img/winamp/bg.png ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/bg.png");

/***/ }),

/***/ "./src/img/winamp/bg2.png":
/*!********************************!*\
  !*** ./src/img/winamp/bg2.png ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/bg2.png");

/***/ }),

/***/ "./src/img/winamp/digits.png":
/*!***********************************!*\
  !*** ./src/img/winamp/digits.png ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/digits.png");

/***/ }),

/***/ "./src/img/winamp/enableRadioBtn.png":
/*!*******************************************!*\
  !*** ./src/img/winamp/enableRadioBtn.png ***!
  \*******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/enableRadioBtn.png");

/***/ }),

/***/ "./src/img/winamp/hr-slider-btn-small.png":
/*!************************************************!*\
  !*** ./src/img/winamp/hr-slider-btn-small.png ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/hr-slider-btn-small.png");

/***/ }),

/***/ "./src/img/winamp/slider-btn.png":
/*!***************************************!*\
  !*** ./src/img/winamp/slider-btn.png ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/slider-btn.png");

/***/ }),

/***/ "./src/video/as.webm":
/*!***************************!*\
  !*** ./src/video/as.webm ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/video/as.webm");

/***/ }),

/***/ "./src/video/brush.webm":
/*!******************************!*\
  !*** ./src/video/brush.webm ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/video/brush.webm");

/***/ }),

/***/ "./src/video/brush2.webm":
/*!*******************************!*\
  !*** ./src/video/brush2.webm ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/video/brush2.webm");

/***/ }),

/***/ "./src/video/clicker.webm":
/*!********************************!*\
  !*** ./src/video/clicker.webm ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/video/clicker.webm");

/***/ }),

/***/ "./src/video/clickerMouse.webm":
/*!*************************************!*\
  !*** ./src/video/clickerMouse.webm ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/video/clickerMouse.webm");

/***/ }),

/***/ "./src/video/ctrlZ.webm":
/*!******************************!*\
  !*** ./src/video/ctrlZ.webm ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/video/ctrlZ.webm");

/***/ }),

/***/ "./src/video/flood.webm":
/*!******************************!*\
  !*** ./src/video/flood.webm ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/video/flood.webm");

/***/ }),

/***/ "./src/video/line.webm":
/*!*****************************!*\
  !*** ./src/video/line.webm ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/video/line.webm");

/***/ }),

/***/ "./src/video/patternDemo.webm":
/*!************************************!*\
  !*** ./src/video/patternDemo.webm ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/video/patternDemo.webm");

/***/ }),

/***/ "./src/video/phoneDrawing.mp4":
/*!************************************!*\
  !*** ./src/video/phoneDrawing.mp4 ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/video/phoneDrawing.mp4");

/***/ }),

/***/ "./src/video/toolC.webm":
/*!******************************!*\
  !*** ./src/video/toolC.webm ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/video/toolC.webm");

/***/ }),

/***/ "./src/font/pixel/min5.png":
/*!*********************************!*\
  !*** ./src/font/pixel/min5.png ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/font/min5.png");

/***/ }),

/***/ "./src/font/pixel/min5.txt":
/*!*********************************!*\
  !*** ./src/font/pixel/min5.txt ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/font/min5.txt");

/***/ }),

/***/ "./src/font/pixel/winamp.png":
/*!***********************************!*\
  !*** ./src/font/pixel/winamp.png ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/font/winamp.png");

/***/ }),

/***/ "./src/font/pixel/winamp.txt":
/*!***********************************!*\
  !*** ./src/font/pixel/winamp.txt ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/font/winamp.txt");

/***/ }),

/***/ "./src/css/colorVars.css":
/*!*******************************!*\
  !*** ./src/css/colorVars.css ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/css/style.css":
/*!***************************!*\
  !*** ./src/css/style.css ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/img/badges sync \\.png$":
/*!**************************************************!*\
  !*** ./src/img/badges/ sync nonrecursive \.png$ ***!
  \**************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

var map = {
	"./jimbo.png": "./src/img/badges/jimbo.png",
	"./ny24.png": "./src/img/badges/ny24.png",
	"./pepe.png": "./src/img/badges/pepe.png",
	"./pony.png": "./src/img/badges/pony.png",
	"./scream.png": "./src/img/badges/scream.png",
	"./star.png": "./src/img/badges/star.png",
	"./umum.png": "./src/img/badges/umum.png",
	"./yoba.png": "./src/img/badges/yoba.png",
	"./z.png": "./src/img/badges/z.png"
};


function webpackContext(req) {
	var id = webpackContextResolve(req);
	return __webpack_require__(id);
}
function webpackContextResolve(req) {
	if(!__webpack_require__.o(map, req)) {
		var e = new Error("Cannot find module '" + req + "'");
		e.code = 'MODULE_NOT_FOUND';
		throw e;
	}
	return map[req];
}
webpackContext.keys = function webpackContextKeys() {
	return Object.keys(map);
};
webpackContext.resolve = webpackContextResolve;
module.exports = webpackContext;
webpackContext.id = "./src/img/badges sync \\.png$";

/***/ }),

/***/ "./src/img/old-wipes sync \\.png$":
/*!*****************************************************!*\
  !*** ./src/img/old-wipes/ sync nonrecursive \.png$ ***!
  \*****************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

var map = {
	"./01.06.20.png": "./src/img/old-wipes/01.06.20.png",
	"./02.05.22.png": "./src/img/old-wipes/02.05.22.png",
	"./03.04.23.png": "./src/img/old-wipes/03.04.23.png",
	"./03.06.19.png": "./src/img/old-wipes/03.06.19.png",
	"./09.04.18.png": "./src/img/old-wipes/09.04.18.png",
	"./09.08.19.png": "./src/img/old-wipes/09.08.19.png",
	"./10.07.17.png": "./src/img/old-wipes/10.07.17.png",
	"./16.08.25.png": "./src/img/old-wipes/16.08.25.png",
	"./18.11.19.png": "./src/img/old-wipes/18.11.19.png",
	"./22.08.18.png": "./src/img/old-wipes/22.08.18.png",
	"./22.11.18.png": "./src/img/old-wipes/22.11.18.png",
	"./25.02.19.png": "./src/img/old-wipes/25.02.19.png",
	"./26.02.20.png": "./src/img/old-wipes/26.02.20.png",
	"./26.10.23.png": "./src/img/old-wipes/26.10.23.png"
};


function webpackContext(req) {
	var id = webpackContextResolve(req);
	return __webpack_require__(id);
}
function webpackContextResolve(req) {
	if(!__webpack_require__.o(map, req)) {
		var e = new Error("Cannot find module '" + req + "'");
		e.code = 'MODULE_NOT_FOUND';
		throw e;
	}
	return map[req];
}
webpackContext.keys = function webpackContextKeys() {
	return Object.keys(map);
};
webpackContext.resolve = webpackContextResolve;
module.exports = webpackContext;
webpackContext.id = "./src/img/old-wipes sync \\.png$";

/***/ }),

/***/ "./src/img/winamp sync \\.png$":
/*!**************************************************!*\
  !*** ./src/img/winamp/ sync nonrecursive \.png$ ***!
  \**************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

var map = {
	"./bg.png": "./src/img/winamp/bg.png",
	"./bg2.png": "./src/img/winamp/bg2.png",
	"./digits.png": "./src/img/winamp/digits.png",
	"./enableRadioBtn.png": "./src/img/winamp/enableRadioBtn.png",
	"./hr-slider-btn-small.png": "./src/img/winamp/hr-slider-btn-small.png",
	"./slider-btn.png": "./src/img/winamp/slider-btn.png"
};


function webpackContext(req) {
	var id = webpackContextResolve(req);
	return __webpack_require__(id);
}
function webpackContextResolve(req) {
	if(!__webpack_require__.o(map, req)) {
		var e = new Error("Cannot find module '" + req + "'");
		e.code = 'MODULE_NOT_FOUND';
		throw e;
	}
	return map[req];
}
webpackContext.keys = function webpackContextKeys() {
	return Object.keys(map);
};
webpackContext.resolve = webpackContextResolve;
module.exports = webpackContext;
webpackContext.id = "./src/img/winamp sync \\.png$";

/***/ }),

/***/ "./src/js/Bucket.js":
/*!**************************!*\
  !*** ./src/js/Bucket.js ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Bucket)
/* harmony export */ });
class Bucket{
    constructor(delay, max){
        this._allowance = 0;

        this.delay = delay;
        this.max = max;

        this.lastCheck = Date.now();
    }

    get allowance () {
        if(this.delay === 0) return Infinity;
        
        this._allowance += (Date.now() - this.lastCheck) / this.delay;

        this.lastCheck = Date.now();

        if(this._allowance > this.max) this._allowance = this.max;

        return this._allowance
    }

    set allowance(c){
        this._allowance = c;
    }

    spend(count){
        if(this.delay === 0) return true;

        let allow = this.allowance;

        if(allow < count) return false;

        this.allowance  = allow - count;

        return true
    }
}

/***/ }),

/***/ "./src/js/Chat.js":
/*!************************!*\
  !*** ./src/js/Chat.js ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__),
/* harmony export */   fixChatPosition: () => (/* binding */ fixChatPosition),
/* harmony export */   initChat: () => (/* binding */ initChat),
/* harmony export */   initMobileChatToggle: () => (/* binding */ initMobileChatToggle),
/* harmony export */   toggleChat: () => (/* binding */ toggleChat),
/* harmony export */   toggleEmojis: () => (/* binding */ toggleEmojis),
/* harmony export */   updateEmojis: () => (/* binding */ updateEmojis)
/* harmony export */ });
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./config */ "./src/js/config.js");
/* harmony import */ var _ui_elements__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./ui/elements */ "./src/js/ui/elements.js");
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./globals */ "./src/js/globals.js");
/* harmony import */ var _translate__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./translate */ "./src/js/translate.js");
/* harmony import */ var _utils_cssColorsList__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./utils/cssColorsList */ "./src/js/utils/cssColorsList.js");
/* harmony import */ var _utils_localStorage__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./utils/localStorage */ "./src/js/utils/localStorage.js");
/* harmony import */ var _utils_misc__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./utils/misc */ "./src/js/utils/misc.js");
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");








// currently chat supports only one channel
// but socket is designed to handle many

function pad(pad, str, padLeft) {
    if (typeof str === 'undefined')
        return pad;
    if (padLeft) {
        return (pad + str).slice(-pad.length);
    } else {
        return (str + pad).substring(0, pad.length);
    }
}

const colorRegEx = new RegExp(/\[(#?[A-Z0-9]{1,8})*?\]/gi);
// https : / / host.com/img .png       ? q=321123
const imgRegEx = new RegExp(/http?s:\/\/.+?\.(png|jpg|jpeg|gif)(\?\S+)?/i);
const goroxelsLinkRegEx = new RegExp(`^https?://${location.host}/.*`);

class Chat {
    constructor() {
        this.element = $('#chat');

        this.logElems = {};

        this.colorsEnabled = !JSON.parse((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_5__.getOrDefault)('disableColors', false));

        this.muted = JSON.parse((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_5__.getLS)('muted')) || [];

        this.channel = undefined;

        this.initChatEvents();
    }

    loadChannelElements() {
        [...$('#chatLog').children()].map(el => {
            let channel = el.dataset.channel;
            if (channel === 'local') {
                channel = _config__WEBPACK_IMPORTED_MODULE_0__.canvasName;
            }
            this.logElems[channel] = $(el);
        })
    }

    // mobile version of hide/show
    mobileShow() {
        this.element.css('top', '0');
    }

    mobileHide() {
        this.element.css('top', '-100vh');
    }

    setColors(state) {
        this.colorsEnabled = state;

        $('.chatColored').toggleClass('noColor', !state);
    }

    parseColors(str) {
        // colors should be formatted like: [RED]test or [#FF0000]te[]st

        let colorEntries = 0;

        let regIter = str.matchAll(colorRegEx);
        while (true) {
            let {
                value: entry,
                done
            } = regIter.next();
            if (done) break;

            let color = entry[1];

            if (color) {
                // test for "#" and mathing A-F a-f hex alphabet
                if (color.startsWith('#') && !/[G-Zg-z]/.test(color)) {
                    color = pad(color.slice(-1).repeat(6 + 1), color);
                } else if (!_utils_cssColorsList__WEBPACK_IMPORTED_MODULE_4__["default"][color]) continue;

                str = str.replace(entry[0],
                    `<div class="chatColored${this.colorsEnabled ? '' : ' noColor'}" style="color:${color}">`);
                colorEntries++;
            } else { // empty braces
                if (colorEntries > 0) {
                    str = str.replace(entry[0], '</div>');
                    colorEntries--;
                } else {
                    // "[" and "]"
                    str = str.replace(entry[0], '&#91;&#93;');
                }
            }
        }

        if (colorEntries > 0) str += '</div>'.repeat(colorEntries);

        return str
    }
    parseCoords(str) {
        return str.replace(/\((\d{1,5}), ?(\d{1,5})\)/g,
            `<a class="cordgo" onclick="camera.centerOn($1, $2)">$&</a>`)
    }
    parseImage(str) {
        let matching = str.match(imgRegEx);

        if (matching) {
            let src = matching[0];
            str = str.replace(src,
                `<span class="imageLink" onclick="globals.chat.toggleImage(this)">${src}</span>`)
        }

        return str
    }
    toggleImage(target) {
        const element = $(target);
        const parent = element.parent();

        const exists = !!$('img', parent).length;
        if (exists) {
            $('.imageLink', parent).css('cursor', 'zoom-in')
            $('img', parent).remove();
        } else {
            $('.imageLink', parent).css('cursor', 'zoom-out');
            const img = $(`<img src="${element.text()}" class="chatImg" onclick="globals.chat.toggleImage(this)">`);
            img.on('load', this.scroll.bind(this, this.channel));
            parent.append(img);
        }
    }
    parseGoroxelsLink(text) {
        const firstArg = text.split(' ')[0];
        if (!firstArg) return text;

        const match = text.match(goroxelsLinkRegEx);
        if (!match) return text;

        return text.replace(match[0], `<a href="${match[0]}">${match[0]}</a>`);
    }

    parseBB(str) {
        // function does not checks for brackets order validity
        let openedTags = [];

        let regIter = str.matchAll(/\[(\/?[bi])\]/gi);
        while (true) {
            let {
                value: entry,
                done
            } = regIter.next();
            if (done) break;

            let tag = entry[1];
            str = str.replace(entry[0],
                `<${tag}>`);
            if (!tag.startsWith('/'))
                openedTags.push(tag);
            else {
                openedTags = openedTags.splice(openedTags.indexOf(tag.slice(1)));
            }
        }

        while (openedTags.length) {
            str += `</${openedTags.shift()}>`
        }

        return str
    }

    addMessage(message) {
        $('.showChat').addClass('showChat-notify');
        $('.chatNotif').addClass('active');

        const channel = message.ch;

        if (message.server)
            return this.addServerMessage(message.msg, channel);

        let text = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_6__.htmlspecialchars)(message.msg),
            nick = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_6__.htmlspecialchars)(message.nick);

        const realNick = nick;

        if (nick === 'Goroh') {
            nick = `<span style="text-shadow:0 0 3px">[#0]${nick}</span>`
        }

        try {
            text = this.parseColors(text);
            text = this.parseBB(text);
            text = this.parseCoords(text);
            text = this.parseGoroxelsLink(text);
            text = this.parseImage(text);

            nick = this.parseColors(nick);
        } catch (e) {
            console.log(e);
        }

        const isMuted = ~this.muted.indexOf(realNick);

        const msgEl = $(
            `<div class="chatMessage" ${isMuted ? 'style="display:none"' : ''}>
            <div class="messageNick" data-nick="${realNick}">${nick}:</div>
            <div class="messageText">${text}</div>
        </div>`);

        $('.messageNick', msgEl).on('click', function () {
            const visibleNick = this.innerText.slice(0, -1);
            _ui_elements__WEBPACK_IMPORTED_MODULE_1__.chatInput[0].value += visibleNick + ', ';
            _ui_elements__WEBPACK_IMPORTED_MODULE_1__.chatInput.trigger('focus');
        })

        this.logElems[channel].append(msgEl);

        this.afterAddingMessage(channel);
    }

    addLocalMessage(text, channel) {
        text = this.parseColors(text);
        text = this.parseBB(text);
        text = this.parseCoords(text);
        text = this.parseGoroxelsLink(text);
        text = this.parseImage(text);

        const msgEl = $(
            `<div class="chatMessage">
                <div class="messageText">${text}</div>
            </div>`)

        this.logElems[channel].append(msgEl);

        this.afterAddingMessage(channel);
    }



    switchChannel(channel) {
        if (this.channel === channel) {
            return;
        }

        const channelAlias = channel;
        if (channel === 'local') {
            channel = _config__WEBPACK_IMPORTED_MODULE_0__.canvasName;
        }

        for (let ch of Object.values(this.logElems)) {
            ch.hide();
        }
        this.logElems[channel].show();

        $(`#chatChannels>div`).removeClass('selected');
        $(`#chatChannels>div[data-channel="${channelAlias}"]`).addClass('selected');

        this.scroll(channel, true);

        this.channel = channel;
    }

    addServerMessage(text, channel) {
        this.addLocalMessage(text, channel);
    }

    afterAddingMessage(channel) {
        const el = this.logElems[channel];
        if (el.children().length > _config__WEBPACK_IMPORTED_MODULE_0__.game.chatLimit) {
            el.children()[0].remove();
        }
        this.scroll(channel);
    }

    // handles messages to send
    handleMessage(message) {
        if (message.startsWith('/')) {
            this.handleCommand(message);
        } else {
            if (!_globals__WEBPACK_IMPORTED_MODULE_2__["default"].socket.connected) {
                _ui_elements__WEBPACK_IMPORTED_MODULE_1__.chatInput.val(message);
                return;
            }
            _globals__WEBPACK_IMPORTED_MODULE_2__["default"].socket.sendChatMessage(message, this.channel);
        }
    }

    sendWhisper(target, message) {
        _globals__WEBPACK_IMPORTED_MODULE_2__["default"].socket.sendChatWhisper(message, this.channel, target);
    }

    // handles chat commands
    handleCommand(command) {
        let args = command.split(' ');

        const cmd = args[0];
        args = args.slice(1);

        switch (cmd) {
            case '/mute': {
                const nick = args.join(' ');
                this.mute(nick);

                break
            }
            case '/unmute': {
                const nick = args.join(' ');
                this.unmute(nick);

                break
            }
            case '/w': {
                if (args.length < 2) {
                    return this.addLocalMessage('Usage: /w &lt;targetAccountId&gt; &lt;message&gt;');
                }
                const id = args[0];
                const msg = args.slice(1).join(' ');

                if (_globals__WEBPACK_IMPORTED_MODULE_2__["default"].socket.connected) {
                    this.sendWhisper(id, msg);
                    this.addLocalMessage(`${(0,_translate__WEBPACK_IMPORTED_MODULE_3__.translate)('chat.you')} -> id${id}: <i>${msg}</i>`, this.channel);
                    _ui_elements__WEBPACK_IMPORTED_MODULE_1__.chatInput.val(`/w ${id} `);
                }

                break
            }
            case '/help': {
                const commands =
                    `/mute ${(0,_translate__WEBPACK_IMPORTED_MODULE_3__.translate)('chat.muteDesc')}<br>` +
                    `/unmute ${(0,_translate__WEBPACK_IMPORTED_MODULE_3__.translate)('chat.unmuteDesc')}<br>` +
                    `/w ${(0,_translate__WEBPACK_IMPORTED_MODULE_3__.translate)('chat.wDesc')}`;

                this.addLocalMessage(commands, this.channel);
            }
        }
    }

    mute(nick) {
        const pref = '<b>mute:</b> ';

        if (!nick.length || nick.length > 32) {
            return this.addLocalMessage(pref + (0,_translate__WEBPACK_IMPORTED_MODULE_3__.translate)('Wrong nick length'))
        }
        if (~this.muted.indexOf(nick)) {
            return this.addLocalMessage(pref + (0,_translate__WEBPACK_IMPORTED_MODULE_3__.translate)('Player is already muted'))
        }

        this.muted.push(nick);
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_5__.setLS)('muted', JSON.stringify(this.muted));

        $('.messageNick').each((_, el) => {
            if (el.dataset.nick === nick) {
                el.parentElement.style.display = 'none';
            }
        })
    }

    unmute(nick) {
        let pref = '<b>unmute:</b> ', index;

        if (!nick.length || nick.length > 32) {
            return this.addLocalMessage(pref + (0,_translate__WEBPACK_IMPORTED_MODULE_3__.translate)('Wrong nick length'))
        }
        if (!~(index = this.muted.indexOf(nick))) {
            return this.addLocalMessage(pref + (0,_translate__WEBPACK_IMPORTED_MODULE_3__.translate)('Player is not muted'))
        }

        this.muted.splice(index, 1);
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_5__.setLS)('muted', JSON.stringify(this.muted));

        $('.messageNick').each((_, el) => {
            if (el.dataset.nick === nick) {
                el.parentElement.style.display = 'block';
            }
        })
    }

    initChatEvents() {
        _ui_elements__WEBPACK_IMPORTED_MODULE_1__.chatInput.on('input', () => {
            const value = _ui_elements__WEBPACK_IMPORTED_MODULE_1__.chatInput.val();
            if (imgRegEx.test(value) || goroxelsLinkRegEx.test(value)) {
                _ui_elements__WEBPACK_IMPORTED_MODULE_1__.chatInput.css('color', 'white');
            } else {
                _ui_elements__WEBPACK_IMPORTED_MODULE_1__.chatInput.css('color', '');
            }
        })
    }

    // this function scrolls only if player scrolled chat log to the end
    scroll(channel = 'global', force = false) {
        const el$ = this.logElems[channel];
        const el = el$.parent()[0];
        const lastElemHeight = el$.children().slice(-1).innerHeight() || 0;
        // 2 is message margin and 5 is just for fun
        const scrolled = (el.scrollHeight - el.scrollTop - el.clientHeight - lastElemHeight) <= 2 + 5;
        if (scrolled || force) {
            el.scrollBy(0, 999);
        }
    }
}

const chat = new Chat();

function initChat() {
    $(document).on('keydown', e => {
        if(_globals__WEBPACK_IMPORTED_MODULE_2__["default"].lockInputs) return;
        if (e.key !== 'Enter') return;

        if ($('#chatInput').is(':focus') || _globals__WEBPACK_IMPORTED_MODULE_2__["default"].mobile) {
            // send if focused
            const message = _ui_elements__WEBPACK_IMPORTED_MODULE_1__.chatInput.val();
            if (!message.length)
                return _ui_elements__WEBPACK_IMPORTED_MODULE_1__.chatInput.trigger('blur');

            _ui_elements__WEBPACK_IMPORTED_MODULE_1__.chatInput.val('');

            chat.handleMessage(message);
        } else {
            // or focus if not
            $('#chatInput').trigger('focus');
        }
    });

    $('#chatChannels>div').on('click', (e) => {
        const ch = e.target.dataset.channel;
        chat.switchChannel(ch);
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_5__.setLS)('chatChannel', ch);
    });

    (0,_config__WEBPACK_IMPORTED_MODULE_0__.resolveWhenConfigDownloaded)().then(() => {
        chat.loadChannelElements();
        chat.switchChannel((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_5__.getLS)('chatChannel') || 'global');
    })

    initChatHeightWorkaround();
}



function toggleChat() {
    $('.chatNotif').removeClass('active');

    if (_ui_elements__WEBPACK_IMPORTED_MODULE_1__.chat.css('display') === 'none') {
        _ui_elements__WEBPACK_IMPORTED_MODULE_1__.chat.show();
        _ui_elements__WEBPACK_IMPORTED_MODULE_1__.chat.css('left', '');

        $('.chatNotif').hide();
    } else {
        _ui_elements__WEBPACK_IMPORTED_MODULE_1__.chat.css('left', -_ui_elements__WEBPACK_IMPORTED_MODULE_1__.chat.width() - 30);
        setTimeout(() => _ui_elements__WEBPACK_IMPORTED_MODULE_1__.chat.hide(), 500);

        $('.chatNotif').show();
    }
}

function initMobileChatToggle() {
    $('.showChat').on('click', () => {
        $('.showChat').removeClass('showChat-notify');
        chat.mobileShow()
    });
    $('#hideChat').on('click', () => {
        $('.showChat').removeClass('showChat-notify');
        chat.mobileHide()
    });
}

function initChatHeightWorkaround() {
    // -webkit-fill-available does not work since
    // the best way to define height that i know 
    // for the moment is through the script

    function fixChatHeight() {
        document.documentElement.style.setProperty('--gorox-chat-height', $(window).height() + 'px');
    }

    $(window).on('resize', fixChatHeight);
    fixChatHeight();
}

function fixChatPosition() {
    const paletteHeight = $('#palette').innerHeight();
    $('#chat').css('bottom', paletteHeight + 4);
}

function toggleEmojis(state) {
    state ? $('#emotions').show() : $('#emotions').hide();
}

function updateEmojis(list) {
    const container = $('#emotions');
    let html = '';

    for (let el of list) {
        html += `<div class="emotion">${el}</div>`;
    }

    container.html(html);

    $('div', container).on('click', e => {
        $('#chatInput')[0].value += e.target.innerText;
        $('#chatInput').trigger('focus');
    })
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (_globals__WEBPACK_IMPORTED_MODULE_2__["default"].chat = chat);

/***/ }),

/***/ "./src/js/Chunk.js":
/*!*************************!*\
  !*** ./src/js/Chunk.js ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Chunk)
/* harmony export */ });
/* harmony import */ var _Pattern__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Pattern */ "./src/js/Pattern.js");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config */ "./src/js/config.js");
/* harmony import */ var _img_protectedPattern_png__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../img/protectedPattern.png */ "./src/img/protectedPattern.png");
/* harmony import */ var _utils_localStorage__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./utils/localStorage */ "./src/js/utils/localStorage.js");





class Chunk {
    constructor(x, y, buffer) {
        this.x = x;
        this.y = y;

        this.width = _config__WEBPACK_IMPORTED_MODULE_1__.chunkSize;
        this.height = _config__WEBPACK_IMPORTED_MODULE_1__.chunkSize;

        this.canvas = document.createElement('canvas');
        this.canvas.width = this.canvas.height = _config__WEBPACK_IMPORTED_MODULE_1__.chunkSize;

        this.ctx = this.canvas.getContext('2d');

        this.imgData = this.ctx.createImageData(_config__WEBPACK_IMPORTED_MODULE_1__.chunkSize, _config__WEBPACK_IMPORTED_MODULE_1__.chunkSize);
        this.view = new Uint32Array(this.imgData.data.buffer);

        // protected

        // chunksized means the canvas with sizes of the chunk, filled with "protected" pattern
        this.protectedPatternChunkSized = null;
        this._protectedPattern = new _Pattern__WEBPACK_IMPORTED_MODULE_0__["default"](_img_protectedPattern_png__WEBPACK_IMPORTED_MODULE_2__["default"]);
        this._protectedPattern.onload = () => {
            this.needRender = true;
            // pattern shift is an offset, to shift
            // the texture for current chunk, because it might not
            // be dividable by chunk size (pattern misjoint between chunks in result)
            const patternShift = [
                (this.x * this.width) % this._protectedPattern.canvas.width,
                (this.y * this.height) % this._protectedPattern.canvas.height
            ]

            if((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.getLS)('protectDebug') === '1'){
                const canv = this.protectedPatternChunkSized = document.createElement('canvas');
                canv.width = this.width; canv.height = this.height;
                const canvCtx = canv.getContext('2d');
                canvCtx.fillStyle = 'rgb(0,255,0)';
                canvCtx.fillRect(0, 0, this.width, this.height);
            }else{
                this.protectedPatternChunkSized = this._protectedPattern.createFilledCanvas(this.width, this.height, patternShift[0], patternShift[1]);
            }
        }

        this.pCanvas = document.createElement('canvas');
        this.pCanvas.width = this.pCanvas.height = _config__WEBPACK_IMPORTED_MODULE_1__.chunkSize;

        this.pCtx = this.pCanvas.getContext('2d');
        this.pImgData = this.pCtx.createImageData(_config__WEBPACK_IMPORTED_MODULE_1__.chunkSize, _config__WEBPACK_IMPORTED_MODULE_1__.chunkSize);
        this.pView = new Uint32Array(this.pImgData.data.buffer);

        this.needRender = true;

        this.fromBuffer(buffer);
    }

    render() {
        if (this.needRender) {
            this.needRender = false;
            this.ctx.putImageData(this.imgData, 0, 0);

            if (_config__WEBPACK_IMPORTED_MODULE_1__.game.showProtected) {
                if((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.getLS)('protectDebug') === '1'){
                    this.ctx.globalAlpha = 1;
                }else{
                    this.ctx.globalAlpha = 0.7;
                }

                this.pCtx.putImageData(this.pImgData, 0, 0);
                if(this.protectedPatternChunkSized !== null){
                    this.pCtx.globalCompositeOperation = 'source-in';
                    this.pCtx.drawImage(this.protectedPatternChunkSized, 0, 0);
                    this.pCtx.globalCompositeOperation = 'source-over'; // back to default
                }

                this.ctx.drawImage(this.pCanvas, 0, 0);

                this.ctx.globalAlpha = 1;
            }
        }
    }

    fromBuffer(buf) {
        let col, isProtected;
        for (let i = 0; i < buf.byteLength; i++) {
            col = buf[i];
            isProtected = col & 0x80;

            isProtected && (this.pView[i] = 0xFFFF0000);
            this.view[i] = _config__WEBPACK_IMPORTED_MODULE_1__.bgrPalette[col & 0x7F];
        }
    }

    get(x, y) {
        return this.view[x + y * _config__WEBPACK_IMPORTED_MODULE_1__.chunkSize]
    }

    set(x, y, c) {
        const i = x + y * _config__WEBPACK_IMPORTED_MODULE_1__.chunkSize

        this.view[i] = c;

        this.needRender = true;
    }

    setProtect(x, y, state) {
        const i = x + y * _config__WEBPACK_IMPORTED_MODULE_1__.chunkSize;
        this.pView[i] = state ? 0xFFFF0000 : 0;

        this.needRender = true;
    }

    getProtect(x, y) {
        const i = x + y * _config__WEBPACK_IMPORTED_MODULE_1__.chunkSize;
        return !!this.pView[i];
    }
}

/***/ }),

/***/ "./src/js/ChunkManager.js":
/*!********************************!*\
  !*** ./src/js/ChunkManager.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ ChunkManager)
/* harmony export */ });
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./globals */ "./src/js/globals.js");
/* harmony import */ var _Chunk__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Chunk */ "./src/js/Chunk.js");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./config */ "./src/js/config.js");
/* harmony import */ var _utils_conversions__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./utils/conversions */ "./src/js/utils/conversions.js");
/* harmony import */ var _TempChunkPlaceholder__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./TempChunkPlaceholder */ "./src/js/TempChunkPlaceholder.js");
/* harmony import */ var _utils_api__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./utils/api */ "./src/js/utils/api.js");
/* harmony import */ var _utils_localStorage__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./utils/localStorage */ "./src/js/utils/localStorage.js");
/* harmony import */ var _utils_camera__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./utils/camera */ "./src/js/utils/camera.js");









const CHUNK_LOADING_THREADS = 5;
const CHUNK_CACHE_NAME = 'chunks-cache-v1';
const cacheApiSupported = ('caches' in window);

class ChunkManager {
    constructor() {
        this.chunks = new Map();

        this.loadingChunks = new Set();

        this.checkQueue = [];
        this._checkInterval = null;
        this.checking = false;
        this.chunkHashes = null;

        // globals.socket.on('chunk', (cx, cy, cdata) => {
        //     let key = this.getChunkKey(cx, cy);
        //     if (this.loadingChunks.has(key)){
        //         this.loadingChunks.delete(key);
        //     }

        //     let chunk = new Chunk(cx, cy, cdata);
        //     this.chunks.set(key, chunk);

        //     globals.renderer.needRender = true;
        // })

        _globals__WEBPACK_IMPORTED_MODULE_0__["default"].socket.on('place', (x, y, col) => {
            this.setChunkPixel(x, y, col);

            _globals__WEBPACK_IMPORTED_MODULE_0__["default"].renderer.needRender = true;
        })

        _globals__WEBPACK_IMPORTED_MODULE_0__["default"].socket.on('protect', (x, y, state) => {
            this.setProtect(x, y, state);

            _globals__WEBPACK_IMPORTED_MODULE_0__["default"].renderer.needRender = true;
        });

        this.init();
    }

    init() {
        this.loadSavedChunkHashes();
        this.initCheckInterval();
    }

    loadSavedChunkHashes() {
        this.chunkHashes = JSON.parse((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_6__.getLS)(`chunkHashes`, true)) ?? {};
    }
    saveChunkHashes() {
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_6__.setLS)(`chunkHashes`, JSON.stringify(this.chunkHashes), true);
    }

    initCheckInterval() {
        this._checkInterval = setInterval(async () => {
            if (!this.checkQueue.length || this.checking) return;
            this.checking = true;

            // console.log(this.checkQueue.size);

            try {
                // converting to array to remove checked chunks
                const asArr = this.checkQueue//[...this.checkQueue];
                await this.checkChunks(asArr.splice(0, 32).map(this.fromChunkKey));

                // this.checkQueue = new Set(asArr);
            } finally {
                this.checking = false;
            }
        }, 1);
    }

    async checkChunks(chunkList) {
        // some chunks may not have hash
        let chunksListFinal = [];
        let hashList = [];
        for (let [cx, cy] of chunkList) {
            if (!(0,_utils_camera__WEBPACK_IMPORTED_MODULE_7__.isChunkVisible)(cx, cy)) continue;
            if (this.loadingChunks.has(this.getChunkKey(cx, cy))) continue;

            const hash = this.chunkHashes[`${cx},${cy}`];
            if (typeof hash === 'string' && hash.length >= 16) {
                // this is intentional: the array is flattened
                chunksListFinal.push(cx, cy);
                hashList.push(hash);
            } else {
                this.requestChunk(cx, cy);
            }
        }

        if (!hashList.length) return;

        const chunksFormatted = JSON.stringify(chunksListFinal);
        const hashesFormatted = JSON.stringify(hashList);

        const params = new URLSearchParams();
        params.set('canvas', _config__WEBPACK_IMPORTED_MODULE_2__.canvasId);
        params.set('chunks', chunksFormatted);
        params.set('hashes', hashesFormatted);

        const resp = await (0,_utils_api__WEBPACK_IMPORTED_MODULE_5__.apiRequest)(`/chunks/check?${params.toString()}`);

        const respData = await resp.json();
        if (respData.errors) return;

        if (!Array.isArray(respData)) {
            throw new Error('Server returned unknown shit: ' + respData);
        }

        for (let i = 0; i < chunksListFinal.length; i += 2) {
            const [cx, cy] = [chunksListFinal[i], chunksListFinal[i + 1]];

            const isActual = respData[i / 2];
            if (isActual) {
                this.loadChunkFromCache(cx, cy);
            } else {
                delete this.chunkHashes[`${cx},${cy}`];
                this.saveChunkHashes();

                this.requestChunk(cx, cy);
            }
        }
    }

    clearChunks() {
        this.chunks.clear();
    }

    getChunkKey(x, y) {
        return x << 16 | y
    }

    fromChunkKey(key) {
        return [
            key >> 16,
            key & 0xFFFF
        ]
    }

    reloadChunks(chunksToReload) {
        if (!chunksToReload) {
            this.clearChunks();
        } else {
            for (const { x: cx, y: cy } of chunksToReload) {
                this.chunks.delete(this.getChunkKey(cx, cy));
            }
        }
    }

    async requestChunk(x, y) {
        let key = this.getChunkKey(x, y);

        if (!this.loadingChunks.has(key) &&
            this.loadingChunks.size < CHUNK_LOADING_THREADS) {

            this.loadingChunks.add(key);

            try {
                const resp = await (0,_utils_api__WEBPACK_IMPORTED_MODULE_5__.apiRequest)(`/chunks/get?canvas=${_config__WEBPACK_IMPORTED_MODULE_2__.canvasId}&x=${x}&y=${y}`, {
                    credentials: 'omit'
                });

                const newHash = resp.headers.get('X-Compressed-Hash');
                if (newHash && cacheApiSupported) {
                    this.chunkHashes[`${x},${y}`] = newHash;
                    this.saveChunkHashes();

                    const cache = await caches.open(CHUNK_CACHE_NAME);
                    await cache.put(`${_config__WEBPACK_IMPORTED_MODULE_2__.canvasId}-${x}-${y}`, resp.clone());
                }

                // use pako only if chunk got from socket
                // const cdataCompressed = await resp.arrayBuffer();
                // const cdata = Pako.inflate(cdataCompressed);

                await this.loadChunkFromResp(x, y, resp);
            } finally {
                if (this.loadingChunks.has(key)) {
                    this.loadingChunks.delete(key);
                }
            }
            // globals.socket.requestChunk(x, y);
        }
    }

    async loadChunkFromCache(x, y) {
        const chunkKey = this.getChunkKey(x, y);
        if (this.loadingChunks.has(chunkKey)) return;

        this.loadingChunks.add(chunkKey);

        try {
            const cache = await caches.open(CHUNK_CACHE_NAME);
            const resp = await cache.match(`${_config__WEBPACK_IMPORTED_MODULE_2__.canvasId}-${x}-${y}`);
            if (!resp) {
                console.log('cache no match');
                delete this.chunkHashes[`${x},${y}`];
                this.saveChunkHashes();

                this.loadChunk(x, y);
                return;
            }

            await this.loadChunkFromResp(x, y, resp, true);

        } finally {
            this.loadingChunks.delete(chunkKey);
        }
    }

    async loadChunkFromResp(x, y, resp, cached = false) {
        const cdata = await resp.arrayBuffer();

        let chunk = new _Chunk__WEBPACK_IMPORTED_MODULE_1__["default"](x, y, new Uint8Array(cdata));
        this.chunks.set(this.getChunkKey(x, y), chunk);

        if (!cached) {
            chunk.render(); // workaround because TempChunkPlaceholder getting zeroes until chunk is rendered once
            new _TempChunkPlaceholder__WEBPACK_IMPORTED_MODULE_4__["default"](x, y).save(chunk.canvas);
        }

        _globals__WEBPACK_IMPORTED_MODULE_0__["default"].renderer.needRender = true;
    }

    loadChunk(x, y) {
        if (!cacheApiSupported) {
            // old method (threaded chunk queue)
            this.requestChunk(x, y);
            return;
        }

        // new method (bulk chunk check for updates)
        const chunkKey = this.getChunkKey(x, y);
        if (this.checkQueue.includes(chunkKey) || this.checking || this.loadingChunks.has(chunkKey)) {
            return;
        }

        this.checkQueue.push(this.getChunkKey(x, y));
    }

    clearLoadingChunks() {
        this.loadingChunks = new Set;
    }

    hasChunk(x, y) {
        let key = this.getChunkKey(x, y);

        return this.chunks.has(key);
    }

    getChunk(x, y) {
        let key = this.getChunkKey(x, y);

        if (!this.chunks.has(key)) {
            return 0
        }
        return this.chunks.get(key)
    }

    getChunkPixel(x, y) {
        let [cx, cy, offx, offy] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_3__.boardToChunk)(x, y);
        let chunk = this.getChunk(cx, cy);

        if (!chunk || x < 0 || y < 0) return -1

        let argb = chunk.get(offx, offy);

        return _config__WEBPACK_IMPORTED_MODULE_2__.argbToId[argb]
    }

    setChunkPixel(x, y, col) {
        let [cx, cy, offx, offy] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_3__.boardToChunk)(x, y);

        let key = this.getChunkKey(cx, cy);
        if (this.chunks.has(key)) {
            this.chunks.get(key).set(offx, offy, _config__WEBPACK_IMPORTED_MODULE_2__.bgrPalette[col])
        }
    }

    setProtect(x, y, state) {
        let [cx, cy, offx, offy] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_3__.boardToChunk)(x, y);

        let key = this.getChunkKey(cx, cy);
        if (this.chunks.has(key)) {
            this.chunks.get(key).setProtect(offx, offy, state)
        }
    }

    getProtect(x, y) {
        let [cx, cy, offx, offy] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_3__.boardToChunk)(x, y);
        let chunk = this.getChunk(cx, cy);
        if (!chunk) return -1

        return chunk.getProtect(offx, offy);
    }

    // for the screenshot function
    dumpAll() {
        const canvas = document.createElement('canvas');
        canvas.width = _config__WEBPACK_IMPORTED_MODULE_2__.boardWidth;
        canvas.height = _config__WEBPACK_IMPORTED_MODULE_2__.boardHeight;

        const ctx = canvas.getContext('2d');

        this.chunks.forEach(chunk => {
            if (!chunk.canvas) return;

            const offX = chunk.x * _config__WEBPACK_IMPORTED_MODULE_2__.chunkSize,
                offY = chunk.y * _config__WEBPACK_IMPORTED_MODULE_2__.chunkSize;

            ctx.drawImage(chunk.canvas, offX, offY)
        })
        return canvas
    }
}

/***/ }),

/***/ "./src/js/MiniWindow.js":
/*!******************************!*\
  !*** ./src/js/MiniWindow.js ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   SelectMiniWindow: () => (/* binding */ SelectMiniWindow),
/* harmony export */   "default": () => (/* binding */ MiniWindow)
/* harmony export */ });
/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! events */ "./node_modules/events/events.js");
/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(events__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _translate__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./translate */ "./src/js/translate.js");
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");



class MiniWindow extends (events__WEBPACK_IMPORTED_MODULE_0___default()){
    // 0=0 1=ok, 2=ok+cancel
    constructor(title='', closeButtons=1){
        super();

        this.title = title;

        this._closeButtons = closeButtons;

        this.element = null;
        this.bodyElement = null;

        this.closed = false;

        this._create();
    }

    _create(){
        const html = $(`
        <div class="miniWindow">
            <div class="miniWindowTitle">
                ${this.title}
            </div>
            <div class="miniWindowBody">
            </div>
            <div class="miniWindowButtons">
            </div>
        </div>
        `);

        const buttons = [];
        if(this._closeButtons >= 1){
            const okButton = $(`<button>${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('OK')}</button>`);
            okButton.on('click', this.buttonHandler.bind(this, 'ok'));
            buttons.push(okButton);
        }
        if(this._closeButtons >= 2){
            const cancelButton = $(`<button>${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('Cancel')}</button>`);
            cancelButton.on('click', this.buttonHandler.bind(this, 'cancel'));
            buttons.push(cancelButton);
        }
        
        buttons.forEach(b => $('.miniWindowButtons', html).append(b));

        this.element = html;
        this.bodyElement = $('.miniWindowBody', html);
    }

    buttonHandler(buttonName){
        const event = {
            _cancelledClose: false,
            cancelClose: function(){ this._cancelledClose = true }
        }

        switch(buttonName){
            case 'ok':
                this.emit('okClicked', event);
                break;
            case 'cancel':
                this.emit('cancelClicked', event);
        }

        if(!event._cancelledClose){
            this.close();
        }
    }

      center() {
        if (!this.element || this.closed) {
            return;
        }

        const $window = $(window);
        const windowWidth = $window.width();
        const windowHeight = $window.height();
        
        const elementWidth = this.element.outerWidth();
        const elementHeight = this.element.outerHeight();

        const left = Math.max(0, (windowWidth - elementWidth) / 2);
        const top = Math.max(0, (windowHeight - elementHeight) / 2);

        this.element.css({
            position: 'fixed',
            left: left + 'px',
            top: top + 'px',
            transform: 'none'
        });
    }

    close(){
        this.removeAllListeners();
        this.element.remove();
        this.closed = true;
    }
}

class SelectMiniWindow extends MiniWindow {
    constructor(selects, callback, title){
        if(!selects.length) throw new Error('no selects, no way to close the window!');

        super(title, 0);

        this.selects = selects;
        this.callback = callback;
        this._sel_create();
    }

    _sel_create(){
        for(const select of this.selects){
            const selectEl = $(`<button>${select.text}</button>`);
            selectEl.one('click', () => this.onChosen(select.id));

            this.bodyElement.append(selectEl);
        }
    }

    onChosen(id){
        this.close();

        this.callback(id);
    }
}

/***/ }),

/***/ "./src/js/Pattern.js":
/*!***************************!*\
  !*** ./src/js/Pattern.js ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Pattern)
/* harmony export */ });
class Pattern{
    constructor(url){
        this.url = url;
        this.loaded = false;

        this.canvas = null

        this._load()
    }

    _load(){
        const canvas = document.createElement('canvas');
        
        const img = new Image();
        img.src = this.url;

        img.onload = () => {
            canvas.width = img.width;
            canvas.height = img.height;

            canvas.getContext('2d').drawImage(img, 0, 0);

            this.canvas = canvas;

            this.loaded = true;
            this.onload();
        }
    }

    createFilledCanvas(width, height, offsetX, offsetY){
        const ctx = this.canvas.getContext('2d');
        const pattern = ctx.createPattern(this.canvas, 'repeat');

        const filledCanvas = document.createElement('canvas');
        filledCanvas.width = width;
        filledCanvas.height = height;

        const filledCtx = filledCanvas.getContext('2d');
        
        filledCtx.fillStyle = pattern;
        
        // this "save restore" shit is copied from stackoverflow
        // it's needed to actually shift the pattern
        filledCtx.save();
        filledCtx.translate(offsetX, offsetY);
        filledCtx.fillRect(-offsetX, -offsetY, width, height);
        filledCtx.restore();

        return filledCanvas;
    }

    onload(){}
}

/***/ }),

/***/ "./src/js/Renderer.js":
/*!****************************!*\
  !*** ./src/js/Renderer.js ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Renderer)
/* harmony export */ });
/* harmony import */ var _img_chunkPlaceholder_png__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../img/chunkPlaceholder.png */ "./src/img/chunkPlaceholder.png");
/* harmony import */ var _camera__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./camera */ "./src/js/camera.js");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./config */ "./src/js/config.js");
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./globals */ "./src/js/globals.js");
/* harmony import */ var _Pattern__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./Pattern */ "./src/js/Pattern.js");
/* harmony import */ var _utils_camera__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./utils/camera */ "./src/js/utils/camera.js");
/* harmony import */ var _utils_misc__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./utils/misc */ "./src/js/utils/misc.js");
/* harmony import */ var _template__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./template */ "./src/js/template.js");
/* harmony import */ var _utils_shapes__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./utils/shapes */ "./src/js/utils/shapes.js");
/* harmony import */ var _player__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./player */ "./src/js/player.js");
/* harmony import */ var _TempChunkPlaceholder__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./TempChunkPlaceholder */ "./src/js/TempChunkPlaceholder.js");












const isMobile = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_6__.insanelyLongMobileBrowserCheck)();


class Renderer {
    /**
     * 
     * @param {CanvasRenderingContext2D} ctx 
     */
    constructor(ctx) {
        this.ctx = ctx;
        this.canvas = this.ctx.canvas;

        this.chunkPlaceholderPattern = new _Pattern__WEBPACK_IMPORTED_MODULE_4__["default"](_img_chunkPlaceholder_png__WEBPACK_IMPORTED_MODULE_0__["default"]);
        this.chunkPlaceholderPattern.onload = () => {
            this.needRender = true;
        }
        this.chunkPreviews = {};

        this.needRender = true;

        this.preRendered = {
            brush: {
                canvas: undefined,
                ctx: undefined,
                imageData: undefined,

                circle: undefined,
            }
        }

        this.preRender();
    }

    preRender(){
        this.preRenderBrush();
    }

    preRenderBrush(){
        // TODO make it render only before brush used
        // because it renders on every zoom
        const size = _player__WEBPACK_IMPORTED_MODULE_9__["default"].brushSize,
            zoom = _camera__WEBPACK_IMPORTED_MODULE_1__["default"].zoom;
        
        if(zoom < 1) return

        const canvas = document.createElement('canvas');
        canvas.width = canvas.height = zoom*(size+1);
        const ctx = canvas.getContext('2d');
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;

        const r = size/2;

        const circle = _utils_shapes__WEBPACK_IMPORTED_MODULE_8__["default"].filledCircle(0, 0, r);
        let circleMatrix = [];
        for(let y = 0; y < size+1; y++){
            circleMatrix.push((new Array(size+1)).fill(0))
        }
        
        circle.forEach(([x, y]) => {
            circleMatrix[x+r][y+r] = 1;
        })
        
        ctx.beginPath();
        ctx.lineWidth = zoom / 4;
        ctx.strokeStyle = _config__WEBPACK_IMPORTED_MODULE_2__.hexPalette[_player__WEBPACK_IMPORTED_MODULE_9__["default"].color];
        ctx.lineCap = 'square';

        ctx.fillStyle = 'blue';

        for(let x = 0; x < size; x++){
            for(let y = 0; y < size; y++){
                if(isBound(x, y)) continue;

                let upper = isBound(x, y-1),
                    left = isBound(x - 1, y),
                    right = isBound(x + 1, y),
                    bottom = isBound(x, y + 1);

                if(upper){
                    ctx.moveTo(x*zoom, y*zoom);
                    ctx.lineTo((x+1)*zoom, y*zoom);
                }
                if(left){
                    ctx.moveTo(x*zoom, y*zoom);
                    ctx.lineTo(x*zoom, (y+1)*zoom);
                }
                if(right){
                    ctx.moveTo((x+1)*zoom, y*zoom);
                    ctx.lineTo((x+1)*zoom, (y+1)*zoom);
                }
                if(bottom){
                    ctx.moveTo((x+1)*zoom, (y+1)*zoom);
                    ctx.lineTo(x*zoom, (y+1)*zoom);
                }
            }
        }

        ctx.stroke();
        ctx.closePath();

        function isBound(x, y){
            // check is pixel opaque/out of array

            if(x < 0 || x >= size || y < 0 || y >= size) return true;

            return !circleMatrix[x][y];
        }

        this.preRendered.brush.canvas = canvas;
        this.preRendered.brush.ctx = canvas;
        this.preRendered.brush.imageData = canvas;
        this.preRendered.brush.circle = circle;
    }

    requestRender(){
        if(this.needRender){
            this.needRender = false;

            this.render()
        }

        _globals__WEBPACK_IMPORTED_MODULE_3__["default"].fxRenderer.render();
    }

    correctSmoothing(){
        if(isMobile) return;

        if (_camera__WEBPACK_IMPORTED_MODULE_1__["default"].zoom < 1) {
            this.ctx.imageSmoothingEnabled = true;
            this.ctx.canvas.style.imageRendering = 'auto'
        } else {
            this.ctx.imageSmoothingEnabled = false;
            this.ctx.canvas.style.imageRendering = 'pixelated'
        }
    }

    render() {
        // smooth when zoom < 1, pixelated otherwise
        this.correctSmoothing();

        let visibleChunks = (0,_utils_camera__WEBPACK_IMPORTED_MODULE_5__.getVisibleChunks)();

        // clear veiwport
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

        let camX = _camera__WEBPACK_IMPORTED_MODULE_1__["default"].x + _utils_misc__WEBPACK_IMPORTED_MODULE_6__.halfMap[0] - ((this.canvas.width >> 1) / _camera__WEBPACK_IMPORTED_MODULE_1__["default"].zoom);
        let camY = _camera__WEBPACK_IMPORTED_MODULE_1__["default"].y + _utils_misc__WEBPACK_IMPORTED_MODULE_6__.halfMap[1] - ((this.canvas.height >> 1) / _camera__WEBPACK_IMPORTED_MODULE_1__["default"].zoom);

        let zoom = _camera__WEBPACK_IMPORTED_MODULE_1__["default"].zoom;

        if(zoom === 1){
            // for Firefox, to render normally at least on zoom 1
            camX = Math.floor(camX)
            camY = Math.floor(camY)
        }

        this.ctx.save();
        this.ctx.translate(Math.floor(-camX*zoom), Math.floor(-camY*zoom));
        this.ctx.scale(zoom, zoom);

        visibleChunks.forEach(chunkCord => {
            let [cx, cy] = chunkCord;

            let offX = cx * _config__WEBPACK_IMPORTED_MODULE_2__.chunkSize;
            let offY = cy * _config__WEBPACK_IMPORTED_MODULE_2__.chunkSize;


            if (!_globals__WEBPACK_IMPORTED_MODULE_3__["default"].chunkManager.hasChunk(cx, cy)){
                _globals__WEBPACK_IMPORTED_MODULE_3__["default"].chunkManager.loadChunk(cx, cy);

                // search for chunk preview placeholder
                let chunkPreview = this.chunkPreviews[`${cx}-${cy}`];
                if(!chunkPreview){
                    // create one if not found (one-time op)
                    chunkPreview = this.chunkPreviews[`${cx}-${cy}`] = {
                        loaded: false,
                        data: null
                    };
                    new _TempChunkPlaceholder__WEBPACK_IMPORTED_MODULE_10__["default"](cx, cy).load().then(imgData => {
                        chunkPreview.data = imgData;
                        chunkPreview.loaded = true;
                        this.needRender = true;
                    });
                }else if (chunkPreview.loaded && chunkPreview.data !== null){
                    // or, render it if it's loaded and found in db
                    this.ctx.drawImage(chunkPreview.data, offX, offY, _config__WEBPACK_IMPORTED_MODULE_2__.chunkSize, _config__WEBPACK_IMPORTED_MODULE_2__.chunkSize);

                    // also render default placeholder over it, to clarify we are dealing with preview
                    if(this.chunkPlaceholderPattern.loaded){
                        this.ctx.globalAlpha = 0.5;
                        this.ctx.drawImage(this.chunkPlaceholderPattern.canvas, offX, offY, _config__WEBPACK_IMPORTED_MODULE_2__.chunkSize, _config__WEBPACK_IMPORTED_MODULE_2__.chunkSize);
                        this.ctx.globalAlpha = 1;
                    }
                }else {

                    // fallback to default placeholder if available
                    if(this.chunkPlaceholderPattern.loaded)
                        this.ctx.drawImage(this.chunkPlaceholderPattern.canvas, offX, offY, _config__WEBPACK_IMPORTED_MODULE_2__.chunkSize, _config__WEBPACK_IMPORTED_MODULE_2__.chunkSize);
                }

                return
            }
            
            const chunk = _globals__WEBPACK_IMPORTED_MODULE_3__["default"].chunkManager.getChunk(cx, cy);

            chunk.render();
            this.ctx.drawImage(chunk.ctx.canvas, offX, offY);
        });

        this.ctx.restore();
    }
}



/***/ }),

/***/ "./src/js/Socket.js":
/*!**************************!*\
  !*** ./src/js/Socket.js ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Socket)
/* harmony export */ });
/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! events */ "./node_modules/events/events.js");
/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(events__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var pako__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! pako */ "./node_modules/pako/index.js");
/* harmony import */ var pako__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(pako__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _protocol__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./protocol */ "./src/js/protocol.js");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./config */ "./src/js/config.js");
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./globals */ "./src/js/globals.js");
/* harmony import */ var _user__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./user */ "./src/js/user.js");
/* harmony import */ var _Chat__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./Chat */ "./src/js/Chat.js");
/* harmony import */ var _windows__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./windows */ "./src/js/windows.js");
/* harmony import */ var _Window__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./Window */ "./src/js/Window.js");
/* harmony import */ var _player__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./player */ "./src/js/player.js");
/* harmony import */ var _translate__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./translate */ "./src/js/translate.js");
/* harmony import */ var _utils_misc__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./utils/misc */ "./src/js/utils/misc.js");
/* provided dependency */ var toastr = __webpack_require__(/*! toastr */ "./node_modules/toastr/toastr.js");
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");














class Socket extends (events__WEBPACK_IMPORTED_MODULE_0___default()) {
    constructor(port) {
        super();

        const scheme = location.protocol.startsWith('https') ? 'wss' : 'ws';
        const host = location.hostname || 'localhost';
        this.url = `${scheme}://${host}:${port}`;

        this.pendingPixels = {};

        this.connectedOnce = false;

        this.reconnectFactor = 1;

        this.connect();
    }

    get connected() {
        return this.socket && this.socket.readyState === WebSocket.OPEN
    }

    connect() {
        this.socket = new WebSocket(this.url);
        this.socket.binaryType = 'arraybuffer';

        this.socket.onopen = () => {
            this.sendChatSubscribe('global', this.connectedOnce);
            this.sendChatSubscribe(_config__WEBPACK_IMPORTED_MODULE_3__.canvasName, this.connectedOnce);
            this.sendCanvas(_config__WEBPACK_IMPORTED_MODULE_3__.canvasId);

            this.emit('opened');
            console.log('Socket has been connected');

            if (!this.connectedOnce) this.connectedOnce = true;
        }

        this.socket.onmessage = this.onmessage.bind(this);

        this.socket.onclose = () => {
            this.emit('closed');
            Object.values(_globals__WEBPACK_IMPORTED_MODULE_4__["default"].users).forEach(u => u.close(u.id));
            _globals__WEBPACK_IMPORTED_MODULE_4__["default"].users = {};

            _globals__WEBPACK_IMPORTED_MODULE_4__["default"].chunkManager.clearLoadingChunks();

            const reconnectDelay = Math.min(this.reconnectFactor * 1000 - Math.random() * 1000, 60_000);
            setTimeout(() => {
                console.log('reconnect');
                this.reconnect();
                this.reconnectFactor *= 1.5;
            }, reconnectDelay);
        }
    }

    close() {
        this.socket.close();
    }

    reconnect() {
        this.socket.onmessage = null;
        this.socket.onopen = null;
        this.socket.onclose = null;

        this.connect();
    }

    onmessage({
        data: message
    }) {
        if (typeof message === 'string') {
            this.onStringMessage(message);
        } else {
            // must be ping
            if (!message.byteLength) return;

            this.onBinaryMessage(message);
        }
    }

    onStringMessage(msg) {
        let decoded;
        try {
            decoded = JSON.parse(msg);
        } catch (e) {
            console.log('onStringMessage message decoding error: ' + e, 'message: ' + msg);
            return
        }

        switch (decoded.c) {
            case _protocol__WEBPACK_IMPORTED_MODULE_2__.STRING_OPCODES.userJoin: {
                const {
                    nick: name,
                    userId,
                    id,
                    registered,
                    role
                } = decoded;

                let sameUser;
                if (name) {
                    sameUser = Object.values(_globals__WEBPACK_IMPORTED_MODULE_4__["default"].users).find(u => u.name === name);
                }

                if (sameUser) {
                    _globals__WEBPACK_IMPORTED_MODULE_4__["default"].users[id] = sameUser;
                    sameUser.newConnection(id);
                } else {
                    const user = _globals__WEBPACK_IMPORTED_MODULE_4__["default"].users[id] = new _user__WEBPACK_IMPORTED_MODULE_5__["default"](name, id, userId, registered, role);
                    user.loadBadges()
                        .then(user.updateBadges.bind(user))
                        .catch(e => console.error('failed to load badges', e));
                }

                break
            }

            case _protocol__WEBPACK_IMPORTED_MODULE_2__.STRING_OPCODES.userLeave: {
                const id = decoded.id;

                if (_globals__WEBPACK_IMPORTED_MODULE_4__["default"].users[id]) _globals__WEBPACK_IMPORTED_MODULE_4__["default"].users[id].close(id);

                break
            }

            case _protocol__WEBPACK_IMPORTED_MODULE_2__.STRING_OPCODES.error: {
                decoded.errors.forEach(error => {
                    if (error === 'error.captcha') {
                        if (!_Window__WEBPACK_IMPORTED_MODULE_8__["default"].Exists('Captcha'))
                            (0,_windows__WEBPACK_IMPORTED_MODULE_7__.captchaModal)();
                    }
                    let msg;
                    if (typeof error === 'object') {
                        msg = (0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('socketErr.' + error.msg) + error.data ?? '';
                    } else {
                        msg = (0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('socketErr.' + error);
                    }
                    toastr.error(msg, (0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('Error from the Socket:'), {
                        preventDuplicates: true,
                        timeOut: 30000,
                    });
                });

                break;
            }

            case _protocol__WEBPACK_IMPORTED_MODULE_2__.STRING_OPCODES.chatMessage: {
                _Chat__WEBPACK_IMPORTED_MODULE_6__["default"].addMessage(decoded)

                break
            }

            case _protocol__WEBPACK_IMPORTED_MODULE_2__.STRING_OPCODES.alert: {
                // todo  
                if (decoded.type === 0) {
                    toastr.info(decoded.msg, 'ALERT', {
                        timeOut: 1000 * 60 * 5,
                        extendedTimeOut: 1000 * 60 * 5
                    });
                } else {
                    const safeMsg = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_11__.htmlspecialchars)(decoded.msg);
                    const m = new _Window__WEBPACK_IMPORTED_MODULE_8__.Modal;
                    m.init();
                    const mBody = $(
                        `<div style="margin:0;padding:5px;text-align:center;">
                            <h1>ADMIN:</h1>
                            <p>${safeMsg}</p>
                            <button style="padding: 8px;">OK</button>
                        </div>`)
                    m.contEl.appendChild(mBody[0]);

                    $('button', mBody).on('click', () => {
                        m.close();
                    });
                }
                break
            }

            case _protocol__WEBPACK_IMPORTED_MODULE_2__.STRING_OPCODES.me: {
                _player__WEBPACK_IMPORTED_MODULE_9__["default"].id = decoded.id;
                break
            }

            case _protocol__WEBPACK_IMPORTED_MODULE_2__.STRING_OPCODES.reload: {
                location.reload();
                break
            }

            case _protocol__WEBPACK_IMPORTED_MODULE_2__.STRING_OPCODES.reloadChunks: {
                const toReload = decoded.chunks;
                _globals__WEBPACK_IMPORTED_MODULE_4__["default"].chunkManager.reloadChunks(toReload);
                break
            }
        }
    }

    onBinaryMessage(msg) {
        const dv = new DataView(msg);

        switch (dv.getUint8(0)) {
            case _protocol__WEBPACK_IMPORTED_MODULE_2__.OPCODES.captcha: {
                (0,_windows__WEBPACK_IMPORTED_MODULE_7__.captchaModal)();
                break
            }
            case _protocol__WEBPACK_IMPORTED_MODULE_2__.OPCODES.chunk: {
                const cx = dv.getUint8(1);
                const cy = dv.getUint8(2);

                const chunkData = pako__WEBPACK_IMPORTED_MODULE_1___default().inflate(dv.buffer.slice(3));

                this.emit('chunk', cx, cy, chunkData);

                break
            }

            case _protocol__WEBPACK_IMPORTED_MODULE_2__.OPCODES.place: {
                const x = dv.getUint16(1);
                const y = dv.getUint16(3);
                const col = dv.getUint8(5);

                const id = dv.getUint32(5);

                this.onIncomingPixel([x, y, col], id);
                break
            }

            case _protocol__WEBPACK_IMPORTED_MODULE_2__.OPCODES.online: {
                const count = dv.getUint16(1);

                this.emit('online', count);
                break
            }

            case _protocol__WEBPACK_IMPORTED_MODULE_2__.OPCODES.pixels: {
                const isProtect = !!dv.getUint8(1),
                    uid = dv.getUint32(2, false);
                let x, y, col;
                for (let i = 6; i < dv.byteLength; i += 5) {
                    x = dv.getUint16(i);
                    y = dv.getUint16(i + 2);
                    col = dv.getUint8(i + 4);

                    if (col > _config__WEBPACK_IMPORTED_MODULE_3__.palette.length) continue;

                    if (isProtect) {
                        this.emit('protect', x, y, col);
                    } else {
                        this.emit('place', x, y, col, uid);
                    }
                }

                const user = _globals__WEBPACK_IMPORTED_MODULE_4__["default"].users[uid];
                if (user) user.updateCoords(col, x, y);

                break
            }

            case _protocol__WEBPACK_IMPORTED_MODULE_2__.OPCODES.ping: {
                this.reconnectFactor = 1;

                this.socket.send(new Uint8Array([_protocol__WEBPACK_IMPORTED_MODULE_2__.OPCODES.ping]));
                break
            }

            case _protocol__WEBPACK_IMPORTED_MODULE_2__.OPCODES.placeBatch: {
                const PIXEL_LENGTH = 9;

                const totalPixels = (dv.byteLength - 1) / PIXEL_LENGTH;
                if (totalPixels % 1 !== 0) {
                    console.warn('TotalPixels length is not integer');
                }

                for (let off = 1; off < dv.byteLength; off += PIXEL_LENGTH) {
                    const x = dv.getUint16(off);
                    const y = dv.getUint16(off + 2);
                    const c = dv.getUint8(off + 4);
                    const placerId = dv.getUint32(off + 5);

                    if (c > _config__WEBPACK_IMPORTED_MODULE_3__.palette.length) continue;

                    this.onIncomingPixel([x, y, c], placerId);
                }
                break
            }

            case _protocol__WEBPACK_IMPORTED_MODULE_2__.OPCODES.updateRadio: {
                const type = dv.getUint8(1);
                this.emit('radio', type);
                break
            }
        }
    }

    onIncomingPixel([x, y, col], id) {
        const user = _globals__WEBPACK_IMPORTED_MODULE_4__["default"].users[id];
        if (user) user.updateCoords(col, x, y);

        const key = x + ',' + y;
        let timeout = this.pendingPixels[key];
        if (timeout) {
            clearTimeout(timeout);
            delete this.pendingPixels[key];
        }

        this.emit('place', x, y, col, id);

        // does not work, id is not player id
        if (id === _player__WEBPACK_IMPORTED_MODULE_9__["default"].id)
            (0,_player__WEBPACK_IMPORTED_MODULE_9__.updatePlaced)(_player__WEBPACK_IMPORTED_MODULE_9__["default"].placedCount++);
    }

    requestChunk(x, y) {
        let dv = new DataView(new ArrayBuffer(1 + 1 + 1));
        dv.setUint8(0, _protocol__WEBPACK_IMPORTED_MODULE_2__.OPCODES.chunk);
        dv.setUint8(1, x);
        dv.setUint8(2, y);

        this.socket.send(dv.buffer)
    }

    sendPixel(x, y, c) {
        let dv = new DataView(new ArrayBuffer(1 + 5))

        dv.setUint8(0, _protocol__WEBPACK_IMPORTED_MODULE_2__.OPCODES.place);
        dv.setUint16(1, x);
        dv.setUint16(3, y);
        dv.setUint8(5, c);

        this.socket.send(dv.buffer);
    }

    sendPixels(pixels, isProtect = false) {
        let dv = new DataView(new ArrayBuffer(6 + pixels.length * 5))

        dv.setUint8(0, _protocol__WEBPACK_IMPORTED_MODULE_2__.OPCODES.pixels);
        dv.setUint8(1, isProtect ? 1 : 0); // isProtect
        for (let i = 0; i < pixels.length; i++) {
            let offset = i * 5 + 6;
            const [x, y, col] = pixels[i];

            dv.setUint16(offset, x);
            dv.setUint16(offset + 2, y);
            dv.setUint8(offset + 4, col);
        }

        this.socket.send(dv.buffer)
    }

    sendCanvas(id) {
        const dv = new DataView(new ArrayBuffer(2));
        dv.setUint8(0, _protocol__WEBPACK_IMPORTED_MODULE_2__.OPCODES.canvas);
        dv.setUint8(1, id);

        this.socket.send(dv.buffer);
    }

    sendChatSubscribe(channel, isReconnect) {
        const packet = {
            c: _protocol__WEBPACK_IMPORTED_MODULE_2__.STRING_OPCODES.subscribeChat,
            ch: channel,
            reconnect: isReconnect
        }

        this.socket.send(JSON.stringify(packet));
    }

    sendChatMessage(text, channel, whisper = false) {
        const packet = {
            c: _protocol__WEBPACK_IMPORTED_MODULE_2__.STRING_OPCODES.chatMessage,
            msg: text,
            ch: channel
        }

        if (whisper) packet.whisper = whisper;

        this.socket.send(JSON.stringify(packet));
    }

    sendChatWhisper(text, channel, whisperId) {
        return this.sendChatMessage(text, channel, whisperId);
    }

    sendAlert(to, text, isModal = false) {
        const packet = {
            c: _protocol__WEBPACK_IMPORTED_MODULE_2__.STRING_OPCODES.alert,
            to,
            msg: text,
            type: isModal ? 1 : 0
        }

        this.socket.send(JSON.stringify(packet));
    }
}

/***/ }),

/***/ "./src/js/TempChunkPlaceholder.js":
/*!****************************************!*\
  !*** ./src/js/TempChunkPlaceholder.js ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ TempChunkPlaceholder)
/* harmony export */ });
/* harmony import */ var _config_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./config.js */ "./src/js/config.js");
/* harmony import */ var _indexedDb_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./indexedDb.js */ "./src/js/indexedDb.js");
/* harmony import */ var _utils_misc__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./utils/misc */ "./src/js/utils/misc.js");
// this class is for loading/getting saved chunk placeholder,
// based on the previous loaded chunk image





class TempChunkPlaceholder {
    constructor(chunkX, chunkY) {
        this.x = chunkX;
        this.y = chunkY;
    }

    // load from localStorage
    async load() {
        return new Promise((res, rej) => {
            const dbKey = `${_config_js__WEBPACK_IMPORTED_MODULE_0__.canvasId}-${this.x}-${this.y}`;
            _indexedDb_js__WEBPACK_IMPORTED_MODULE_1__.addInitCallback(async () => {
                try {
                    const chunkData = await this._loadFromDb(dbKey);
                    const chunkCanvas = this._fromData(chunkData);

                    res(chunkCanvas);
                } catch (error) {
                    rej(error);
                }
            })
        })
    }

    async _loadFromDb(dbKey) {
        return new Promise((res, rej) => {
            let transaction = _indexedDb_js__WEBPACK_IMPORTED_MODULE_1__.database.transaction("chunkPlaceholders", "readonly");

            let request = transaction.objectStore("chunkPlaceholders").get(dbKey);
    
            request.onsuccess = function () {
                const chunk = request.result;

                if(chunk === undefined) return res(null);
                return res(chunk);
            };
    
            request.onerror = function (event) {
                rej(request.error);
            };
    
            transaction.onabort = function () {
                rej(request.error);
            };
        })
    }

    _fromData(savedChunk){
        const canvas = document.createElement('canvas');

        if(savedChunk){
            canvas.width = savedChunk.width;
            canvas.height = savedChunk.height;
    
            const ctx = canvas.getContext('2d');
            
            const imageData = ctx.createImageData(canvas.width, canvas.height);
            imageData.data.set(savedChunk.data);
    
            ctx.putImageData(imageData, 0, 0);
        }

        return (0,_utils_misc__WEBPACK_IMPORTED_MODULE_2__.resizeCanvas)(canvas, _config_js__WEBPACK_IMPORTED_MODULE_0__.chunkSize, _config_js__WEBPACK_IMPORTED_MODULE_0__.chunkSize);
    }

    async save(chunkCanvas){
        return new Promise((res, rej) => {
            const dbKey = `${_config_js__WEBPACK_IMPORTED_MODULE_0__.canvasId}-${this.x}-${this.y}`;
            _indexedDb_js__WEBPACK_IMPORTED_MODULE_1__.addInitCallback(async () => {
                try {
                    await this._saveToDb(dbKey, chunkCanvas);

                    res();
                } catch (error) {
                    rej(error);
                }
            })
        })
    }

    async _saveToDb(dbKey, chunkCanvas){
        return new Promise((res, rej) => {
            // 50x50 is hardcoded size for all previews
            const resizedChunkCanvas = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_2__.resizeCanvas)(chunkCanvas, 50, 50);
            const resizedImgData = resizedChunkCanvas.getContext('2d').getImageData(0, 0, 50, 50);

            let transaction = _indexedDb_js__WEBPACK_IMPORTED_MODULE_1__.database.transaction("chunkPlaceholders", "readwrite");

            let request = transaction.objectStore("chunkPlaceholders").put({
                'chunk_key': dbKey,

                width: resizedImgData.width,
                height: resizedImgData.height,
                data: resizedImgData.data,
            });
    
            request.onsuccess = function () {
                res();
            };
    
            request.onerror = function (event) {
                rej(request.error);
            };
    
            transaction.onabort = function () {
                rej(request.error);
            };
        })
    }
}

/***/ }),

/***/ "./src/js/Tool.js":
/*!************************!*\
  !*** ./src/js/Tool.js ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Tool)
/* harmony export */ });
/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! events */ "./node_modules/events/events.js");
/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(events__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./constants */ "./src/js/constants.js");



class Tool extends (events__WEBPACK_IMPORTED_MODULE_0___default()){
    constructor(name, defaultKey=null, iconURL=null, minRole=_constants__WEBPACK_IMPORTED_MODULE_1__.ROLE.GUEST){
        super();

        this.name = name;
        this.icon = iconURL;

        this.defaultKey = defaultKey;
        this.key = defaultKey ? defaultKey.toString() : undefined;

        this.requiredRole = minRole;
    }
}

/***/ }),

/***/ "./src/js/ToolManager.js":
/*!*******************************!*\
  !*** ./src/js/ToolManager.js ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ ToolManager)
/* harmony export */ });
/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! events */ "./node_modules/events/events.js");
/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(events__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./globals */ "./src/js/globals.js");
/* harmony import */ var _tools__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./tools */ "./src/js/tools.js");
/* harmony import */ var _camera__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./camera */ "./src/js/camera.js");
/* harmony import */ var _player__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./player */ "./src/js/player.js");
/* harmony import */ var _utils_conversions__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./utils/conversions */ "./src/js/utils/conversions.js");
/* harmony import */ var _utils_misc__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./utils/misc */ "./src/js/utils/misc.js");
/* harmony import */ var _utils_localStorage__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./utils/localStorage */ "./src/js/utils/localStorage.js");
/* harmony import */ var _me__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./me */ "./src/js/me.js");
/* harmony import */ var _ui_elements__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./ui/elements */ "./src/js/ui/elements.js");
/* harmony import */ var _img_arrow_svg__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../img/arrow.svg */ "./src/img/arrow.svg");
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* provided dependency */ var toastr = __webpack_require__(/*! toastr */ "./node_modules/toastr/toastr.js");













const coords = _ui_elements__WEBPACK_IMPORTED_MODULE_9__.coords[0];

function updatePlayerCoords(clientX, clientY) {
    let [newX, newY] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_5__.screenToBoardSpace)(clientX, clientY);

    if (newX === _player__WEBPACK_IMPORTED_MODULE_4__["default"].x && newY === _player__WEBPACK_IMPORTED_MODULE_4__["default"].y) {
        return
    }

    _player__WEBPACK_IMPORTED_MODULE_4__["default"].x = newX;
    _player__WEBPACK_IMPORTED_MODULE_4__["default"].y = newY;

    coords.innerText = `(${_player__WEBPACK_IMPORTED_MODULE_4__["default"].x}, ${_player__WEBPACK_IMPORTED_MODULE_4__["default"].y})`

    if (_player__WEBPACK_IMPORTED_MODULE_4__["default"].color != -1 && _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom > 1)
        _globals__WEBPACK_IMPORTED_MODULE_1__["default"].renderer.needRender = true;
}

const isMobile = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_6__.insanelyLongMobileBrowserCheck)();

class ToolManager extends (events__WEBPACK_IMPORTED_MODULE_0___default()) {
    constructor() {
        super();

        this.tools = _tools__WEBPACK_IMPORTED_MODULE_2__["default"];
        this.tool = _tools__WEBPACK_IMPORTED_MODULE_2__["default"].mover;

        this._keyBinds = {};
        this._colorBinds = {};
        this.activeTools = {};

        this.addTools();
        this.loadBinds();
        this.initEvents();

        this.ctrlDown = false;
        this.altDown = false;

        this.toolChangeBlocked = false;

        _me__WEBPACK_IMPORTED_MODULE_8__["default"].callOnLoaded(this.filterTools.bind(this));
    }

    filterTools() {
        Object.keys(this.tools).forEach(name => {
            if (this.tools[name].requiredRole > _me__WEBPACK_IMPORTED_MODULE_8__["default"].role) {
                delete this._keyBinds[this.tools[name].key];

                if (isMobile) {
                    $(`#tool_${name}`).remove();
                }
            }
        })
    }

    addTools() {
        const toolsEl = document.getElementById('tools');
        let hiddenToolsEl = null;

        Object.keys(this.tools).forEach(name => {
            const tool = this.tools[name];

            if (isMobile) {
                if (!tool.icon) return;

                let el = document.createElement('div');
                el.classList = 'toolContainer';
                el.id = `tool_${name}`;
                let img = document.createElement('img');
                img.className = 'toolIcon';
                img.src = tool.icon;

                el.appendChild(img);

                if(toolsEl.childElementCount >= 5){
                    if(!hiddenToolsEl){
                        hiddenToolsEl = document.createElement('div');
                        hiddenToolsEl.style.display = 'none';

                        const showAllButton = document.createElement('div');
                        showAllButton.className = 'showAllToolsButton';
                        const showAllImg = document.createElement('img');
                        showAllImg.src = _img_arrow_svg__WEBPACK_IMPORTED_MODULE_10__["default"];

                        showAllButton.append(showAllImg);

                        showAllButton.addEventListener('click', e => {
                            const state = parseInt(showAllButton.dataset.state ?? 0);
                            hiddenToolsEl.style.display = state ? 'none' : '';
                            showAllImg.style.transform = state ? '' : 'rotate(180deg)';
                            showAllButton.dataset.state = state ? '0' : '1';
                        });

                        toolsEl.append(hiddenToolsEl, showAllButton);
                    }

                    hiddenToolsEl.append(el);
                }else{
                    toolsEl.appendChild(el);
                }

                el.addEventListener('pointerdown', this.selectTool.bind(this, tool));

                if (tool.name === 'mover')
                    this.selectTool(tool);
            } else {
                if (_player__WEBPACK_IMPORTED_MODULE_4__["default"])
                    this._keyBinds[tool.key] = tool;
            }
        })
    }

    getToolKey(tool) {
        for (const [key, value] of Object.entries(this.tools)) {
            if (tool === value) return key;
        }

        return null;
    }

    selectTool(tool) {
        if (this.toolChangeBlocked) return;

        let oldToolEl = document.getElementsByClassName('toolContainer selected')[0]
        if (oldToolEl)
            oldToolEl.className = 'toolContainer';

        const toolKey = this.getToolKey(tool);
        const curToolEl = document.getElementById(`tool_${toolKey}`);
        curToolEl.classList = ['toolContainer selected'];

        this.tool.emit('deselected');
        this.tool = tool;
        this.tool.emit('selected');
    }

    blockToolChange() {
        this.toolChangeBlocked = true;
    }

    unblockToolChange() {
        this.toolChangeBlocked = false;
    }

    initEvents() {
        let em = _globals__WEBPACK_IMPORTED_MODULE_1__["default"].eventManager;

        if (isMobile) {
            em.on('zoom', zoom => {
                _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom *= zoom + 1;
                _camera__WEBPACK_IMPORTED_MODULE_3__["default"].checkZoom();
                _globals__WEBPACK_IMPORTED_MODULE_1__["default"].renderer.needRender = true;
                _globals__WEBPACK_IMPORTED_MODULE_1__["default"].fxRenderer.needRender = true;
            });

            em.on('mousedown', e => {
                updatePlayerCoords(e.clientX, e.clientY);
            });

            em.on('mousemove', e => {
                updatePlayerCoords(e.clientX, e.clientY);
            });

            let events = [
                ['mousedown', 'down'],
                ['mousemove', 'move'],
                ['mouseup', 'up']
            ];

            events.forEach(event => {
                const [realEvent, myEvent] = event;
                em.on(realEvent, e => {
                    let tool = this.tool;
                    if (e && e.gesture) {
                        this.tool.emit('_gesture');
                        tool = this.tools.mover;
                    }
                    if (!tool) return

                    // emit to selected tool
                    tool.emit(myEvent, e);
                    // emit to other subscribers
                    this.emit(myEvent, e);
                });
            });
        } else {
            em.on('mouseup', e => {
                // if (e.button === 2) {
                //     player.switchColor(-1);
                //     player.switchSecondColor(-1);
                // }
            });
            em.on('mousemove', e => {
                updatePlayerCoords(e.clientX, e.clientY);

                this.tool.emit('move', e)
                this.emit('move', e);
            });

            const keydown = (e) => {
                if(_globals__WEBPACK_IMPORTED_MODULE_1__["default"].lockInputs) return;

                let str = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_6__.stringifyKeyEvent)(e);
                if (!str) return;

                const tool = this._keyBinds[str];

                if (tool) {
                    // TODO
                    this.tool = tool; // , 
                    // ?   mousemove  down
                    //    up
                    tool.emit('down', e);
                }
            }
            em.on('keydown', keydown);
            em.on('mousedown', keydown);


            const keyup = (e) => {
                if(_globals__WEBPACK_IMPORTED_MODULE_1__["default"].lockInputs) return;

                let strEvKey = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_6__.stringifyKeyEvent)(e);
                if (!strEvKey) return;

                const tool = this._keyBinds[strEvKey];

                for (let name of Object.keys(this.tools)) {
                    const tool2 = this.tools[name];

                    if (!tool2.key || tool2 === tool)
                        continue;

                    const tool2keyDecoded = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_6__.decodeKey)(tool2.key);

                    if (strEvKey === tool2.key || 
                        // make up event on single Alt, because after that keyup on the 
                        // primary key will no longer match the tool key string (i.e. up="V" vs key="ALT+V")
                        
                        (strEvKey.startsWith('Alt') && tool2keyDecoded.alt) || 
                        (strEvKey.startsWith('Ctrl') && tool2keyDecoded.ctrl)) {
                            tool2.emit('up', e)
                        }
                }

                if (tool) {
                    e.preventDefault();
                    e.stopPropagation();

                    tool.emit('up', e);
                }
            }
            em.on('keyup', keyup);
            em.on('mouseup', keyup);

            em.on('wheel', e => {
                const oldZoom = _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom;
                _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoomTo(e.deltaY);

                const dx = e.clientX - window.innerWidth / 2;
                const dy = e.clientY - window.innerHeight / 2;

                _camera__WEBPACK_IMPORTED_MODULE_3__["default"].moveTo((dx / oldZoom), (dy / oldZoom));
                _camera__WEBPACK_IMPORTED_MODULE_3__["default"].moveTo(-(dx / _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom), -(dy / _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom));

                if (localStorage.getItem('iHaveProblems') === 'yes') {
                    _camera__WEBPACK_IMPORTED_MODULE_3__["default"].x = Math.round(_camera__WEBPACK_IMPORTED_MODULE_3__["default"].x); _camera__WEBPACK_IMPORTED_MODULE_3__["default"].y = Math.round(_camera__WEBPACK_IMPORTED_MODULE_3__["default"].y);
                    _globals__WEBPACK_IMPORTED_MODULE_1__["default"].renderer.needRender = true;
                }
            });
        }

        function specKeysHandlers(e) {
            this.ctrlDown = e.ctrlKey;
            this.altDown = e.altKey;
        }

        em.on('keydown', specKeysHandlers.bind(this));
        em.on('keyup', specKeysHandlers.bind(this));

        // TODO: add listener directly to ToolManager, istead of tool itself, avoiding cyclic check
        em.on('tick', e => {
            Object.keys(this.tools).forEach(name => {
                const tool = this.tools[name];
                if (tool.listenerCount('tick') > 0) {
                    tool.emit('tick', e);
                }
            });
        });
    }

    changeKey(tool, key, deleteOld=true) {
        if(deleteOld){
            const oldKey = tool.key;
            delete this._keyBinds[oldKey];
        }

        tool.key = key;
        this._keyBinds[key] = tool
    }

    loadBinds() {
        const str = (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_7__.getLS)('keyBinds');
        let newBinds;
        try {
            newBinds = JSON.parse(str);
            if (!newBinds)
                return;
        } catch {
            toastr.error('Error on parsing key binds from local storage');
            localStorage.removeItem('keyBinds');
            return
        }

        // clearing keybinds ahead of time
        // it's not safe to delete them in for loop
        this._keyBinds = {};
        let toolname;
        for (let key of Object.keys(newBinds)) {
            if (toolname = this.findByName(key)){
                this.changeKey(this.tools[toolname], newBinds[key], false);                
            }
        }
    }

    saveBinds() {
        let toSave = {};

        for (const tool of Object.values(_tools__WEBPACK_IMPORTED_MODULE_2__["default"])) {
            if (!tool.key) continue;

            toSave[tool.name] = tool.key;
        }

        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_7__.setLS)('keyBinds', JSON.stringify(toSave));
    }

    findByName(name) {
        const keys = Object.keys(this.tools);
        return keys.find(key => this.tools[key].name === name)
    }

    initColorBinds() {

    }

    loadColorBinds() {

    }
}

/***/ }),

/***/ "./src/js/Window.js":
/*!**************************!*\
  !*** ./src/js/Window.js ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ConfirmModal: () => (/* binding */ ConfirmModal),
/* harmony export */   Modal: () => (/* binding */ Modal),
/* harmony export */   "default": () => (/* binding */ Window)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _img_cross_svg__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../img/cross.svg */ "./src/img/cross.svg");
/* harmony import */ var _translate__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./translate */ "./src/js/translate.js");
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
// copied from template 3.0
// copyright GOROX





let windows = [];
window.windows = windows;

class Window {
    static Exists(title) {
        return windows.some(x => x.title === title)
    }
    static Find(title) {
        return windows.find(x => x.title === title)
    }
    constructor(config) {
        // all values also will be loaded from config few lines below

        // title can be passed instead of config
        if (typeof config == 'string')
            config = { title: config }

        this.created = false;

        this.x = 0;
        this.y = 0;

        this.title = "";

        this.parent = document.body;

        // do not set to false if closeable
        this.moveable = true;
        this.closeable = true;
        this.closed = false;

        this.center = false;

        // here
        Object.assign(this, config);

        if (Window.Exists(this.title)) {
            this.oldWindow = Window.Find(this.title);
            return
        }

        this.created = true;

        if (!this.block) { // for static windows like chat
            this.block = this.createParentBlock();
            this.moveTo(this.x, this.y); // user defined coordinates
            this.parent.appendChild(this.block);
        }

        if (this.center) {
            this.moveToCenter();
            // :    
            setTimeout(() => this.moveToCenter());
        }

        this.addFeatures();

        windows.push(this);
    }

    get width() {
        return this.element?.getBoundingClientRect().width;
    }

    get height() {
        return this.element?.getBoundingClientRect().height;
    }

    get left() {
        return this.x;
    }
    get right() {
        return this.x + this.width;
    }
    get top() {
        return this.y;
    }
    get bottom() {
        return this.y + this.height;
    }

    updateTitle(newTitle, temp = false) {
        if (!temp) {
            this.title = newTitle;
        }
        const head = $('.windowTitle', this.element);

        // this makes ".innerHtml = ..." of method below purposeless
        // since html is not saved here
        head.text(newTitle);
    }

    createParentBlock() {
        let el = document.createElement('div');
        el.className = 'window';
        this.element = el;

        let head = document.createElement('div');
        head.className = 'windowHeader'
        head.innerHTML = '<h3 class="windowTitle">' + this.title + '</h3>';
        el.appendChild(head);

        if (this.closeable) {
            const closer = document.createElement('div');
            closer.className = 'closeWindow';
            closer.innerHTML = '<div></div>';

            closer.addEventListener('pointerdown', event => {
                // prevent window moving
                event.stopPropagation();
            });
            closer.addEventListener('click', () => this.close());
            head.appendChild(closer);
        }

        let body = document.createElement('div');
        body.className = 'windowBody';
        el.appendChild(body);
        this.body = body;

        return el
    }

    moveTo(x, y) {
        const rect = this.block.getBoundingClientRect();
        const w = rect.width,
            h = rect.height;

        this.x = Math.max(-w + 10, x);
        this.y = Math.max(-h + 10, y);

        this.x = Math.min(window.innerWidth - 10, this.x);
        this.y = Math.min(window.innerHeight - 10, this.y);

        this.block.style.left = this.x + 'px';
        this.block.style.top = this.y + 'px';
    }

    moveBy(x, y) {
        this.moveTo(this.x + x, this.y + y);
    }

    moveToCenter() {
        let windowWidth = window.innerWidth,
            windowHeight = window.innerHeight;

        let blockWidth = this.block.offsetWidth,
            blockHeight = this.block.offsetHeight;

        this.moveTo(
            windowWidth / 2 - blockWidth / 2,
            windowHeight / 2 - blockHeight / 2
        );
    }

    addFeatures() {
        if (this.moveable) {
            $(this.block).on('pointerdown', e => {
                let self = this;
                let lastX = e.clientX;
                let lastY = e.clientY;

                jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).on('pointermove', moved)

                function moved(e) {
                    e = e.originalEvent;
                    let movedX = e.clientX - lastX;
                    let movedY = e.clientY - lastY;

                    lastX = e.clientX;
                    lastY = e.clientY;

                    self.moveBy(movedX, movedY);
                }

                jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).one('pointerup pointerleave', () => {
                    jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).off('pointermove', moved);
                });
            });

            $(this.body).on('pointerdown', e => {
                e.stopPropagation();
            })
        }

        // for window be in screen after
        // screen rotation
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                this.moveTo(this.x, this.y);
            }, 500);
        })
    }

    close() {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(this.block).remove();
        this.closed = true;
        windows.splice(windows.indexOf(this), 1);
    }
}

let Modal_exists = false;
class Modal {
    static get isRunning() {
        return Modal_exists
    }
    static set isRunning(val) {
        return Modal_exists = val;
    }

    constructor() {
        if (Modal.isRunning)
            throw new Error('Modal is running');

        this.body = null;

    }
    
    init() {
        const els =
        $(`<div class="modalBg">
            <div class="modalCont">
            </div>
            </div>`);
            
            this.bgEl = els[0];
        this.contEl = this.bgEl.children[0];
        
        $(document.body).append(els);

        Modal.isRunning = true;
    }

    close() {
        Modal.isRunning = false;
        this.bgEl.remove();
    }
}

class ConfirmModal extends Modal {
    constructor(msg, cb = null) {
        super();

        this.msg = msg;
        this.cb = cb;

        this.init();
    }

    init() {
        super.init();

        const mBody = $(
            `<div style="margin:0;padding:5px;text-align:center;color:var(--light-text)">
                <p>${this.msg}</p>
                <button class='confirmBtn' style="padding: 8px;">${(0,_translate__WEBPACK_IMPORTED_MODULE_2__.translate)('OK')}</button>
                <button class='cancelBtn' style="padding: 8px;">${(0,_translate__WEBPACK_IMPORTED_MODULE_2__.translate)('Cancel')}</button>
            </div>`)
        this.contEl.appendChild(mBody[0]);

        $('button', mBody).on('click', () => {
            this.close();
        });

        $('.confirmBtn', mBody).on('click', () => {
            if (this.cb) this.cb(true);
        });
        $('.cancelBtn', mBody).on('click', () => {
            if (this.cb) this.cb(false);
        });
    }
}

/***/ }),

/***/ "./src/js/assets.js":
/*!**************************!*\
  !*** ./src/js/assets.js ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _css_colorVars_css__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../css/colorVars.css */ "./src/css/colorVars.css");
/* harmony import */ var _css_style_css__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../css/style.css */ "./src/css/style.css");
/* harmony import */ var _node_modules_toastr_build_toastr_css__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../node_modules/toastr/build/toastr.css */ "./node_modules/toastr/build/toastr.css");
/* harmony import */ var _img_vk_logo_svg__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../img/vk-logo.svg */ "./src/img/vk-logo.svg");
/* harmony import */ var _img_discord_logo_circle_svg__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../img/discord-logo-circle.svg */ "./src/img/discord-logo-circle.svg");
/* harmony import */ var _img_gg_logo_svg__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../img/gg-logo.svg */ "./src/img/gg-logo.svg");
/* harmony import */ var _img_stripes_png__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../img/stripes.png */ "./src/img/stripes.png");
/* harmony import */ var _img_dots_svg__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../img/dots.svg */ "./src/img/dots.svg");
/* harmony import */ var _img_goroxels_png__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../img/goroxels.png */ "./src/img/goroxels.png");
/* harmony import */ var _img_move_icon_svg__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../img/move-icon.svg */ "./src/img/move-icon.svg");
/* harmony import */ var _img_telegram_svg__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../img/telegram.svg */ "./src/img/telegram.svg");
/* harmony import */ var _video_clickerMouse_webm__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../video/clickerMouse.webm */ "./src/video/clickerMouse.webm");
/* harmony import */ var _video_clicker_webm__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../video/clicker.webm */ "./src/video/clicker.webm");
/* harmony import */ var _video_as_webm__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../video/as.webm */ "./src/video/as.webm");
/* harmony import */ var _video_toolC_webm__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../video/toolC.webm */ "./src/video/toolC.webm");
/* harmony import */ var _video_brush_webm__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../video/brush.webm */ "./src/video/brush.webm");
/* harmony import */ var _video_brush2_webm__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../video/brush2.webm */ "./src/video/brush2.webm");
/* harmony import */ var _video_line_webm__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../video/line.webm */ "./src/video/line.webm");
/* harmony import */ var _video_flood_webm__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../video/flood.webm */ "./src/video/flood.webm");
/* harmony import */ var _img_unavailable_png__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../img/unavailable.png */ "./src/img/unavailable.png");
/* harmony import */ var _video_ctrlZ_webm__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../video/ctrlZ.webm */ "./src/video/ctrlZ.webm");
/* harmony import */ var _video_patternDemo_webm__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../video/patternDemo.webm */ "./src/video/patternDemo.webm");
/* harmony import */ var _video_phoneDrawing_mp4__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../video/phoneDrawing.mp4 */ "./src/video/phoneDrawing.mp4");
/* harmony import */ var _img_3rdcf_png__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../img/3rdcf.png */ "./src/img/3rdcf.png");




























/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({});

/***/ }),

/***/ "./src/js/camera.js":
/*!**************************!*\
  !*** ./src/js/camera.js ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./globals */ "./src/js/globals.js");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config */ "./src/js/config.js");
/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! events */ "./node_modules/events/events.js");
/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(events__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _utils_localStorage__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./utils/localStorage */ "./src/js/utils/localStorage.js");





const camera = {
    x: null, y: null,
    zoom: null,
    minX: null, minY: null, 
    maxX: null, maxY: null,

    minZoom: 0.1,
    maxZoom: 64,

    // when it's needed to disable moving
    noMoving: false,

    init(){
        Object.assign(this, {
            x: +(0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.getOrDefault)('posX', 0, true),
            y: +(0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.getOrDefault)('posY', 0, true),

            zoom: +(0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.getOrDefault)('zoom', 1, true),

            minX: -_config__WEBPACK_IMPORTED_MODULE_1__.boardWidth/2,
            minY: -_config__WEBPACK_IMPORTED_MODULE_1__.boardHeight/2,
            maxX: _config__WEBPACK_IMPORTED_MODULE_1__.boardWidth/2,
            maxY: _config__WEBPACK_IMPORTED_MODULE_1__.boardHeight/2,
        })
        if(isNaN(this.x) || isNaN(this.y) || isNaN(this.zoom)){
            this.x = 0;
            this.y = 0;
            this.zoom = 1;
        }
    },

    centerOn(x, y){
        _globals__WEBPACK_IMPORTED_MODULE_0__["default"].renderer.needRender = true;
        _globals__WEBPACK_IMPORTED_MODULE_0__["default"].fxRenderer.needRender = true;
        if(this.noMoving) return;
        
        this.x = x - this.maxX;
        this.y = y - this.maxY;

        this.clampPos();
    },

    moveTo(movx, movy){
        _globals__WEBPACK_IMPORTED_MODULE_0__["default"].renderer.needRender = true;
        if(this.noMoving) return;

        this.x += movx;
        this.y += movy;

        this.clampPos();
    },

    clampPos(){
        this.x = Math.min(Math.max(this.x, this.minX), this.maxX);
        this.y = Math.min(Math.max(this.y, this.minY), this.maxY);
    },

    zoomTo(dir){
        if(dir < 0){
            this.zoom = this.zoom * 2 | 0 || 1;
        }else{
            this.zoom = this.zoom / 2;
        }
        this.checkZoom();

        this.emit('zoom', this.zoom);

        _globals__WEBPACK_IMPORTED_MODULE_0__["default"].renderer.needRender = true;
        _globals__WEBPACK_IMPORTED_MODULE_0__["default"].fxRenderer.needRender = true;

        _globals__WEBPACK_IMPORTED_MODULE_0__["default"].renderer.preRender();
    },

    checkZoom(){
        this.zoom = Math.min(Math.max(this.zoom, this.minZoom), this.maxZoom)
    }, 

    disableMove(){
        this.noMoving = true;
    },

    enableMove(){
        this.noMoving = false;
    },

    __proto__: new (events__WEBPACK_IMPORTED_MODULE_2___default())
}

let lastX, lastY, lastZ;
setInterval(() => {
    const newX = camera.x,
        newY = camera.y,
        newZ = camera.zoom;

    if(lastX != newX) (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.setLS)('posX', newX, true);
    if(lastY != newY) (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.setLS)('posY', newY, true);
    if(lastZ != newZ) (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.setLS)('zoom', newZ, true);

    lastX = newX; lastY = newY; lastZ = newZ;
}, 3000);

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (window.camera = camera);

/***/ }),

/***/ "./src/js/constants.js":
/*!*****************************!*\
  !*** ./src/js/constants.js ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ROLE: () => (/* binding */ ROLE),
/* harmony export */   ROLE_I: () => (/* binding */ ROLE_I),
/* harmony export */   keys: () => (/* binding */ keys)
/* harmony export */ });
// key codes to human readable string
// !deprecated!
const keys = { // others are ok with charCodeAt
    8: "Backspace",
    9: "Tab",
    12: "Clear",
    13: "Enter",
    16: "Shift",
    17: "Control",
    18: "Alt",
    19: "Pause",
    20: "CapsLock",
    27: "Escape",
    32: "Space",
    33: "PageUp",
    34: "PageDown",
    35: "End",
    36: "Home",
    37: "ArrowLeft",
    38: "ArrowUp",
    39: "ArrowRight",
    40: "ArrowDown",
    45: "Insert",
    46: "Delete",
    112: "F1",
    113: "F2",
    114: "F3",
    115: "F4",
    116: "F5",
    117: "F6",
    118: "F7",
    119: "F8",
    120: "F9",
    121: "F10",
    122: "F11",
    123: "F12",
    144: "NumLock",
    145: "ScrollLock",
    48: "0",
    49: "1",
    50: "2",
    51: "3",
    52: "4",
    53: "5",
    54: "6",
    55: "7",
    56: "8",
    57: "9",
    106: "*",
    107: "+",
    109: "-",
    111: "/",
    186: ";",
    187: "=",
    188: ",",
    189: "-",
    190: ".",
    191: "/",
    192: "`",
    219: "[",
    220: "\\",
    221: "]",
    222: "'"
}

const ROLE = {
    BANNED: -1,
    GUEST: 0,
    USER: 1,
    TRUSTED: 2,
    MOD: 3,
    ADMIN: 4
}
const ROLE_I = {};
Object.keys(ROLE).forEach(x => ROLE_I[ROLE[x]] = x);



/***/ }),

/***/ "./src/js/draggableInputs.js":
/*!***********************************!*\
  !*** ./src/js/draggableInputs.js ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   initDraggableInputs: () => (/* binding */ initDraggableInputs)
/* harmony export */ });
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
function initDraggableInputs() {
    const DRAG_THRESHOLD = 5;

    document.querySelectorAll('input[type=number].valueDrag').forEach(input => {
        input.style.cursor = 'ew-resize';

        let startX = 0;
        let startValue = 0;
        let dragging = false;
        let armed = false;

        const step = () => {
            let s = parseFloat(input.step);
            return isNaN(s) || s <= 0 ? 1 : s;
        };

        const min = () => {
            let m = parseFloat(input.min);
            return isNaN(m) ? -Infinity : m;
        };

        const max = () => {
            let m = parseFloat(input.max);
            return isNaN(m) ? Infinity : m;
        };

        input.addEventListener('mousedown', e => {
            if (e.button !== 0) return;
            armed = true;
            dragging = false;
            startX = e.clientX;
            startValue = parseFloat(input.value) || 0;
            e.preventDefault();
        });

        document.addEventListener('mousemove', e => {
            if (!armed) return;
            let dx = e.clientX - startX;

            if (!dragging && Math.abs(dx) >= DRAG_THRESHOLD) {
                dragging = true;

                input.blur();
                document.body.style.userSelect = 'none';
                document.body.style.cursor = 'ew-resize';
            }

            if (dragging) {
                let val = startValue + dx * step();
                val = Math.min(max(), Math.max(min(), val));
                input.value = val;
                input.dispatchEvent(new Event('input', { bubbles: true }));
            }
        });

        document.addEventListener('mouseup', e => {
            if (!armed) return;
            if (dragging) {
                input.dispatchEvent(new Event('change', { bubbles: true }));
            }
            
            if(e.target === input){
                $(input).trigger('focus');
            }

            document.body.style.userSelect = '';
            document.body.style.cursor = '';
            armed = false;
            dragging = false;
        });
    });
}

/***/ }),

/***/ "./src/js/fxcanvas.js":
/*!****************************!*\
  !*** ./src/js/fxcanvas.js ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   FX: () => (/* binding */ FX),
/* harmony export */   FXRenderer: () => (/* binding */ FXRenderer),
/* harmony export */   FX_STATE: () => (/* binding */ FX_STATE),
/* harmony export */   addFX: () => (/* binding */ addFX),
/* harmony export */   removeFX: () => (/* binding */ removeFX)
/* harmony export */ });
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./globals */ "./src/js/globals.js");


const FX_STATE = {
    IN_PROCESS: 0, // to force renderer to render
    FINISHED: 1, // render when it's needed (next canvas update)
    REMOVED: 2 // don't render and delete
}

class FX {
    constructor(renderFunc) {
        this.renderFunc = renderFunc;

        this.removed = false;
    }

    render(ctx) {
        return this.renderFunc(ctx);
    }

    remove() {
        this.removed = true;
    }
}

class FXRenderer {
    constructor() {
        // three layers
        this.fxList = [[], [], []];
        this.ctx = _globals__WEBPACK_IMPORTED_MODULE_0__["default"].fxCtx;

        this.needRender = true;
        this.needClear = false;
    }

    add(fx, layer = 0) {
        this.fxList[layer].push(fx);

        this.needRender = true;
    }

    /*
      You can request it by returning zero in rendering
      functions or explicitly 
    */
    requestRender() {
        this.needRender = true;
    }

    render() {
        if (!this.needRender) return;

        this.ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);

        this.needRender = false;

        for (let layer = 0; layer < this.fxList.length; layer++) {
            this.fxList[layer].forEach(fx => {
                try {
                    if (fx.removed) return this.remove(fx);

                    let r = fx.render(this.ctx);


                    if (r == FX_STATE.REMOVED) {
                        this.remove(fx);
                    } else if (r == FX_STATE.IN_PROCESS) {
                        this.needRender = true;
                    }
                } catch (error) {
                    console.error(error);
                }

            })
        }
    }

    remove(fx) {
        for (let layer = 0; layer < this.fxList.length; layer++) {
            let idx = this.fxList[layer].indexOf(fx);
            if (idx != -1) {
                this.fxList[layer][idx].remove();
                this.fxList[layer].splice(idx, 1);
                this.needRender = true;
                break
            }
        }

    }
}

// fxRenderer is loaded later then tools/template
// so here is the workaround
let _deferredFX = [];
function addFX(fx, layer) {
    if (_globals__WEBPACK_IMPORTED_MODULE_0__["default"].fxRenderer) {
        _globals__WEBPACK_IMPORTED_MODULE_0__["default"].fxRenderer.add(fx, layer);
    } else _deferredFX.push([fx, layer]);
}

function removeFX(fx) {
    _globals__WEBPACK_IMPORTED_MODULE_0__["default"].fxRenderer.remove(fx);
}
let fxi = setInterval(() => {
    if (_globals__WEBPACK_IMPORTED_MODULE_0__["default"].fxRenderer) {
        clearInterval(fxi);
        for (let [fx, layer] of _deferredFX) {
            addFX(fx, layer);
        }
        _deferredFX = [];
    }
}, 5);

/***/ }),

/***/ "./src/js/history.js":
/*!***************************!*\
  !*** ./src/js/history.js ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   showHistoryCanvas: () => (/* binding */ showHistoryCanvas),
/* harmony export */   unloadHistoryCanvas: () => (/* binding */ unloadHistoryCanvas),
/* harmony export */   wipes: () => (/* binding */ wipes)
/* harmony export */ });
/* harmony import */ var _camera__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./camera */ "./src/js/camera.js");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config */ "./src/js/config.js");
/* harmony import */ var _fxcanvas__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./fxcanvas */ "./src/js/fxcanvas.js");
/* harmony import */ var _utils_conversions__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./utils/conversions */ "./src/js/utils/conversions.js");





// require wipes dynamically, parsing the file name of each
const requireOldWipe = __webpack_require__("./src/img/old-wipes sync \\.png$");

const namePathEntries = requireOldWipe.keys().map(key => {
    const module = requireOldWipe(key);
    const path = module.default;
    const fname = path.match(/([\.\d]+)\.png$/)[1];

    return [fname, path];
}).sort(([name1], [name2]) => {
    // sort by date
    const [day1, month1, year1] = name1.split('.').map(Number);
    const [day2, month2, year2] = name2.split('.').map(Number);
    
    if (year1 !== year2) return year2 - year1;
    if (month1 !== month2) return month2 - month1;
    return day2 - day1;
});

const wipes = Object.fromEntries(namePathEntries);

let historyFx = null, fxCtx = null, prevCameraState;
async function showHistoryCanvas(name) {
    unloadHistoryCanvas();


    const canvasImg = await loadHistoryCanvas(wipes[name]);

    // saving and changing camera borders
    // (the thing that helps you not get lost when moving canvas)
    prevCameraState = cloneCameraProps(_camera__WEBPACK_IMPORTED_MODULE_0__["default"]);

    _camera__WEBPACK_IMPORTED_MODULE_0__["default"].minX = -canvasImg.width / 2;
    _camera__WEBPACK_IMPORTED_MODULE_0__["default"].minY = -canvasImg.height / 2;
    _camera__WEBPACK_IMPORTED_MODULE_0__["default"].maxX = canvasImg.width / 2;
    _camera__WEBPACK_IMPORTED_MODULE_0__["default"].maxY = canvasImg.height / 2;

    _camera__WEBPACK_IMPORTED_MODULE_0__["default"].x = 0;
    _camera__WEBPACK_IMPORTED_MODULE_0__["default"].y = 0;
    _camera__WEBPACK_IMPORTED_MODULE_0__["default"].zoom = _camera__WEBPACK_IMPORTED_MODULE_0__["default"].minZoom;

    globals.renderer.needRender = true;

    // need to center it in the current canvas, otherwise 
    // even camera borders change will not help
    const canvasStartX = _config__WEBPACK_IMPORTED_MODULE_1__.boardWidth/2 - canvasImg.width/2;
    const canvasStartY = _config__WEBPACK_IMPORTED_MODULE_1__.boardHeight/2 - canvasImg.height/2;

    historyFx = new _fxcanvas__WEBPACK_IMPORTED_MODULE_2__.FX(ctx => {
        if (fxCtx === null) {
            fxCtx = ctx;
            // hiding real canvas
            ctx.canvas.style.backgroundColor = 'gray';
        }

        const zoom = _camera__WEBPACK_IMPORTED_MODULE_0__["default"].zoom
        const topLeftPos = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_3__.boardToScreenSpace)(canvasStartX, canvasStartY);

        ctx.drawImage(canvasImg, ...topLeftPos, canvasImg.width * zoom, canvasImg.height * zoom);

        return 1;
    });

    globals.fxRenderer.add(historyFx, 1);
}

async function loadHistoryCanvas(path) {
    return new Promise((res, rej) => {
        const img = new Image();

        img.style.imageRendering = 'pixelated';

        img.onload = () => res(img);
        img.onerror = rej;

        img.src = path;
    });
}

function cloneCameraProps(){
    const { x, y, zoom, minX, minY, maxX, maxY } = _camera__WEBPACK_IMPORTED_MODULE_0__["default"];
    return { x, y, zoom, minX, minY, maxX, maxY };
}

function unloadHistoryCanvas() {
    globals.fxRenderer.remove(historyFx);
    if (fxCtx) {
        fxCtx.canvas.style.backgroundColor = '';
        fxCtx = null;
    }
    if (prevCameraState) {
        const { x, y, zoom, minX, minY, maxX, maxY } = prevCameraState;
        Object.assign(_camera__WEBPACK_IMPORTED_MODULE_0__["default"], { x, y, zoom, minX, minY, maxX, maxY });
    }
}

function sortDates(dates) {
    return dates.sort((a, b) => {
        const [dayA, monthA, yearA] = a.split('.').map(Number);
        const [dayB, monthB, yearB] = b.split('.').map(Number);
        
        const dateA = new Date(2000 + yearA, monthA - 1, dayA);
        const dateB = new Date(2000 + yearB, monthB - 1, dayB);
        
        return dateA - dateB;
    });
}

/***/ }),

/***/ "./src/js/indexedDb.js":
/*!*****************************!*\
  !*** ./src/js/indexedDb.js ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   addInitCallback: () => (/* binding */ addInitCallback),
/* harmony export */   database: () => (/* binding */ database),
/* harmony export */   init: () => (/* binding */ init),
/* harmony export */   initiated: () => (/* binding */ initiated)
/* harmony export */ });
let initiated = false;
let database = null;

let deferredCallbacks = [];

function init() {
    let openRequest = indexedDB.open("db", 1);

    function onDone(){
        initiated = true;
        execCallbacks();
    }

    openRequest.onupgradeneeded = function () {
        database = openRequest.result;
        if (!database.objectStoreNames.contains('chunkPlaceholders')) {
            database.createObjectStore('chunkPlaceholders', { keyPath: 'chunk_key' });
        }

        onDone();
    };

    openRequest.onsuccess = () => {
        database = openRequest.result;
        onDone();
    };
}

function execCallbacks(){
    deferredCallbacks.forEach(cb => {
        try {
            cb(database);   
        } catch (error) {
            console.error(error);
        }
    })
    deferredCallbacks.length = 0;
}

function addInitCallback(cb) {
    if (initiated) {
        cb(database);
        return;
    }

    deferredCallbacks.push(cb);
}

/***/ }),

/***/ "./src/js/init.js":
/*!************************!*\
  !*** ./src/js/init.js ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   initInputs: () => (/* binding */ initInputs),
/* harmony export */   initOtherCoolFeatures: () => (/* binding */ initOtherCoolFeatures)
/* harmony export */ });
/* harmony import */ var _Chat__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Chat */ "./src/js/Chat.js");
/* harmony import */ var _draggableInputs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./draggableInputs */ "./src/js/draggableInputs.js");
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./globals */ "./src/js/globals.js");
/* harmony import */ var _player__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./player */ "./src/js/player.js");
/* harmony import */ var _template__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./template */ "./src/js/template.js");
/* harmony import */ var _ui_config__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./ui/config */ "./src/js/ui/config.js");
/* harmony import */ var _ui_toggles__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./ui/toggles */ "./src/js/ui/toggles.js");
/* harmony import */ var _winamp_player__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./winamp/player */ "./src/js/winamp/player.js");
/* harmony import */ var _windows__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./windows */ "./src/js/windows.js");
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");










function initInputs() {
    (0,_template__WEBPACK_IMPORTED_MODULE_4__.loadValues)();
    (0,_template__WEBPACK_IMPORTED_MODULE_4__.initHandlers)();
    (0,_windows__WEBPACK_IMPORTED_MODULE_8__.initButtons)();
    (0,_Chat__WEBPACK_IMPORTED_MODULE_0__.initChat)();
    (0,_draggableInputs__WEBPACK_IMPORTED_MODULE_1__.initDraggableInputs)();
}

function initOtherCoolFeatures() {
    (0,_template__WEBPACK_IMPORTED_MODULE_4__.initTemplateMobileMove)();

    (0,_template__WEBPACK_IMPORTED_MODULE_4__.importTemplateFromUrl)();

    (0,_template__WEBPACK_IMPORTED_MODULE_4__.initTemplateMoveByMouse)();
    initModMenu();
    (0,_ui_toggles__WEBPACK_IMPORTED_MODULE_6__.initMobileMenuToggler)();
    (0,_ui_config__WEBPACK_IMPORTED_MODULE_5__.initUISettings)();
    (0,_Chat__WEBPACK_IMPORTED_MODULE_0__.initMobileChatToggle)();
    (0,_windows__WEBPACK_IMPORTED_MODULE_8__.initHelpButton)();
    _player__WEBPACK_IMPORTED_MODULE_3__["default"].init();
    (0,_ui_config__WEBPACK_IMPORTED_MODULE_5__.initCoordsClick)();
    (0,_windows__WEBPACK_IMPORTED_MODULE_8__.initOnlineViewer)();
    (0,_ui_toggles__WEBPACK_IMPORTED_MODULE_6__.initMenuResizer)();
    (0,_windows__WEBPACK_IMPORTED_MODULE_8__.showHelpIfFirstTime)();
    (0,_winamp_player__WEBPACK_IMPORTED_MODULE_7__.startWinampRadio)();
}

function initModMenu() {
    initSliding();
    initSendAlerts();

    function initSliding() {
        $('#modMenu .title').on('click', e => {
            const m = $('#modMenu');
            if (m.data('state') === 'open') {
                m.data('state', 'close');
                m.css('right', '');
            } else {
                m.data('state', 'open');
                m.css('right', $('#modMenu .body').css('width'));
            }
        })
    }

    function initSendAlerts() {
        $('#sendAlerts').on('click', () => {
            const val = $('#sendAlertsText').val();
            if (val.length == 0 || val.length > 2000) return;

            $('#sendAlertsText').val('');
            _globals__WEBPACK_IMPORTED_MODULE_2__["default"].socket.sendAlert('all', val);
        })
    }
}

/***/ }),

/***/ "./src/js/main.js":
/*!************************!*\
  !*** ./src/js/main.js ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _assets__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./assets */ "./src/js/assets.js");
/* harmony import */ var _Socket__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Socket */ "./src/js/Socket.js");
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./globals */ "./src/js/globals.js");
/* harmony import */ var _ChunkManager__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./ChunkManager */ "./src/js/ChunkManager.js");
/* harmony import */ var _Renderer__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./Renderer */ "./src/js/Renderer.js");
/* harmony import */ var _fxcanvas__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./fxcanvas */ "./src/js/fxcanvas.js");
/* harmony import */ var _player__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./player */ "./src/js/player.js");
/* harmony import */ var _ToolManager__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./ToolManager */ "./src/js/ToolManager.js");
/* harmony import */ var _utils_misc__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./utils/misc */ "./src/js/utils/misc.js");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./config */ "./src/js/config.js");
/* harmony import */ var _translate__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./translate */ "./src/js/translate.js");
/* harmony import */ var _camera__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./camera */ "./src/js/camera.js");
/* harmony import */ var _Window__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./Window */ "./src/js/Window.js");
/* harmony import */ var _utils_localStorage__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./utils/localStorage */ "./src/js/utils/localStorage.js");
/* harmony import */ var _indexedDb__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./indexedDb */ "./src/js/indexedDb.js");
/* harmony import */ var _init__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./init */ "./src/js/init.js");
/* harmony import */ var _ui_toggles__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./ui/toggles */ "./src/js/ui/toggles.js");
/* harmony import */ var _ui_config__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./ui/config */ "./src/js/ui/config.js");
/* harmony import */ var _Chat__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./Chat */ "./src/js/Chat.js");
/* harmony import */ var _ui_elements__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./ui/elements */ "./src/js/ui/elements.js");
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");























(async () => {    
    _indexedDb__WEBPACK_IMPORTED_MODULE_14__.init();
    await _config__WEBPACK_IMPORTED_MODULE_9__.download();

    window.onresize = () => {
        _ui_elements__WEBPACK_IMPORTED_MODULE_19__.mainCanvas[0].width = window.innerWidth;
        _ui_elements__WEBPACK_IMPORTED_MODULE_19__.mainCanvas[0].height = window.innerHeight;

        _ui_elements__WEBPACK_IMPORTED_MODULE_19__.fxCanvas[0].width = window.innerWidth;
        _ui_elements__WEBPACK_IMPORTED_MODULE_19__.fxCanvas[0].height = window.innerHeight;

        const fxCtx = _ui_elements__WEBPACK_IMPORTED_MODULE_19__.fxCanvas[0].getContext('2d');

        ctx.imageSmoothingEnabled = fxCtx.imageSmoothingEnabled = false;
        ctx.webkitImageSmoothingEnabled = fxCtx.webkitImageSmoothingEnabled = false;
        ctx.mozImageSmoothingEnabled = fxCtx.mozImageSmoothingEnabled = false;
        ctx.msImageSmoothingEnabled = fxCtx.msImageSmoothingEnabled = false;
        ctx.oImageSmoothingEnabled = fxCtx.oImageSmoothingEnabled = false;

        renderer.needRender = true;
        fxRenderer.needRender = true;

        if (!_globals__WEBPACK_IMPORTED_MODULE_2__["default"].mobile) {
            (0,_utils_misc__WEBPACK_IMPORTED_MODULE_8__.calculateColumnSize)();
        }

        (0,_ui_config__WEBPACK_IMPORTED_MODULE_17__.fixColorsWidth)();
        (0,_Chat__WEBPACK_IMPORTED_MODULE_18__.fixChatPosition)();
    }


    window.oncontextmenu = function (e) {
        if (e.target === _ui_elements__WEBPACK_IMPORTED_MODULE_19__.mainCanvas[0] ||
            e.target.classList[0] === 'paletteColor' ||
            (e.path && e.path[1].classList[0] === 'paletteColor')) {
            e.preventDefault();
        }
    }

    _camera__WEBPACK_IMPORTED_MODULE_11__["default"].init();
    (0,_utils_misc__WEBPACK_IMPORTED_MODULE_8__.initHalfmap)();

    _config__WEBPACK_IMPORTED_MODULE_9__.palette.forEach((color, id) => {
        const el = document.createElement('div');
        el.style.backgroundColor = `rgb(${color.join(',')})`;
        // el.classList = ['paletteColor ' + (isDarkColor(...color) ? 'dark' : 'light')];
        el.classList = ['paletteColor light'];
        el.id = 'col' + id;

        // detect long press
        let downtime = 0;

        var $el = $(el);

        $el.on('pointerdown', () => {
            downtime = Date.now();
        })

        $el.on('pointerleave', () => {
            downtime = 0;
        })

        el.onclick = e => {
            let isLong = false;
            if (downtime != 0) {
                if (Date.now() - downtime > 700) {
                    isLong = true;
                }
                downtime = 0;
            }

            let f = isLong ? _player__WEBPACK_IMPORTED_MODULE_6__["default"].switchSecondColor : _player__WEBPACK_IMPORTED_MODULE_6__["default"].switchColor;
            f.call(_player__WEBPACK_IMPORTED_MODULE_6__["default"], id);
        }

        // only for MMB events
        el.onmouseup = e => {
            if(e.button !== 1){
                return;
            }

            _globals__WEBPACK_IMPORTED_MODULE_2__["default"].toolManager.tools['colorador'].mmb(id);
        }

        el.oncontextmenu = () => {
            // right button click
            _player__WEBPACK_IMPORTED_MODULE_6__["default"].switchSecondColor(id);
        }

        palette.append(el);
    })

    const ctx = _ui_elements__WEBPACK_IMPORTED_MODULE_19__.mainCanvas[0].getContext('2d');
    ctx.imageSmoothingEnabled = false;

    const wsPort = location.protocol === 'https:' ? 443 : (location.port || 80);
    const socket = new _Socket__WEBPACK_IMPORTED_MODULE_1__["default"](wsPort);
    _globals__WEBPACK_IMPORTED_MODULE_2__["default"].socket = socket;

    const chunkManager = new _ChunkManager__WEBPACK_IMPORTED_MODULE_3__["default"]();
    _globals__WEBPACK_IMPORTED_MODULE_2__["default"].chunkManager = chunkManager;

    const renderer = window.renderer = new _Renderer__WEBPACK_IMPORTED_MODULE_4__["default"](ctx);
    _globals__WEBPACK_IMPORTED_MODULE_2__["default"].renderer = renderer;

    const fxRenderer = new _fxcanvas__WEBPACK_IMPORTED_MODULE_5__.FXRenderer();
    _globals__WEBPACK_IMPORTED_MODULE_2__["default"].fxRenderer = fxRenderer;

    _globals__WEBPACK_IMPORTED_MODULE_2__["default"].toolManager = new _ToolManager__WEBPACK_IMPORTED_MODULE_7__["default"](document.getElementById('board'));

    _globals__WEBPACK_IMPORTED_MODULE_2__["default"].player = _player__WEBPACK_IMPORTED_MODULE_6__["default"];

    const renderLoop = () => {
        requestAnimationFrame(() => {
            renderer.requestRender();
            renderLoop();
        })
    }
    renderLoop();

    window.onresize();

    socket.on('opened', () => { });
    socket.on('online', count => {
        $('.online').text(count);
    });
    socket.on('closed', () => {
        $('.online').text('offline');
    })

    window.globals = _globals__WEBPACK_IMPORTED_MODULE_2__["default"];

    // create nsfw modal
    _config__WEBPACK_IMPORTED_MODULE_9__.callOnLoad(() => {
        if (_config__WEBPACK_IMPORTED_MODULE_9__.canvasName !== 'nsfw') return;
        if ((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_13__.getLS)('modal18') == 'accepted') return;

        const m = new _Window__WEBPACK_IMPORTED_MODULE_12__.Modal;
        m.init();
        const mBody = $(
            `<div style="margin:0;padding:5px;text-align:center;">
                <h1>${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('WARNING')}</h1>
                <p>${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('This canvas may contain illustrations, inappropriate for people under age of 18, including:')}
                <br>${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('Gore, furry, porn, hate, anime and all possible variations of these.')}</p>
                <p><b>${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('Are you 18 y.o. and fully understanding what are you doing?')}</b></p>
                <button style="padding: 8px;">${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('I am 18 years old and I take responsibility for my psyche on myself')}</button>
            </div>`)
        m.contEl.appendChild(mBody[0]);

        $('button', mBody).on('click', () => {
            m.close();
            (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_13__.setLS)('modal18', 'accepted');
        });
    });

    (0,_player__WEBPACK_IMPORTED_MODULE_6__.updateMe)();
    (0,_translate__WEBPACK_IMPORTED_MODULE_10__.init)();
    (0,_init__WEBPACK_IMPORTED_MODULE_15__.initInputs)();
    (0,_init__WEBPACK_IMPORTED_MODULE_15__.initOtherCoolFeatures)();
    // now hides by default
    if(_globals__WEBPACK_IMPORTED_MODULE_2__["default"].mobile)
        (0,_ui_toggles__WEBPACK_IMPORTED_MODULE_16__.toggleTopMenu)();
})();

/***/ }),

/***/ "./src/js/me.js":
/*!**********************!*\
  !*** ./src/js/me.js ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./constants */ "./src/js/constants.js");
/* harmony import */ var _utils_api__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./utils/api */ "./src/js/utils/api.js");
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");



let loaded = false;
let cbs = [];

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({
    registered: false,
    name: null,
    id: null,
    role: _constants__WEBPACK_IMPORTED_MODULE_0__.ROLE.GUEST,
    update(newMe){
        this.registered = newMe.registered;
        if(newMe.registered){
            this.name = newMe.name;
            this.role = newMe.role;
            this.id = newMe.id;
        }

        this.updateRoleRelatedHtml();
    },

    updateRoleRelatedHtml(){
        $('.minrole-admin').hide();
        $('.minrole-mod').hide();
        $('.minrole-trusted').hide();
        $('.minrole-user').hide();

        switch(this.role){
            case _constants__WEBPACK_IMPORTED_MODULE_0__.ROLE.ADMIN:
                $('.minrole-admin').show();
            case _constants__WEBPACK_IMPORTED_MODULE_0__.ROLE.MOD:
                $('.minrole-mod').show();
            case _constants__WEBPACK_IMPORTED_MODULE_0__.ROLE.TRUSTED:
                $('.minrole-trusted').show();
            case _constants__WEBPACK_IMPORTED_MODULE_0__.ROLE.USER:
                $('.minrole-user').show();
        }
    },

    checkCanGetUserInfo(){
        return this.registered && this.role >= _constants__WEBPACK_IMPORTED_MODULE_0__.ROLE.TRUSTED
    },

    async load(){
        const response = await (0,_utils_api__WEBPACK_IMPORTED_MODULE_1__.apiRequest)('/me');
        const user = await response.json();

        this.update(user);

        loaded = true;
        this.callStacked();
    },

    callOnLoaded(cb){
        if(this.loaded)
            return cb();
        cbs.push(cb);
    },
    callStacked(){
        cbs.forEach(cb => cb());
        cbs = [];
    }
});

/***/ }),

/***/ "./src/js/player.js":
/*!**************************!*\
  !*** ./src/js/player.js ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__),
/* harmony export */   placePixel: () => (/* binding */ placePixel),
/* harmony export */   placePixels: () => (/* binding */ placePixels),
/* harmony export */   togglePlaced: () => (/* binding */ togglePlaced),
/* harmony export */   updateBrush: () => (/* binding */ updateBrush),
/* harmony export */   updateMe: () => (/* binding */ updateMe),
/* harmony export */   updatePlaced: () => (/* binding */ updatePlaced)
/* harmony export */ });
/* harmony import */ var _Bucket__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Bucket */ "./src/js/Bucket.js");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config */ "./src/js/config.js");
/* harmony import */ var _ui_elements__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./ui/elements */ "./src/js/ui/elements.js");
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./globals */ "./src/js/globals.js");
/* harmony import */ var _me__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./me */ "./src/js/me.js");
/* harmony import */ var _utils_localStorage__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./utils/localStorage */ "./src/js/utils/localStorage.js");
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./constants */ "./src/js/constants.js");
/* harmony import */ var _translate__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./translate */ "./src/js/translate.js");
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* provided dependency */ var toastr = __webpack_require__(/*! toastr */ "./node_modules/toastr/toastr.js");









const player = {
    x: 0,
    y: 0,
    color: -1,
    brushSize: 1,
    secondCol: -1,
    id: -1,
    suspendedClrs: null,
    init() {
        this.loadColors();
        this.switchColor(this.color, true);
        this.switchSecondColor(this.secondCol, true);
    },
    loadColors() {
        this.color = +(0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_5__.getOrDefault)('color1', -1, true);
        this.secondCol = +(0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_5__.getOrDefault)('color2', -1, true);
    },
    switchColor(id, initial = false) {
        if (this.secondCol === id && id !== -1) {
            this.switchSecondColor(-1);
        }

        if (this.color === id && !initial)
            id = this.color = -1;
        else
            this.color = id;
        _globals__WEBPACK_IMPORTED_MODULE_3__["default"].fxRenderer.needRender = true;
        _globals__WEBPACK_IMPORTED_MODULE_3__["default"].renderer.preRender();

        $('.paletteColor.selected').removeClass('selected');
        if (id !== -1) {
            $('#col' + id).addClass('selected');
        }

        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_5__.setLS)('color1', id, true);
    },
    switchSecondColor(id, initial) {
        if (this.color === id && id !== -1) {
            this.switchColor(-1);
        }
        if (this.secondCol === id && !initial)
            id = this.secondCol = -1;
        else
            this.secondCol = id;
        _globals__WEBPACK_IMPORTED_MODULE_3__["default"].fxRenderer.needRender = true;
        _globals__WEBPACK_IMPORTED_MODULE_3__["default"].renderer.preRender();

        $('.paletteColor.selectedSecond').removeClass('selectedSecond');
        if (id !== -1) {
            $('#col' + id).addClass('selectedSecond');
        }

        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_5__.setLS)('color2', id, true);
    },
    swapColors() {
        const temp = this.color;
        this.switchColor(this.secondCol);
        this.switchSecondColor(temp);
    },
    resetColors() {
        this.switchColor(-1);
        this.switchSecondColor(-1);
    },

    // suspend/restore is a workaround to
    // temporarily disable drawing by mouse/tools
    suspendColors() {
        this.suspendedClrs = [this.color, this.secondCol];
        this.resetColors();
    },
    restoreColors() {
        if (!this.suspendedClrs) return;

        this.switchColor(this.suspendedClrs[0]);
        this.switchSecondColor(this.suspendedClrs[1]);

        this.suspendedClrs = null;
    },

    bucket: null,
    updateBucket([delay, max]) {
        this.bucket = new _Bucket__WEBPACK_IMPORTED_MODULE_0__["default"](delay, max);
    },
    placed: [],
    maxPlaced: isNaN(+localStorage['maxPlaced']) ? 5000 : +localStorage['maxPlaced'],
    placedCount: +(0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_5__.getLS)('placedCount', true) || 0
}

async function updateMe() {
    await _me__WEBPACK_IMPORTED_MODULE_4__["default"].load();

    player.updateBucket(getMyCooldown());
    if (_me__WEBPACK_IMPORTED_MODULE_4__["default"].registered) {
        _ui_elements__WEBPACK_IMPORTED_MODULE_2__.chatInput.removeAttr('disabled');
        _ui_elements__WEBPACK_IMPORTED_MODULE_2__.chatInput.val('');

        $('#loginButtons,.authBtn').hide();
        $('#chatNick,#chatChannels').show();
        $('#chatNick').text(_me__WEBPACK_IMPORTED_MODULE_4__["default"].name);
        $('#chatHeader').addClass('logged');
    } else {
        _ui_elements__WEBPACK_IMPORTED_MODULE_2__.chatInput.attr('disabled');
        _ui_elements__WEBPACK_IMPORTED_MODULE_2__.chatInput.val((0,_translate__WEBPACK_IMPORTED_MODULE_7__.translate)('login to chat'));

        // $('#chatNick').text('CHAT');
        $('#chatNick,#chatChannels').hide();
        $('#loginButtons,.authBtn').show();
        $('#chatHeader').removeClass('logged');
    }
}

function getMyCooldown() {
    const cooldowns = _config__WEBPACK_IMPORTED_MODULE_1__.cooldown;

    if (_constants__WEBPACK_IMPORTED_MODULE_6__.ROLE_I[_me__WEBPACK_IMPORTED_MODULE_4__["default"].role] == 'ADMIN') return [0, 32]
    return cooldowns[_constants__WEBPACK_IMPORTED_MODULE_6__.ROLE_I[_me__WEBPACK_IMPORTED_MODULE_4__["default"].role]] || _config__WEBPACK_IMPORTED_MODULE_1__.cooldown.GUEST;
}

function placePixels(pixels, store = true, isCtrlZ = false) {
    // does not check pixels, excluding for wand

    // check to allow place only on selected color, if selected
    if (!isCtrlZ && _globals__WEBPACK_IMPORTED_MODULE_3__["default"].wandSelectedColor !== null) {
        const allowedCol = _globals__WEBPACK_IMPORTED_MODULE_3__["default"].wandSelectedColor;

        let someValid = false;
        for (let i = 0; i < pixels.length; i++) {
            const boardCol = _globals__WEBPACK_IMPORTED_MODULE_3__["default"].chunkManager.getChunkPixel(...pixels[i]);
            if (boardCol !== allowedCol) {
                // making pixels invalid
                pixels[i][2] = 127;
            } else {
                someValid = true;
            }
        }

        if (!someValid) return;

        _globals__WEBPACK_IMPORTED_MODULE_3__["default"].fxRenderer.needRender = true;
    }

    if (store) {
        pixels.forEach(([x, y, c]) => {
            if(c === 127) return;
            player.placed.push([x, y, _globals__WEBPACK_IMPORTED_MODULE_3__["default"].chunkManager.getChunkPixel(x, y)]);
        })
    }
    _globals__WEBPACK_IMPORTED_MODULE_3__["default"].socket.sendPixels(pixels, false);
}

function placePixel(x, y, col, store = true, isCtrlZ = false) {
    const oldCol = _globals__WEBPACK_IMPORTED_MODULE_3__["default"].chunkManager.getChunkPixel(x, y),
        isProtected = _globals__WEBPACK_IMPORTED_MODULE_3__["default"].chunkManager.getProtect(x, y);

    const wandColor = _globals__WEBPACK_IMPORTED_MODULE_3__["default"].wandSelectedColor;
    if (!isCtrlZ && wandColor !== null && oldCol !== wandColor) return;

    if (oldCol !== col && (!isProtected || _me__WEBPACK_IMPORTED_MODULE_4__["default"].role >= _constants__WEBPACK_IMPORTED_MODULE_6__.ROLE.TRUSTED) && _globals__WEBPACK_IMPORTED_MODULE_3__["default"].socket.connected) {
        if (store) {
            player.placed.push([x, y, _globals__WEBPACK_IMPORTED_MODULE_3__["default"].chunkManager.getChunkPixel(x, y)]);

            if (player.placed.length > player.maxPlaced * 2) {
                player.placed = player.placed.slice(-player.maxPlaced);
            }
        }

        _globals__WEBPACK_IMPORTED_MODULE_3__["default"].chunkManager.setChunkPixel(x, y, col);
        _globals__WEBPACK_IMPORTED_MODULE_3__["default"].fxRenderer.needRender = true;

        _globals__WEBPACK_IMPORTED_MODULE_3__["default"].socket.sendPixel(x, y, col);

        _globals__WEBPACK_IMPORTED_MODULE_3__["default"].socket.pendingPixels[x + ',' + y] = setTimeout(() => {
            _globals__WEBPACK_IMPORTED_MODULE_3__["default"].chunkManager.setChunkPixel(x, y, oldCol);
            _globals__WEBPACK_IMPORTED_MODULE_3__["default"].renderer.needRender = true;
        }, 3000)
    } else {
        if (isProtected && _me__WEBPACK_IMPORTED_MODULE_4__["default"].role < _constants__WEBPACK_IMPORTED_MODULE_6__.ROLE.TRUSTED) {
            toastr.error((0,_translate__WEBPACK_IMPORTED_MODULE_7__.translate)('error.protected_pixel'), (0,_translate__WEBPACK_IMPORTED_MODULE_7__.translate)('Error!'), {
                preventDuplicates: true,
                timeOut: 750
            })
        }
    }
}

function updateBrush(size) {
    player.brushSize = +size;
    _globals__WEBPACK_IMPORTED_MODULE_3__["default"].fxRenderer.needRender = true;

    _globals__WEBPACK_IMPORTED_MODULE_3__["default"].renderer.preRenderBrush();

    $('#brushSizeCounter').text(size - 1);
}

function togglePlaced(state) {
    state ? $('#placedPixels').show() : $('#placedPixels').hide();
}

function updatePlaced(count, handCount) {
    // FIXME: move it to interval?
    $('#placedPixels').text(count);
    if (handCount)
        $('#placedPixels').attr('title', handCount);
}

let lastPlaced = player.placedCount;
setInterval(() => {
    if (lastPlaced !== player.placedCount) {
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_5__.setLS)('placedCount', player.placedCount, true);
        lastPlaced = player.placedCount;
    }
}, 3000);

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (player);

/***/ }),

/***/ "./src/js/protocol.js":
/*!****************************!*\
  !*** ./src/js/protocol.js ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   OPCODES: () => (/* binding */ OPCODES),
/* harmony export */   STRING_OPCODES: () => (/* binding */ STRING_OPCODES),
/* harmony export */   packPixel: () => (/* binding */ packPixel),
/* harmony export */   unpackPixel: () => (/* binding */ unpackPixel)
/* harmony export */ });
// change utils/recorder if changes

const OPCODES = {
    chunk:       0x0,
    place:       0x1,
    online:      0x2,
    canvas:      0x3,
    pixels:      0x4,
    captcha:     0x5,
    ping:        0x6,
    placeBatch:  0x7,
    updateRadio: 0x8
}

const STRING_OPCODES = {
    error: 'e',
    userJoin: 'u',
    userLeave: 'l',
    subscribeChat: 's',
    chatMessage: 'c',
    alert: 'a',
    me: 'm',
    reload: 'r',
    reloadChunks: 'rc'
}

// max coords is up to 4096
function packPixel(x, y, col) {
    return (x << 12 | y) << 7 | col
}

function unpackPixel(num) {
    return [
        num >>> 19,
        num >>> 7 & 0xFFF,
        num & 0b1111111
    ]
}

/***/ }),

/***/ "./src/js/template.js":
/*!****************************!*\
  !*** ./src/js/template.js ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   TemplateFx: () => (/* binding */ TemplateFx),
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__),
/* harmony export */   importTemplateFromUrl: () => (/* binding */ importTemplateFromUrl),
/* harmony export */   initHandlers: () => (/* binding */ initHandlers),
/* harmony export */   initTemplateMobileMove: () => (/* binding */ initTemplateMobileMove),
/* harmony export */   initTemplateMoveByMouse: () => (/* binding */ initTemplateMoveByMouse),
/* harmony export */   loadValues: () => (/* binding */ loadValues),
/* harmony export */   shareTemplate: () => (/* binding */ shareTemplate),
/* harmony export */   showTemplates: () => (/* binding */ showTemplates),
/* harmony export */   updateTemplate: () => (/* binding */ updateTemplate)
/* harmony export */ });
/* harmony import */ var _camera__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./camera */ "./src/js/camera.js");
/* harmony import */ var _utils_misc__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./utils/misc */ "./src/js/utils/misc.js");
/* harmony import */ var _ui_elements__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./ui/elements */ "./src/js/ui/elements.js");
/* harmony import */ var _utils_conversions__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./utils/conversions */ "./src/js/utils/conversions.js");
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./globals */ "./src/js/globals.js");
/* harmony import */ var _fxcanvas__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./fxcanvas */ "./src/js/fxcanvas.js");
/* harmony import */ var _utils_localStorage__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./utils/localStorage */ "./src/js/utils/localStorage.js");
/* harmony import */ var _me__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./me */ "./src/js/me.js");
/* harmony import */ var _utils_api__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./utils/api */ "./src/js/utils/api.js");
/* harmony import */ var _windows__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./windows */ "./src/js/windows.js");
/* harmony import */ var _player__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./player */ "./src/js/player.js");
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* provided dependency */ var toastr = __webpack_require__(/*! toastr */ "./node_modules/toastr/toastr.js");



let winWid = window.innerWidth / 2,
    winHei = window.innerHeight / 2;

window.addEventListener('resize', () => {
    winWid = window.innerWidth / 2;
    winHei = window.innerHeight / 2;
})

;









const widthRegEx = /w(?:idth)?=(\d+)$/;

class TemplateFx {
    constructor() {

    }
}

// singletone atm
class Template {
    constructor() {
        this.x = 0;
        this.y = 0;

        this.templateImg;
        this.templateResizeW = null;

        this._lastUrl = null;

        (0,_fxcanvas__WEBPACK_IMPORTED_MODULE_5__.addFX)(new _fxcanvas__WEBPACK_IMPORTED_MODULE_5__.FX(this.renderFx.bind(this)));
    }

    get url() {
        return _ui_elements__WEBPACK_IMPORTED_MODULE_2__.urlInput.val()
    }

    get opacity() {
        return +_ui_elements__WEBPACK_IMPORTED_MODULE_2__.opacInput.val()
    }

    set opacity(val) {
        _ui_elements__WEBPACK_IMPORTED_MODULE_2__.opacInput.val(val);
    }

    renderFx(ctx) {
        if (!this.templateImg) return 1;

        ctx.imageSmoothingEnabled = false;

        const [posX, posY] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_3__.boardToScreenSpace)(this.x, this.y);
        const zoom = _camera__WEBPACK_IMPORTED_MODULE_0__["default"].zoom;

        let canvasW, canvasH;
        // patternized or not
        if (this.templateResizeW) {
            canvasW = this.templateResizeW;
            // sometimes AR does not align template properly
            // so we need to divide by the pattern size(7) manually
            if (this.templateImg.width / this.templateResizeW === 7) {
                canvasH = Math.floor(this.templateImg.height / 7);
            } else {
                const ar = this.templateImg.width / this.templateImg.height;
                canvasH = Math.floor(this.templateResizeW / ar);
            }
        } else {
            canvasW = this.templateImg.width;
            canvasH = this.templateImg.height;
        }

        const oldOpac = ctx.globalAlpha;
        ctx.globalAlpha = this.opacity;

        ctx.drawImage(this.templateImg, posX, posY, canvasW * zoom | 0, canvasH * zoom | 0);

        ctx.globalAlpha = oldOpac;
        return 1;
    }

    update() {
        this.updatePosition();
        this.updateImage();
    }

    updatePosition() {
        this.x = parseInt(_ui_elements__WEBPACK_IMPORTED_MODULE_2__.xInput.val(), 10);
        this.y = parseInt(_ui_elements__WEBPACK_IMPORTED_MODULE_2__.yInput.val(), 10);

        _globals__WEBPACK_IMPORTED_MODULE_4__["default"].fxRenderer.requestRender();
    }

    static parseImageUrl(url) {
        let width = null;
        let match;
        if (match = url.match(widthRegEx)) {
            width = +match[1];
        }

        if (url.startsWith('GRX')) {
            const file = url.match(/f=(.+\.png)/)[1];
            url = `/api/template/img?t=orig&f=${file}`;
        }

        return {
            url, width
        }
    }

    async updateImage() {
        if (this.url === this._lastUrl) {
            return;
        }

        const {
            url: parsedUrl, width: parsedWidth
        } = Template.parseImageUrl(this.url);

        this.templateImg = await (0,_utils_misc__WEBPACK_IMPORTED_MODULE_1__.loadImage)(parsedUrl);
        this._lastUrl = this.url;

        this.templateResizeW = parsedWidth;

        _globals__WEBPACK_IMPORTED_MODULE_4__["default"].fxRenderer.requestRender();
    }

    get isPatterns() {
        return !isNaN(this.templateResizeW) &&
            this.templateImg.width % 7 == 0 &&
            this.templateImg.height % 7 == 0;
    }
}
const template = new Template();

function loadValues() {
    const urlVal = (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_6__.getOrDefault)('template.url', 'https://i.imgur.com/4GQIMQ7.png', true);
    _ui_elements__WEBPACK_IMPORTED_MODULE_2__.urlInput.val(urlVal);

    const xVal = (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_6__.getOrDefault)('template.x', 0, true);
    _ui_elements__WEBPACK_IMPORTED_MODULE_2__.xInput.val(parseInt(xVal, 10));

    const yVal = (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_6__.getOrDefault)('template.y', 0, true);
    _ui_elements__WEBPACK_IMPORTED_MODULE_2__.yInput.val(parseInt(yVal, 10));

    const opacVal = (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_6__.getOrDefault)('template.opac', 0.5, true);
    _ui_elements__WEBPACK_IMPORTED_MODULE_2__.opacInput.val(parseFloat(opacVal));
}

function saveTemplate() {
    (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_6__.setLS)('template.x', template.x, true);
    (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_6__.setLS)('template.y', template.y, true);
    (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_6__.setLS)('template.url', template.url, true);
    (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_6__.setLS)('template.opac', template.opacity, true);
}

function updateTemplate() {
    template.update();
    saveTemplate();
}

function initHandlers() {
    _ui_elements__WEBPACK_IMPORTED_MODULE_2__.urlInput.on('input', updateTemplate);
    _ui_elements__WEBPACK_IMPORTED_MODULE_2__.xInput.on('input', updateTemplate);
    _ui_elements__WEBPACK_IMPORTED_MODULE_2__.yInput.on('input', updateTemplate);
    _ui_elements__WEBPACK_IMPORTED_MODULE_2__.opacInput.on('input', updateTemplate);

    updateTemplate();
}

function initTemplateMoveByMouse() {
    $(document).on('mousedown', e => {
        if (!e.ctrlKey) return;

        // preventing default movement
        e.stopPropagation();
        e.preventDefault();

        let lastCord = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_3__.screenToBoardSpace)(e.clientX, e.clientY).map(x => x |= 0);

        function mousemove(e) {
            e.stopPropagation();
            e.preventDefault();

            const boardPos = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_3__.screenToBoardSpace)(e.clientX, e.clientY);
            boardPos[0] |= 0;
            boardPos[1] |= 0;

            let [lastX, lastY] = boardPos;

            if (lastX === lastCord[0] && lastY === lastCord[1])
                return;

            // console.log(lastX, lastY, boardPos, lastCord)

            _ui_elements__WEBPACK_IMPORTED_MODULE_2__.xInput.val(template.x -= lastCord[0] - lastX);
            _ui_elements__WEBPACK_IMPORTED_MODULE_2__.yInput.val(template.y -= lastCord[1] - lastY);

            template.updatePosition();

            lastCord = boardPos;

            saveTemplate();
        }
        $(document).on('mousemove', mousemove);
        $(document).one('mouseup mouseleave', () => {
            $(document).off('mousemove', mousemove);
        })
    })
}

function importTemplateFromUrl() {
    const urlParams = new URLSearchParams(window.location.search);
    const tUrl = urlParams.get('t_url');
    const tX = urlParams.get('t_x');
    const tY = urlParams.get('t_y');
    if (!tUrl || !tX || !tY) return

    _ui_elements__WEBPACK_IMPORTED_MODULE_2__.urlInput.val(decodeURIComponent(tUrl));
    _ui_elements__WEBPACK_IMPORTED_MODULE_2__.xInput.val(+tX);
    _ui_elements__WEBPACK_IMPORTED_MODULE_2__.yInput.val(+tY);

    updateTemplate();
    removeAllSearchParams();
}

function removeAllSearchParams() {
    const url = new URL(window.location);
    url.search = '';
    window.history.replaceState(null, '', url);
}

function shareTemplate() {
    const imgUrl = _ui_elements__WEBPACK_IMPORTED_MODULE_2__.urlInput.val();
    const x = _ui_elements__WEBPACK_IMPORTED_MODULE_2__.xInput.val();
    const y = _ui_elements__WEBPACK_IMPORTED_MODULE_2__.yInput.val();

    const curUrl = location.origin + location.pathname;

    const importUrl = `${curUrl}?t_url=${encodeURIComponent(imgUrl)}&t_x=${x}&t_y=${y}`;

    _ui_elements__WEBPACK_IMPORTED_MODULE_2__.chatInput.val(importUrl);
    _ui_elements__WEBPACK_IMPORTED_MODULE_2__.chatInput.trigger('focus');

    // to trigger input events, such as white text color for links
    const inputEvent = new Event('input', {
        bubbles: true,
        cancelable: true
    });
    _ui_elements__WEBPACK_IMPORTED_MODULE_2__.chatInput[0].dispatchEvent(inputEvent);
}

async function showTemplates() {
    if (!_me__WEBPACK_IMPORTED_MODULE_7__["default"].registered) {
        return toastr.error('needs_login_to_use_templates');
    }
    const resp = await (0,_utils_api__WEBPACK_IMPORTED_MODULE_8__.apiRequest)('/template/list');

    const respData = await resp.json();
    if (respData.errors) return;

    (0,_windows__WEBPACK_IMPORTED_MODULE_9__.templatesWindow)(respData);
}

function initTemplateMobileMove() {
    const moveBtn = $('#manualMoveBtn');

    let isMovingEnabled = false;

    let lastPressCord;
    // let pointerId;
    function mousedown(e) {
        if (!isMovingEnabled) return;

        lastPressCord = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_3__.screenToBoardSpace)(e.clientX, e.clientY).map(x => x |= 0);

        // sometimes mouseup's not emitted
        mouseup();

        _globals__WEBPACK_IMPORTED_MODULE_4__["default"].eventManager.on('mousemove', mousemove);
    }

    function mousemove(e) {
        if (e.gesture) return;

        const boardPos = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_3__.screenToBoardSpace)(e.clientX, e.clientY);
        boardPos[0] |= 0;
        boardPos[1] |= 0;

        let [lastX, lastY] = boardPos;

        if (lastX === lastPressCord[0] && lastY === lastPressCord[1])
            return;

        console.log({ lastX, lastY, boardPos, lastPressCord })

        _ui_elements__WEBPACK_IMPORTED_MODULE_2__.xInput.val(template.x -= lastPressCord[0] - lastX);
        _ui_elements__WEBPACK_IMPORTED_MODULE_2__.yInput.val(template.y -= lastPressCord[1] - lastY);

        template.updatePosition();

        lastPressCord = boardPos;

        saveTemplate();
    }

    function mouseup() {
        _globals__WEBPACK_IMPORTED_MODULE_4__["default"].eventManager.off('mousemove', mousemove);
    }

    _globals__WEBPACK_IMPORTED_MODULE_4__["default"].eventManager.on('mousedown', mousedown);
    _globals__WEBPACK_IMPORTED_MODULE_4__["default"].eventManager.on('mouseup', mouseup);

    moveBtn.on('click', () => {
        if (isMovingEnabled) {
            moveBtn.removeClass('active');
            // just to be sure
            mouseup();

            _globals__WEBPACK_IMPORTED_MODULE_4__["default"].toolManager.unblockToolChange();
            restoreTool();
        } else {
            moveBtn.addClass('active');
            saveAndResetTool();
            _globals__WEBPACK_IMPORTED_MODULE_4__["default"].toolManager.blockToolChange();
        }

        isMovingEnabled = !isMovingEnabled;
    });

    // workaround, because to just cancel events 
    // (to prevent tools doing their job during the placement) 
    // we need to rewrite whole eventManager
    let savedTool, savedColors;
    function saveAndResetTool() {
        savedTool = _globals__WEBPACK_IMPORTED_MODULE_4__["default"].toolManager.tool;
        savedColors = [_player__WEBPACK_IMPORTED_MODULE_10__["default"].color, _player__WEBPACK_IMPORTED_MODULE_10__["default"].secondCol];

        _globals__WEBPACK_IMPORTED_MODULE_4__["default"].toolManager.selectTool(_globals__WEBPACK_IMPORTED_MODULE_4__["default"].toolManager.tools['clicker']);
        _player__WEBPACK_IMPORTED_MODULE_10__["default"].resetColors();
    }

    function restoreTool() {
        _globals__WEBPACK_IMPORTED_MODULE_4__["default"].toolManager.selectTool(savedTool);
        [_player__WEBPACK_IMPORTED_MODULE_10__["default"].color, _player__WEBPACK_IMPORTED_MODULE_10__["default"].secondCol] = savedColors;
    }
}




/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (template);

/***/ }),

/***/ "./src/js/tools.js":
/*!*************************!*\
  !*** ./src/js/tools.js ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   PixelFont: () => (/* binding */ PixelFont),
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _Chat__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Chat */ "./src/js/Chat.js");
/* harmony import */ var _MiniWindow__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./MiniWindow */ "./src/js/MiniWindow.js");
/* harmony import */ var _Tool__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./Tool */ "./src/js/Tool.js");
/* harmony import */ var _camera__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./camera */ "./src/js/camera.js");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./config */ "./src/js/config.js");
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./constants */ "./src/js/constants.js");
/* harmony import */ var _fxcanvas__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./fxcanvas */ "./src/js/fxcanvas.js");
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./globals */ "./src/js/globals.js");
/* harmony import */ var _me__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./me */ "./src/js/me.js");
/* harmony import */ var _player__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./player */ "./src/js/player.js");
/* harmony import */ var _template__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./template */ "./src/js/template.js");
/* harmony import */ var _translate__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./translate */ "./src/js/translate.js");
/* harmony import */ var _ui_elements__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./ui/elements */ "./src/js/ui/elements.js");
/* harmony import */ var _ui_toggles__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./ui/toggles */ "./src/js/ui/toggles.js");
/* harmony import */ var _utils_api__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./utils/api */ "./src/js/utils/api.js");
/* harmony import */ var _utils_camera__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./utils/camera */ "./src/js/utils/camera.js");
/* harmony import */ var _utils_color__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./utils/color */ "./src/js/utils/color.js");
/* harmony import */ var _utils_conversions__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./utils/conversions */ "./src/js/utils/conversions.js");
/* harmony import */ var _utils_localStorage__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./utils/localStorage */ "./src/js/utils/localStorage.js");
/* harmony import */ var _utils_math__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./utils/math */ "./src/js/utils/math.js");
/* harmony import */ var _utils_misc__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./utils/misc */ "./src/js/utils/misc.js");
/* harmony import */ var _utils_shapes__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./utils/shapes */ "./src/js/utils/shapes.js");
/* harmony import */ var _utils_webGL__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./utils/webGL */ "./src/js/utils/webGL.js");
/* harmony import */ var _img_toolIcons_clicker_png__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../img/toolIcons/clicker.png */ "./src/img/toolIcons/clicker.png");
/* harmony import */ var _img_toolIcons_disable_png__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../img/toolIcons/disable.png */ "./src/img/toolIcons/disable.png");
/* harmony import */ var _img_toolIcons_floodfill_png__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../img/toolIcons/floodfill.png */ "./src/img/toolIcons/floodfill.png");
/* harmony import */ var _img_toolIcons_line_png__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../img/toolIcons/line.png */ "./src/img/toolIcons/line.png");
/* harmony import */ var _img_toolIcons_move_png__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../img/toolIcons/move.png */ "./src/img/toolIcons/move.png");
/* harmony import */ var _img_toolIcons_protect_png__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ../img/toolIcons/protect.png */ "./src/img/toolIcons/protect.png");
/* harmony import */ var _img_toolIcons_revert_png__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ../img/toolIcons/revert.png */ "./src/img/toolIcons/revert.png");
/* harmony import */ var _img_toolIcons_wand_cur_png__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ../img/toolIcons/wand-cur.png */ "./src/img/toolIcons/wand-cur.png");
/* harmony import */ var _img_toolIcons_disable_cur_png__WEBPACK_IMPORTED_MODULE_31__ = __webpack_require__(/*! ../img/toolIcons/disable-cur.png */ "./src/img/toolIcons/disable-cur.png");
/* harmony import */ var _font_pixel_min5_png__WEBPACK_IMPORTED_MODULE_32__ = __webpack_require__(/*! ../font/pixel/min5.png */ "./src/font/pixel/min5.png");
/* harmony import */ var _font_pixel_min5_txt__WEBPACK_IMPORTED_MODULE_33__ = __webpack_require__(/*! ../font/pixel/min5.txt */ "./src/font/pixel/min5.txt");
/* harmony import */ var _img_disabled_color_svg__WEBPACK_IMPORTED_MODULE_34__ = __webpack_require__(/*! ../img/disabled-color.svg */ "./src/img/disabled-color.svg");
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* provided dependency */ var toastr = __webpack_require__(/*! toastr */ "./node_modules/toastr/toastr.js");





























// import pipetteIcon from '../img/toolIcons/pipette.png'












const mobile = _globals__WEBPACK_IMPORTED_MODULE_7__["default"].mobile;

function getPixel(x, y) {
    return _globals__WEBPACK_IMPORTED_MODULE_7__["default"].chunkManager.getChunkPixel(x, y)
}

function getProtect(x, y) {
    return _globals__WEBPACK_IMPORTED_MODULE_7__["default"].chunkManager.getProtect(x, y)
}

function isOdd(x, y) {
    return ((x + y) % 2) === 0
}

function getCurCol() {
    if (_player__WEBPACK_IMPORTED_MODULE_9__["default"].secondCol === -1) {
        return ~_player__WEBPACK_IMPORTED_MODULE_9__["default"].color ? _player__WEBPACK_IMPORTED_MODULE_9__["default"].color : -1;
    }
    if (_player__WEBPACK_IMPORTED_MODULE_9__["default"].color === -1) return _player__WEBPACK_IMPORTED_MODULE_9__["default"].secondCol;

    return isOdd(_player__WEBPACK_IMPORTED_MODULE_9__["default"].x, _player__WEBPACK_IMPORTED_MODULE_9__["default"].y) ? _player__WEBPACK_IMPORTED_MODULE_9__["default"].color : _player__WEBPACK_IMPORTED_MODULE_9__["default"].secondCol
}

function getColByCord(x, y, first = _player__WEBPACK_IMPORTED_MODULE_9__["default"].color, second = _player__WEBPACK_IMPORTED_MODULE_9__["default"].secondCol) {
    if (second === -1) return first;
    if (first === -1) return second;

    return isOdd(x, y) ? first : second
}

function checkBounds(x, y) {
    return (x >= 0 && x < _config__WEBPACK_IMPORTED_MODULE_4__.boardWidth && y >= 0 && y < _config__WEBPACK_IMPORTED_MODULE_4__.boardHeight)
}

let tmLoaded = false;
let onTMID = setInterval(() => {
    if (_globals__WEBPACK_IMPORTED_MODULE_7__["default"].toolManager) {
        clearInterval(onTMID);
        _onTmLoaded();
    }
}, 5);
let tmCallbacks = [];
function _onTmLoaded() {
    tmLoaded = true;
    tmCallbacks.forEach(cb => cb(_globals__WEBPACK_IMPORTED_MODULE_7__["default"].toolManager));
    tmCallbacks = [];
}
function onToolManager(cb) {
    if (tmLoaded) cb(_globals__WEBPACK_IMPORTED_MODULE_7__["default"].toolManager);
    else tmCallbacks.push(cb)
}

function renderFX() {
    _globals__WEBPACK_IMPORTED_MODULE_7__["default"].fxRenderer.needRender = true;
}

function protectPixels(pixels) {
    _globals__WEBPACK_IMPORTED_MODULE_7__["default"].socket.sendPixels(pixels, true);
}

class Clicker extends _Tool__WEBPACK_IMPORTED_MODULE_2__["default"] {
    constructor(...args) {
        super(...args);

        this._pendingPixels = {};
        this.minZoom = 2;

        this.on('down', this.down);
        this.on('up', this.up);
        this.on('move', this.move);
        this.on('leave', this.up);
        this.on('_gesture', this.ongesture);

        onToolManager(() => {
            // mobile is already subscribed to pointer events
            // so this will duplicate them
            if (!mobile) {
                _globals__WEBPACK_IMPORTED_MODULE_7__["default"].eventManager.on('mousedown', this.mousedown.bind(this));
                _globals__WEBPACK_IMPORTED_MODULE_7__["default"].toolManager.on('move', this.move.bind(this));
                _globals__WEBPACK_IMPORTED_MODULE_7__["default"].eventManager.on('mouseup', this.mouseup.bind(this));
            }
        })

        this.clrInterval = setInterval(() => {
            if (this.clearPending())
                renderFX();
        }, 250);

        // pending pixels debug visualizer
        this.fx = new _fxcanvas__WEBPACK_IMPORTED_MODULE_6__.FX(this.render.bind(this));
        //addFX(this.fx);
    }

    // mouse zone
    mousedown(e) {
        if (e.button !== 0) return;
        this.screenPos = [e.clientX, e.clientY];
    }
    mouseup(e) {
        if (_globals__WEBPACK_IMPORTED_MODULE_7__["default"].toolManager.tools['mover'].key !== 'LMB') return;

        if (e.button !== 0 || !this.screenPos) return;
        const dx = Math.abs(e.clientX - this.screenPos[0]);
        const dy = Math.abs(e.clientY - this.screenPos[1]);
        if (dx > 5 || dy > 5) return;

        const [x, y] = [_player__WEBPACK_IMPORTED_MODULE_9__["default"].x, _player__WEBPACK_IMPORTED_MODULE_9__["default"].y];
        const color = getColByCord(x, y);
        if (this.checkPixel(x, y) && ~color)
            (0,_player__WEBPACK_IMPORTED_MODULE_9__.placePixel)(_player__WEBPACK_IMPORTED_MODULE_9__["default"].x, _player__WEBPACK_IMPORTED_MODULE_9__["default"].y, getColByCord(x, y));
    }
    // end of mouse zone

    down(e) {
        this.lastPos = [_player__WEBPACK_IMPORTED_MODULE_9__["default"].x, _player__WEBPACK_IMPORTED_MODULE_9__["default"].y];
        this.screenPos = [e.clientX, e.clientY];

        if (this.mouseIsDown || _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom < this.minZoom) return;

        this.mouseIsDown = true;

        if (!mobile)
            this.emit('move', {});
        else {
            this.pointerId = e.pointerId;
        }
    }
    up(e) {
        if (this.mouseIsDown) {
            if (mobile)
                this.emit('move', e, true);
            this.mouseIsDown = false;
        }
    }

    ongesture() {
        this.mouseIsDown = false;
        this.lastPos = null;
    }

    checkPixel(x, y) {
        const key = `${x},${y}`;
        const myColor = getColByCord(x, y);

        const pixel = getPixel(x, y),
            isProtected = getProtect(x, y);
        if (pixel === myColor || pixel === -1 || (isProtected && _me__WEBPACK_IMPORTED_MODULE_8__["default"].role < _constants__WEBPACK_IMPORTED_MODULE_5__.ROLE.TRUSTED)) return;

        if (this._pendingPixels[key] && this._pendingPixels[key][0] === myColor) return;
        this._pendingPixels[key] = [myColor, Date.now()];

        return true
    }

    /*
    */
    move(e, isUp = false) {
        if (e.gesture) {
            // if gesture is started, we reset mousedown state
            this.ongesture();
            return
        }
        if (!this.mouseIsDown ||
            e.gesture ||
            getCurCol() === -1) return;

        // mobile and same pointerid as at down but also not initiated by 'up' event
        if (mobile && this.pointerId !== e.pointerId)
            return

        const screenX = e.clientX,
            screenY = e.clientY;

        const dx = Math.abs(screenX - this.screenPos[0]);
        const dy = Math.abs(screenY - this.screenPos[1]);

        if (dx < 5 && dy < 5 && !isUp) {
            return;
        }

        let [x, y] = [_player__WEBPACK_IMPORTED_MODULE_9__["default"].x, _player__WEBPACK_IMPORTED_MODULE_9__["default"].y];

        let line = _utils_shapes__WEBPACK_IMPORTED_MODULE_21__["default"].line(this.lastPos[0], this.lastPos[1], x, y);
        this.lastPos = [x, y];

        let circle = [[0, 0]];
        if (_player__WEBPACK_IMPORTED_MODULE_9__["default"].brushSize !== 1) {
            circle = _globals__WEBPACK_IMPORTED_MODULE_7__["default"].renderer.preRendered.brush.circle;
        }

        for (let [x, y] of line) {
            let pixels = [];

            if (!this.checkAllowance(circle.length)) return;
            circle.forEach(([cx, cy]) => {
                let _x = x + cx;
                let _y = y + cy;
                if (this.checkPixel(_x, _y)) {
                    const myColor = getColByCord(_x, _y); // duplicate
                    pixels.push([_x, _y, myColor]);
                }
            })

            this.place(pixels);
        }
    }

    checkAllowance(count) {
        return _player__WEBPACK_IMPORTED_MODULE_9__["default"].bucket.allowance >= count;
    }

    place(pixels) {
        if (pixels.length === 0) return;

        _player__WEBPACK_IMPORTED_MODULE_9__["default"].bucket.spend(pixels.length)

        if (pixels.length == 1) {
            (0,_player__WEBPACK_IMPORTED_MODULE_9__.placePixel)(...pixels[0])
        } else
            (0,_player__WEBPACK_IMPORTED_MODULE_9__.placePixels)(pixels);
    }

    render(ctx) {
        const zoom = _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom;
        ctx.lineWidth = zoom / 5;
        ctx.globalAlpha = .5;

        for (let key of Object.keys(this._pendingPixels)) {
            let [x, y] = key.split(',').map(x => parseInt(x, 10));

            const color = this._pendingPixels[key][0];
            ctx.strokeStyle = '#000000';
            ctx.fillStyle = _config__WEBPACK_IMPORTED_MODULE_4__.hexPalette[color];

            const [scrX, scrY] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_17__.boardToScreenSpace)(x, y);


            ctx.strokeRect(scrX, scrY, zoom, zoom);
        }

        ctx.globalAlpha = 1;

        return 1
    }

    clearPending() {
        let deletedSome = false;
        Object.keys(this._pendingPixels).forEach(key => {
            let timestamp = this._pendingPixels[key][1];

            if (Date.now() - timestamp > 500) {
                delete this._pendingPixels[key];
                deletedSome = true;
            }
        })

        return deletedSome;
    }
}
const clicker = new Clicker('clicker', 'Space', _img_toolIcons_clicker_png__WEBPACK_IMPORTED_MODULE_23__["default"]);

class Protector extends Clicker {
    constructor(...args) {
        super(...args);

        this.minZoom = 1;

        // is this unprotector
        this._alt = false;
        // first touch determines whether protect or not (for full down-move-up):
        // protected => unprotect; unprotected => protect,
        // i.e. inverts pixel state
        this._mobileIsProtect = null;
    }

    getProtectState() {
        if (mobile)
            return this._mobileIsProtect;
        else
            return this._alt ? false : true;

    }

    // override Clicker's mouse events
    mousedown() { }
    mouseup() { }

    down(e) {
        if (this.mouseIsDown) return;

        super.down(e);

        (0,_config__WEBPACK_IMPORTED_MODULE_4__.showProtected)(); // force protect visibility
        this._mobileIsProtect = !getProtect(...this.lastPos);
    }

    checkPixel(x, y) {
        const key = `${x},${y}`;
        const state = this.getProtectState();

        const curState = getProtect(x, y);
        if (curState === state) return;

        if (this._pendingPixels[key] && this._pendingPixels[key][0] === state) return;
        this._pendingPixels[key] = [state, Date.now()];

        return true
    }

    checkAllowance() { return true }

    place(pixels) {
        // now we should replace colors from
        // clicker's move func with protect state
        const state = this.getProtectState();
        pixels.forEach(p => p[2] = state);
        if (!pixels.length) return;

        protectPixels(pixels);
    }

    render() { }
}
const protector = new Protector('protector', 'KeyV', _img_toolIcons_protect_png__WEBPACK_IMPORTED_MODULE_28__["default"], _constants__WEBPACK_IMPORTED_MODULE_5__.ROLE.MOD);

const altProtector = new Protector('alt protector', 'ALT+KeyV', null, _constants__WEBPACK_IMPORTED_MODULE_5__.ROLE.MOD);
altProtector._alt = true;

class Mover extends _Tool__WEBPACK_IMPORTED_MODULE_2__["default"] {
    constructor(...args) {
        super(...args);

        this.handlers();

        this.downPos = [0, 0];

        // time when "down" was called
        this.downTime = 0;

        this.lastPos = [0, 0];
        this.lastPlayerPos = [0, 0];

        if (!mobile) {
            this.fx = new _fxcanvas__WEBPACK_IMPORTED_MODULE_6__.FX(this.renderCursor);

            (0,_fxcanvas__WEBPACK_IMPORTED_MODULE_6__.addFX)(this.fx);
        }
    }

    handlers() {
        // 
        onToolManager(() => {
            this.on('down', this.down);
            this.on('up', this.up);
            // bind to toolManager for handling not only on canvas
            _globals__WEBPACK_IMPORTED_MODULE_7__["default"].toolManager.on('move', this.move.bind(this));
            this.on('leave', this.up);
        })
    }

    renderCursor(ctx) {
        const zoom = _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom;

        const color = getCurCol();

        if (~color && zoom > 1) {
            if (_player__WEBPACK_IMPORTED_MODULE_9__["default"].brushSize == 1) {
                let [x, y] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_17__.boardToScreenSpace)(_player__WEBPACK_IMPORTED_MODULE_9__["default"].x, _player__WEBPACK_IMPORTED_MODULE_9__["default"].y);
                ctx.strokeStyle = _config__WEBPACK_IMPORTED_MODULE_4__.hexPalette[color];
                //ctx.fillStyle = hexPalette[player.color];
                ctx.lineWidth = zoom / 5;

                let w, h;
                let halfLineWid = ctx.lineWidth / 2;

                x += halfLineWid;
                y += halfLineWid;

                w = zoom - ctx.lineWidth;
                h = w;

                //ctx.fillRect(x, y, zoom, zoom);
                ctx.strokeRect(x, y, w + 1, h + 1);

                //renderFX();
            } else {
                const [x, y] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_17__.boardToScreenSpace)(_player__WEBPACK_IMPORTED_MODULE_9__["default"].x - _player__WEBPACK_IMPORTED_MODULE_9__["default"].brushSize / 2, _player__WEBPACK_IMPORTED_MODULE_9__["default"].y - _player__WEBPACK_IMPORTED_MODULE_9__["default"].brushSize / 2);
                ctx.drawImage(_globals__WEBPACK_IMPORTED_MODULE_7__["default"].renderer.preRendered.brush.canvas, x, y)
            }
        }

        return 1
    }

    down(e) {
        if (e.ctrlKey) return;

        this.mousedown = true;

        // little workaround to keep any ui text
        // unselected while canvas moves
        // guess it's uneffictive
        (0,_ui_elements__WEBPACK_IMPORTED_MODULE_12__.changeSelector)('#ui>div>*', { 'pointer-events': 'none' })

        this.downPos = this.lastPos = [e.clientX, e.clientY];
        this.downTime = Date.now();
    }
    up(e) {
        if (e.ctrlKey) return;

        this.mousedown = false;
        (0,_ui_elements__WEBPACK_IMPORTED_MODULE_12__.changeSelector)('#ui>div>*', { 'pointer-events': 'all' })

        // long tap to get pixel info
        if (mobile && this.moveThreshold() && !e.gesture) {
            const ela = Date.now() - this.downTime;
            if (ela < 1000) return;

            pixelInfo.emit('up');
        }
    }

    move(e) {
        // for template mover
        if (e.ctrlKey) return;

        // idk what was purpose of this
        // but i actually need to render fx on mobiles
        // if (!mobile) {
        if (this.lastPlayerPos[0] != _player__WEBPACK_IMPORTED_MODULE_9__["default"].x ||
            this.lastPlayerPos[1] != _player__WEBPACK_IMPORTED_MODULE_9__["default"].y ||
            this.mousedown) {
            renderFX();
        }

        this.lastPlayerPos = [_player__WEBPACK_IMPORTED_MODULE_9__["default"].x, _player__WEBPACK_IMPORTED_MODULE_9__["default"].y];
        // }

        if (!this.mousedown) return;

        this.lastPos = [e.clientX, e.clientY]
        if (!mobile) {

            if (this.moveThreshold())
                return
        }

        // now works without pixel ratio, i'll keep it here if not
        _camera__WEBPACK_IMPORTED_MODULE_3__["default"].moveTo(-e.movementX / _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom /* / devicePixelRatio */, -e.movementY / _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom /* / devicePixelRatio */);
    }

    moveThreshold() {
        return (Math.abs(this.downPos[0] - this.lastPos[0]) < 5 &&
            Math.abs(this.downPos[1] - this.lastPos[1]) < 5)
    }
}
const mover = new Mover('mover', 'LMB', _img_toolIcons_move_png__WEBPACK_IMPORTED_MODULE_27__["default"]);

class FloodFill extends _Tool__WEBPACK_IMPORTED_MODULE_2__["default"] {
    constructor(...args) {
        super(...args);

        this.on('up', this.up);
        this.on('down', this.down);
        this.on('leave', this.up);

        this.on('tick', this.tick);

        this.previewing = false;
        this.fx = null;
        this.prevStack = [];
    }

    up(e, isCancel) {
        if (this.active) { // stop and return
            this.active = false;
            return
        }

        if (this.previewing) {
            this.fx.remove();
            renderFX();
            this.previewing = false;
        } else return; // means that key wasn't pressed


        if (isCancel)
            return;

        const cord = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_17__.screenToBoardSpace)(e.clientX, e.clientY);
        if (getColByCord(...cord) === -1 || !(0,_utils_camera__WEBPACK_IMPORTED_MODULE_15__.inBounds)(...cord) || e.type === 'mouseleave') {
            return
        }

        this.active = true;

        this.stack = [
            [_player__WEBPACK_IMPORTED_MODULE_9__["default"].x, _player__WEBPACK_IMPORTED_MODULE_9__["default"].y]
        ];

        this.playerCol = _player__WEBPACK_IMPORTED_MODULE_9__["default"].color;
        this.secondPlayerCol = _player__WEBPACK_IMPORTED_MODULE_9__["default"].secondCol;
        this.fillingCol = getPixel(_player__WEBPACK_IMPORTED_MODULE_9__["default"].x, _player__WEBPACK_IMPORTED_MODULE_9__["default"].y);
    }

    down(e) {
        // preview floodfill
        if (e.repeat || this.previewing || this.active) {
            return
        }

        const cord = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_17__.screenToBoardSpace)(e.clientX, e.clientY);
        if (getColByCord(...cord) === -1 || !(0,_utils_camera__WEBPACK_IMPORTED_MODULE_15__.inBounds)(...cord)) {
            return
        }
        let _lastX, _lastY;

        restart.apply(this);

        this.showedPixels = [];
        this.fillingCol = getPixel(_player__WEBPACK_IMPORTED_MODULE_9__["default"].x, _player__WEBPACK_IMPORTED_MODULE_9__["default"].y);

        let fx = new _fxcanvas__WEBPACK_IMPORTED_MODULE_6__.FX(tick.bind(this));
        (0,_fxcanvas__WEBPACK_IMPORTED_MODULE_6__.addFX)(fx, 0);

        this.fx = fx;

        //globals.renderer.needRender = true;

        this.previewing = true;

        function restart() {
            this.prevStack = [
                [_player__WEBPACK_IMPORTED_MODULE_9__["default"].x, _player__WEBPACK_IMPORTED_MODULE_9__["default"].y]
            ];
            this.showedPixels = [];

            _lastX = _player__WEBPACK_IMPORTED_MODULE_9__["default"].x;
            _lastY = _player__WEBPACK_IMPORTED_MODULE_9__["default"].y;

            this.playerCol = _player__WEBPACK_IMPORTED_MODULE_9__["default"].color;
            this.secondPlayerCol = _player__WEBPACK_IMPORTED_MODULE_9__["default"].secondCol;
            this.fillingCol = getPixel(_player__WEBPACK_IMPORTED_MODULE_9__["default"].x, _player__WEBPACK_IMPORTED_MODULE_9__["default"].y);
        }

        function paint() {
            if (!this.prevStack.length) return 1;

            let [x, y] = this.prevStack.pop();

            let color = getColByCord(x, y, this.playerCol, this.secondPlayerCol);
            let tileCol = getPixel(x, y);
            let painted = this.showedPixels.indexOf(x + ',' + y) !== -1;

            if (painted || tileCol === color || tileCol !== this.fillingCol || !(0,_utils_camera__WEBPACK_IMPORTED_MODULE_15__.inBounds)(x, y)) {
                return 0
            }

            this.showedPixels.push(x + ',' + y);

            let top = this.checkP(x, y - 1);
            let bottom = this.checkP(x, y + 1);
            let left = this.checkP(x - 1, y);
            let right = this.checkP(x + 1, y);
            if (top && left) {
                this.checkP(x - 1, y - 1);
            }
            if (top && right) {
                this.checkP(x + 1, y - 1);
            }
            if (bottom && left) {
                this.checkP(x - 1, y + 1);
            }
            if (bottom && right) {
                this.checkP(x + 1, y + 1);
            }

            return 0
        }

        function tick(ctx) {
            if (_globals__WEBPACK_IMPORTED_MODULE_7__["default"].mobile && _globals__WEBPACK_IMPORTED_MODULE_7__["default"].toolManager.tool !== this) {
                this.up({}, true);
                return 1;
            }
            if (_player__WEBPACK_IMPORTED_MODULE_9__["default"].x != _lastX || _player__WEBPACK_IMPORTED_MODULE_9__["default"].y != _lastY) {
                restart.call(this);
            }
            if (getCurCol() === -1) return 1;

            let res = 0;
            for (let i = 0; i < 700 && res == 0; i++)
                res = paint.call(this);


            ctx.strokeWidth = _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom;

            this.showedPixels.forEach((p, i) => {
                let [x, y] = p.split(',').map(x => parseInt(x, 10));

                let alpha = 1;
                let len = this.showedPixels.length
                if (len >= 100 && i < len / 2) {
                    alpha = 1 - (((len / 2) - i) / (len / 2))
                    if (alpha <= 0) return;
                }
                ctx.globalAlpha = alpha;

                const color = getColByCord(x, y, this.playerCol, this.secondPlayerCol);
                ctx.strokeStyle = _config__WEBPACK_IMPORTED_MODULE_4__.hexPalette[color];

                let [absX, absY] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_17__.boardToScreenSpace)(x, y);
                ctx.strokeRect(absX, absY, _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom, _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom);
            });

            return res
        }
    }

    checkP(x, y) {
        if (getPixel(x, y) !== this.fillingCol) return false;
        this.prevStack.unshift([x, y]);
        return true
    }

    tick() {
        if (!this.active) return;

        for (let i = 0; i < 15 && this.stack.length; i++) {
            let nextX = this.stack[this.stack.length - 1][0];

            if (!_player__WEBPACK_IMPORTED_MODULE_9__["default"].bucket.spend(1)) break;

            let [x, y] = this.stack.pop();

            let color = getColByCord(x, y, this.playerCol, this.secondPlayerCol);
            let tileCol = getPixel(x, y);

            if (tileCol === color || tileCol !== this.fillingCol || !(0,_utils_camera__WEBPACK_IMPORTED_MODULE_15__.inBounds)(x, y)) {
                continue
            }

            //this.stack.push([x, y]);

            let top = this.check(x, y - 1);
            let bottom = this.check(x, y + 1);
            let left = this.check(x - 1, y);
            let right = this.check(x + 1, y);
            if (top && left) {
                this.check(x - 1, y - 1);
            }
            if (top && right) {
                this.check(x + 1, y - 1);
            }
            if (bottom && left) {
                this.check(x - 1, y + 1);
            }
            if (bottom && right) {
                this.check(x + 1, y + 1);
            }

            (0,_player__WEBPACK_IMPORTED_MODULE_9__.placePixel)(x, y, color);
        }

        if (!this.stack.length) return this.active = false;
    }

    check(x, y) {
        if (getPixel(x, y) !== this.fillingCol) return false;
        this.stack.unshift([x, y]);
        return true
    }
}
const
    floodfill = new FloodFill('floodfill', 'KeyF', _img_toolIcons_floodfill_png__WEBPACK_IMPORTED_MODULE_25__["default"]);

class Pipette extends _Tool__WEBPACK_IMPORTED_MODULE_2__["default"] {
    constructor(...args) {
        super(...args);

        if (mobile) {
            return
            this.on('down', this.mobileDown.bind(this));
            this.on('up', this.mobileUp.bind(this));
        } else
            this.on('down', this.down);
    }

    down(e) {
        const color = getPixel(_player__WEBPACK_IMPORTED_MODULE_9__["default"].x, _player__WEBPACK_IMPORTED_MODULE_9__["default"].y);

        if (color === -1) return;

        if (e.__alt)
            _player__WEBPACK_IMPORTED_MODULE_9__["default"].switchSecondColor(color);
        else
            _player__WEBPACK_IMPORTED_MODULE_9__["default"].switchColor(color);

        renderFX();
    }

    // separate handlers for handling both
    // primary and seconary colors on mobiles

    // DISABLED FOR THE MOMENT
    // is pipette really need in game
    // with restricted palette .. ?
    mobileDown() {
        this.downCord = [_player__WEBPACK_IMPORTED_MODULE_9__["default"].x, _player__WEBPACK_IMPORTED_MODULE_9__["default"].y];
        this.downTime = Date.now();
    }

    mobileUp() {
        let lastCord = [_player__WEBPACK_IMPORTED_MODULE_9__["default"].x, _player__WEBPACK_IMPORTED_MODULE_9__["default"].y];
        let lastTime = Date.now();

        this.downCord = null;
        this.downTime = null;
    }
}
const pipette = new Pipette('pipette', 'KeyC', /*pipetteIcon*/);

const altPipette = new Pipette('alt pipette', 'ALT+KeyC');
altPipette.off('down', altPipette.down);
altPipette.on('down', (e) => {
    e.__alt = true;
    altPipette.down.call(altPipette, e)
});

class Line extends _Tool__WEBPACK_IMPORTED_MODULE_2__["default"] {
    constructor(...args) {
        super(...args);

        this.drawLength = JSON.parse((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_18__.getOrDefault)('drawLineLen', false));;

        onToolManager(() => {
            this.handlers();
        })
    }

    handlers() {
        let startCoords, endCoords, lastCoords = [],
            fx, isDown = false,
            line,
            startColor1, startColor2, startCircleSize;

        function down() {
            if (isDown) return;
            isDown = true;

            startCoords = [_player__WEBPACK_IMPORTED_MODULE_9__["default"].x, _player__WEBPACK_IMPORTED_MODULE_9__["default"].y];

            [startColor1, startColor2] = [_player__WEBPACK_IMPORTED_MODULE_9__["default"].color, _player__WEBPACK_IMPORTED_MODULE_9__["default"].secondCol];

            startCircleSize = 1;
            if (_player__WEBPACK_IMPORTED_MODULE_9__["default"].brushSize !== 1) {
                startCircleSize = _globals__WEBPACK_IMPORTED_MODULE_7__["default"].renderer.preRendered.brush.circle.length;
            }

            //this.emit('move');
        }

        function move(e) {
            if (!isDown || !startCoords) return;
            if (e.gesture) {
                isDown = false;
                return startCoords = null;
            };

            endCoords = [_player__WEBPACK_IMPORTED_MODULE_9__["default"].x, _player__WEBPACK_IMPORTED_MODULE_9__["default"].y];

            if (_player__WEBPACK_IMPORTED_MODULE_9__["default"].color === -1 && _player__WEBPACK_IMPORTED_MODULE_9__["default"].secondCol === -1) {
                fx && (0,_fxcanvas__WEBPACK_IMPORTED_MODULE_6__.removeFX)(fx);
                return;
            }
            if (endCoords[0] != lastCoords[0] || endCoords[1] != lastCoords[1]) {
                lastCoords = endCoords;

                const line = buildLine(...startCoords, ...endCoords)

                fx && (0,_fxcanvas__WEBPACK_IMPORTED_MODULE_6__.removeFX)(fx);
                fx = new _fxcanvas__WEBPACK_IMPORTED_MODULE_6__.FX((ctx) => {
                    ctx.globalAlpha = .5;

                    // draw line pixel by pixel
                    line.forEach(([x, y]) => {
                        const color = getColByCord(x, y);
                        ctx.fillStyle = _config__WEBPACK_IMPORTED_MODULE_4__.hexPalette[color];

                        let [screenX, screenY] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_17__.boardToScreenSpace)(x, y);
                        ctx.fillRect(screenX, screenY, _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom, _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom);
                    });

                    // draw (non pixelated) black line over the line
                    ctx.strokeStyle = '#000000';
                    ctx.lineWidth = _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom / 5;

                    const startScreen = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_17__.boardToScreenSpace)(...line[0]);
                    const endScreen = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_17__.boardToScreenSpace)(...line[line.length - 1]);

                    ctx.beginPath();
                    ctx.lineCap = 'round'
                    ctx.moveTo(...startScreen.map(z => z += _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom / 2));
                    ctx.lineTo(...endScreen.map(z => z += _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom / 2));

                    // draw line length text

                    function angle(cx, cy, ex, ey) {
                        var dy = ey - cy;
                        var dx = ex - cx;
                        var theta = Math.atan2(dy, dx); // range (-PI, PI]
                        theta *= 180 / Math.PI; // rads to degs, range (-180, 180]
                        //if (theta < 0) theta = 360 + theta; // range [0, 360)
                        return theta;
                    }

                    function toRadians(angle) {
                        return angle * (Math.PI / 180);
                    }

                    if (this.drawLength && line.length > 1) {
                        let [startPosX, startPosY] = startScreen;
                        let [endPosX, endPosY] = endScreen;

                        let minX = Math.min(startPosX, endPosX);
                        let minY = Math.min(startPosY, endPosY);
                        let maxX = Math.max(startPosX, endPosX);
                        let maxY = Math.max(startPosY, endPosY);

                        let [midPosX, midPosY] = [maxX - Math.abs(maxX - minX) / 2, maxY - Math.abs(maxY - minY) / 2];

                        // append half-pixel offset to center text in the middle
                        midPosX += _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom * 0.5;
                        midPosY += _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom * 0.5;

                        let lineAngle = angle(startPosX, startPosY, endPosX, endPosY);
                        if (lineAngle > 90) {
                            lineAngle -= 180;
                        } else if (lineAngle < -90) {
                            lineAngle += 180;
                        }

                        let lineRads = toRadians(lineAngle);
                        let offsetX = 40 * Math.sin(lineRads);
                        let offsetY = 40 * Math.cos(lineRads);

                        midPosX += offsetX;
                        midPosY -= offsetY;



                        ctx.save();
                        ctx.globalAlpha = .7;

                        const fontHei = 20//camera.zoom / 1.5;
                        ctx.font = fontHei + 'px sans-serif';
                        ctx.fillStyle = 'black'
                        ctx.strokeStyle = 'white';

                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.lineWidth = fontHei / 6;

                        const text = line.length;
                        const [x, y] = [midPosX, midPosY];

                        ctx.strokeText(text, x, y);
                        ctx.fillText(text, x, y);

                        ctx.restore();
                    }

                    ctx.stroke();

                    ctx.globalAlpha = 1;

                    return 1
                })
                ;(0,_fxcanvas__WEBPACK_IMPORTED_MODULE_6__.addFX)(fx)
            }
        }

        function buildLine(x1, y1, x2, y2) {
            let circle = [[0, 0]];
            if (_player__WEBPACK_IMPORTED_MODULE_9__["default"].brushSize !== 1) {
                circle = _globals__WEBPACK_IMPORTED_MODULE_7__["default"].renderer.preRendered.brush.circle;
            }

            const w = _config__WEBPACK_IMPORTED_MODULE_4__.boardWidth;

            // to not repeat already added pixels
            const placed = new Set();

            const bruhLinePixels = [];
            const linePixels = _utils_shapes__WEBPACK_IMPORTED_MODULE_21__["default"].line(x1, y1, x2, y2);

            // starting from the end and then
            // reversing brushed array will
            // make pixels rendering looking more brush-like
            for (let i = linePixels.length - 1; i >= 0; i--) {
                const [x, y] = linePixels[i]
                circle.forEach(([offX, offY]) => {
                    const absX = x + offX;
                    const absY = y + offY;

                    const encoded = absX + absY * w;

                    if (placed.has(encoded)) return;
                    placed.add((encoded));

                    bruhLinePixels.push([absX, absY]);
                })
            }

            return bruhLinePixels.reverse();
        }

        function up() {
            this.off('tick', tick);

            if (!isDown || !startCoords) return;
            isDown = false;

            fx && fx.remove();

            if (!endCoords) endCoords = [_player__WEBPACK_IMPORTED_MODULE_9__["default"].x, _player__WEBPACK_IMPORTED_MODULE_9__["default"].y];

            line = buildLine(...startCoords, ...endCoords);
            startCoords = null;
            endCoords = null;

            renderFX();
            this.on('tick', tick);
        }

        function tick() {
            if (_player__WEBPACK_IMPORTED_MODULE_9__["default"].color === -1 && _player__WEBPACK_IMPORTED_MODULE_9__["default"].secondCol === -1) {
                // assume player cancelled line
                line = null;
            }

            let placed = 0;
            while (true) {
                if (!line || !line.length) {
                    this.off('tick', tick);
                    return;
                }

                const [x, y] = line.pop();
                const col = getColByCord(x, y, startColor1, startColor2);

                if (col === undefined || col === -1) return this.off('tick', tick);
                if (!checkBounds(x, y) || getPixel(x, y) === col) continue;

                if (!_player__WEBPACK_IMPORTED_MODULE_9__["default"].bucket.spend(1)) return line.push([x, y]);

                (0,_player__WEBPACK_IMPORTED_MODULE_9__.placePixel)(x, y, col);
                placed++;
                if (placed >= startCircleSize / 2) {
                    return
                }
            }
        }

        down = down.bind(this);
        move = move.bind(this);
        up = up.bind(this);

        tick = tick.bind(this);

        this.on('down', down);
        // TODO maybe it's too many listeners
        // so it'd be good to make some sort of local signal
        // that there was gesture (this listener is only for e.gesture to reset start coords)
        _globals__WEBPACK_IMPORTED_MODULE_7__["default"].toolManager.on('move', move);
        this.on('up', up);
    }
}
const line = new Line('line', 'ShiftLeft', _img_toolIcons_line_png__WEBPACK_IMPORTED_MODULE_26__["default"]);

const cordAdd = new _Tool__WEBPACK_IMPORTED_MODULE_2__["default"]('coords to chat', 'KeyU');
cordAdd.on('up', function () {
    const cords = $('#coords').text();
    if (!cords.length) return;
    _ui_elements__WEBPACK_IMPORTED_MODULE_12__.chatInput[0].value += cords + ' ';
    _ui_elements__WEBPACK_IMPORTED_MODULE_12__.chatInput.trigger('focus');
});

const colorSwap = new _Tool__WEBPACK_IMPORTED_MODULE_2__["default"]('swap colors', 'KeyX');
colorSwap.on('up', _player__WEBPACK_IMPORTED_MODULE_9__["default"].swapColors.bind(_player__WEBPACK_IMPORTED_MODULE_9__["default"]));

const colorDec = new _Tool__WEBPACK_IMPORTED_MODULE_2__["default"]('left color', 'KeyA');
colorDec.on('down', function () {
    let color = _player__WEBPACK_IMPORTED_MODULE_9__["default"].color;
    if (--color < 0) color = _config__WEBPACK_IMPORTED_MODULE_4__.hexPalette.length - 1;

    _player__WEBPACK_IMPORTED_MODULE_9__["default"].switchColor(color);
});

const colorInc = new _Tool__WEBPACK_IMPORTED_MODULE_2__["default"]('right color', 'KeyS');
colorInc.on('down', function () {
    let color = _player__WEBPACK_IMPORTED_MODULE_9__["default"].color;
    if (++color >= _config__WEBPACK_IMPORTED_MODULE_4__.hexPalette.length) color = 0;

    _player__WEBPACK_IMPORTED_MODULE_9__["default"].switchColor(color);
});

const chatOpac = new _Tool__WEBPACK_IMPORTED_MODULE_2__["default"]('toggle chat', 'KeyK');
chatOpac.on('down', function () {
    (0,_Chat__WEBPACK_IMPORTED_MODULE_0__.toggleChat)();
});

const menuOpac = new _Tool__WEBPACK_IMPORTED_MODULE_2__["default"]('toggle menu', 'KeyL');
menuOpac.on('down', function () {
    (0,_ui_toggles__WEBPACK_IMPORTED_MODULE_13__.toggleTopMenu)();
});

const allOpac = new _Tool__WEBPACK_IMPORTED_MODULE_2__["default"]('toggle everything', 'Semicolon' /* ; */);
allOpac.on('down', function () {
    (0,_ui_toggles__WEBPACK_IMPORTED_MODULE_13__.toggleEverything)();
});

class CtrlZ extends _Tool__WEBPACK_IMPORTED_MODULE_2__["default"] {
    constructor(...args) {
        super(...args);

        this.handlers();
    }

    handlers() {
        let isDown = false;

        function reset() {
            isDown = false;

            this.off('tick', tick);
            tickTime = tickMax;
            lastTick = 0;
        }
        reset = reset.bind(this);

        const down = function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (e.gesture) {
                return reset();
            }

            // i know about e.repeat
            if (isDown) return;
            isDown = true;

            tick();
            this.on('tick', tick);
        }.bind(this);

        const move = function (e) {
            if (e.gesture) {
                reset();
            }
        }.bind(this);

        const up = function () {
            reset();
        }.bind(this);

        const tickMax = 500;
        const tickMin = 50;

        const nocdMinTick = 2;
        // ticknow = ticknow - (ts / nocdStepFactor)
        // i.e ms passed since last tick divided by this factor
        const nocdStepFactor = 100;

        const step = 1.5;
        let tickTime = tickMax;

        let lastTick = 0;
        const tick = function () {
            const ts = Date.now() - lastTick;
            if (ts < tickTime) return;
            let multiTicks = ts / tickTime | 0;
            // when lastTick is 0 (tool is just activated)
            if (multiTicks < 0) multiTicks = 1;

            lastTick = Date.now();

            do {
                // if (tickTime <= tickMin) {
                //     if(player.bucket.delay < tickMin){
                //         tickTime = Math.max(nocdMinTick, tickTime-(ts/nocdStepFactor))
                //     }
                // }else{
                //     tickTime /= step;
                // }

                // instead of speeding up we'll do it only if alt pressed
                const altFactor = _globals__WEBPACK_IMPORTED_MODULE_7__["default"].toolManager.altDown ? 0.2 : 1;
                tickTime = Math.max(tickTime / step, tickMin * altFactor);

                if (_player__WEBPACK_IMPORTED_MODULE_9__["default"].placed.length > _player__WEBPACK_IMPORTED_MODULE_9__["default"].maxPlaced) {
                    _player__WEBPACK_IMPORTED_MODULE_9__["default"].placed = _player__WEBPACK_IMPORTED_MODULE_9__["default"].placed.slice(-_player__WEBPACK_IMPORTED_MODULE_9__["default"].maxPlaced);
                }
                if (!_player__WEBPACK_IMPORTED_MODULE_9__["default"].placed.length) return;
                if (!_player__WEBPACK_IMPORTED_MODULE_9__["default"].bucket.spend(1)) return;

                const [x, y, c] = _player__WEBPACK_IMPORTED_MODULE_9__["default"].placed.pop();

                (0,_player__WEBPACK_IMPORTED_MODULE_9__.placePixel)(x, y, c, false, true);
            }
            while (--multiTicks)
        }.bind(this);

        this.on('down', down);
        _globals__WEBPACK_IMPORTED_MODULE_7__["default"].eventManager.on('mousemove', move);
        this.on('up', up);
    }
}
const ctrlZ = new CtrlZ('ctrlZ', 'KeyZ', _img_toolIcons_revert_png__WEBPACK_IMPORTED_MODULE_29__["default"]);

class Grid extends _Tool__WEBPACK_IMPORTED_MODULE_2__["default"] {
    constructor(...args) {
        super(...args);

        this.state = 0;
        this.fx = null;

        this.pattern = null;

        _camera__WEBPACK_IMPORTED_MODULE_3__["default"].on('zoom', () => {
            if (this.state == 1) {
                this.tryRender();
            }
        });

        this.on('down', this.pressed.bind(this));
        if (JSON.parse((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_18__.getOrDefault)('enableGrid', false))) {
            this.show();
        }
    }

    pressed(e) {
        if (e.repeat) return;
        this.toggle();
    }

    /**@param {CanvasRenderingContext2D} ctx*/
    drawGrid(ctx) {
        let [x, y] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_17__.screenToBoardSpace)(0, 0),
            [clientX, clientY] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_17__.boardToScreenSpace)(x, y);

        let { width, height } = ctx.canvas;
        const zoom = _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom;


        ctx.fillStyle = 'rgb(127,127,127)';

        // make grid fade out from zoom 16 to 5 (lower than 5 is invisible)
        const calculatedAlpha = zoom > 16 ? 0.5 : (0,_utils_math__WEBPACK_IMPORTED_MODULE_19__.mapRange)(zoom, 24, 5, 0.5, 0);
        ctx.globalAlpha = calculatedAlpha;

        let thickInterval;
        if (_config__WEBPACK_IMPORTED_MODULE_4__.chunkSize % 16 == 0) thickInterval = 16;
        else if (_config__WEBPACK_IMPORTED_MODULE_4__.chunkSize % 10 == 0) thickInterval = 10;
        else thickInterval = null;

        // finally, i decided to disable this feature
        thickInterval = null;

        let wid = 1;

        // kostyl
        x--; y--;

        // pixels lines
        for (; clientX < width; clientX += zoom) {
            x++
            if (x % thickInterval == 0) wid = 1;
            else wid = 1;

            if (x % _config__WEBPACK_IMPORTED_MODULE_4__.chunkSize == 0) wid = 1;

            ctx.fillRect(clientX | 0, 0, wid, height);
        }

        for (; clientY < height; clientY += zoom) {
            y++
            if (y % thickInterval == 0) wid = 1;
            else wid = 1;

            if (y % _config__WEBPACK_IMPORTED_MODULE_4__.chunkSize == 0) wid = 1;

            ctx.fillRect(0, clientY | 0, width, wid);
        }

        ctx.globalAlpha = 1;
    }

    tryRender() {
        if (!this.fx || this.fx.removed) {
            this.fx = new _fxcanvas__WEBPACK_IMPORTED_MODULE_6__.FX(this.render.bind(this));
            (0,_fxcanvas__WEBPACK_IMPORTED_MODULE_6__.addFX)(this.fx, 2);
        }
    }

    toggle() {
        if (this.state == 0) this.show();
        else this.hide();
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_18__.setLS)('enableGrid', (!!this.state).toString())
    }

    show() {
        this.state = 1;
        this.tryRender();
    }

    hide() {
        this.state = 0;
        this.fx && (0,_fxcanvas__WEBPACK_IMPORTED_MODULE_6__.removeFX)(this.fx);
    }

    render(ctx) {
        if (_camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom <= 5) return 1;

        this.drawGrid(ctx);
    }
}
const grid = new Grid('grid', 'KeyG');

// WARNING: it's not supposed to be a bot
// so it won't check for connection or re-check image
// write your own bots please 
class Paste extends _Tool__WEBPACK_IMPORTED_MODULE_2__["default"] {
    constructor(...args) {
        super(...args);

        // 0 - idle
        // 1 - choosing
        // 2 - placing
        // 3 - drawing
        this.state = 0;

        this.moveFX = null;
        this.drawInterval = null;

        this.lastClipboardEvent = {
            ev: null,
            date: null
        }

        this.initListeners();
    }

    initListeners() {
        this.on('down', this.down.bind(this));
    }

    async down() {
        if (this.state === 0 || this.state === 1) {
            this.state = 1;

            // in case 'Paste' event launched later
            await (0,_utils_misc__WEBPACK_IMPORTED_MODULE_20__.sleep)(100);

            try {
                let whichOne = 'file';
                if (this.isImagePasted()) {
                    whichOne = await this.promptClipboardOrFile();
                }

                let canvas;
                if (whichOne === 'clip') {
                    canvas = await this.getClipboardImage(this.lastClipboardEvent.ev);
                } else if (whichOne === 'file') {
                    canvas = await this.askFileImage();
                }
                if (canvas)
                    this.startPlace(canvas);

                this.lastClipboardEvent.ev = null;
                this.lastClipboardEvent.date = null;
            } finally {
                this.state = 0;
            }
        } else if (this.state == 2) {
            // this.state = 0
            // this.stopPlace();
        } else if (this.state == 3) {
            this.state = 0;
            this.stopDraw();
        }
    }

    async promptClipboardOrFile() {
        return new Promise((res, rej) => {
            try {
                const btns = [{
                    text: (0,_translate__WEBPACK_IMPORTED_MODULE_11__.translate)('from_clipboard'),
                    id: 'clip'
                },
                {
                    text: (0,_translate__WEBPACK_IMPORTED_MODULE_11__.translate)('from_file'),
                    id: 'file'
                }];

                const win = new _MiniWindow__WEBPACK_IMPORTED_MODULE_1__.SelectMiniWindow(btns, res, (0,_translate__WEBPACK_IMPORTED_MODULE_11__.translate)('paste.choose_from'));
                document.body.appendChild(win.element[0]);

                win.center();
            } catch (error) {
                rej(error);
            }
        });
    }

    isImagePasted() {
        const lastEv = this.lastClipboardEvent;
        if (!lastEv.images || Date.now() - lastEv.date > 1000) return false;
        return true;
    }

    async getClipboardImage() {
        const { images } = this.lastClipboardEvent;
        if (!images?.length) return null;
        return await this.readCanvasFromFile(images[0]);
    }

    async askFileImage() {
        // get file from system
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/png';

        input.click();

        return new Promise((res, rej) => {
            input.onchange = () => {
                input.onchange = null;

                if (!input.files.length || input.files[0] == "") {
                    return rej();
                }

                // read first file with filereader
                this.readCanvasFromFile(input.files[0])
                    .then(res)
                    .catch(rej);
            }
        })
    }

    readCanvasFromFile(file) {
        return new Promise((res, rej) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);

            reader.onload = () => {
                const img = new Image();
                img.src = reader.result;
                img.onload = () => {
                    // draw image on canvas to get its data
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width;
                    canvas.height = img.height;

                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0);

                    res(canvas);
                }
                img.onerror = rej;
            }
            reader.onerror = rej;
        })
    }

    startPlace(canvas, protectMask = null) {
        if (protectMask && protectMask.length !== canvas.width * canvas.height) {
            throw new Error('protect mask length mismatch');
        }

        _player__WEBPACK_IMPORTED_MODULE_9__["default"].suspendColors();
        this.state = 2;

        let xPos = _player__WEBPACK_IMPORTED_MODULE_9__["default"].x,
            yPos = _player__WEBPACK_IMPORTED_MODULE_9__["default"].y;

        function render(ctx) {
            const [x, y] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_17__.boardToScreenSpace)(xPos, yPos);
            const z = _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom;

            const opacity = (0,_utils_math__WEBPACK_IMPORTED_MODULE_19__.mapRange)(Math.sin(Date.now() / 400), -1, 1, 0.5, 1);
            ctx.globalAlpha = opacity;

            ctx.save();
            ctx.scale(z, z);
            ctx.drawImage(canvas, x / z, y / z);
            ctx.restore();

            ctx.globalAlpha = 1;
            return 0
        }

        const fx = this.moveFX = new _fxcanvas__WEBPACK_IMPORTED_MODULE_6__.FX(render);
        (0,_fxcanvas__WEBPACK_IMPORTED_MODULE_6__.addFX)(fx);

        function move() {
            let newX = _player__WEBPACK_IMPORTED_MODULE_9__["default"].x,
                newY = _player__WEBPACK_IMPORTED_MODULE_9__["default"].y;
            if (newX == xPos && newY == yPos)
                return;

            xPos = newX;
            yPos = newY;
        }

        let lastX, lastY;
        let down = function (e) {
            lastX = e.clientX;
            lastY = e.clientY;
        }

        let up = function (e) {
            if (e.button == 2) {
                this.state = 0;
                this.stopPlace(); off();
                return;
            };

            let [x, y] = [e.clientX, e.clientY];
            if (Math.abs(x - lastX) > 5 || Math.abs(y - lastY) > 5) return;

            off();
            _player__WEBPACK_IMPORTED_MODULE_9__["default"].restoreColors();

            this.stopPlace();
            this.startDraw(canvas, xPos, yPos, protectMask);
        }
        up = up.bind(this);

        function off() {
            _globals__WEBPACK_IMPORTED_MODULE_7__["default"].eventManager.off('mousedown', down);
            _globals__WEBPACK_IMPORTED_MODULE_7__["default"].eventManager.off('mouseup', up);
            _globals__WEBPACK_IMPORTED_MODULE_7__["default"].toolManager.off('move', move);
        }

        _globals__WEBPACK_IMPORTED_MODULE_7__["default"].eventManager.on('mousedown', down);
        _globals__WEBPACK_IMPORTED_MODULE_7__["default"].eventManager.on('mouseup', up);
        _globals__WEBPACK_IMPORTED_MODULE_7__["default"].toolManager.on('move', move);
    }

    stopPlace() {
        (0,_fxcanvas__WEBPACK_IMPORTED_MODULE_6__.removeFX)(this.moveFX);
        this.removeAllListeners('move');
    }

    startDraw(canvas, startX, startY, protectMask = null) {
        this.state = 3;

        const ctx = canvas.getContext('2d');
        const { width: w } = canvas;

        let imgdata = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
        let offset = -4;

        const isMod = _me__WEBPACK_IMPORTED_MODULE_8__["default"].role >= _constants__WEBPACK_IMPORTED_MODULE_5__.ROLE.MOD;

        function draw() {
            let allowance = Math.floor(_player__WEBPACK_IMPORTED_MODULE_9__["default"].bucket.allowance);
            if (allowance == 0) return;

            let pixels = [], protectPixels = [];

            let max = 13106;
            if ((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_18__.getLS)('ya', false) === 'polkovnik') {
                max = 52441;
            }
            while (allowance > 0 && offset < imgdata.length - 4 && pixels.length < max && protectPixels.length < max) {
                offset += 4;

                let rgba = [
                    imgdata[offset],
                    imgdata[offset + 1],
                    imgdata[offset + 2],
                    imgdata[offset + 3],
                ]

                if (rgba[3] < 127) continue;

                let off = offset / 4;
                const offX = off % w,
                    offY = off / w | 0;

                const boardX = startX + offX,
                    boardY = startY + offY;
                if (boardX < 0 || boardX >= _config__WEBPACK_IMPORTED_MODULE_4__.boardWidth ||
                    boardY < 0 || boardY >= _config__WEBPACK_IMPORTED_MODULE_4__.boardHeight)
                    continue

                if (isMod && protectMask) {
                    const protectedState = protectMask[offX + offY * w];
                    protectPixels.push([boardX, boardY, protectedState]);
                }


                const color = (0,_utils_color__WEBPACK_IMPORTED_MODULE_16__.closestColor)(rgba, _config__WEBPACK_IMPORTED_MODULE_4__.palette);
                const oldCol = _globals__WEBPACK_IMPORTED_MODULE_7__["default"].chunkManager.getChunkPixel(boardX, boardY);
                if (oldCol == color) continue;

                allowance--;

                pixels.push([boardX, boardY, color]);
            }

            if (pixels.length) {
                _player__WEBPACK_IMPORTED_MODULE_9__["default"].bucket.spend(pixels.length);
                _globals__WEBPACK_IMPORTED_MODULE_7__["default"].socket.sendPixels(pixels);
                if (protectPixels.length) {
                    _globals__WEBPACK_IMPORTED_MODULE_7__["default"].socket.sendPixels(protectPixels, true);
                }
            }

            if (offset >= imgdata.length - 4) {
                this.state = 0;
                this.stopDraw();
            }
        }

        this.drawInterval = setInterval(draw.bind(this), 50);
    }

    stopDraw() {
        clearInterval(this.drawInterval);
    }
}
const paste = new Paste('paste', 'CTRL+KeyV', null, _constants__WEBPACK_IMPORTED_MODULE_5__.ROLE.MOD);
document.addEventListener('paste', (ev) => {
    // paste event does not work for other than ctrl+v
    // so skip in case some another tool assigned for this key
    // (check your sanity if you do :D)
    if (paste.key !== 'CTRL+KeyV') return;

    const images = [];
    for (const item of ev.clipboardData.items) {
        if (item.type.startsWith('image/')) {
            images.push(item.getAsFile());
        }
    }

    if (images.length) {
        paste.lastClipboardEvent = {
            images,
            date: Date.now()
        };
    }
})

// TODO move it to config or globals
let tempOpacity = parseFloat((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_18__.getOrDefault)('template.opacity', 0.5, true));
const templateOp1 = new _Tool__WEBPACK_IMPORTED_MODULE_2__["default"]('template 0/N opaq', 'KeyO');
templateOp1.on('down', () => {
    if (_template__WEBPACK_IMPORTED_MODULE_10__["default"].opacity == 0) {
        _template__WEBPACK_IMPORTED_MODULE_10__["default"].opacity = tempOpacity;
    } else {
        tempOpacity = _template__WEBPACK_IMPORTED_MODULE_10__["default"].opacity
        _template__WEBPACK_IMPORTED_MODULE_10__["default"].opacity = 0;
    }
    (0,_template__WEBPACK_IMPORTED_MODULE_10__.updateTemplate)();
});

const templateOp2 = new _Tool__WEBPACK_IMPORTED_MODULE_2__["default"]('template 1/N opaq', 'KeyP');
templateOp2.on('down', () => {
    if (_template__WEBPACK_IMPORTED_MODULE_10__["default"].opacity == 1) {
        _template__WEBPACK_IMPORTED_MODULE_10__["default"].opacity = tempOpacity;
    } else {
        tempOpacity = _template__WEBPACK_IMPORTED_MODULE_10__["default"].opacity
        _template__WEBPACK_IMPORTED_MODULE_10__["default"].opacity = 1;
    }
    (0,_template__WEBPACK_IMPORTED_MODULE_10__.updateTemplate)();
});

class Square extends _Tool__WEBPACK_IMPORTED_MODULE_2__["default"] {
    constructor(...args) {
        super(...args);

        this.handlers();
    }

    handlers() {
        let startCoords, endCoords, lastCoords = [],
            fx, isDown = false,
            square,
            color, color2;

        function down() {
            if (isDown) return;
            isDown = true;

            startCoords = [_player__WEBPACK_IMPORTED_MODULE_9__["default"].x, _player__WEBPACK_IMPORTED_MODULE_9__["default"].y];

            [color, color2] = [_player__WEBPACK_IMPORTED_MODULE_9__["default"].color, _player__WEBPACK_IMPORTED_MODULE_9__["default"].secondCol];

            this.emit('move');
        }

        function move() {
            if (!isDown || !startCoords) return;

            endCoords = [_player__WEBPACK_IMPORTED_MODULE_9__["default"].x, _player__WEBPACK_IMPORTED_MODULE_9__["default"].y];

            if (endCoords[0] != lastCoords[0] || endCoords[1] != lastCoords[1]) {
                lastCoords = endCoords;

                const pixels = _utils_shapes__WEBPACK_IMPORTED_MODULE_21__["default"].square(...startCoords, ...endCoords)

                fx && (0,_fxcanvas__WEBPACK_IMPORTED_MODULE_6__.removeFX)(fx);
                fx = new _fxcanvas__WEBPACK_IMPORTED_MODULE_6__.FX((ctx) => {
                    ctx.globalAlpha = .5;

                    for (let [x, y] of pixels) {
                        const [sx, sy] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_17__.boardToScreenSpace)(x, y);
                        const color = getColByCord(x, y);
                        ctx.fillStyle = _config__WEBPACK_IMPORTED_MODULE_4__.hexPalette[color];
                        ctx.fillRect(sx, sy, _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom, _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom);
                    }

                    ctx.globalAlpha = 1;

                    return 1
                })
                ;(0,_fxcanvas__WEBPACK_IMPORTED_MODULE_6__.addFX)(fx)
            }
        }

        function up() {
            this.off('tick', tick);
            isDown = false;

            if (!startCoords) return;

            fx && fx.remove();

            if (!endCoords) endCoords = [_player__WEBPACK_IMPORTED_MODULE_9__["default"].x, _player__WEBPACK_IMPORTED_MODULE_9__["default"].y];

            square = _utils_shapes__WEBPACK_IMPORTED_MODULE_21__["default"].square(...startCoords, ...endCoords);

            renderFX();

            if (square.length <= 1) return;
            this.on('tick', tick);
        }

        function tick() {
            let infCd = (_player__WEBPACK_IMPORTED_MODULE_9__["default"].bucket.allowance === Infinity);

            if (!this.lastTick) this.lastTick = Date.now();

            if (infCd && Date.now() - this.lastTick < 50) return;
            this.lastTick = Date.now();

            //   0
            let counter = 0;
            let toSend = [];
            while (counter < 1000) {
                if (!square || !square.length) {
                    this.off('tick', tick);
                    break;
                }

                const [x, y] = square.pop();
                const col = getColByCord(x, y, color, color2);

                if (col === undefined || col === -1) return this.off('tick', tick);
                if (!checkBounds(x, y)) continue;
                if (getPixel(x, y) === col) continue;
                if (!_player__WEBPACK_IMPORTED_MODULE_9__["default"].bucket.spend(1)) return square.push([x, y]);

                counter++;

                if (infCd) {
                    toSend.push([x, y, col]);
                } else {
                    (0,_player__WEBPACK_IMPORTED_MODULE_9__.placePixel)(x, y, col);
                }
            }

            if (toSend.length) {
                (0,_player__WEBPACK_IMPORTED_MODULE_9__.placePixels)(toSend, true);
            }
        }

        down = down.bind(this);
        move = move.bind(this);
        up = up.bind(this);

        tick = tick.bind(this);

        this.on('down', down);
        this.on('move', move);
        this.on('up', up);
    }
}
const square = new Square('square', 'KeyJ');

const incBrush = new _Tool__WEBPACK_IMPORTED_MODULE_2__["default"]('+brush size', 'BracketRight'); // [
incBrush.on('down', () => {
    if (_player__WEBPACK_IMPORTED_MODULE_9__["default"].brushSize >= 100) return;
    if (_player__WEBPACK_IMPORTED_MODULE_9__["default"].brushSize == 1) return (0,_player__WEBPACK_IMPORTED_MODULE_9__.updateBrush)(4);
    (0,_player__WEBPACK_IMPORTED_MODULE_9__.updateBrush)(_player__WEBPACK_IMPORTED_MODULE_9__["default"].brushSize + 2);
});

const decBrush = new _Tool__WEBPACK_IMPORTED_MODULE_2__["default"]('-brush size', 'BracketLeft'); // ]
decBrush.on('down', () => {
    if (_player__WEBPACK_IMPORTED_MODULE_9__["default"].brushSize <= 4) return (0,_player__WEBPACK_IMPORTED_MODULE_9__.updateBrush)(1);
    (0,_player__WEBPACK_IMPORTED_MODULE_9__.updateBrush)(_player__WEBPACK_IMPORTED_MODULE_9__["default"].brushSize - 2);
})

class Copy extends _Tool__WEBPACK_IMPORTED_MODULE_2__["default"] {
    constructor(...args) {
        super(...args);

        // 0 - idle
        // 1 - started selection
        this.state = 0;

        this.selectFX = null;

        this.initListeners();
    }

    initListeners() {
        this.on('down', this.down.bind(this));
    }

    down(e) {
        if (this.state > 0 || paste.state > 0)
            return

        // since default key is ctrl+c
        const isTextSelected = (window.getSelection().type === 'Range');
        if (isTextSelected) return;

        e.preventDefault();
        e.stopPropagation();

        _camera__WEBPACK_IMPORTED_MODULE_3__["default"].disableMove();
        _player__WEBPACK_IMPORTED_MODULE_9__["default"].suspendColors();
        _ui_elements__WEBPACK_IMPORTED_MODULE_12__.mainCanvas.css('cursor', 'crosshair');

        this.state = 1;

        let fx;
        let startX, startY, endX, endY;

        let altPressed = false,
            lassoMode = false,
            lassoPoints = [];
        function keydown(e) {
            if (e.key === 'Alt')
                altPressed = true;
        }
        // function keyup(e) {
        //     // tf is this ... ???
        //     if (e.key === 'Alt')
        //         altPressed = false;
        // }

        function mousedown() {
            if (altPressed) {
                lassoMode = true;
                lassoPoints = [[_player__WEBPACK_IMPORTED_MODULE_9__["default"].x, _player__WEBPACK_IMPORTED_MODULE_9__["default"].y]];
            } else {
                startX = _player__WEBPACK_IMPORTED_MODULE_9__["default"].x;
                startY = _player__WEBPACK_IMPORTED_MODULE_9__["default"].y;
            }
        }
        function mousemove() {
            if (lassoMode) {
                let x = _player__WEBPACK_IMPORTED_MODULE_9__["default"].x,
                    y = _player__WEBPACK_IMPORTED_MODULE_9__["default"].y;

                lassoPoints.push([x, y]);
            } else {
                endX = _player__WEBPACK_IMPORTED_MODULE_9__["default"].x + 1;
                endY = _player__WEBPACK_IMPORTED_MODULE_9__["default"].y + 1;
            }
        }
        function mouseup() {
            // area is selected and we can tell Paste tool to draw it
            _ui_elements__WEBPACK_IMPORTED_MODULE_12__.mainCanvas.css('cursor', '');

            (0,_fxcanvas__WEBPACK_IMPORTED_MODULE_6__.removeFX)(fx);

            _globals__WEBPACK_IMPORTED_MODULE_7__["default"].eventManager.off('keydown', keydown);
            // globals.eventManager.off('keyup', keyup);
            _globals__WEBPACK_IMPORTED_MODULE_7__["default"].eventManager.off('mousedown', mousedown);
            _globals__WEBPACK_IMPORTED_MODULE_7__["default"].eventManager.off('mousemove', mousemove);
            _globals__WEBPACK_IMPORTED_MODULE_7__["default"].eventManager.off('mouseup', mouseup);

            this.state = 0;

            _camera__WEBPACK_IMPORTED_MODULE_3__["default"].enableMove();
            _player__WEBPACK_IMPORTED_MODULE_9__["default"].restoreColors();

            onSelected();
        }

        function render(ctx) {
            ctx.save();

            ctx.strokeStyle = 'gray';
            ctx.lineWidth = 2;
            ctx.setLineDash([3, 3]);
            ctx.globalAlpha = 1;

            if (lassoMode) {
                ctx.beginPath();
                const firstCord = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_17__.boardToScreenSpace)(lassoPoints[0][0], lassoPoints[0][1]);
                ctx.moveTo(...firstCord);
                for (let i = 1; i < lassoPoints.length; i++) {
                    const point = lassoPoints[i];
                    ctx.lineTo(...(0,_utils_conversions__WEBPACK_IMPORTED_MODULE_17__.boardToScreenSpace)(...point))
                }
                ctx.closePath();
                ctx.stroke();
            } else {
                const [x1, y1] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_17__.boardToScreenSpace)(startX, startY);
                const [x2, y2] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_17__.boardToScreenSpace)(endX, endY);
                ctx.strokeRect(x1, y1, x2 - x1, y2 - y1);
            }

            ctx.restore();
            return 1
        }
        fx = new _fxcanvas__WEBPACK_IMPORTED_MODULE_6__.FX(render);
        (0,_fxcanvas__WEBPACK_IMPORTED_MODULE_6__.addFX)(fx);

        keydown = keydown.bind(this);
        // keyup = keyup.bind(this);
        mousedown = mousedown.bind(this);
        mousemove = mousemove.bind(this);
        mouseup = mouseup.bind(this);

        _globals__WEBPACK_IMPORTED_MODULE_7__["default"].eventManager.on('keydown', keydown);
        // globals.eventManager.on('keyup', keyup);
        _globals__WEBPACK_IMPORTED_MODULE_7__["default"].eventManager.on('mousedown', mousedown);
        _globals__WEBPACK_IMPORTED_MODULE_7__["default"].eventManager.on('mousemove', mousemove);
        _globals__WEBPACK_IMPORTED_MODULE_7__["default"].eventManager.on('mouseup', mouseup);


        function onSelected() {
            let minX, maxX, minY, maxY;
            if (lassoMode) {
                minX = maxX = lassoPoints[0][0];
                minY = maxY = lassoPoints[0][1];
                for (let i = 0; i < lassoPoints.length; i++) {
                    const point = lassoPoints[i];
                    if (point[0] < minX)
                        minX = point[0];
                    if (point[0] > maxX)
                        maxX = point[0];
                    if (point[1] < minY)
                        minY = point[1];
                    if (point[1] > maxY)
                        maxY = point[1];
                }
            } else {
                if ([startX, startY, endX, endY].some(x => x === undefined))
                    return;

                minX = Math.min(startX, endX);
                maxX = Math.max(startX, endX) + 1;
                minY = Math.min(startY, endY);
                maxY = Math.max(startY, endY) + 1;
            }

            // normalize coordinates
            minX = Math.max(minX, 0);
            maxX = Math.min(maxX, _config__WEBPACK_IMPORTED_MODULE_4__.boardWidth);
            minY = Math.max(minY, 0);
            maxY = Math.min(maxY, _config__WEBPACK_IMPORTED_MODULE_4__.boardHeight);

            const w = maxX - minX;
            const h = maxY - minY;

            const canvas = document.createElement('canvas');
            canvas.width = w;
            canvas.height = h;

            const ctx = canvas.getContext('2d');
            const data = ctx.createImageData(w, h);
            const protectMask = new Uint8Array(w * h);

            // poly x coordinates and y coordinates arrays
            let vertx, verty;
            if (lassoMode) {
                vertx = new Array(lassoPoints.length);
                verty = new Array(lassoPoints.length);

                for (let i = 0; i < lassoPoints.length; i++) {
                    const point = lassoPoints[i];
                    vertx[i] = point[0];
                    verty[i] = point[1];
                }
            }

            // local canvas coordinates
            for (let x = 0; x < w; x++) {
                for (let y = 0; y < h; y++) {
                    const i = (x + y * w) * 4;

                    // absolute board coordinates
                    const absX = minX + x;
                    const absY = minY + y;

                    if (lassoMode && !(0,_utils_misc__WEBPACK_IMPORTED_MODULE_20__.testPointInPolygon)(lassoPoints.length, vertx, verty, absX, absY)) {
                        continue
                    }


                    const isProtected = _globals__WEBPACK_IMPORTED_MODULE_7__["default"].chunkManager.getProtect(absX, absY);
                    protectMask[i / 4] = isProtected;

                    const colId = _globals__WEBPACK_IMPORTED_MODULE_7__["default"].chunkManager.getChunkPixel(absX, absY);
                    const col = _config__WEBPACK_IMPORTED_MODULE_4__.palette[colId];

                    data.data[i] = col[0];
                    data.data[i + 1] = col[1];
                    data.data[i + 2] = col[2];
                    data.data[i + 3] = 255;
                }
            }

            ctx.putImageData(data, 0, 0);

            // let the Paste tool do other stuff
            paste.startPlace(canvas, protectMask);
        }
    }
}
const copy = new Copy('copy', 'CTRL+KeyC', null, _constants__WEBPACK_IMPORTED_MODULE_5__.ROLE.MOD);

const pixelInfo = new _Tool__WEBPACK_IMPORTED_MODULE_2__["default"]('pixel info', 'KeyI');

let last = null, pinfoFx = null
function removeLast() {
    if (last) {
        last.remove();
        last = null;
    }
    if (pinfoFx) {
        pinfoFx.remove();
        pinfoFx = null;
    }
}
_globals__WEBPACK_IMPORTED_MODULE_7__["default"].eventManager.on('mouseup', removeLast);

pixelInfo.on('up', async () => {
    removeLast()

    const [x, y] = [_player__WEBPACK_IMPORTED_MODULE_9__["default"].x, _player__WEBPACK_IMPORTED_MODULE_9__["default"].y];

    const resp = await (0,_utils_api__WEBPACK_IMPORTED_MODULE_14__.apiRequest)(`/pixelInfo?canvas=${_config__WEBPACK_IMPORTED_MODULE_4__.canvasId}&x=${x}&y=${y}`);
    const data = await resp.json();
    if (!data || !data.type) return;

    const el = $('<div class="infoBubble"><span style="user-select:text"></span></div>');
    last = el;

    const coordsLegend = $('<div>');
    coordsLegend[0].style.cssText =
        `position: absolute;
    top: -7px;
    left: 0;
    width: 100%;
    font-size: 14px;
    font-weight: bold;
    text-shadow: rgb(255 255 255) -1px 1px 0px, rgb(255 255 255) 1px 1px 0px, rgb(255 255 255) 1px -1px 0px, rgb(255 255 255) -1px -1px 0px;
    text-align: center;`
    coordsLegend.text(`(${x}, ${y})`)

    el.append(coordsLegend);

    let text = '';

    if (data.type === 'UID') {
        const sanitizedName = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_20__.htmlspecialchars)(data.placer.nick);

        text += '<b>UID</b>&nbsp;' + data.placer.id + '<br>',
            text += '<b>name</b>&nbsp;' + sanitizedName;
    } else {
        text += `<b>${data.type}</b>`;
        if (data.placer) {
            text += '&nbsp;' + data.placer
        }
    }

    $('span', el).html(text);

    $('body').append(el);

    const w = el[0].clientWidth;
    const h = el[0].clientHeight;

    function fixPos() {
        const [clientX, clientY] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_17__.boardToScreenSpace)(x, y);
        const posX = clientX + (_camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom / 2) - (w / 2)
        const posY = clientY - h - 11;

        el.css('top', posY).css('left', posX);

        return 1;
    }
    fixPos();


    pinfoFx = new _fxcanvas__WEBPACK_IMPORTED_MODULE_6__.FX(() => {
        fixPos();
    })
    ;(0,_fxcanvas__WEBPACK_IMPORTED_MODULE_6__.addFX)(pinfoFx, 2);
});

class PixelFont {
    static defaultVSpacing = 1;

    constructor(imagePath, infoPath) {
        this.imagePath = imagePath;
        this.infoPath = infoPath;

        this.defaultWidth = null;
        this.defaultHeight = null;
        this.letters = {};

        this.loaded = false;
        this._isLoading = false;
    }

    async load() {
        if (this._isLoading) return;
        this._isLoading = true;

        try {
            const fontCanvas = await new Promise((res, rej) => {
                const img = new Image();

                img.onload = () => {
                    const canvas = document.createElement('canvas');

                    canvas.width = img.width;
                    canvas.height = img.height;

                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0);

                    res(canvas);
                }

                img.onerror = rej;

                img.src = this.imagePath;
            })

            const fontInfoResp = await fetch(this.infoPath);
            const fontInfo = await fontInfoResp.json();

            const defaultWidth = fontInfo.defaultWidth;
            this.defaultWidth = defaultWidth;
            const height = fontInfo.fixedHeight;
            this.defaultHeight = height;

            const fontCanvasCtx = fontCanvas.getContext('2d');
            this.letters = {};

            let offsetX = 0;
            for (let letter of fontInfo.letters) {
                const {
                    letter: letterSymbol,
                    width = defaultWidth
                } = letter;

                const slice = fontCanvasCtx.getImageData(offsetX, 0, width, height);
                this.letters[letterSymbol] = slice;

                // extra 1 because it's one white pixel before each next letter
                offsetX += width + 1;
            }
        } catch (error) {
            this._isLoading = false;
            throw error
        }

        this._isLoading = false;
        this.loaded = true;
    }

    drawText(text, color = 'black') {
        if (!this.loaded) throw new Error('font not loaded');

        text = text.toUpperCase();

        const {
            width: textWidth,
            height: textHeight
        } = this.measureText(text);

        if (textWidth == 0 || textHeight == 0) {
            return null;
        }

        const colorCanvas = document.createElement('canvas');
        const textCanvas = document.createElement('canvas');

        colorCanvas.width = textCanvas.width = textWidth;
        colorCanvas.height = textCanvas.height = textHeight;

        const colorCanvasCtx = colorCanvas.getContext('2d');
        const textCanvasCtx = textCanvas.getContext('2d');

        const textLetters = text.split('');
        let cursorX = 0, cursorY = 0;
        for (let letter of textLetters) {
            if (letter == '\n') {
                cursorY += this.defaultHeight + PixelFont.defaultVSpacing;
                cursorX = 0;
                continue
            }

            if (letter == ' ') {
                cursorX += this.defaultWidth;
                continue
            }

            let letterImData = this.letters[letter];
            if (!letterImData) {
                cursorX += this.defaultWidth;
                continue
            }

            textCanvasCtx.putImageData(letterImData, cursorX, cursorY);
            cursorX += letterImData.width + 1; // 1 is the constant spacing
        }

        // first, we draw text canvas shaped, colored rect 
        // then we will put the text on top of it, using
        // globalComposite property.
        // this will keep only those pixels of colored rect, in which
        // letters are. this will "color" the letters in the color of the rect
        colorCanvasCtx.fillStyle = color;
        colorCanvasCtx.fillRect(0, 0, textWidth, textHeight);

        colorCanvasCtx.globalCompositeOperation = 'destination-atop';
        colorCanvasCtx.drawImage(textCanvas, 0, 0);

        return colorCanvas;
    }

    measureText(text) {
        if (!this.loaded) throw new Error('font not loaded');

        text = text.toUpperCase();

        const textLetters = text.split('');
        let curWidth = 0, maxWidth = 0, height = this.defaultHeight;

        for (let letter of textLetters) {
            if (letter == '\n') {
                height += this.defaultHeight + PixelFont.defaultVSpacing;
                maxWidth = Math.max(curWidth, maxWidth);
                curWidth = 0;
                continue
            }

            if (letter == ' ') {
                curWidth += this.defaultWidth;
                continue
            }

            if (this.letters[letter]) {
                curWidth += (this.letters[letter].width || this.defaultWidth) + 1;
            }
        }

        return {
            width: Math.max(curWidth, maxWidth), height
        }
    }
}

class Text extends _Tool__WEBPACK_IMPORTED_MODULE_2__["default"] {
    constructor(...args) {
        super(...args);

        this.fonts = [
            new PixelFont(_font_pixel_min5_png__WEBPACK_IMPORTED_MODULE_32__["default"], _font_pixel_min5_txt__WEBPACK_IMPORTED_MODULE_33__["default"])
        ];
        this.fonts.forEach(f => f.load());

        this.miniWindow = null;

        this.on('down', this.down.bind(this));
    }

    down(e) {
        if (this.miniWindow && !this.miniWindow.closed) return;

        _globals__WEBPACK_IMPORTED_MODULE_7__["default"].lockInputs = true;

        this.miniWindow = new _MiniWindow__WEBPACK_IMPORTED_MODULE_1__["default"]('Draw text', 2);
        const winEl = this.miniWindow.element;
        if (mobile) {
            winEl.css('left', 0).css('top', 0);
        } else {
            winEl.css('left', window.screen.width / 3).css('top', window.screen.height / 3);
        }

        const innerHtml = $(`
            <textarea style="width: 100%;"></textarea>
            <div style="display:flex; margin: 2px 0">
                <div style="display: flex">
                    <div>x:</div> <input type="number" class="textXCord" style="width: 100%">
                </div>
                <div style="display: flex; margin-left: 2px">
                    <div>y:</div> <input type="number" class="textYCord" style="width: 100%">
                </div>
            </div>
        `);

        this.miniWindow.bodyElement.css('max-width', 200).css('display', 'flex').css('flex-direction', 'column');
        this.miniWindow.bodyElement.append(innerHtml);
        document.body.appendChild(winEl[0]);

        const textInput = $('textarea', this.miniWindow.bodyElement);
        const xCordInput = $('.textXCord', this.miniWindow.bodyElement);
        const yCordInput = $('.textYCord', this.miniWindow.bodyElement);

        const lastCord = [_player__WEBPACK_IMPORTED_MODULE_9__["default"].x, _player__WEBPACK_IMPORTED_MODULE_9__["default"].y];
        xCordInput.val(lastCord[0]);
        yCordInput.val(lastCord[1]);

        const font = this.fonts[0];

        let lastText = null, lastColor = _player__WEBPACK_IMPORTED_MODULE_9__["default"].color, lastTextCanvas = null
        const previewFx = new _fxcanvas__WEBPACK_IMPORTED_MODULE_6__.FX((ctx) => {
            const text = textInput.val();
            if (!text) return 0;

            if (!font.loaded) {
                return 0;
            }

            // remap the sine value based on the time
            // to the min-max opacity borders
            ctx.globalAlpha = (0,_utils_math__WEBPACK_IMPORTED_MODULE_19__.mapRange)(Math.sin(Date.now() / 400), -1, 1, 0.2, 0.9);

            const x = xCordInput.val();
            const y = yCordInput.val();

            if (lastText !== text || lastColor !== _player__WEBPACK_IMPORTED_MODULE_9__["default"].color) {
                lastText = text;
                lastColor = _player__WEBPACK_IMPORTED_MODULE_9__["default"].color;
                lastTextCanvas = font.drawText(lastText, _config__WEBPACK_IMPORTED_MODULE_4__.hexPalette[lastColor]);
            }

            const [screenX, screenY] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_17__.boardToScreenSpace)(x, y);


            ctx.save();
            ctx.scale(_camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom, _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom);

            ctx.imageSmoothingEnabled = false;

            const deZoomedX = screenX / _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom;
            const deZoomedY = screenY / _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom;

            if (~_player__WEBPACK_IMPORTED_MODULE_9__["default"].secondCol) {
                ctx.fillStyle = _config__WEBPACK_IMPORTED_MODULE_4__.hexPalette[_player__WEBPACK_IMPORTED_MODULE_9__["default"].secondCol];
                ctx.fillRect(deZoomedX, deZoomedY, lastTextCanvas.width, lastTextCanvas.height);
            }
            ctx.drawImage(lastTextCanvas, deZoomedX, deZoomedY);

            ctx.restore();

            return 0
        })
        ;(0,_fxcanvas__WEBPACK_IMPORTED_MODULE_6__.addFX)(previewFx);

        this.miniWindow.on('okClicked', () => {
            _globals__WEBPACK_IMPORTED_MODULE_7__["default"].lockInputs = false;

            (0,_fxcanvas__WEBPACK_IMPORTED_MODULE_6__.removeFX)(previewFx);

            const text = textInput.val();
            if (!text || !lastTextCanvas) return;

            // add background if second color is selected
            if (~_player__WEBPACK_IMPORTED_MODULE_9__["default"].secondCol) {
                const ctx = lastTextCanvas.getContext('2d');
                // draw only on opaque pixels
                ctx.globalCompositeOperation = 'destination-over';
                ctx.fillStyle = _config__WEBPACK_IMPORTED_MODULE_4__.hexPalette[_player__WEBPACK_IMPORTED_MODULE_9__["default"].secondCol];
                ctx.fillRect(0, 0, lastTextCanvas.width, lastTextCanvas.height);
            }

            const x = +xCordInput.val();
            const y = +yCordInput.val();

            paste.startDraw(lastTextCanvas, x, y);
        });

        this.miniWindow.on('cancelClicked', () => {
            _globals__WEBPACK_IMPORTED_MODULE_7__["default"].lockInputs = false;

            (0,_fxcanvas__WEBPACK_IMPORTED_MODULE_6__.removeFX)(previewFx);
        });
    }
}
const text = new Text('text', 'KeyT', null, _constants__WEBPACK_IMPORTED_MODULE_5__.ROLE.USER);

const resetColors = new _Tool__WEBPACK_IMPORTED_MODULE_2__["default"]('reset colors', 'RMB');
resetColors.on('up', () => {
    _player__WEBPACK_IMPORTED_MODULE_9__["default"].resetColors();
});

const WAND_STATE = {
    DISABLED: 0,
    SELECTING: 1,
    RENDERING: 2
}
class MagicWand extends _Tool__WEBPACK_IMPORTED_MODULE_2__["default"] {
    constructor(...args) {
        super(...args);

        this.state = WAND_STATE.DISABLED;

        this.mouseListeners = {
            down: this.mousedown.bind(this),
            up: this.mouseup.bind(this)
        };

        this.downPos = null;

        this.fx = null;

        this.selectedColor = null;

        this.maskCanvas = null;
        this.maskImData = null;
        this.maskBuffer = null;

        this.glData = {
            selColorLoc: null,
            screenSizeLoc: null,
            sdfRadiusLoc: null,
            isDarkLoc: null
        }

        this.on('up', this.up.bind(this));
        this.on('selected', this.selected.bind(this));
        this.on('deselected', this.deselected.bind(this));
    }

    // mobile events
    selected() {
        if (this.state === WAND_STATE.RENDERING) {
            this.stopRendering();
        }
        this.startSelecting();
    }
    deselected() {
        if (this.state === WAND_STATE.SELECTING) {
            this.stopSelecting();
        }
    }

    up() {
        switch (this.state) {
            case WAND_STATE.DISABLED: {
                this.startSelecting();
                break;
            }
            case WAND_STATE.SELECTING: {
                this.stopSelecting();
                break;
            }
            case WAND_STATE.RENDERING: {
                this.stopRendering();
                if (mobile) {
                    this.startSelecting();
                }
                break;
            }
        }
    }

    mousedown(e) {
        this.downPos = [e.clientX, e.clientY];
    }

    mouseup(e) {
        if (!this.downPos) return;

        const upPos = [e.clientX, e.clientY];
        if (!(0,_utils_misc__WEBPACK_IMPORTED_MODULE_20__.isClick)(this.downPos, upPos)) {
            return;
        }

        this.stopSelecting();

        const boardPos = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_17__.screenToBoardSpace)(...upPos);
        const boardColId = _globals__WEBPACK_IMPORTED_MODULE_7__["default"].chunkManager.getChunkPixel(...boardPos);
        const rgbCol = _config__WEBPACK_IMPORTED_MODULE_4__.palette[boardColId];

        this.selectedColor = rgbCol;
        _globals__WEBPACK_IMPORTED_MODULE_7__["default"].wandSelectedColor = boardColId;

        this.startRendering();
    }

    startSelecting() {
        this.state = WAND_STATE.SELECTING;

        this.changeCursor(1);
        _player__WEBPACK_IMPORTED_MODULE_9__["default"].suspendColors();

        _globals__WEBPACK_IMPORTED_MODULE_7__["default"].eventManager.on('mousedown', this.mouseListeners.down);
        _globals__WEBPACK_IMPORTED_MODULE_7__["default"].eventManager.on('mouseup', this.mouseListeners.up);
    }

    stopSelecting() {
        this.state = WAND_STATE.DISABLED;

        this.changeCursor(0);
        _player__WEBPACK_IMPORTED_MODULE_9__["default"].restoreColors();

        _globals__WEBPACK_IMPORTED_MODULE_7__["default"].eventManager.off('mousedown', this.mouseListeners.down);
        _globals__WEBPACK_IMPORTED_MODULE_7__["default"].eventManager.off('mouseup', this.mouseListeners.up);
    }

    changeCursor(cursorState) {
        if (cursorState === 1) {
            document.body.style.cursor = `url('${_img_toolIcons_wand_cur_png__WEBPACK_IMPORTED_MODULE_30__["default"]}') 2 2, auto`;
        } else {
            document.body.style.cursor = '';
        }
    }

    glRenderMask() {
        const gl = this.glData.gl;

        gl.viewport(0, 0, this.maskCanvas.width, this.maskCanvas.height);

        const mainCanvas = _globals__WEBPACK_IMPORTED_MODULE_7__["default"].mainCtx.canvas;

        gl.bindTexture(gl.TEXTURE_2D, this.glData.texture);
        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA,
            gl.UNSIGNED_BYTE, mainCanvas);

        const [r, g, b] = this.selectedColor;

        gl.uniform4f(this.glData.selColorLoc, r / 255, g / 255, b / 255, 1);
        gl.uniform2f(this.glData.screenSizeLoc, mainCanvas.width, mainCanvas.height);
        gl.uniform1f(this.glData.sdfRadiusLoc, 5);
        gl.uniform1f(this.glData.isDarkLoc, (0,_utils_color__WEBPACK_IMPORTED_MODULE_16__.isDarkColor)(...this.selectedColor) ? 1 : 0);

        gl.drawArrays(gl.TRIANGLES, 0, 6);
    }
    startRendering() {
        this.state = WAND_STATE.RENDERING;

        // first time we need to (re)generate it
        // to prevent the old mask from showing off
        this.generateMaskCanvas();

        this.fx = new _fxcanvas__WEBPACK_IMPORTED_MODULE_6__.FX(ctx => {
            if (this.state !== WAND_STATE.RENDERING) {
                return _fxcanvas__WEBPACK_IMPORTED_MODULE_6__.FX_STATE.REMOVED;
            }
            const w = ctx.canvas.width;
            const h = ctx.canvas.height;

            // handling window resize
            if (w !== this.maskCanvas.width ||
                h !== this.maskCanvas.height) {
                this.generateMaskCanvas();
            }

            this.glRenderMask();

            ctx.globalAlpha = 0.8;
            ctx.drawImage(this.maskCanvas, 0, 0);
            ctx.globalAlpha = 1;

            return _fxcanvas__WEBPACK_IMPORTED_MODULE_6__.FX_STATE.FINISHED;
        });
        (0,_fxcanvas__WEBPACK_IMPORTED_MODULE_6__.addFX)(this.fx);
    }

    stopRendering() {
        this.state = WAND_STATE.DISABLED;

        // cleaning up
        this.maskCanvas = null;
        this.maskImData = null;
        this.maskBuffer = null;

        this.fx = null;

        this.selectedColor = null;
        _globals__WEBPACK_IMPORTED_MODULE_7__["default"].wandSelectedColor = null;

        _globals__WEBPACK_IMPORTED_MODULE_7__["default"].fxRenderer.needRender = true;
    }

    generateMaskCanvas() {
        const canvas = document.createElement('canvas');
        canvas.width = _globals__WEBPACK_IMPORTED_MODULE_7__["default"].mainCtx.canvas.width;
        canvas.height = _globals__WEBPACK_IMPORTED_MODULE_7__["default"].mainCtx.canvas.height;


        this.maskCanvas = canvas;

        this.generateShader();
    }
    generateShader() {
        const maskCanvas = this.maskCanvas;

        const fragmentShader = `
        precision mediump float;
        uniform sampler2D u_image;
        uniform vec4 u_selectedColor;
        uniform vec2 u_screenSize;
        uniform float u_sdfRadius;
        uniform float u_isDark;
        varying vec2 v_texCoord;

        void main() {
            vec3 outColor = vec3(0.0);

            vec4 color = texture2D(u_image, v_texCoord);
            float match = all(equal(color, u_selectedColor)) ? 0.0 : 1.0;

            float dx = 1.0 / u_screenSize.x;
            float dy = 1.0 / u_screenSize.y;

            
            // process only surrounding pixels
            if(match == 1.0 && u_isDark == 1.0){
                float maxLength = length(vec2(u_sdfRadius, u_sdfRadius));
                float mindist = 10000.0;
                const float maxRadius = 5.0;
                for(float x = -maxRadius; x < maxRadius; x++){
                    if(abs(x) > u_sdfRadius) continue;
                    for(float y = -maxRadius; y < maxRadius; y++){
                        if(abs(y) > u_sdfRadius) continue;

                        vec2 newCoord = vec2(dx*x + v_texCoord.x, dy*y + v_texCoord.y);
                        vec4 color = texture2D(u_image, newCoord);
                        bool match = all(equal(color, u_selectedColor));

                        if(match){
                            mindist = min(mindist, length(vec2(x, y)));
                        }
                    }
                }
                if(mindist != 10000.0){
                    float norm = 1.0 - mindist / maxLength;

                    outColor = vec3(norm);
                }
            }

            gl_FragColor = vec4(outColor, match);
        }
        `;

        const { gl, program, texture } = (0,_utils_webGL__WEBPACK_IMPORTED_MODULE_22__.generateShader)(maskCanvas, fragmentShader);

        this.glData.selColorLoc = gl.getUniformLocation(program, "u_selectedColor");
        this.glData.screenSizeLoc = gl.getUniformLocation(program, "u_screenSize");
        this.glData.sdfRadiusLoc = gl.getUniformLocation(program, "u_sdfRadius");
        this.glData.isDarkLoc = gl.getUniformLocation(program, "u_isDark");

        this.glData.gl = gl;
        this.glData.texture = texture;
    }
}
const wand = new MagicWand('wand', 'KeyW', _img_toolIcons_wand_cur_png__WEBPACK_IMPORTED_MODULE_30__["default"]);

const COLORADOR_STATE = {
    DISABLED: 0,
    SELECTING: 1
}
class TemplateColorador extends _Tool__WEBPACK_IMPORTED_MODULE_2__["default"] {
    constructor(...args) {
        super(...args);

        this.colorsWhitelist = [];
        (0,_config__WEBPACK_IMPORTED_MODULE_4__.resolveWhenConfigDownloaded)().then(() => {
            this.colorsWhitelist = JSON.parse((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_18__.getOrDefault)('coloradorColors', '[]', true));
            if (this.colorsWhitelist.length) {
                (0,_fxcanvas__WEBPACK_IMPORTED_MODULE_6__.addFX)(new _fxcanvas__WEBPACK_IMPORTED_MODULE_6__.FX(() => {
                    if (!_template__WEBPACK_IMPORTED_MODULE_10__["default"].templateImg?.width) return _fxcanvas__WEBPACK_IMPORTED_MODULE_6__.FX_STATE.IN_PROCESS;

                    try {
                        this.update();                        
                    } catch (error) {}

                    return _fxcanvas__WEBPACK_IMPORTED_MODULE_6__.FX_STATE.REMOVED;
                }));
            }
        });

        this.state = COLORADOR_STATE.DISABLED;

        this.on('up', this.up.bind(this));
        this.on('selected', this.selected.bind(this));
        this.on('deselected', this.deselected.bind(this));

        this.mouseListeners = {
            down: this.mousedown.bind(this),
            up: this.mouseup.bind(this)
        };

        // needed for the reference
        this.origTemplateCanvas = null;
        this.origTemplateCtx = null;
        // the one that is monkeypatched into the Template
        this.templateCanvas = null;
        this.templateUpdated = false;

        this.glData = {
            imageLoc: null,
            colorsWhitelistLoc: null,
            screenSizeLoc: null,
            disabledOpacityLoc: null,
            texture: null,
        }
    }

    selected() {
        this.startSelecting();
    }
    deselected() {
        this.stopSelecting();
    }

    up() {
        switch (this.state) {
            case COLORADOR_STATE.DISABLED: {
                this.startSelecting();
                break;
            }
            case COLORADOR_STATE.SELECTING: {
                this.stopSelecting();
                break;
            }
        }
    }

    mmb(colorId) {
        this.toggleWhitelistColor(_config__WEBPACK_IMPORTED_MODULE_4__.palette[colorId]);
    }

    mousedown(e) {
        this.downPos = [e.clientX, e.clientY];
    }

    mouseup(e) {
        try {
            if (!this.downPos) return;

            const upPos = [e.clientX, e.clientY];
            if (!(0,_utils_misc__WEBPACK_IMPORTED_MODULE_20__.isClick)(this.downPos, upPos)) {
                return;
            }

            this.regenerateTemplateIfNeeded();

            const boardPos = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_17__.screenToBoardSpace)(...upPos);

            if (this.isOutsideTemplate(...boardPos)) {
                this.colorsWhitelist.length = 0;
                this.update();
                return;
            }

            const templateCol = this.getTemplateColor(...boardPos);
            if (!templateCol) return;

            const templateColId = (0,_utils_color__WEBPACK_IMPORTED_MODULE_16__.getPaletteColorId)(templateCol);
            if (templateColId === -1) {
                toastr.warning((0,_translate__WEBPACK_IMPORTED_MODULE_11__.translate)('color_not_in_palette'));
                return
            }

            this.toggleWhitelistColor(templateCol);
        } finally {
            if (mobile) {
                this.startSelecting();
            }
        }
    }
    isOutsideTemplate(boardX, boardY) {
        const div = _template__WEBPACK_IMPORTED_MODULE_10__["default"].isPatterns ? 7 : 1
        const templateW = _template__WEBPACK_IMPORTED_MODULE_10__["default"].templateImg.width / div;
        const templateH = _template__WEBPACK_IMPORTED_MODULE_10__["default"].templateImg.height / div;

        return boardX < _template__WEBPACK_IMPORTED_MODULE_10__["default"].x || boardY < _template__WEBPACK_IMPORTED_MODULE_10__["default"].y ||
            boardX >= _template__WEBPACK_IMPORTED_MODULE_10__["default"].x + templateW ||
            boardY >= _template__WEBPACK_IMPORTED_MODULE_10__["default"].y + templateH;
    }


    getTemplateColor(boardX, boardY) {
        const temCtx = this.origTemplateCtx;

        const temX = boardX - _template__WEBPACK_IMPORTED_MODULE_10__["default"].x;
        const temY = boardY - _template__WEBPACK_IMPORTED_MODULE_10__["default"].y;

        let color = null;
        if (!_template__WEBPACK_IMPORTED_MODULE_10__["default"].isPatterns) {
            const temColor = temCtx.getImageData(temX, temY, 1, 1).data;
            // no color if it is opaque
            if (temColor[3] === 0) {
                return null;
            }
            color = temColor.slice(0, 3);
        } else {
            const multedTemX = temX * 7;
            const multedTemY = temY * 7;

            // finding the color in the 7x7 pattern cell
            toBreak: for (let x = 0; x < 7; x++) {
                for (let y = 0; y < 7; y++) {
                    const curX = multedTemX + x;
                    const curY = multedTemY + y;

                    const curColor = temCtx.getImageData(curX, curY, 1, 1).data;
                    // alpha
                    if (curColor[3] !== 0) {
                        color = curColor.slice(0, 3);
                        break toBreak;
                    }
                }
            }
        }

        return color;

    }

    toggleWhitelistColor(targetCol) {
        const whitelistColId = this.colorsWhitelist.findIndex(rgb => rgb[0] === targetCol[0] && rgb[1] === targetCol[1] && rgb[2] === targetCol[2]);
        if (whitelistColId !== -1) {
            this.removeWhitelistColor(whitelistColId);
        } else {
            this.addWhitelistColor(targetCol);
        }
    }
    addWhitelistColor(rgb) {
        this.colorsWhitelist.push([...rgb]);
        this.update();
    }
    removeWhitelistColor(idx) {
        this.colorsWhitelist.splice(idx, 1);
        this.update();
    }

    updateUIPalette() {
        $('.paletteColor>img.disabledClr').remove();

        if (!this.colorsWhitelist.length) return;

        $(`.paletteColor`).append(`<img src="${_img_disabled_color_svg__WEBPACK_IMPORTED_MODULE_34__["default"]}" class="disabledClr">`);

        for (const rgb of this.colorsWhitelist) {
            const id = (0,_utils_color__WEBPACK_IMPORTED_MODULE_16__.getPaletteColorId)(rgb);
            if (id === -1) {
                console.warn('color', rgb, 'not found in the palette');
                continue;
            }

            $(`#col${id}>img.disabledClr`).remove();
        }
    }

    update() {
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_18__.setLS)('coloradorColors', JSON.stringify(this.colorsWhitelist), true);

        this.regenerateTemplateIfNeeded();

        if (this.colorsWhitelist.length > 0) {
            this.generateShader();
            this.renderShader(false);
            this.patchTemplate();
        } else {
            this.unpatchTemplate();
        }

        this.updateUIPalette();
    }

    regenerateTemplateIfNeeded() {
        if (!this.origTemplateCanvas || !this.templateCanvas || this.templateCanvas !== _template__WEBPACK_IMPORTED_MODULE_10__["default"].templateImg) {
            this.templateUpdated = true;
            this.glData.gl = null;

            const templateImg = _template__WEBPACK_IMPORTED_MODULE_10__["default"].templateImg;

            const origCanv = this.origTemplateCanvas = document.createElement('canvas');
            const templCanv = this.templateCanvas = document.createElement('canvas');

            origCanv.width = templCanv.width = templateImg.width;
            origCanv.height = templCanv.height = templateImg.height;

            this.origTemplateCtx = origCanv.getContext('2d');
            this.origTemplateCtx.drawImage(templateImg, 0, 0);
        }
    }

    startSelecting() {
        this.state = COLORADOR_STATE.SELECTING;

        this.changeCursor(1);
        _player__WEBPACK_IMPORTED_MODULE_9__["default"].suspendColors();

        this.clearListeners();

        _globals__WEBPACK_IMPORTED_MODULE_7__["default"].eventManager.on('mousedown', this.mouseListeners.down);
        _globals__WEBPACK_IMPORTED_MODULE_7__["default"].eventManager.on('mouseup', this.mouseListeners.up);

        this.renderShader(true);
    }

    stopSelecting() {
        this.state = COLORADOR_STATE.DISABLED;

        this.changeCursor(0);
        _player__WEBPACK_IMPORTED_MODULE_9__["default"].restoreColors();

        this.clearListeners();
        
        this.renderShader(false);
    }
    
    clearListeners(){
        _globals__WEBPACK_IMPORTED_MODULE_7__["default"].eventManager.off('mousedown', this.mouseListeners.down);
        _globals__WEBPACK_IMPORTED_MODULE_7__["default"].eventManager.off('mouseup', this.mouseListeners.up);
    }

    createWhitelistTexture(gl, colors) {
        const data = new Uint8Array(colors.flat());
        const tex = gl.createTexture();
        gl.bindTexture(gl.TEXTURE_2D, tex);
        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGB, colors.length, 1, 0, gl.RGB, gl.UNSIGNED_BYTE, data);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
        return tex;
    }

    renderShader(drawDisabled) {
        if (!this.glData.gl) {
            this.regenerateTemplateIfNeeded();
            this.generateShader();
        }

        if (!this.colorsWhitelist.length) return;

        const gl = this.glData.gl;



        gl.viewport(0, 0, this.templateCanvas.width, this.templateCanvas.height);

        gl.activeTexture(gl.TEXTURE0);
        gl.bindTexture(gl.TEXTURE_2D, this.glData.texture);
        if (this.templateUpdated) {
            this.templateUpdated = false;

            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA,
                gl.UNSIGNED_BYTE, this.origTemplateCanvas);
        }
        gl.uniform1i(this.glData.imageLoc, 0);

        gl.activeTexture(gl.TEXTURE1);
        const whitelistTexture = this.createWhitelistTexture(gl, this.colorsWhitelist);
        gl.bindTexture(gl.TEXTURE_2D, whitelistTexture);
        gl.uniform1i(this.glData.colorsWhitelistLoc, 1);

        gl.uniform2f(this.glData.screenSizeLoc, _ui_elements__WEBPACK_IMPORTED_MODULE_12__.mainCanvas.width, _ui_elements__WEBPACK_IMPORTED_MODULE_12__.mainCanvas.height);

        const disabledOpacity = drawDisabled ? 0.1 : 0;
        gl.uniform1f(this.glData.disabledOpacityLoc, disabledOpacity);

        gl.drawArrays(gl.TRIANGLES, 0, 6);
    }
    generateShader() {
        if (!this.colorsWhitelist.length) return;

        const fragmentShader = `
        #define COLORS_SIZE ${this.colorsWhitelist.length}
        precision mediump float;
        uniform sampler2D u_image;
        uniform sampler2D u_colorsWhitelist;
        uniform vec2 u_screenSize;
        uniform float u_disabledOpacity;
        varying vec2 v_texCoord;

        bool colorMatch(vec3 a, vec3 b) {
            return distance(a, b) < 0.01;
        }

        void main() {
            vec4 color = texture2D(u_image, v_texCoord);
            
            if(color.a < 0.001){
                gl_FragColor = color;
                return;
            }

            for(int i = 0; i < COLORS_SIZE; i++){
                vec3 wl = texture2D(u_colorsWhitelist, vec2((float(i) + 0.5) / float(COLORS_SIZE), 0.5)).rgb;
                if(colorMatch(wl, color.rgb)){
                    gl_FragColor = color;
                    return;
                }
            }

            
            gl_FragColor = vec4(0.0, 0.0, 0.0, u_disabledOpacity);
        }
        `;

        let existingGl = this.glData.gl;
        const { gl, program, texture } = (0,_utils_webGL__WEBPACK_IMPORTED_MODULE_22__.generateShader)(existingGl ?? this.templateCanvas, fragmentShader, existingGl ? false : true);

        this.glData.imageLoc = gl.getUniformLocation(program, "u_image");
        this.glData.colorsWhitelistLoc = gl.getUniformLocation(program, "u_colorsWhitelist");
        this.glData.screenSizeLoc = gl.getUniformLocation(program, "u_screenSize");
        this.glData.disabledOpacityLoc = gl.getUniformLocation(program, "u_disabledOpacity");

        this.glData.gl = gl;
        if (texture) {
            this.glData.texture = texture;
        }
    }

    patchTemplate() {
        _template__WEBPACK_IMPORTED_MODULE_10__["default"].templateImg = this.templateCanvas;
        _globals__WEBPACK_IMPORTED_MODULE_7__["default"].fxRenderer.needRender = true;
    }
    unpatchTemplate() {
        _template__WEBPACK_IMPORTED_MODULE_10__["default"].templateImg = this.origTemplateCanvas;
        _globals__WEBPACK_IMPORTED_MODULE_7__["default"].fxRenderer.needRender = true;
    }

    changeCursor(cursorState) {
        if (cursorState === 1) {
            document.body.style.cursor = `url('${_img_toolIcons_disable_cur_png__WEBPACK_IMPORTED_MODULE_31__["default"]}') 0 0, auto`;
        } else {
            document.body.style.cursor = '';
        }
    }
}
const colorador = new TemplateColorador('colorador', 'KeyD', _img_toolIcons_disable_png__WEBPACK_IMPORTED_MODULE_24__["default"]);

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({
    clicker,
    mover,
    floodfill,
    pipette, altPipette,
    line,
    colorInc, colorDec,
    colorSwap,
    chatOpac, menuOpac, allOpac,
    ctrlZ,
    protector, altProtector,
    grid,
    copy,
    paste,
    cordAdd,
    templateOp1, templateOp2,
    square,
    incBrush, decBrush,
    pixelInfo,
    text,
    resetColors,
    wand,
    colorador
});


/***/ }),

/***/ "./src/js/ui/config.js":
/*!*****************************!*\
  !*** ./src/js/ui/config.js ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   fixColorsWidth: () => (/* binding */ fixColorsWidth),
/* harmony export */   initCoordsClick: () => (/* binding */ initCoordsClick),
/* harmony export */   initUISettings: () => (/* binding */ initUISettings),
/* harmony export */   setPaletteColorsSize: () => (/* binding */ setPaletteColorsSize),
/* harmony export */   setPaletteRows: () => (/* binding */ setPaletteRows),
/* harmony export */   showPatternsOnPalette: () => (/* binding */ showPatternsOnPalette),
/* harmony export */   swapToolsPos: () => (/* binding */ swapToolsPos),
/* harmony export */   unloadPalettePatterns: () => (/* binding */ unloadPalettePatterns)
/* harmony export */ });
/* harmony import */ var _Chat__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../Chat */ "./src/js/Chat.js");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../config */ "./src/js/config.js");
/* harmony import */ var _convert_patterns__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../convert/patterns */ "./src/js/convert/patterns.js");
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../globals */ "./src/js/globals.js");
/* harmony import */ var _player__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../player */ "./src/js/player.js");
/* harmony import */ var _utils_color__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../utils/color */ "./src/js/utils/color.js");
/* harmony import */ var _utils_localStorage__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../utils/localStorage */ "./src/js/utils/localStorage.js");
/* harmony import */ var _utils_misc__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../utils/misc */ "./src/js/utils/misc.js");
/* harmony import */ var _elements__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./elements */ "./src/js/ui/elements.js");
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");










function initUISettings() {
    fixColorsWidth();
    (0,_Chat__WEBPACK_IMPORTED_MODULE_0__.toggleEmojis)((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_6__.getLS)('hideEmojis') != 1);
    (0,_Chat__WEBPACK_IMPORTED_MODULE_0__.updateEmojis)((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_6__.getOrDefault)('emojis', '        ').split(' '));
    (0,_player__WEBPACK_IMPORTED_MODULE_4__.togglePlaced)(!+(0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_6__.getOrDefault)('hidePlaced', 1))
    ;(0,_player__WEBPACK_IMPORTED_MODULE_4__.updatePlaced)((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_6__.getLS)('placedCount', true));
    if ((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_6__.getLS)('showPalettePatterns') == 1) {
        showPatternsOnPalette();
        _globals__WEBPACK_IMPORTED_MODULE_3__["default"].showPatterns = true;
    }
    if ((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_6__.getLS)('swapToolsPos') == 1) {
        swapToolsPos((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_6__.getLS)('swapToolsPos'));
    }
}

function initCoordsClick() {
    _elements__WEBPACK_IMPORTED_MODULE_8__.coords.on('click', function () {
        _elements__WEBPACK_IMPORTED_MODULE_8__.chatInput[0].value += this.innerText;
        _elements__WEBPACK_IMPORTED_MODULE_8__.chatInput.trigger('focus');
    })
}

function fixColorsWidth() {
    const savedWidth = (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_6__.getLS)('colorSize', true);
    const calculated = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_7__.getRecommendedColorSize)();

    const colSize = +savedWidth || calculated
    setPaletteColorsSize(colSize);
    (0,_Chat__WEBPACK_IMPORTED_MODULE_0__.fixChatPosition)();
}

// an old analog for setPaletteColorsSize
function setPaletteRows(rows) {
    let width = (window.innerWidth / 100) * rows;

    $('#palette').css('max-width', width);
}


function setPaletteColorsSize(size) {
    if (size === undefined) {
        size = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_7__.getRecommendedColorSize)();
    }
    $('.paletteColor').css('width', size).css('height', size);
}

// beta and probably temprorary
// purposely not optimised
function showPatternsOnPalette() {
    unloadPalettePatterns();

    _config__WEBPACK_IMPORTED_MODULE_1__.palette.forEach(([r, g, b], i) => {

        const pat = _convert_patterns__WEBPACK_IMPORTED_MODULE_2__.patterns[i % _convert_patterns__WEBPACK_IMPORTED_MODULE_2__.patterns.length];

        const canvas = document.createElement('canvas');
        canvas.width = canvas.height = 14;
        const ctx = canvas.getContext('2d');

        ctx.fillStyle = _config__WEBPACK_IMPORTED_MODULE_1__.hexPalette[i];

        for (let i = 0; i < 7 * 7; i++) {
            if (!pat[i]) continue;
            const x = i % 7;
            const y = i / 7 | 0;

            ctx.fillRect(x * 2, y * 2, 2, 2);
        }

        function toI(x, y) {
            return (x + y * 14) * 4;
        }

        // draw contour
        let imd = ctx.getImageData(0, 0, 14, 14).data;
        if ((0,_utils_color__WEBPACK_IMPORTED_MODULE_5__.isDarkColor)(r, g, b)) {
            ctx.fillStyle = 'white';
            let coords = [];
            for (let x = 0; x < 14; x++) {
                for (let y = 0; y < 14; y++) {
                    if (imd[toI(x, y) + 3]) continue

                    const top = imd[toI(x, y - 1) + 3];
                    const bottom = imd[toI(x, y + 1) + 3];
                    const left = imd[toI(x - 1, y) + 3];
                    const right = imd[toI(x + 1, y) + 3];

                    const leftTop = imd[toI(x - 1, y - 1) + 3];
                    const rightTop = imd[toI(x + 1, y - 1) + 3];
                    const leftBottom = imd[toI(x - 1, y + 1) + 3];
                    const rightBottom = imd[toI(x + 1, y + 1) + 3];

                    if (top || bottom || left || right ||
                        leftTop || rightTop || leftBottom || rightBottom) {
                        ctx.fillRect(x, y, 1, 1);
                    }
                }
            }
        }


        imd = ctx.getImageData(0, 0, 14, 14).data;
        ctx.fillStyle = 'black';
        for (let i = 0; i < 14 * 14; i++) {
            if (!imd[i * 4 + 3])
                ctx.fillRect(i % 14, i / 14 | 0, 1, 1)
        }


        const dataurl = canvas.toDataURL();
        const img = document.createElement('img');
        img.src = dataurl;
        $(`#col${i}`).append(img);
    });
    $('.paletteColor').addClass('patternColor');
}
function swapToolsPos(state){
    const qs = $('#tools,.showMenu,.showChat')
    if(state == 1){
        qs.addClass('right');
    }else{
        qs.removeClass('right');
    }
}

function unloadPalettePatterns() {
    $('.paletteColor>img').remove();
    $('.paletteColor').removeClass('patternColor');
}

/***/ }),

/***/ "./src/js/ui/toggles.js":
/*!******************************!*\
  !*** ./src/js/ui/toggles.js ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   initMenuResizer: () => (/* binding */ initMenuResizer),
/* harmony export */   initMobileMenuToggler: () => (/* binding */ initMobileMenuToggler),
/* harmony export */   toggleEverything: () => (/* binding */ toggleEverything),
/* harmony export */   toggleTopMenu: () => (/* binding */ toggleTopMenu)
/* harmony export */ });
/* harmony import */ var _Chat__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../Chat */ "./src/js/Chat.js");
/* harmony import */ var _utils_localStorage__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../utils/localStorage */ "./src/js/utils/localStorage.js");
/* harmony import */ var _elements__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./elements */ "./src/js/ui/elements.js");
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");




function toggleTopMenu() {
    if (_elements__WEBPACK_IMPORTED_MODULE_2__.topMenu.css('display') === 'none') {
        _elements__WEBPACK_IMPORTED_MODULE_2__.topMenu.show();
        _elements__WEBPACK_IMPORTED_MODULE_2__.topMenu.css('margin-top', '');
    } else {
        _elements__WEBPACK_IMPORTED_MODULE_2__.topMenu.css('margin-top', -_elements__WEBPACK_IMPORTED_MODULE_2__.topMenu.height() - 30);
        setTimeout(() => _elements__WEBPACK_IMPORTED_MODULE_2__.topMenu.hide(), 500);
    }
}

function toggleEverything() {
    // $('#ui>div>div').each((_, el) => {
    //     if(el.style.getPropertyPriority('display') == 'important')
    //         return;

    //     if (el.style.display === 'none') {
    //         $(el).css('display', '')
    //     } else {
    //         $(el).css('display', 'none')
    //     }
    // })
    $('#ui').fadeToggle(100);
    (0,_Chat__WEBPACK_IMPORTED_MODULE_0__.fixChatPosition)();
}

function initMobileMenuToggler() {
    $('.showMenu,.hideMenu').on('click', toggleTopMenu)
}

function initMenuResizer() {
    const resizer = $('#menuResizer');
    const resizerStripes = $('#resizingStripes');

    let curHeight = +(0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_1__.getLS)('columnHeight');
    if (isNaN(curHeight) || curHeight == 0) {
        curHeight = 123;
    } else if (curHeight < 0) {
        curHeight = 0;
    } else if (curHeight >= (window.screen.height - 250)) {
        curHeight = window.screen.height - 250;
    }
    $('.columnContent').css('height', curHeight);

    let resizeTimeout;
    let resizeLock = false;

    function unfade() {
        resizer.css('height', '7px');
        resizer.css('background-color', '#4c4c4c');
        resizerStripes.css('opacity', '1');
    }

    function fade() {
        clearTimeout(resizeTimeout);
        resizer.css('height', '');
        resizer.css('background-color', '');
        resizerStripes.css('opacity', '');
    }

    resizer.on('mouseover', () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
            unfade();
        }, 500)
    })

    resizer.on('mouseout', () => {
        if (resizeLock) return;

        fade();
    })

    function onmousedown() {
        resizeLock = true;
        unfade();

        function onmousemove(e) {
            curHeight += e.originalEvent.movementY;
            $('.columnContent').css('height', curHeight);
            setLS('columnHeight', curHeight);
        }
        function oncemouseup() {
            $(document).off('mousemove', onmousemove);
            resizeLock = false;
            fade();
        }

        $(document).on('mousemove', onmousemove)
        $(document).one('mouseup', oncemouseup)
    }
    resizer.on('mousedown', onmousedown);
}

/***/ }),

/***/ "./src/js/user.js":
/*!************************!*\
  !*** ./src/js/user.js ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ User)
/* harmony export */ });
/* harmony import */ var querystring__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! querystring */ "./node_modules/querystring/index.js");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config */ "./src/js/config.js");
/* harmony import */ var _camera__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./camera */ "./src/js/camera.js");
/* harmony import */ var _windows__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./windows */ "./src/js/windows.js");
/* harmony import */ var _Window__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./Window */ "./src/js/Window.js");
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./globals */ "./src/js/globals.js");
/* harmony import */ var _me__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./me */ "./src/js/me.js");
/* harmony import */ var _img_user_svg__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../img/user.svg */ "./src/img/user.svg");
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./constants */ "./src/js/constants.js");
/* harmony import */ var _translate__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./translate */ "./src/js/translate.js");
/* harmony import */ var _img_mod_badge_svg__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../img/mod-badge.svg */ "./src/img/mod-badge.svg");
/* harmony import */ var _img_admin_badge_svg__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../img/admin-badge.svg */ "./src/img/admin-badge.svg");
/* harmony import */ var _utils_misc__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./utils/misc */ "./src/js/utils/misc.js");
/* harmony import */ var _utils_api__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./utils/api */ "./src/js/utils/api.js");
/* harmony import */ var _MiniWindow__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./MiniWindow */ "./src/js/MiniWindow.js");
/* harmony import */ var _ui_elements__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./ui/elements */ "./src/js/ui/elements.js");
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* provided dependency */ var toastr = __webpack_require__(/*! toastr */ "./node_modules/toastr/toastr.js");









// import userImg from '../img/user2.png';











// WARNING: this will work only if file names are not changed by webpack
const requireBadge = __webpack_require__("./src/img/badges sync \\.png$");
const badgeLinks = {};
requireBadge.keys().map(requireBadge).forEach(path => {
    const filename = path.default.match(/([\w\d_]+)\.png$/);
    badgeLinks[filename[1]] = path.default;
});


const usersContainer = $('#usersTable');

class User {
    // create user window from given object
    // tempId is a temporary id for connection
    static async CreateWindow(info, tempId) {
        const win = new _Window__WEBPACK_IMPORTED_MODULE_4__["default"]({
            center: true,
            title: `${info.name || (0,_translate__WEBPACK_IMPORTED_MODULE_9__.translate)('PLAYER') + ' ' + (tempId || info.id)}`
        });

        // show everything by default
        const htmlInfo = new Map();

        if (info.registered) {
            htmlInfo.set('name', (0,_utils_misc__WEBPACK_IMPORTED_MODULE_12__.htmlspecialchars)(info.name));
            htmlInfo.set('mail', (0,_utils_misc__WEBPACK_IMPORTED_MODULE_12__.htmlspecialchars)(info.email));

        }

        htmlInfo.set('id', info.id || tempId);

        if (info.ip) {
            if (info.cc && info.cc !== 'XX') {
                // adds a flag near the ip address

                const cc = info.cc;
                htmlInfo.set('ip', info.ip + ` [${cc}]`);
                htmlInfo.set('ip', htmlInfo.get('ip') + `<img src="${location.protocol}//flagcdn.com/h20/${cc.toLowerCase()}.png" style="margin-left:1px;height:13px;">`);
            } else {
                htmlInfo.set('ip', info.ip);
            }
        }

        htmlInfo.set('role', info.role);

        // allowing role/badge change 
        if (info.role !== undefined && _me__WEBPACK_IMPORTED_MODULE_6__["default"].role === _constants__WEBPACK_IMPORTED_MODULE_8__.ROLE.ADMIN) {
            if (_me__WEBPACK_IMPORTED_MODULE_6__["default"].id !== info.id) {
                const role = info.role;
                let str = '';
                Object.keys(_constants__WEBPACK_IMPORTED_MODULE_8__.ROLE).forEach(text => {
                    // now bans are through the special menu
                    if (text === 'BANNED') return;

                    str += `<option ${(text === role) ? 'selected' : ''}>${text}</option>`;
                })
                info.role = role ? _constants__WEBPACK_IMPORTED_MODULE_8__.ROLE[role] : null;

                htmlInfo.set('role', `<select type="role">${str}</select>`);
            }

            const badges = info.badges || [];
            requestAnimationFrame(() => {
                badges.forEach(badge => addBadge(badge.name));
            });

            let badgesCont = $(`<div class="badgesList"></div><button class="addBadgeBtn" title="Add Badge">+</button>`);
            htmlInfo.set('badges', badgesCont.map(function () {
                return this.outerHTML;
            }).get().join(''));
        }

        let infoArr = [...htmlInfo.keys(htmlInfo)].map(key => [key, htmlInfo.get(key)]), misc = [];
        infoArr = infoArr.filter(([k, v]) => !!v);

        if (_me__WEBPACK_IMPORTED_MODULE_6__["default"].role >= _constants__WEBPACK_IMPORTED_MODULE_8__.ROLE.MOD) {
            misc = [
                [`<input class="alertInput">`, `<button class="sendAlert">${(0,_translate__WEBPACK_IMPORTED_MODULE_9__.translate)('btn.sendAlert')}</button>`],
                [`<input class="modalInput">`, `<button class="sendModal">${(0,_translate__WEBPACK_IMPORTED_MODULE_9__.translate)('btn.sendModal')}</button>`]
            ];
            if (info.bannedUntil) {
                misc.push([(0,_translate__WEBPACK_IMPORTED_MODULE_9__.translate)('label.bannedUntil'), info.bannedUntil]);
            }
            if (_me__WEBPACK_IMPORTED_MODULE_6__["default"].id !== info.id) {
                if (info.role) {
                    misc.push([`<button class="openBanMenu">${(0,_translate__WEBPACK_IMPORTED_MODULE_9__.translate)('ban_menu')}</button>`]);
                } else {
                    // ip ban is only for guests
                    misc.push([`<button class="banByIp">${(0,_translate__WEBPACK_IMPORTED_MODULE_9__.translate)('Ban by ip')}</button>`]);
                }
            }
        }

        let together = infoArr.concat(misc);

        $(win.body).append((0,_windows__WEBPACK_IMPORTED_MODULE_3__.generateTable)(together));

        $('select[type=role]', win.body).on('change', async e => {
            const role = e.target.value,
                userId = info.id;
            const resp = await fetch('/api/admin/changerole', {
                method: 'POST',
                body: JSON.stringify({
                    id: userId,
                    role
                }),
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            const body = await resp.json();
            if (body.errors) {
                body.errors.forEach(error => {
                    toastr.error(error, (0,_translate__WEBPACK_IMPORTED_MODULE_9__.translate)('ERROR'));
                })
            } else {
                toastr.success((0,_translate__WEBPACK_IMPORTED_MODULE_9__.translate)('Changed role to') + ' ' + role);
            }
        })


        $('.sendAlert', win.body).on('click', () => {
            const val = $('.alertInput', win.body).val();

            if (val.length == 0) return;

            $('.alertInput', win.body).val('');
            _globals__WEBPACK_IMPORTED_MODULE_5__["default"].socket.sendAlert(tempId, val);
        });

        $('.sendModal', win.body).on('click', () => {
            const val = $('.modalInput', win.body).val();

            if (val.length == 0) return;

            $('.modalInput', win.body).val('');
            _globals__WEBPACK_IMPORTED_MODULE_5__["default"].socket.sendAlert(tempId, val, true);
        });

        $('.banByIp', win.body).on('click', async () => {
            const ip = info.ip;
            if (!ip) return toastr.error((0,_translate__WEBPACK_IMPORTED_MODULE_9__.translate)('No ip!'));

            const miniWindow = new _MiniWindow__WEBPACK_IMPORTED_MODULE_14__["default"](``, 2);
            const banMenuContents = $(
                '<div>'+
                `0= <input type="number" class="bannedUntilNum" value="0" min="0">` +
                `<select class="bannedUntilMult">
                    <option value="${1000 * 60}">${(0,_translate__WEBPACK_IMPORTED_MODULE_9__.translate)('time.minute')}</option>
                    <option value="${1000 * 60 * 60}">${(0,_translate__WEBPACK_IMPORTED_MODULE_9__.translate)('time.hour')}</option>
                    <option value="${1000 * 60 * 60 * 24}">${(0,_translate__WEBPACK_IMPORTED_MODULE_9__.translate)('time.day')}</option>
                </select>`+
                '<div>'
            );

            const untilNum = $('.bannedUntilNum', banMenuContents);
            const untilMulti = $('.bannedUntilMult', banMenuContents);

            miniWindow.on('okClicked', () => {
                const untilNumValue = untilNum.val();
                const untilMultiValue = new Number(untilMulti.val());

                const untilDate = new Date(Date.now() + untilNumValue * untilMultiValue);

                const ipBanParams = { ip };
                if (untilNumValue > 0) {
                    ipBanParams['until'] = untilDate.toISOString();
                }
                (0,_utils_api__WEBPACK_IMPORTED_MODULE_13__.apiRequest)(`/admin/ban/byIp?${querystring__WEBPACK_IMPORTED_MODULE_0__.stringify(ipBanParams)}`);
            });

            miniWindow.bodyElement.append(banMenuContents);
            $(document.body).append(miniWindow.element);

            setTimeout(() => miniWindow.center());
        });

        $('.openBanMenu', win.body).on('click', async () => {
            const miniWindow = new _MiniWindow__WEBPACK_IMPORTED_MODULE_14__["default"](`${(0,_translate__WEBPACK_IMPORTED_MODULE_9__.translate)('ban_menu_for')} ${(0,_utils_misc__WEBPACK_IMPORTED_MODULE_12__.htmlspecialchars)(info.name)}`, 2);
            const banMenuContents = $(
                `<input type="checkbox" id="${info.id}-shadow-cb" class="shadowCheckbox" ${info.shadowBanned ? 'checked' : ''}>` +
                `<label for="${info.id}-shadow-cb">${(0,_translate__WEBPACK_IMPORTED_MODULE_9__.translate)('label.shadowBanned')}</label><br>` +

                `<input type="checkbox" id="${info.id}-banned-cb" class="bannedCheckbox" ${info.role === 'BANNED' ? 'checked' : ''}>` +
                `<label for="${info.id}-banned-cb">${(0,_translate__WEBPACK_IMPORTED_MODULE_9__.translate)('label.banned')}</label><br>` +

                `0= <input type="number" id="${info.id}-until-number" class="bannedUntilNum" value="0" min="0">` +
                `<select id="${info.id}-until-multiplier" class="bannedUntilMult">
                    <option value="${1000 * 60}">${(0,_translate__WEBPACK_IMPORTED_MODULE_9__.translate)('time.minute')}</option>
                    <option value="${1000 * 60 * 60}">${(0,_translate__WEBPACK_IMPORTED_MODULE_9__.translate)('time.hour')}</option>
                    <option value="${1000 * 60 * 60 * 24}">${(0,_translate__WEBPACK_IMPORTED_MODULE_9__.translate)('time.day')}</option>
                </select>`
            );
            miniWindow.bodyElement.append(banMenuContents);
            $(document.body).append(miniWindow.element);


            const chadowCb = $('.shadowCheckbox', miniWindow.element);
            const banCb = $('.bannedCheckbox', miniWindow.element);
            const untilNum = $('.bannedUntilNum', miniWindow.element);
            const untilMulti = $('.bannedUntilMult', miniWindow.element);

            miniWindow.on('okClicked', () => {
                const shadowChecked = chadowCb.is(':checked');
                const banChecked = banCb.is(':checked');
                const untilNumValue = untilNum.val();
                const untilMultiValue = new Number(untilMulti.val());

                const untilDate = new Date(Date.now() + untilNumValue * untilMultiValue);

                const vastBanParams = {
                    uid: info.id,
                    banned: banChecked
                };
                if (untilNumValue > 0) {
                    vastBanParams['until'] = untilDate.toISOString();
                }
                (0,_utils_api__WEBPACK_IMPORTED_MODULE_13__.apiRequest)(`/admin/ban?${querystring__WEBPACK_IMPORTED_MODULE_0__.stringify(vastBanParams)}`);

                const shadowBanParams = {
                    uid: info.id,
                    banned: shadowChecked
                };
                if (untilNumValue > 0) {
                    shadowBanParams['until'] = untilDate.toISOString();
                }
                (0,_utils_api__WEBPACK_IMPORTED_MODULE_13__.apiRequest)(`/admin/ban/shadow?${querystring__WEBPACK_IMPORTED_MODULE_0__.stringify(shadowBanParams)}`);
            });


            setTimeout(() => miniWindow.center());

        });

        $('.addBadgeBtn', win.body).on('click', async () => {
            const subwindow = new _Window__WEBPACK_IMPORTED_MODULE_4__["default"]({
                title: 'Badges for ' + info.id,
                x: win.x + win.width + 5,
                y: win.y
            });
            if (!subwindow.created) return;

            subwindow.body.style.display = 'flex';
            subwindow.body.style.gap = '2px';

            for (const [badgeName, badgeLink] of Object.entries(badgeLinks)) {
                const badgeImg = $(`<div style="padding: 3px; background: gray; border-radius: 4px; max-width: fit-content;">
                <img src="${badgeLink}">
                </div>`);
                badgeImg.on('click', () => {
                    (0,_utils_api__WEBPACK_IMPORTED_MODULE_13__.apiRequest)(`/badges/add?userId=${info.id}&badge=${badgeName}`, { method: 'POST' }).then(async resp => {
                        if (!(await resp.json()).ok) return;

                        addBadge(badgeName);
                    });
                });
                $(subwindow.body).append(badgeImg);
            }
        });

        function addBadge(badgeName) {
            const badgeHtml = $(`<div class="badge" title="${badgeName}">
                            <img src="${badgeLinks[badgeName]}" alt="${badgeName}">
                        </div>`);
            $('.badgesList', win.body).append(badgeHtml);

            badgeHtml.on('click', () => {
                (0,_utils_api__WEBPACK_IMPORTED_MODULE_13__.apiRequest)(`/badges/del?userId=${info.id}&badge=${badgeName}`, { method: 'POST' }).then(async resp => {
                    if (!(await resp.json()).ok) return;

                    badgeHtml.remove();
                });
            });
        }
    }


    constructor(name, id, userId, registered, role, badges = null) {
        if (!name) name = 'ID ' + id;

        this.name = name;
        this.id = id;
        this.userId = userId;

        this.registered = registered;

        this.role = role;

        this.conns = [id];

        this.badges = badges;


        const safeName = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_12__.htmlspecialchars)(this.name);
        let displayName = _globals__WEBPACK_IMPORTED_MODULE_5__["default"].chat.parseColors(safeName).replace(/<[^>]*>/g, '');

        const roleBadgeProps = this.getRoleBadgeAndTitle();

        this.element = $(
            `<tr class="tableRow">
                <td title="id ${id}" class="user">
                    ${roleBadgeProps ? `<img src="${roleBadgeProps.icon}" title="${roleBadgeProps.tooltip}" class="roleBadge">` : ''}
                    <button class="userInfoBtn minrole-trusted"><img style="height: 20px" src="${_img_user_svg__WEBPACK_IMPORTED_MODULE_7__["default"]}"></button>
                    <span class="name">${displayName}</span>
                    <span class="badges"></span>
                    <span class="xConns"></span>
                </td>
                <td></td>
            </tr>`);

        this.nameEl = $('.name', this.element);
        this.coordsEl = $(this.element.children()[1]);

        this.nameEl.on('click', function () {
            const visibleNick = this.innerText;
            _ui_elements__WEBPACK_IMPORTED_MODULE_15__.chatInput[0].value += visibleNick + ', ';
            _ui_elements__WEBPACK_IMPORTED_MODULE_15__.chatInput.trigger('focus');
        })


        $('.userInfoBtn', this.element).on('click', async () => {
            const isReg = this.registered;
            const id = isReg ? this.userId : this.id;

            const req = await fetch(`/api/userInfo?id=${id}${isReg ? '' : '&unreg=1'}`);
            const info = await req.json();
            await User.CreateWindow(info, this.id);
        });

        this.coordsEl.on('click', () => {
            const [x, y] = this.coordsEl.text()
                .slice(1, -1)
                .split(', ')
                .map(x => parseInt(x, 10));

            if (Number.isInteger(x) && Number.isInteger(y))
                _camera__WEBPACK_IMPORTED_MODULE_2__["default"].centerOn(x, y);
        })

        usersContainer[0].appendChild(this.element[0]);

        _me__WEBPACK_IMPORTED_MODULE_6__["default"].updateRoleRelatedHtml();
    }

    async loadBadges() {
        if (this.userId === null) return;

        const resp = await (0,_utils_api__WEBPACK_IMPORTED_MODULE_13__.apiRequest)(`/userInfo/badges?id=${this.userId}`);
        const badges = await resp.json();
        this.badges = badges;
    }

    updateBadges() {
        $('.badges', this.element).append(this.getAchieveBadgesHtml());
    }

    getAchieveBadgesHtml() {
        if (!this.badges) return '';

        let html = '';
        for (let badge of this.badges) {
            const {
                name, width, height
            } = badge;

            const customWidth = width ? `width: ${width}px;` : '';
            const customHeight = height ? `height: ${height}px;` : '';

            html += `<img src="${badgeLinks[name]}" style="${customWidth}${customHeight}">`;
        }
        return html
    }

    getRoleBadgeAndTitle() {
        if (!this.role) return null;

        let tooltip, icon;

        switch (this.role) {
            case 'MOD':
                tooltip = 'mod';
                icon = _img_mod_badge_svg__WEBPACK_IMPORTED_MODULE_10__["default"];
                break
            case 'ADMIN':
                tooltip = 'admin';
                icon = _img_admin_badge_svg__WEBPACK_IMPORTED_MODULE_11__["default"];
                break
            default:
                return null
        }

        // if (this.userId == 1) {
        //     tooltip = 'creator';
        //     icon = creatorBadge;
        // }

        return {
            tooltip,
            icon
        }
    }

    updateCoords(color, x, y) {
        this.coordsEl.css('color', _config__WEBPACK_IMPORTED_MODULE_1__.hexPalette[color]);
        this.coordsEl.text(`(${x}, ${y})`);
    }

    close(clientId) {
        this.conns.splice(this.conns.indexOf(clientId), 1);
        if (this.conns.length === 0)
            this.destroy();
        else
            this.updateX();

        delete _globals__WEBPACK_IMPORTED_MODULE_5__["default"].users[clientId]
    }

    destroy() {
        this.element.remove();
    }

    newConnection(clientId) {
        this.conns.push(clientId);
        this.updateX();
    }

    updateX() {
        const text = (this.conns.length > 1) ? `[x${this.conns.length}]` : '';
        $('.xConns', this.element).text(text);
    }
}

/***/ }),

/***/ "./src/js/utils/camera.js":
/*!********************************!*\
  !*** ./src/js/utils/camera.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   getVisibleChunks: () => (/* binding */ getVisibleChunks),
/* harmony export */   inBounds: () => (/* binding */ inBounds),
/* harmony export */   isAreaVisible: () => (/* binding */ isAreaVisible),
/* harmony export */   isChunkVisible: () => (/* binding */ isChunkVisible)
/* harmony export */ });
/* harmony import */ var _camera__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../camera */ "./src/js/camera.js");
/* harmony import */ var _misc__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./misc */ "./src/js/utils/misc.js");
/* harmony import */ var _conversions__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./conversions */ "./src/js/utils/conversions.js");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../config */ "./src/js/config.js");





function isAreaVisible(x, y, w, h) {
    const [x1, y1] = (0,_conversions__WEBPACK_IMPORTED_MODULE_2__.boardToScreenSpace)(x, y);
    const [x2, y2] = (0,_conversions__WEBPACK_IMPORTED_MODULE_2__.boardToScreenSpace)(x + w, y + h);

    return x1 < window.innerWidth && x2 >= 0 && y1 < window.innerHeight && y2 >= 0;
}

function isChunkVisible(cx, cy) {
    return isAreaVisible(cx * _config__WEBPACK_IMPORTED_MODULE_3__.chunkSize, cy * _config__WEBPACK_IMPORTED_MODULE_3__.chunkSize, _config__WEBPACK_IMPORTED_MODULE_3__.chunkSize, _config__WEBPACK_IMPORTED_MODULE_3__.chunkSize);
}

function getVisibleChunks() {
    // todo rework it
    // rn it checks left top chunk and right bottom chunk

    let [sx, sy] = (0,_conversions__WEBPACK_IMPORTED_MODULE_2__.screenToBoardSpace)(0, 0);
    let [ex, ey] = (0,_conversions__WEBPACK_IMPORTED_MODULE_2__.screenToBoardSpace)(window.innerWidth, window.innerHeight);


    let startX = sx / _config__WEBPACK_IMPORTED_MODULE_3__.chunkSize | 0, // math floor
        endX = ex / _config__WEBPACK_IMPORTED_MODULE_3__.chunkSize + 1 | 0; // math ceil

    let startY = sy / _config__WEBPACK_IMPORTED_MODULE_3__.chunkSize | 0,
        endY = ey / _config__WEBPACK_IMPORTED_MODULE_3__.chunkSize + 1 | 0;

    let arr = []
    for (let x = Math.max(startX, 0); x < Math.min(endX, _config__WEBPACK_IMPORTED_MODULE_3__.boardChunkWid); x++) {
        for (let y = Math.max(startY, 0); y < Math.min(endY, _config__WEBPACK_IMPORTED_MODULE_3__.boardChunkHei); y++) {
            arr.push([x, y]);
        }
    }

    return arr
}

function inBounds(x, y) {
    if (x < 0 || x >= _config__WEBPACK_IMPORTED_MODULE_3__.boardWidth || y < 0 || y >= _config__WEBPACK_IMPORTED_MODULE_3__.boardHeight) return false;
    return true;
}

/***/ }),

/***/ "./src/js/utils/conversions.js":
/*!*************************************!*\
  !*** ./src/js/utils/conversions.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   boardToChunk: () => (/* binding */ boardToChunk),
/* harmony export */   boardToScreenSpace: () => (/* binding */ boardToScreenSpace),
/* harmony export */   chunkToBoard: () => (/* binding */ chunkToBoard),
/* harmony export */   screenToBoardSpace: () => (/* binding */ screenToBoardSpace)
/* harmony export */ });
/* harmony import */ var _camera__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../camera */ "./src/js/camera.js");
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../globals */ "./src/js/globals.js");
/* harmony import */ var _misc__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./misc */ "./src/js/utils/misc.js");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../config */ "./src/js/config.js");





function screenToBoardSpace(clientX, clientY) {
    let screenOffsetX = (clientX - (_globals__WEBPACK_IMPORTED_MODULE_1__["default"].renderer.canvas.width >> 1)) / _camera__WEBPACK_IMPORTED_MODULE_0__["default"].zoom;
    let screenOffsetY = (clientY - (_globals__WEBPACK_IMPORTED_MODULE_1__["default"].renderer.canvas.height >> 1)) / _camera__WEBPACK_IMPORTED_MODULE_0__["default"].zoom;

    let boardOffsetX = _camera__WEBPACK_IMPORTED_MODULE_0__["default"].x + _misc__WEBPACK_IMPORTED_MODULE_2__.halfMap[0];
    let boardOffsetY = _camera__WEBPACK_IMPORTED_MODULE_0__["default"].y + _misc__WEBPACK_IMPORTED_MODULE_2__.halfMap[1];

    let x = boardOffsetX + screenOffsetX,
        y = screenOffsetY + boardOffsetY;

    return [x | 0, y | 0]
}

function boardToScreenSpace(x, y) {
    x -= _camera__WEBPACK_IMPORTED_MODULE_0__["default"].x + _misc__WEBPACK_IMPORTED_MODULE_2__.halfMap[0];
    y -= _camera__WEBPACK_IMPORTED_MODULE_0__["default"].y + _misc__WEBPACK_IMPORTED_MODULE_2__.halfMap[1];

    x *= _camera__WEBPACK_IMPORTED_MODULE_0__["default"].zoom;
    y *= _camera__WEBPACK_IMPORTED_MODULE_0__["default"].zoom;

    x += _globals__WEBPACK_IMPORTED_MODULE_1__["default"].renderer.canvas.width >> 1; // x >> 1 = x / 2
    y += _globals__WEBPACK_IMPORTED_MODULE_1__["default"].renderer.canvas.height >> 1;

    return [Math.floor(x), Math.floor(y)]
}

function boardToChunk(x, y) {
    let cx = x / _config__WEBPACK_IMPORTED_MODULE_3__.chunkSize | 0;
    let cy = y / _config__WEBPACK_IMPORTED_MODULE_3__.chunkSize | 0;

    let offx = x % _config__WEBPACK_IMPORTED_MODULE_3__.chunkSize;
    let offy = y % _config__WEBPACK_IMPORTED_MODULE_3__.chunkSize;

    return [
        cx,
        cy,
        offx,
        offy
    ]
}

function chunkToBoard(cx, cy, offx, offy) {
    return [cx * _config__WEBPACK_IMPORTED_MODULE_3__.chunkSize + offx, cy * _config__WEBPACK_IMPORTED_MODULE_3__.chunkSize + offy]
}

/***/ }),

/***/ "./src/js/utils/cssColorsList.js":
/*!***************************************!*\
  !*** ./src/js/utils/cssColorsList.js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({
    "ALICEBLUE": "#F0F8FF",
    "ANTIQUEWHITE": "#FAEBD7",
    "AQUA": "#00FFFF",
    "AQUAMARINE": "#7FFFD4",
    "AZURE": "#F0FFFF",
    "BEIGE": "#F5F5DC",
    "BISQUE": "#FFE4C4",
    "BLACK": "#000000",
    "BLANCHEDALMOND": "#FFEBCD",
    "BLUE": "#0000FF",
    "BLUEVIOLET": "#8A2BE2",
    "BROWN": "#A52A2A",
    "BURLYWOOD": "#DEB887",
    "CADETBLUE": "#5F9EA0",
    "CHARTREUSE": "#7FFF00",
    "CHOCOLATE": "#D2691E",
    "CORAL": "#FF7F50",
    "CORNFLOWERBLUE": "#6495ED",
    "CORNSILK": "#FFF8DC",
    "CRIMSON": "#DC143C",
    "CYAN": "#00FFFF",
    "DARKBLUE": "#00008B",
    "DARKCYAN": "#008B8B",
    "DARKGOLDENROD": "#B8860B",
    "DARKGRAY": "#A9A9A9",
    "DARKGREY": "#A9A9A9",
    "DARKGREEN": "#006400",
    "DARKKHAKI": "#BDB76B",
    "DARKMAGENTA": "#8B008B",
    "DARKOLIVEGREEN": "#556B2F",
    "DARKORANGE": "#FF8C00",
    "DARKORCHID": "#9932CC",
    "DARKRED": "#8B0000",
    "DARKSALMON": "#E9967A",
    "DARKSEAGREEN": "#8FBC8F",
    "DARKSLATEBLUE": "#483D8B",
    "DARKSLATEGRAY": "#2F4F4F",
    "DARKSLATEGREY": "#2F4F4F",
    "DARKTURQUOISE": "#00CED1",
    "DARKVIOLET": "#9400D3",
    "DEEPPINK": "#FF1493",
    "DEEPSKYBLUE": "#00BFFF",
    "DIMGRAY": "#696969",
    "DIMGREY": "#696969",
    "DODGERBLUE": "#1E90FF",
    "FIREBRICK": "#B22222",
    "FLORALWHITE": "#FFFAF0",
    "FORESTGREEN": "#228B22",
    "FUCHSIA": "#FF00FF",
    "GAINSBORO": "#DCDCDC",
    "GHOSTWHITE": "#F8F8FF",
    "GOLD": "#FFD700",
    "GOLDENROD": "#DAA520",
    "GRAY": "#808080",
    "GREY": "#808080",
    "GREEN": "#008000",
    "GREENYELLOW": "#ADFF2F",
    "HONEYDEW": "#F0FFF0",
    "HOTPINK": "#FF69B4",
    "INDIANRED": "#CD5C5C",
    "INDIGO": "#4B0082",
    "IVORY": "#FFFFF0",
    "KHAKI": "#F0E68C",
    "LAVENDER": "#E6E6FA",
    "LAVENDERBLUSH": "#FFF0F5",
    "LAWNGREEN": "#7CFC00",
    "LEMONCHIFFON": "#FFFACD",
    "LIGHTBLUE": "#ADD8E6",
    "LIGHTCORAL": "#F08080",
    "LIGHTCYAN": "#E0FFFF",
    "LIGHTGOLDENRODYELLOW": "#FAFAD2",
    "LIGHTGRAY": "#D3D3D3",
    "LIGHTGREY": "#D3D3D3",
    "LIGHTGREEN": "#90EE90",
    "LIGHTPINK": "#FFB6C1",
    "LIGHTSALMON": "#FFA07A",
    "LIGHTSEAGREEN": "#20B2AA",
    "LIGHTSKYBLUE": "#87CEFA",
    "LIGHTSLATEGRAY": "#778899",
    "LIGHTSLATEGREY": "#778899",
    "LIGHTSTEELBLUE": "#B0C4DE",
    "LIGHTYELLOW": "#FFFFE0",
    "LIME": "#00FF00",
    "LIMEGREEN": "#32CD32",
    "LINEN": "#FAF0E6",
    "MAGENTA": "#FF00FF",
    "MAROON": "#800000",
    "MEDIUMAQUAMARINE": "#66CDAA",
    "MEDIUMBLUE": "#0000CD",
    "MEDIUMORCHID": "#BA55D3",
    "MEDIUMPURPLE": "#9370DB",
    "MEDIUMSEAGREEN": "#3CB371",
    "MEDIUMSLATEBLUE": "#7B68EE",
    "MEDIUMSPRINGGREEN": "#00FA9A",
    "MEDIUMTURQUOISE": "#48D1CC",
    "MEDIUMVIOLETRED": "#C71585",
    "MIDNIGHTBLUE": "#191970",
    "MINTCREAM": "#F5FFFA",
    "MISTYROSE": "#FFE4E1",
    "MOCCASIN": "#FFE4B5",
    "NAVAJOWHITE": "#FFDEAD",
    "NAVY": "#000080",
    "OLDLACE": "#FDF5E6",
    "OLIVE": "#808000",
    "OLIVEDRAB": "#6B8E23",
    "ORANGE": "#FFA500",
    "ORANGERED": "#FF4500",
    "ORCHID": "#DA70D6",
    "PALEGOLDENROD": "#EEE8AA",
    "PALEGREEN": "#98FB98",
    "PALETURQUOISE": "#AFEEEE",
    "PALEVIOLETRED": "#DB7093",
    "PAPAYAWHIP": "#FFEFD5",
    "PEACHPUFF": "#FFDAB9",
    "PERU": "#CD853F",
    "PINK": "#FFC0CB",
    "PLUM": "#DDA0DD",
    "POWDERBLUE": "#B0E0E6",
    "PURPLE": "#800080",
    "REBECCAPURPLE": "#663399",
    "RED": "#FF0000",
    "ROSYBROWN": "#BC8F8F",
    "ROYALBLUE": "#4169E1",
    "SADDLEBROWN": "#8B4513",
    "SALMON": "#FA8072",
    "SANDYBROWN": "#F4A460",
    "SEAGREEN": "#2E8B57",
    "SEASHELL": "#FFF5EE",
    "SIENNA": "#A0522D",
    "SILVER": "#C0C0C0",
    "SKYBLUE": "#87CEEB",
    "SLATEBLUE": "#6A5ACD",
    "SLATEGRAY": "#708090",
    "SLATEGREY": "#708090",
    "SNOW": "#FFFAFA",
    "SPRINGGREEN": "#00FF7F",
    "STEELBLUE": "#4682B4",
    "TAN": "#D2B48C",
    "TEAL": "#008080",
    "THISTLE": "#D8BFD8",
    "TOMATO": "#FF6347",
    "TURQUOISE": "#40E0D0",
    "VIOLET": "#EE82EE",
    "WHEAT": "#F5DEB3",
    "WHITE": "#FFFFFF",
    "WHITESMOKE": "#F5F5F5",
    "YELLOW": "#FFFF00",
    "YELLOWGREEN": "#9ACD32"
});

/***/ }),

/***/ "./src/js/utils/math.js":
/*!******************************!*\
  !*** ./src/js/utils/math.js ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   avrg: () => (/* binding */ avrg),
/* harmony export */   clamp: () => (/* binding */ clamp),
/* harmony export */   dist: () => (/* binding */ dist),
/* harmony export */   mapRange: () => (/* binding */ mapRange),
/* harmony export */   mod: () => (/* binding */ mod)
/* harmony export */ });
function mod(n, m) {
    return ((n % m) + m) % m;
}

function dist(x1, y1, x2, y2) {
    return Math.hypot(x2 - x1, y2 - y1)
}

function avrg(...values) {
    return values.reduce((a, b) => a + b) / values.length
}

function mapRange(value, inputMin, inputMax, outputMin, outputMax) {
    return (value - inputMin) * (outputMax - outputMin) / (inputMax - inputMin) + outputMin;
}

function clamp(value, min, max){
    return Math.max(Math.min(value, max), min)
}

/***/ }),

/***/ "./src/js/utils/shapes.js":
/*!********************************!*\
  !*** ./src/js/utils/shapes.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({
    line: function (x, y, x2, y2) {
        let pointArr = [];

        let steep = Math.abs(y2 - y) > Math.abs(x2 - x);
        if (steep) {
            [x, y] = [y, x];
            [x2, y2] = [y2, x2];
        }
        let reverseFlag = false;
        if (x > x2) {
            [y, y2] = [y2, y];
            [x, x2] = [x2, x];
            reverseFlag = true;
        }
        let dist = {
            x: x2 - x,
            y: Math.abs(y2 - y)
        }
        let err = dist.x / 2;
        let stepY = (y < y2) ? 1 : -1;
        for (; x <= x2; x++) {
            pointArr.push([steep ? y : x, steep ? x : y]);
            err -= dist.y;
            if (err < 0) {
                y += stepY;
                err += dist.x;
            }
        }
        if (reverseFlag) pointArr.reverse();

        pointArr.reverse();

        return pointArr;
    },

    filledCircle: function (centerX, centerY, r) {
        let pixels = [];

        const squareR = r * r;

        for (let _x = -r + centerX; _x < r + centerX; _x++) {
            for (let _y = -r + centerY; _y < r + centerY; _y++) {
                if (isIn(_x, _y)) {
                    pixels.push([_x, _y])
                }
            }
        }

        function isIn(_x, _y) {
            let dx = _x - centerX,
                dy = _y - centerY;

            if (dx * dx + dy * dy <= squareR * 0.8)
                return true
            return false
        }

        return pixels
    },

    square(x1, y1, x2, y2) {
        const minX = Math.min(x1, x2),
            minY = Math.min(y1, y2),
            maxX = Math.max(x1, x2),
            maxY = Math.max(y1, y2);

        let pixels = [];
        for (let y = minY; y < maxY+1; y++) {
            for (let x = minX; x < maxX+1; x++) {
                pixels.push([x, y]);
            }
        }

        return pixels
    }
});

/***/ }),

/***/ "./src/js/utils/strings.js":
/*!*********************************!*\
  !*** ./src/js/utils/strings.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   capitalize: () => (/* binding */ capitalize)
/* harmony export */ });
function capitalize(str) {
    return str.replace(
      /[-\w]+/g,
      function(txt) {
        return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
      }
    );
  }

/***/ }),

/***/ "./src/js/utils/webGL.js":
/*!*******************************!*\
  !*** ./src/js/utils/webGL.js ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   createTexture: () => (/* binding */ createTexture),
/* harmony export */   createWebGLProgram: () => (/* binding */ createWebGLProgram),
/* harmony export */   generateShader: () => (/* binding */ generateShader)
/* harmony export */ });
function createWebGLProgram(canvas, vertexSrc, fragmentSrc) {
    let gl;
    if(canvas instanceof WebGLRenderingContext){
        gl = canvas;
    }else{
        gl = canvas.getContext('webgl');
        if (!gl) throw new Error("WebGL is not supported");
    }

    function compileShader(type, src) {
        const shader = gl.createShader(type);
        gl.shaderSource(shader, src);
        gl.compileShader(shader);
        if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
            console.error(gl.getShaderInfoLog(shader));
            throw new Error("Shader compilation error");
        }
        return shader;
    }

    const vs = compileShader(gl.VERTEX_SHADER, vertexSrc);
    const fs = compileShader(gl.FRAGMENT_SHADER, fragmentSrc);

    const program = gl.createProgram();
    gl.attachShader(program, vs);
    gl.attachShader(program, fs);
    gl.linkProgram(program);
    if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
        console.error(gl.getProgramInfoLog(program));
        throw new Error("GL linking error");
    }

    const buffer = gl.createBuffer();
    gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
    gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([
        -1, -1, 1, -1, -1, 1,
        -1, 1, 1, -1, 1, 1
    ]), gl.STATIC_DRAW);

    const posLoc = gl.getAttribLocation(program, "a_position");
    gl.enableVertexAttribArray(posLoc);
    gl.vertexAttribPointer(posLoc, 2, gl.FLOAT, false, 0, 0);

    return { gl, program };
}

function createTexture(gl, sourceCanvas) {
    const texture = gl.createTexture();
    gl.bindTexture(gl.TEXTURE_2D, texture);

    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);

    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA,
                  gl.UNSIGNED_BYTE, sourceCanvas);

    return texture;
}
const defaultVertexShader = `
        attribute vec2 a_position;
        varying vec2 v_texCoord;
        void main() {
            v_texCoord = (a_position + 1.0) * 0.5;
            // for some reason Y is inverted by default
            v_texCoord.y = 1.0 - v_texCoord.y;
            gl_Position = vec4(a_position, 0.0, 1.0);
        }
        `
function generateShader(canvas, fragmentShader, needCreateTexture=true) {
    const { gl, program } = createWebGLProgram(canvas, defaultVertexShader, fragmentShader);

    let texture;
    if(needCreateTexture){
        texture = createTexture(gl, canvas);
    }

    gl.useProgram(program);

    return { gl, program, texture };
}

/***/ }),

/***/ "./src/js/winamp/player.js":
/*!*********************************!*\
  !*** ./src/js/winamp/player.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   createRadioStarterBtn: () => (/* binding */ createRadioStarterBtn),
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__),
/* harmony export */   initRadio: () => (/* binding */ initRadio),
/* harmony export */   startWinampRadio: () => (/* binding */ startWinampRadio)
/* harmony export */ });
/* harmony import */ var _utils_localStorage__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../utils/localStorage */ "./src/js/utils/localStorage.js");
/* harmony import */ var _utils_misc__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../utils/misc */ "./src/js/utils/misc.js");
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../globals */ "./src/js/globals.js");
/* harmony import */ var _utils_conversions__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../utils/conversions */ "./src/js/utils/conversions.js");
/* harmony import */ var _fxcanvas__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../fxcanvas */ "./src/js/fxcanvas.js");
/* harmony import */ var _utils_math__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../utils/math */ "./src/js/utils/math.js");
/* harmony import */ var _camera__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../camera */ "./src/js/camera.js");
/* harmony import */ var _player__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../player */ "./src/js/player.js");
/* harmony import */ var _font_pixel_winamp_png__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../font/pixel/winamp.png */ "./src/font/pixel/winamp.png");
/* harmony import */ var _font_pixel_winamp_txt__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../font/pixel/winamp.txt */ "./src/font/pixel/winamp.txt");
/* harmony import */ var _tools__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../tools */ "./src/js/tools.js");
/* harmony import */ var _img_winamp_enableRadioBtn_png__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../img/winamp/enableRadioBtn.png */ "./src/img/winamp/enableRadioBtn.png");
/* harmony import */ var _utils_api__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../utils/api */ "./src/js/utils/api.js");

















async function importMaterials() {
    __webpack_require__("./src/img/winamp sync \\.png$")
    const images = {
        bg: await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! ../../img/winamp/bg2.png */ "./src/img/winamp/bg2.png")),
        hrSlider: await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! ../../img/winamp/hr-slider-btn-small.png */ "./src/img/winamp/hr-slider-btn-small.png")),
        hrSliderBig: await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! ../../img/winamp/slider-btn.png */ "./src/img/winamp/slider-btn.png")),
        digits: await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! ../../img/winamp/digits.png */ "./src/img/winamp/digits.png")),
    }

    const wFont = new _tools__WEBPACK_IMPORTED_MODULE_10__.PixelFont(_font_pixel_winamp_png__WEBPACK_IMPORTED_MODULE_8__["default"], _font_pixel_winamp_txt__WEBPACK_IMPORTED_MODULE_9__["default"]);
    await wFont.load();

    return {
        images,
        fonts: {
            winamp: wFont
        }
    }
}

class UIRect {
    constructor(x, y, w, h) {
        Object.assign(this, {
            x, y, w, h
        });
    }
}

let tempColors;
function preserveColors() {
    tempColors = [_player__WEBPACK_IMPORTED_MODULE_7__["default"].color, _player__WEBPACK_IMPORTED_MODULE_7__["default"].secondCol];

    _player__WEBPACK_IMPORTED_MODULE_7__["default"].switchColor(-1);
    _player__WEBPACK_IMPORTED_MODULE_7__["default"].switchSecondColor(-1);
}
function restoreColors() {
    _player__WEBPACK_IMPORTED_MODULE_7__["default"].switchColor(tempColors[0]);
    _player__WEBPACK_IMPORTED_MODULE_7__["default"].switchSecondColor(tempColors[1]);
}

function initRadio() {
    const player = new WinampPlayer();
    player.init();
    window.wPlayer = player;
}

let documentClicked = false, onDocumentClickCallbacks = [];
document.addEventListener('click', () => {
    documentClicked = true;

    onDocumentClickCallbacks.forEach(cb => cb());
    onDocumentClickCallbacks.length = 0;
})

async function createRadioStarterBtn() {
    const btnImg = await (0,_utils_misc__WEBPACK_IMPORTED_MODULE_1__.loadImage)(_img_winamp_enableRadioBtn_png__WEBPACK_IMPORTED_MODULE_11__["default"]);
    const bW = btnImg.width;
    const bH = btnImg.height;

    const bX = -btnImg.width - 5;
    const bY = 0;

    function renderBtn(ctx) {
        const z = _camera__WEBPACK_IMPORTED_MODULE_6__["default"].zoom;
        const [canvasX, canvasY] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_3__.boardToScreenSpace)(bX, bY);

        if (this.needRender)
            this.redraw();

        ctx.save();
        ctx.scale(z, z);
        ctx.drawImage(btnImg, canvasX / z, canvasY / z);
        ctx.restore();

        return 1;
    }

    let btnFx = new _fxcanvas__WEBPACK_IMPORTED_MODULE_4__.FX(renderBtn);
    _globals__WEBPACK_IMPORTED_MODULE_2__["default"].fxRenderer.add(btnFx, 2);

    let mousedownAt = 0, listeners = [];
    function onMousedown(e) {
        const boardPos = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_3__.screenToBoardSpace)(e.clientX, e.clientY);
        if (checkIsButtonPos(...boardPos)) {
            mousedownAt = Date.now();
        }
    }

    async function onMouseup(e) {
        const boardPos = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_3__.screenToBoardSpace)(e.clientX, e.clientY);
        if (checkIsButtonPos(...boardPos)) {
            if (Date.now() - mousedownAt < 500) {
                await onBtnClick();
            }
        }
    }

    _globals__WEBPACK_IMPORTED_MODULE_2__["default"].eventManager.on('mousedown', onMousedown);
    _globals__WEBPACK_IMPORTED_MODULE_2__["default"].eventManager.on('mouseup', onMouseup);

    listeners.push(['mousedown', onMousedown]);
    listeners.push(['mouseup', onMouseup]);

    function removeBtn() {
        if (btnFx) {
            _globals__WEBPACK_IMPORTED_MODULE_2__["default"].fxRenderer.remove(btnFx);
            btnFx = null;
        }
        for (const [ev, fn] of listeners) {
            _globals__WEBPACK_IMPORTED_MODULE_2__["default"].eventManager.off(ev, fn);
        }
        listeners = [];
    }

    async function onBtnClick() {
        removeBtn();

        initRadio();
    }

    function checkIsButtonPos(x, y) {
        return x >= bX && x < bX + bW && y >= bY && y < bY + bH;
    }
}

class WinampPlayer {
    constructor() {
        this.canvas = document.createElement('canvas');
        this.ctx = this.canvas.getContext('2d');

        this.playerPosition = JSON.parse((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_0__.getLS)('winamp.position', true) || '[-275,0]');
        this.sndBalance = 0; // -1; 1
        this.volumeLvl = +((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_0__.getLS)('winamp.volume', true) || '0.5'); // 0; 1

        this.queue = null;
        this.currentTrack = null;

        this.images = null;
        this.needRender = true;

        this.startPolling();

        this.config = {
            width: 275,
            height: 348,
            headerRect: new UIRect(2, 2, 262, 12),
            closeBtnRect: new UIRect(265, 4, 7, 7),
            volumeBoundsRect: new UIRect(108, 61, 63, 4),
            soundBalanceBoundsRect: new UIRect(178, 61, 35, 4),
            volumeSliderRect: new UIRect(-1, -1, -1, -1),
            balanceSliderRect: new UIRect(-1, -1, -1, -1),
            titleRect: new UIRect(111, 24, 155, 12),
            kbpsRect: new UIRect(111, 41, 16, 10),
            khzRect: new UIRect(156, 41, 11, 10),
            mm1Rect: new UIRect(48, 26, 9, 13),
            mm2Rect: new UIRect(60, 26, 9, 13),
            ss1Rect: new UIRect(78, 26, 9, 13),
            ss2Rect: new UIRect(90, 26, 9, 13),
            progressSliderBndRect: new UIRect(16, 72, 249, 10),
            queueBoxRect: new UIRect(18, 257, 238, 48)
        }

        this._cache = {};
        this._holdingButton = null;
        this._lastHoldPos = null;
        this._destroyed = false;
        this.noFeed = false;
        this.title = null;
        this.visibleTitle = null;

        this._boundHandlers = {};
        this._socketHandlers = {};
    }

    addAudioStoppedListeners() {
        this.audio.addEventListener("pause", () => {
            // controls are disabled, but you can still
            // press "pause/play" button and it will stop
            // the player. this is not good because the 
            // whole radio will be screwed
            if (!this.audio._destroyed) {
                this.audio.play().catch(err => {
                    console.warn("Resume blocked until user interaction:", err);
                });
            }
        });

        this.audio.addEventListener("stalled", () => {
            console.warn("Stream stalled");
            this.restartStream();
        });

        this.audio.addEventListener("error", (e) => {
            console.error("Audio error", e);
            this.restartStream();
        });

        this.audio.addEventListener("ended", () => {
            console.warn("Stream ended");
            this.restartStream();
        });
    }

    async init() {
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_0__.setLS)('radioLover', '1');

        await this.loadMaterials();
        this.recalculateButtons();
        this.initTouchControls();
        this.setTitle('Goroxels Radio 1.0 alpha');

        this.canvas.width = this.config.width;
        this.canvas.height = this.config.height;

        this._fx = new _fxcanvas__WEBPACK_IMPORTED_MODULE_4__.FX(this.render.bind(this));
        _globals__WEBPACK_IMPORTED_MODULE_2__["default"].fxRenderer.add(this._fx, 2);

        await this.updateSong();
        this.startPolling();

        // socket handlers
        this._socketHandlers.radio = (type) => {
            switch (type) {
                case 0: this.updateSong(); break;
                case 1: this.updateQueue(); break;
            }
        };
        this._socketHandlers.opened = () => {
            this.updateSong();
        };

        _globals__WEBPACK_IMPORTED_MODULE_2__["default"].socket.on('radio', this._socketHandlers.radio);
        _globals__WEBPACK_IMPORTED_MODULE_2__["default"].socket.on('opened', this._socketHandlers.opened);

        this.ackRender();
        this.initAutoRender();
    }

    volume(val) {
        this.volumeLvl = val;
        this.gainNode.gain.value = val;
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_0__.setLS)('winamp.volume', val.toString(), true);
    }

    balance(val) {
        this.sndBalance = val;
        this.pannerNode.pan.value = val;
    }


    initAutoRender() {
        setInterval(() => this.ackRender(), 1000);
    }

    initTouchControls() {
        const self = this;

        function mousedown(e) {
            if (self._holdingButton) mouseup(e);
            let obj = self.getObjectAtPosition(e.clientX, e.clientY);
            if (obj) {
                preserveColors();
                _camera__WEBPACK_IMPORTED_MODULE_6__["default"].disableMove();
                self.onObjMousedown.call(self, obj, e);
                self._lastHoldPos = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_3__.screenToBoardSpace)(e.clientX, e.clientY);
            }
        }
        function mouseup(e) {
            self._lastHoldPos = null;
            _camera__WEBPACK_IMPORTED_MODULE_6__["default"].enableMove();
            if (self._holdingButton) {
                self.onObjMouseup.call(self, self._holdingButton, e);
                self._holdingButton = false;
                setTimeout(restoreColors);
            }
        }
        function mousemove(e) {
            if (self._holdingButton) {
                self.onObjMousemove.call(self, self._holdingButton, e);
                self._lastHoldPos = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_3__.screenToBoardSpace)(e.clientX, e.clientY);
            }
        }

        this._boundHandlers.mousedown = (e) => {
            if (this._destroyed) return;
            if (e.gesture) return mouseup(e);
            mousedown(e);
        };
        this._boundHandlers.mouseup = (e) => {
            if (this._destroyed) return;
            mouseup(e);
        };
        this._boundHandlers.mousemove = (e) => {
            if (this._destroyed) return;
            if (e.gesture) return;
            mousemove(e);
        };

        _globals__WEBPACK_IMPORTED_MODULE_2__["default"].eventManager.on('mousedown', this._boundHandlers.mousedown);
        _globals__WEBPACK_IMPORTED_MODULE_2__["default"].eventManager.on('mouseup', this._boundHandlers.mouseup);
        _globals__WEBPACK_IMPORTED_MODULE_2__["default"].eventManager.on('mousemove', this._boundHandlers.mousemove);
    }

    close() {
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_0__.setLS)('radioLover', '0');

        if (this.audio) {
            this.audio._destroyed = true;
            this.audio.pause();
            this.audio.src = "";
            this.audio.remove();
        }

        if (this.audioCtx) {
            this.audioCtx.close();
        }

        clearTimeout(this.__pollTimeout);
        clearInterval(this._titleRollerInterval);
        _globals__WEBPACK_IMPORTED_MODULE_2__["default"].fxRenderer.remove(this._fx);

        // remove eventManager handlers
        if (this._boundHandlers) {
            _globals__WEBPACK_IMPORTED_MODULE_2__["default"].eventManager.off('mousedown', this._boundHandlers.mousedown);
            _globals__WEBPACK_IMPORTED_MODULE_2__["default"].eventManager.off('mouseup', this._boundHandlers.mouseup);
            _globals__WEBPACK_IMPORTED_MODULE_2__["default"].eventManager.off('mousemove', this._boundHandlers.mousemove);
            this._boundHandlers = {};
        }

        // remove socket handlers
        if (this._socketHandlers) {
            _globals__WEBPACK_IMPORTED_MODULE_2__["default"].socket.off('radio', this._socketHandlers.radio);
            _globals__WEBPACK_IMPORTED_MODULE_2__["default"].socket.off('opened', this._socketHandlers.opened);
            this._socketHandlers = {};
        }

        this._destroyed = true;


        createRadioStarterBtn();
    }

    getObjectAtPosition(screenX, screenY) {
        const objsToCheck = [
            this.config.headerRect,
            this.config.closeBtnRect,
            this.config.volumeSliderRect,
            this.config.balanceSliderRect,
        ];

        const [boardX, boardY] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_3__.screenToBoardSpace)(screenX, screenY);
        const [playerX, playerY] = this.getRelPos(boardX, boardY);

        for (let obj of objsToCheck) {
            if (playerX >= obj.x && playerX < obj.x + obj.w &&
                playerY >= obj.y && playerY < obj.y + obj.h) {
                return obj;
            }
        }
    }

    onObjMousedown(obj) {
        this._holdingButton = obj;
    }
    onObjMouseup(obj, e) {
        switch (obj) {
            case this.config.closeBtnRect: {
                if (this.getObjectAtPosition(e.clientX, e.clientY) === this.config.closeBtnRect) {
                    this.close();
                }
            }
        }
    }
    onObjMousemove(obj, e) {
        const [movX, movY] = this.calcMovement(e);

        switch (obj) {
            case this.config.headerRect: {
                this.playerPosition[0] += movX;
                this.playerPosition[1] += movY;

                (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_0__.setLS)('winamp.position', JSON.stringify(this.playerPosition), true);

                this.ackRender();

                break;
            }
            case this.config.volumeSliderRect: {
                const [relX] = this.getRelPos(...(0,_utils_conversions__WEBPACK_IMPORTED_MODULE_3__.screenToBoardSpace)(e.clientX, e.clientY));

                const bndRect = this.config.volumeBoundsRect;
                const sliderImg = this.images.hrSlider;

                const [clampedX, clampedY] = this.clampHrSliderPos(relX, bndRect, sliderImg);

                this.config.volumeSliderRect.x = clampedX;
                this.config.volumeSliderRect.y = clampedY;

                const newValue = this.mapHrSliderPos(clampedX, bndRect, sliderImg, 0, 1);
                this.volume(newValue);

                this.ackRender();

                break;
            }

            case this.config.balanceSliderRect: {
                const [relX] = this.getRelPos(...(0,_utils_conversions__WEBPACK_IMPORTED_MODULE_3__.screenToBoardSpace)(e.clientX, e.clientY));

                const bndRect = this.config.soundBalanceBoundsRect;
                const sliderImg = this.images.hrSlider;

                const [clampedX, clampedY] = this.clampHrSliderPos(relX, bndRect, sliderImg);

                this.config.balanceSliderRect.x = clampedX;
                this.config.balanceSliderRect.y = clampedY;

                const newValue = this.mapHrSliderPos(clampedX, bndRect, sliderImg, -1, 1);
                this.balance(newValue);

                this.ackRender();

                break;
            }
        }
    }

    // clamp mouse position to slider bounds
    clampHrSliderPos(relX, bndRect, sliderImg) {
        // center the slider to the mouse pos
        relX -= sliderImg.width / 2;

        const clampX = (0,_utils_math__WEBPACK_IMPORTED_MODULE_5__.clamp)(relX, bndRect.x, bndRect.x + bndRect.w - sliderImg.width);
        const constY = bndRect.y + (bndRect.h / 2) - (sliderImg.height / 2) + 1;

        return [clampX | 0, constY | 0];
    }

    // convert slider position to output value
    mapHrSliderPos(posX, bndRect, sliderImg, minValue, maxValue) {
        const minPosX = bndRect.x;
        const maxPosX = bndRect.x + bndRect.w - sliderImg.width;

        const mappedVal = (0,_utils_math__WEBPACK_IMPORTED_MODULE_5__.mapRange)(posX, minPosX, maxPosX, minValue, maxValue);
        return mappedVal;
    }

    // convert value to position
    reverseMapHrSliderPos(value, bndRect, sliderImg, minValue, maxValue) {
        const minPosX = bndRect.x;
        const maxPosX = bndRect.x + bndRect.w - sliderImg.width;

        const mappedPosX = (0,_utils_math__WEBPACK_IMPORTED_MODULE_5__.mapRange)(value, minValue, maxValue, minPosX, maxPosX);
        return mappedPosX | 0;
    }

    // convert global board position to local canvas position
    getRelPos(boardX, boardY) {
        const playerX = boardX - this.playerPosition[0];
        const playerY = boardY - this.playerPosition[1];

        return [playerX, playerY];
    }

    // getHrSliderPos(minX, maxX, )

    calcMovement(e) {
        if (!this._lastHoldPos) {
            return null;
        }

        const curBoardPos = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_3__.screenToBoardSpace)(e.clientX, e.clientY);

        const diffX = curBoardPos[0] - this._lastHoldPos[0];
        const diffY = curBoardPos[1] - this._lastHoldPos[1];

        return [diffX, diffY];
    }

    async loadMaterials() {
        const {
            images: urlsObj,
            fonts
        } = await importMaterials();

        const imgObj = {};
        for (let key of Object.keys(urlsObj)) {
            let url = urlsObj[key].default;

            imgObj[key] = await (0,_utils_misc__WEBPACK_IMPORTED_MODULE_1__.loadImage)(url);
        }

        this.images = imgObj;
        this.fonts = fonts;
    }

    ackRender() {
        this.needRender = true;
        _globals__WEBPACK_IMPORTED_MODULE_2__["default"].fxRenderer.requestRender();
    }

    render(ctx) {
        if (this._destroyed) return 2;

        const [x, y] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_3__.boardToScreenSpace)(this.playerPosition[0], this.playerPosition[1]);
        const z = _camera__WEBPACK_IMPORTED_MODULE_6__["default"].zoom;

        if (this.needRender)
            this.redraw();

        ctx.save();
        ctx.scale(z, z);
        ctx.drawImage(this.canvas, x / z, y / z);
        ctx.restore();

        return 1
    }

    generateQueueText() {
        if (!this.queue) return '';

        const queue = [
            ...this.queue.queue,
            ...this.queue.defaultQueue
        ].slice(0, 7);

        const str = queue.map(s => {
            let title = cutTextToWidth(s.title, 190);
            return `${s.id ?? 'x'}. ${title} <${s.duration / 60 | 0}:${pad2(s.duration % 60 | 0)}>`

            function cutTextToWidth(text, maxWidth) {
                let curWidth = 0;
                let curText = '';
                for (const ch of text) {
                    // every dot is 3px wide
                    if (curWidth >= maxWidth - 9) {
                        curText += '...';
                        break;
                    }

                    if (ch === ' ' || /[-]/.test(ch)) curWidth += 5;
                    else if (/[A-z]/.test(ch)) curWidth += 4;
                    else if (ch === '.') curWidth += 2;
                    else curWidth += 4;

                    curWidth += 1;

                    curText += ch;
                }

                return curText;
            }
        }).join('\n');

        return str;
    }

    redraw() {
        this.needRender = false;

        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        this.ctx.drawImage(this.images.bg, 0, 0);
        this.ctx.drawImage(this.images.hrSlider, this.config.volumeSliderRect.x, this.config.volumeSliderRect.y);
        this.ctx.drawImage(this.images.hrSlider, this.config.balanceSliderRect.x, this.config.balanceSliderRect.y);

        this.drawTextInInput(this.title, this.config.titleRect, '#00E200');

        if (this.currentTrack) {
            const kbps = (2 * 2 * this.currentTrack.sampleRate) / 1000 | 0; // channels*sampleSize(16bit=2byte)*sampleRate
            const khz = this.currentTrack.sampleRate / 1000 | 0;

            this.drawTextInInput(kbps.toString(), this.config.kbpsRect, '#00E200');
            this.drawTextInInput(khz.toString(), this.config.khzRect, '#00E200');

            const sPassed = (Date.now() - this.currentTrack.startedAt) / 1000;

            const mmPassed = pad2((sPassed / 60 | 0).toString());
            const ssPassed = pad2((sPassed % 60 | 0).toString());

            this.drawBigDigit(this.config.mm1Rect, mmPassed[0]);
            this.drawBigDigit(this.config.mm2Rect, mmPassed[1]);
            this.drawBigDigit(this.config.ss1Rect, ssPassed[0]);
            this.drawBigDigit(this.config.ss2Rect, ssPassed[1]);

            const progressPosX = this.reverseMapHrSliderPos(sPassed, this.config.progressSliderBndRect, this.images.hrSliderBig, 0, this.currentTrack.duration);
            const progressPosY = this.config.progressSliderBndRect.y;

            this.ctx.drawImage(this.images.hrSliderBig, progressPosX, progressPosY);
        }

        // this shit eats a lot of cpu
        const queueText = this.generateQueueText();
        if (queueText && queueText !== this._cache.queueText) {
            const qTextImg = this.fonts.winamp.drawText(queueText, '#00E200');
            if (qTextImg) {
                this._cache.queueTextImg = qTextImg;
                this._cache.queueText = queueText;
                this.ctx.drawImage(qTextImg, this.config.queueBoxRect.x, this.config.queueBoxRect.y);
            }
        } else if (queueText) {
            this.ctx.drawImage(this._cache.queueTextImg, this.config.queueBoxRect.x, this.config.queueBoxRect.y);
        }
    }

    drawBigDigit(rect, number) {
        const digitW = rect.w;
        this.ctx.drawImage(this.images.digits, digitW * number, 0, rect.w, rect.h, rect.x, rect.y, rect.w, rect.h);
    }

    drawTextInInput(text, inputRect, color) {
        const drawnText = this.fonts.winamp.drawText(text, color);
        this.ctx.drawImage(drawnText, 0, 0, inputRect.w, drawnText.height, inputRect.x, ((inputRect.y + inputRect.h / 2) - drawnText.height / 2) | 0, inputRect.w, drawnText.height);
    }

    recalculateButtons() {
        const smallSliderWidth = this.images.hrSlider.width;
        const smallSliderHeight = this.images.hrSlider.height;

        const volRect = this.config.volumeBoundsRect;
        const volSliderX = (0,_utils_math__WEBPACK_IMPORTED_MODULE_5__.mapRange)(this.volumeLvl, 0, 1, volRect.x, (volRect.x + volRect.w) - smallSliderWidth);
        const volSliderY = ((volRect.y + volRect.h / 2) - smallSliderHeight / 2) + 1

        this.config.volumeSliderRect.x = volSliderX | 0;
        this.config.volumeSliderRect.y = volSliderY | 0;
        this.config.volumeSliderRect.w = smallSliderWidth;
        this.config.volumeSliderRect.h = smallSliderHeight;

        const balRect = this.config.soundBalanceBoundsRect;
        const balSliderX = (0,_utils_math__WEBPACK_IMPORTED_MODULE_5__.mapRange)(this.sndBalance, -1, 1, balRect.x, (balRect.x + balRect.w) - smallSliderWidth);
        const balSliderY = ((balRect.y + balRect.h / 2) - smallSliderHeight / 2) + 1

        this.config.balanceSliderRect.x = balSliderX | 0;
        this.config.balanceSliderRect.y = balSliderY | 0;
        this.config.balanceSliderRect.w = smallSliderWidth;
        this.config.balanceSliderRect.h = smallSliderHeight;
    }

    initAudioChain() {
        if (!this.audioCtx || this.audioCtx.state === "closed") {
            this.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }

        this.gainNode = this.audioCtx.createGain();
        this.gainNode.gain.value = this.volumeLvl;

        this.pannerNode = this.audioCtx.createStereoPanner();
        this.pannerNode.pan.value = this.sndBalance;

        if (this.audio) {
            try { this.audio._destroyed = true; } catch { }
            try { this.audio.pause(); } catch { }
            try { this.audio.remove(); } catch { }
        }

        this.audio = document.createElement("audio");
        this.audio.autoplay = true;
        this.audio.controls = false;
        this.audio._destroyed = false;

        this.addAudioStoppedListeners();

        const srcNode = this.audioCtx.createMediaElementSource(this.audio);
        srcNode.connect(this.gainNode).connect(this.pannerNode).connect(this.audioCtx.destination);
    }

    async startStream() {
        if (this._destroyed) return;
        if (this._streaming) return;

        this._streaming = true;

        const startFn = () => {
            try {
                if (!this.audio || this.audio._destroyed) {
                    this.initAudioChain();
                }

                this.audio.src = `${location.protocol}//${location.hostname}/api/radio/stream`;
                this.audio.autoplay = true;

                const playPromise = this.audio.play();
                if (playPromise) {
                    playPromise.catch(err => console.warn("Playback blocked until user interaction:", err));
                }
            } catch (err) {
                console.error("Failed to start stream:", err);
                this._streaming = false;

                if (!this._destroyed) {
                    setTimeout(() => this.startStream(), 5000);
                }
            }
        };

        if (!documentClicked) {
            onDocumentClickCallbacks.push(startFn);
        } else {
            startFn();
        }
    }

    async restartStream() {
        if (this._destroyed) return;
        this._streaming = false;
        console.info("Restarting radio stream...");
        await this.startStream();
    }

    async startPolling() {
        if (this._destroyed) return;
        await this.startStream();
    }


    async updateSong() {
        if (this._destroyed) return;

        this.noFeed = true;

        const song = await this.fetchCurTrack();

        this.currentTrack = song;

        const curTrackMins = song.duration / 60 | 0;
        const curTrackSecs = song.duration % 60 | 0;
        this.setTitle(this.currentTrack.title + ` <${curTrackMins}:${pad2(curTrackSecs)}>`);


        this.noFeed = false;

        this.ackRender();

        this.updateQueue().then(() => this.ackRender());
    }

    async updateQueue() {
        const queue = await this.fetchQueue();
        if (!queue) return;

        this.queue = queue;
        this.ackRender();
    }

    async fetchCurTrack() {
        const resp = await (0,_utils_api__WEBPACK_IMPORTED_MODULE_12__.apiRequest)('/radio/current-song');
        const json = await resp.json();
        if (!json.success) {
            // toastr.error('cannot fetch current song! reload the page.');
            return
        }

        return json.song;
    }

    async fetchQueue() {
        const resp = await (0,_utils_api__WEBPACK_IMPORTED_MODULE_12__.apiRequest)('/radio/get-queue');
        const json = await resp.json();
        if (!json.success) {
            // toastr.warn('cannot fetch song queue');
            return
        }

        return json.queues;
    }

    setTitle(title) {
        this._titleSet = Date.now();

        this.title = title;

        clearInterval(this._titleRollerInterval)

        // roll only if it exceeds input width
        if (this.fonts.winamp.measureText(this.title).width > this.config.titleRect.w) {
            this._titleRollerInterval = setInterval(() => {
                // rotate title by 1 char
                const titleArr = this.title.split('');
                titleArr.push(titleArr.shift());

                this.title = titleArr.join('');
                this.ackRender();
            }, 300);
        }
    }
}


function pad2(num) {
    return num.toString().padStart(2, '0');
}

function startWinampRadio() {
    if ((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_0__.getLS)('radioLover') === '1') {
        initRadio();
    } else {
        createRadioStarterBtn();
    }

}



/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (WinampPlayer);

/***/ }),

/***/ "./src/js/windows.js":
/*!***************************!*\
  !*** ./src/js/windows.js ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   accountSettings: () => (/* binding */ accountSettings),
/* harmony export */   authWindow: () => (/* binding */ authWindow),
/* harmony export */   captchaModal: () => (/* binding */ captchaModal),
/* harmony export */   gameSettings: () => (/* binding */ gameSettings),
/* harmony export */   generateTable: () => (/* binding */ generateTable),
/* harmony export */   help: () => (/* binding */ help),
/* harmony export */   initButtons: () => (/* binding */ initButtons),
/* harmony export */   initHelpButton: () => (/* binding */ initHelpButton),
/* harmony export */   initOnlineViewer: () => (/* binding */ initOnlineViewer),
/* harmony export */   keyBinds: () => (/* binding */ keyBinds),
/* harmony export */   onlineViewWindow: () => (/* binding */ onlineViewWindow),
/* harmony export */   showHelpIfFirstTime: () => (/* binding */ showHelpIfFirstTime),
/* harmony export */   templatesWindow: () => (/* binding */ templatesWindow),
/* harmony export */   toolsWindow: () => (/* binding */ toolsWindow),
/* harmony export */   uiSettings: () => (/* binding */ uiSettings)
/* harmony export */ });
/* harmony import */ var toastr__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! toastr */ "./node_modules/toastr/toastr.js");
/* harmony import */ var toastr__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(toastr__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _Chat__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Chat */ "./src/js/Chat.js");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./config */ "./src/js/config.js");
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./constants */ "./src/js/constants.js");
/* harmony import */ var _ui_elements__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./ui/elements */ "./src/js/ui/elements.js");
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./globals */ "./src/js/globals.js");
/* harmony import */ var _history__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./history */ "./src/js/history.js");
/* harmony import */ var _me__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./me */ "./src/js/me.js");
/* harmony import */ var _player__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./player */ "./src/js/player.js");
/* harmony import */ var _tools__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./tools */ "./src/js/tools.js");
/* harmony import */ var _translate__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./translate */ "./src/js/translate.js");
/* harmony import */ var _user__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./user */ "./src/js/user.js");
/* harmony import */ var _Window__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./Window */ "./src/js/Window.js");
/* harmony import */ var _utils_localStorage__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./utils/localStorage */ "./src/js/utils/localStorage.js");
/* harmony import */ var _utils_strings__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./utils/strings */ "./src/js/utils/strings.js");
/* harmony import */ var _utils_misc__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./utils/misc */ "./src/js/utils/misc.js");
/* harmony import */ var _img_arrow_svg__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../img/arrow.svg */ "./src/img/arrow.svg");
/* harmony import */ var _img_icon_desktop_svg__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../img/icon-desktop.svg */ "./src/img/icon-desktop.svg");
/* harmony import */ var _img_icon_phone_svg__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../img/icon-phone.svg */ "./src/img/icon-phone.svg");
/* harmony import */ var _img_user2_png__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../img/user2.png */ "./src/img/user2.png");
/* harmony import */ var _img_discord_logo_circle_svg__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../img/discord-logo-circle.svg */ "./src/img/discord-logo-circle.svg");
/* harmony import */ var _img_gg_logo_svg__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../img/gg-logo.svg */ "./src/img/gg-logo.svg");
/* harmony import */ var _img_vk_logo_svg__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ../img/vk-logo.svg */ "./src/img/vk-logo.svg");
/* harmony import */ var _img_mouse_mouse_lmb_png__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ../img/mouse/mouse-lmb.png */ "./src/img/mouse/mouse-lmb.png");
/* harmony import */ var _img_mouse_mouse_rmb_png__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ../img/mouse/mouse-rmb.png */ "./src/img/mouse/mouse-rmb.png");
/* harmony import */ var _img_mouse_mouse_mmb_png__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../img/mouse/mouse-mmb.png */ "./src/img/mouse/mouse-mmb.png");
/* harmony import */ var _img_mouse_mouse_4mb_png__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../img/mouse/mouse-4mb.png */ "./src/img/mouse/mouse-4mb.png");
/* harmony import */ var _img_mouse_mouse_5mb_png__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ../img/mouse/mouse-5mb.png */ "./src/img/mouse/mouse-5mb.png");
/* harmony import */ var _utils_api__WEBPACK_IMPORTED_MODULE_28__ = __webpack_require__(/*! ./utils/api */ "./src/js/utils/api.js");
/* harmony import */ var _template__WEBPACK_IMPORTED_MODULE_29__ = __webpack_require__(/*! ./template */ "./src/js/template.js");
/* harmony import */ var _ui_config__WEBPACK_IMPORTED_MODULE_30__ = __webpack_require__(/*! ./ui/config */ "./src/js/ui/config.js");
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");




































const mouseKeys = {
    'LMB': _img_mouse_mouse_lmb_png__WEBPACK_IMPORTED_MODULE_23__["default"],
    'RMB': _img_mouse_mouse_rmb_png__WEBPACK_IMPORTED_MODULE_24__["default"],
    'MMB': _img_mouse_mouse_mmb_png__WEBPACK_IMPORTED_MODULE_25__["default"],
    '4MB': _img_mouse_mouse_4mb_png__WEBPACK_IMPORTED_MODULE_26__["default"],
    '5MB': _img_mouse_mouse_5mb_png__WEBPACK_IMPORTED_MODULE_27__["default"],
}

function initButtons() {
    $('#accountSettings').on('click', accountSettings);
    $('#toolBinds').on('click', keyBinds);
    $('#uiSettings').on('click', uiSettings);
    $('#canvasSettings').on('click', gameSettings);
    $('#toolsB').on('click', toolsWindow);
    $('.authBtn').on('click', authWindow);
    $('#showTemplates').on('click', _template__WEBPACK_IMPORTED_MODULE_29__.showTemplates);
    $('#shareTemplate').on('click', _template__WEBPACK_IMPORTED_MODULE_29__.shareTemplate);
}

function initHelpButton() {
    $('.helpBtn').on('click', () => {
        help();
    })
}

function showHelpIfFirstTime() {
    const shownAlready = (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_13__.getLS)('helpShown');
    if (!shownAlready) {
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_13__.setLS)('helpShown', '1');
        help();
    }
}



function initOnlineViewer() {
    $('#onlineColumn .columnHeader').on('click', async () => {
        let json;
        try {
            const resp = await fetch('/api/online');
            json = await resp.json();
        } catch (e) {
            toastr__WEBPACK_IMPORTED_MODULE_0___default().error(e);
            return
        }

        onlineViewWindow(json);
    });
}


function createCollapsibleBlock(title, bodyHtml, collapsed = true) {
    const head = $('<div>');
    head[0].style.cssText =
        `width: 100%;
    height: 30px;
    background-color: #5f5f5f;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    user-select: none;
    cursor: pointer`

    head.append(`<div style="font-size:20px;text-transform:uppercase;">${title}</div>`)

    const arrow = $('<div>');
    arrow[0].style.cssText =
        `position: absolute;
    top: 50%;
    transform: translate(0, -50%);
    left: 5px;
    background-image: url(${_img_arrow_svg__WEBPACK_IMPORTED_MODULE_16__["default"]});
    background-size: 100%;
    background-repeat: no-repeat;
    transition: transform .2s ease-in-out;
    width: 20px;
    height: 20px;`

    head.append(arrow);

    const body = $('<div>');
    body[0].style.cssText =
        `max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s linear;
    font-size: 20px;`

    const innerBody = $('<div>');
    innerBody[0].style.cssText =
        `padding:8px`
    innerBody.html(bodyHtml);

    body.append(innerBody);

    const headBodyContainer = $('<div>');
    headBodyContainer[0].style.cssText =
        `margin-bottom: 1px;`
    headBodyContainer.append(head, body)

    let state = 0; // 0 - closed, 1 - opened
    let reCheckHeightIntervalId = null;
    function toggle() {
        clearTimeout(reCheckHeightIntervalId);
        if (state) {
            arrow.css('transform', 'translate(0px, -50%) rotate(0deg)');
            body.css('max-height', 0);
        } else {
            arrow.css('transform', 'translate(0px, -50%) rotate(180deg)');

            requestAnimationFrame(() => {
                // force layout calc reflow
                // otherwise scrollHeight may be not updated
                body[0].offsetHeight;

                body.css('max-height', body[0].scrollHeight);

                reCheckHeightIntervalId = setTimeout(() => {
                    body.css('max-height', body[0].scrollHeight);
                }, 300);
            });
        }
        state = !state;
    }
    if (!collapsed) setTimeout(toggle);

    head.on('click', toggle);

    return headBodyContainer
}

function generateTable(arr = []) {
    const table = $('<table class="columnTable"></table>');
    arr.forEach(([title, content]) => {
        let tableBlock = $(`
                <tr>
                    ${content === void 0 ?
                `<td colspan="2">${title}</td>` :
                `<td>${title}</td>
                        <td>${content}</td>`
            }
                </tr>`);
        table.append(tableBlock)
    });

    return table
}

function accountSettings() {
    const settingsWin = new _Window__WEBPACK_IMPORTED_MODULE_12__["default"]({
        title: (0,_utils_strings__WEBPACK_IMPORTED_MODULE_14__.capitalize)((0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('account settings')),
        center: true
    });
    if (!settingsWin.created) return;

    let html = generateTable([
        [(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('role'), _constants__WEBPACK_IMPORTED_MODULE_3__.ROLE_I[_me__WEBPACK_IMPORTED_MODULE_7__["default"].role].toUpperCase()],
        [
            (0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('change name'),
            `<input type="text" id="name" style="width:50%"><button id="changeName">yes</button>`
        ],
        [
            `<button id="logout">${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('logout')}</button>`
        ],
        // [
        //     `<button id="deleteAccount">${tr('delete_account')}</button>`
        // ]

    ]);

    $(settingsWin.body).append(html);

    $('#name').val(_me__WEBPACK_IMPORTED_MODULE_7__["default"].name)
    $('#changeName').on('click', () => {
        const newName = $('#name').val();

        if (!_me__WEBPACK_IMPORTED_MODULE_7__["default"].registered) {
            return toastr__WEBPACK_IMPORTED_MODULE_0___default().error('Hey wtf', '0_o');
        }
        if (newName.length < 0 || newName.length > 32) {
            return toastr__WEBPACK_IMPORTED_MODULE_0___default().error('Name length is not 0 < length < 32', 'Name change')
        }
        if (_me__WEBPACK_IMPORTED_MODULE_7__["default"].name === newName) {
            return toastr__WEBPACK_IMPORTED_MODULE_0___default().error('Name is the same as was', 'Name change')
        }

        fetch('/api/changename', {
            method: 'POST',
            body: JSON.stringify({
                name: newName
            }),
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(async r => {
            const result = await r.json();
            if (!result.errors.length) {
                _globals__WEBPACK_IMPORTED_MODULE_5__["default"].socket.close();
                toastr__WEBPACK_IMPORTED_MODULE_0___default().success('Name successfully changed');
                (0,_player__WEBPACK_IMPORTED_MODULE_8__.updateMe)();
            } else {
                result.errors.map(e => {
                    toastr__WEBPACK_IMPORTED_MODULE_0___default().error(e, 'Name change error')
                })
            }
        })
    })

    $('#logout').on('click', async () => {
        if (_me__WEBPACK_IMPORTED_MODULE_7__["default"].registered) {
            const req = await (0,_utils_api__WEBPACK_IMPORTED_MODULE_28__.apiRequest)('/auth/logout');
            const success = await req.json();
            if (success) {
                location.pathname = '/';
            } else {
                toastr__WEBPACK_IMPORTED_MODULE_0___default().error('Can\'t log out');
            }
        }
    })
}

function keyBinds() {
    const keysWin = new _Window__WEBPACK_IMPORTED_MODULE_12__["default"]({
        title: (0,_utils_strings__WEBPACK_IMPORTED_MODULE_14__.capitalize)((0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('toolbinds settings')),
        center: true
    });
    if (!keysWin.created) return;

    let table = generateTable();



    for (const tool of Object.values(_tools__WEBPACK_IMPORTED_MODULE_9__["default"])) {
        if (!tool.key) continue;
        if (tool.requiredRole > _me__WEBPACK_IMPORTED_MODULE_7__["default"].role) continue;

        const tableRow = $(
            `<tr>
            <td>${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('toolName.' + tool.name)}</td>
            <td>
                <div class="toolKeys" id="KEYS-${tool.name}">
                </div>
                <button class="resetKeyBtn" id="RESET-${tool.name}"></button>
                <button class="changeKeyBtn" "id="CHANGE-${tool.name}"></button>
            </td>
        </tr>`);

        table.append(tableRow);

        const keysContainer = $('.toolKeys', tableRow);
        const changeBtn = $('.changeKeyBtn', tableRow);
        const resetBtn = $('.resetKeyBtn', tableRow);

        changeBtn.on('click', () => {
            if (_globals__WEBPACK_IMPORTED_MODULE_5__["default"].lockInputs) return;
            _globals__WEBPACK_IMPORTED_MODULE_5__["default"].lockInputs = true;

            keysContainer.html('<span>...</span>');

            let clearFade = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_15__.reverseFade)(tableRow[0]);
            const onkeydown = e => {
                e.preventDefault();
                e.stopPropagation();

                redrawToolKeys(e);

                const code = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_15__.getEventKeyCode)(e);
                if (isNormalKey(code) || isMouseKey(code)) {
                    _globals__WEBPACK_IMPORTED_MODULE_5__["default"].toolManager.changeKey(tool, (0,_utils_misc__WEBPACK_IMPORTED_MODULE_15__.stringifyKeyEvent)(e));
                }
            }
            document.addEventListener('keydown', onkeydown);
            document.addEventListener('pointerdown', onkeydown);

            const onkeyup = e => {
                const isMouse = isMouseKey((0,_utils_misc__WEBPACK_IMPORTED_MODULE_15__.getEventKeyCode)(e));
                if (!isMouse && !e.code || e.code === 'ControlLeft' || e.code === 'AltLeft') return;

                e.preventDefault();
                e.stopPropagation();

                cleanup();

                _globals__WEBPACK_IMPORTED_MODULE_5__["default"].toolManager.saveBinds();
            }

            document.addEventListener('keyup', onkeyup);
            document.addEventListener('pointerup', onkeyup);

            function cleanup() {
                clearFade?.call();
                document.removeEventListener('keydown', onkeydown);
                document.removeEventListener('pointerdown', onkeydown);
                document.removeEventListener('keyup', onkeyup);
                document.removeEventListener('pointerup', onkeyup);

                _globals__WEBPACK_IMPORTED_MODULE_5__["default"].lockInputs = false;
            }
        });

        resetBtn.on('click', () => {
            if (_globals__WEBPACK_IMPORTED_MODULE_5__["default"].lockInputs) return;

            redrawToolKeys((0,_utils_misc__WEBPACK_IMPORTED_MODULE_15__.decodeKey)(tool.defaultKey));

            _globals__WEBPACK_IMPORTED_MODULE_5__["default"].toolManager.changeKey(tool, tool.defaultKey);
            _globals__WEBPACK_IMPORTED_MODULE_5__["default"].toolManager.saveBinds();
        })

        function redrawToolKeys(key) {
            const alt = key.alt ?? key.altKey;
            const ctrl = key.ctrl ?? key.ctrlKey;

            const keyCode = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_15__.getEventKeyCode)(key);

            keysContainer.html('');

            if (alt) {
                keysContainer.append('<kbd>ALT</kbd> + ');
            }
            if (ctrl) {
                keysContainer.append('<kbd>CTRL</kbd> + ');
            }

            if (isNormalKey(keyCode)) {
                keysContainer.append(`<kbd>${keyCode}</kbd>`);
            } else if (isMouseKey(keyCode)) {
                const img = `<img src="${mouseKeys[keyCode]}"/>`
                keysContainer.append(`<kbd>${img}</kbd>`);
            }
        }

        function isNormalKey(code) {
            return code && !code.startsWith('Control') && !code.startsWith('Alt') && !isMouseKey(code)
        }

        function isMouseKey(code) {
            return Object.keys(mouseKeys).includes(code);
        }

        const parsed = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_15__.decodeKey)(tool.key);

        redrawToolKeys(parsed);
    }

    $(keysWin.body).append(table);
}

function uiSettings() {
    const setWin = new _Window__WEBPACK_IMPORTED_MODULE_12__["default"]({
        title: (0,_utils_strings__WEBPACK_IMPORTED_MODULE_14__.capitalize)((0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('ui settings')),
        center: true
    });
    if (!setWin.created) return;

    const table = generateTable([
        [(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('colors size'), '<input type="range" min="16", max="64" step="1" id="colSize"><div style="width:50px;"><div>'],
        [(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('hide emojis'), '<input type="checkbox" id="toggleEmojis">'],
        [(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('emoji list'), '<input type="text" id="emojiList">'],
        [`<button id="moreEmojis">${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('super secret button')}</button>`],
        [(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('show placed pixels'), '<input type="checkbox" id="togglePlaced">'],
        [(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('show patterns over the palette'), '<input type="checkbox" id="showPatterns">'],
        [(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('tools_to_right_pos'), '<input type="checkbox" id="swapToolsPos">']
    ]);
    $(setWin.body).append(table);

    function colorSizeChanged() {
        const val = $('#colSize').val();
        (0,_ui_config__WEBPACK_IMPORTED_MODULE_30__.setPaletteColorsSize)(val);
        $('#colSize').next().text(val + 'px');
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_13__.setLS)('colorSize', val, true);
        (0,_Chat__WEBPACK_IMPORTED_MODULE_1__.fixChatPosition)();
    }

    const colSizeVal = (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_13__.getOrDefault)('colorSize', 24, true);
    $('#colSize').next().text(colSizeVal);
    $('#colSize').val(colSizeVal)
    $('#colSize').on('input', colorSizeChanged);

    $('#toggleEmojis')[0].checked = (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_13__.getLS)('hideEmojis') == 1;
    $('#toggleEmojis').on('click', e => {
        const state = !e.target.checked;
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_13__.setLS)('hideEmojis', state ? 0 : 1);
        (0,_Chat__WEBPACK_IMPORTED_MODULE_1__.toggleEmojis)(state);
    });

    $('#emojiList').val((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_13__.getOrDefault)('emojis', '        '));
    $('#emojiList').on('change', e => {
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_13__.setLS)('emojis', e.target.value);
        (0,_Chat__WEBPACK_IMPORTED_MODULE_1__.updateEmojis)(e.target.value.split(' '));
    })

    $('#moreEmojis').on('click', () => {
        const w = new _Window__WEBPACK_IMPORTED_MODULE_12__["default"]((0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('more emojis!'));
        if (!w.created) return;

        w.body.innerHTML = ''
        w.body.style.userSelect = 'text';
    });
    $('#togglePlaced')[0].checked = (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_13__.getOrDefault)('hidePlaced', 1) == 0;
    $('#togglePlaced').on('click', e => {
        const show = e.target.checked;
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_13__.setLS)('hidePlaced', show ? 0 : 1);
        (0,_player__WEBPACK_IMPORTED_MODULE_8__.togglePlaced)(show);
    });

    $('#showPatterns')[0].checked = _globals__WEBPACK_IMPORTED_MODULE_5__["default"].showPatterns;
    $('#showPatterns').on('click', e => {
        const show = e.target.checked;
        _globals__WEBPACK_IMPORTED_MODULE_5__["default"].showPatterns = show;
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_13__.setLS)('showPalettePatterns', show ? '1' : '0');
        show ? (0,_ui_config__WEBPACK_IMPORTED_MODULE_30__.showPatternsOnPalette)() : (0,_ui_config__WEBPACK_IMPORTED_MODULE_30__.unloadPalettePatterns)();
    });

    $('#swapToolsPos')[0].checked = +(0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_13__.getOrDefault)('swapToolsPos', 0) == 1;
    $('#swapToolsPos').on('click', e => {
        const swap = e.target.checked;
        _globals__WEBPACK_IMPORTED_MODULE_5__["default"].showPatterns = swap;
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_13__.setLS)('swapToolsPos', swap ? '1' : '0');
        (0,_ui_config__WEBPACK_IMPORTED_MODULE_30__.swapToolsPos)(swap);
    });
}

function gameSettings() {
    const win = new _Window__WEBPACK_IMPORTED_MODULE_12__["default"]({
        title: (0,_utils_strings__WEBPACK_IMPORTED_MODULE_14__.capitalize)((0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('game settings')),
        center: true
    });
    if (!win.created) return;

    // 1 for guests (packets disabled by server), 20 for admins, and 10 for others 
    let maxBrushSize = (_me__WEBPACK_IMPORTED_MODULE_7__["default"].role === _constants__WEBPACK_IMPORTED_MODULE_3__.ROLE.ADMIN ? 20 : (_me__WEBPACK_IMPORTED_MODULE_7__["default"].role < _constants__WEBPACK_IMPORTED_MODULE_3__.ROLE.USER ? 1 : 10))

    const table = generateTable([
        [
            (0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('show protected'),
            `<input type="checkbox" id="showProtected" ${_config__WEBPACK_IMPORTED_MODULE_2__.game.showProtected ? 'checked' : ''}>`
        ],
        [
            (0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('brush size'),
            `<input type="checkbox" id="customBrushSize" ${_player__WEBPACK_IMPORTED_MODULE_8__["default"].brushSize > 1 ? 'checked' : ''}>
            <input id="brushSize" type="range" value="${_player__WEBPACK_IMPORTED_MODULE_8__["default"].brushSize}" ` +
            `${_player__WEBPACK_IMPORTED_MODULE_8__["default"].brushSize == 1 ? 'disabled' : ''} min="2" ` +
            `max="${maxBrushSize}" step="2">` +
            `<span id="brushSizeCounter">${_player__WEBPACK_IMPORTED_MODULE_8__["default"].brushSize - 1}<span>`
        ],
        [
            (0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('max saved pixels'),
            `<input id="savePixelsInp" type="number" min="0" value="${_player__WEBPACK_IMPORTED_MODULE_8__["default"].maxPlaced}" style="width:4rem">`
        ],
        [
            (0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('disable chat colors'),
            `<input type="checkbox" id="disableChatColors" ${_Chat__WEBPACK_IMPORTED_MODULE_1__["default"].colorsEnabled ? '' : 'checked'}>`
        ],
        [
            (0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('chat messages limit'),
            `<input type="number" id="chatLimit" value="${_config__WEBPACK_IMPORTED_MODULE_2__.game.chatLimit}" title="maximum messages in chat">`
        ],
        [
            (0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('enable grid'),
            `<input type="checkbox" id="enableGridCB" ${_tools__WEBPACK_IMPORTED_MODULE_9__["default"].grid.state == 1 ? 'checked' : ''}>`
        ],
        [
            (0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('draw line length'),
            `<input type="checkbox" id="drawLineLenCB" ${_tools__WEBPACK_IMPORTED_MODULE_9__["default"].line.drawLength ? 'checked' : ''} title="draw line length near it">`
        ],
    ]);

    $(win.body).append(table);

    $('#showProtected').on('change', e => {
        const show = e.target.checked;
        _config__WEBPACK_IMPORTED_MODULE_2__.game.showProtected = show;
        (0,_config__WEBPACK_IMPORTED_MODULE_2__.showProtected)(show);
    });

    $('#customBrushSize').on('change', e => {
        const use = e.target.checked;

        if (use) {
            $('#brushSize').removeAttr('disabled');
            (0,_player__WEBPACK_IMPORTED_MODULE_8__.updateBrush)($('#brushSize').val());
        } else {
            $('#brushSize').attr('disabled');
            (0,_player__WEBPACK_IMPORTED_MODULE_8__.updateBrush)(1);
        }
    });

    $('#brushSize').on('input', e => {
        (0,_player__WEBPACK_IMPORTED_MODULE_8__.updateBrush)(e.target.value);
    });

    $('#savePixelsInp').on('change', e => {
        e = e.target;
        if (+e.value < 0) e.value = 0;

        _player__WEBPACK_IMPORTED_MODULE_8__["default"].maxPlaced = +e.value;
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_13__.setLS)('maxPlaced', _player__WEBPACK_IMPORTED_MODULE_8__["default"].maxPlaced)
    });

    $('#disableChatColors').on('change', e => {
        const checked = e.target.checked

        ;(0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_13__.setLS)('disableColors', checked.toString());

        _Chat__WEBPACK_IMPORTED_MODULE_1__["default"].setColors(!checked)
    });

    $('#chatLimit').on('change', e => {
        const value = parseInt(e.target.value, 10);
        if (isNaN(value) || value < 1) return;

        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_13__.setLS)('chatLimit', value.toString());

        _config__WEBPACK_IMPORTED_MODULE_2__.game.chatLimit = value;
    });

    $('#enableGridCB').on('change', e => {
        const checked = e.target.checked;

        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_13__.setLS)('enableGrid', checked.toString());

        if (checked) _tools__WEBPACK_IMPORTED_MODULE_9__["default"].grid.show();
        else _tools__WEBPACK_IMPORTED_MODULE_9__["default"].grid.hide();
    });

    $('#drawLineLenCB').on('change', e => {
        const checked = e.target.checked;

        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_13__.setLS)('drawLineLen', checked.toString());

        _tools__WEBPACK_IMPORTED_MODULE_9__["default"].line.drawLength = checked;
    });
}

async function captchaModal() {
    let win = new _Window__WEBPACK_IMPORTED_MODULE_12__["default"]({
        title: (0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('Captcha'),
        center: true,
        closeable: false
    });

    if (win.created) {
        const [help, cont, inp] = $(
            `<div>${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('Case insensitive, 0/o i/l are same')}. <a href="#">${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('Can\'t recognize?')}</a></div>` +
            '<div class="captchaContainer"></div>' +
            '<input class="fullWidthInput" type="text"></input>'
        );

        help.children[0].onclick = captchaModal;

        const [line] = $(`<div style="display:flex;justify-content:center">${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('Captcha').toUpperCase()}:&nbsp;&nbsp;</div>`);
        line.appendChild(inp);

        win.body.appendChild(help)
        win.body.appendChild(cont);
        win.body.appendChild(line);

        inp.addEventListener('keydown', async e => {
            if (e.key === 'Enter') {
                if (inp.value.length == 0) return;
                let val = inp.value;
                inp.value = '';

                const success = await (0,_utils_api__WEBPACK_IMPORTED_MODULE_28__.solveCaptcha)(val);

                if (success) {
                    win.close();
                } else {
                    captchaModal();
                }
            }
        })
    } else win = win.oldWindow;

    let svg;
    try {
        svg = await (0,_utils_api__WEBPACK_IMPORTED_MODULE_28__.fetchCaptcha)();
    } catch (e) {
        console.error('error downloading captcha image: ' + e);

        _globals__WEBPACK_IMPORTED_MODULE_5__["default"].socket.close();
        return win.close();
    }

    // according to default dark theme
    svg = svg.replace('stroke="black"', 'stroke="white"');

    $('.captchaContainer', win.body).html(svg);

    win.moveToCenter();
    $('input', win.body).trigger('focus');
}

function toolsWindow() {
    const toolWin = new _Window__WEBPACK_IMPORTED_MODULE_12__["default"]({
        title: (0,_utils_strings__WEBPACK_IMPORTED_MODULE_14__.capitalize)((0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('tools')),
        center: true
    });
    if (!toolWin.created) return;

    const tableArr = [
        [`<a href="/convert" target="_blank">${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('convert image into palette')}</a>`],
        [`<button id="screenshot">${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('save canvas')}</button>`],
        [`<button id="showPrevWipes">${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('tools.showPrevWipesBtn')}</button>`]
    ]

    if (_me__WEBPACK_IMPORTED_MODULE_7__["default"].role >= _constants__WEBPACK_IMPORTED_MODULE_3__.ROLE.MOD) {
        tableArr.unshift([`<button id="searchUsersB">${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('search users')}</button>`])
    }

    const table = generateTable(tableArr);
    $(toolWin.body).append(table);

    $('#searchUsersB', table).on('click', () => {
        const win = new _Window__WEBPACK_IMPORTED_MODULE_12__["default"]({
            title: (0,_utils_strings__WEBPACK_IMPORTED_MODULE_14__.capitalize)((0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('search users')),
            center: true
        });
        if (!win.created) return;

        const table = generateTable([
            [`<input type="text" placeholder="nickname" id="userSearchText" max="32" style="width:250px"> ${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('OR')} ` +
                '<input type="text" placeholder="id" id="userSearchId" max="32" style="width:50px">' +
                `<input type="checkbox" id="searchIsBanned"><label for="searchIsBanned">${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('banned?')}</label>`],
            ['<div id="searchUsersBody">']
        ]);

        $(win.body).append(table);

        const input = $('#userSearchText');

        $('#userSearchId').on('input', async e => {
            let num = e.target.value.trim();
            num = +num;

            if (isNaN(num) || num < 1 || num > Number.MAX_SAFE_INTEGER) {
                return
            }

            const isBanned = $('#searchIsBanned')[0].checked;

            const searchResp = await search(null, num, isBanned);
            afterSearch(searchResp);
        })

        $('#userSearchText').on('input', async _ => {
            let text = input.val().trim();
            text = text.slice(0, 32);

            const isBanned = $('#searchIsBanned')[0].checked;

            const searchResp = await search(text, null, isBanned);
            afterSearch(searchResp);
        });

        function afterSearch(resp) {
            if (!resp || !resp.length) {
                // clean up if nothing found
                $('#searchUsersBody').html('');
                return
            };

            let table = document.createElement('table');
            table.className = 'innerTable';
            table.innerHTML += '<tr><th>NICK</th><th>ID</th><th>ROLE</th><th>&nbsp;</th></tr>'

            for (let user of resp) {
                const safeNick = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_15__.htmlspecialchars)(user.name);

                // little workaround with click listener,
                // this might be shorter
                const uinfoButton = document.createElement('button');
                uinfoButton.className = 'userInfoBtn';
                uinfoButton.innerHTML = `<img src="${_img_user2_png__WEBPACK_IMPORTED_MODULE_19__["default"]}">`;
                uinfoButton.addEventListener('click', async () => {
                    const req = await (0,_utils_api__WEBPACK_IMPORTED_MODULE_28__.apiRequest)(`/userInfo?id=${user.id}`);
                    const info = await req.json();
                    await _user__WEBPACK_IMPORTED_MODULE_11__["default"].CreateWindow(info);
                })

                const row = $(
                    `<tr>
                        <td>${safeNick}</td><td>${user.id}</td>` +
                    `<td>${user.role}</td>` +
                    `<td></td>
                    </tr>`
                );

                row[0].lastElementChild.appendChild(uinfoButton);
                table.appendChild(row[0]);
            }

            $('#searchUsersBody').html(table);
        }

        async function search(term, id, isBanned) {
            if (!isBanned) {
                if (!term && !id) return;
            }
            if (term && id) return;

            if (term) {
                term = encodeURIComponent(term);
            }
            const req = await (0,_utils_api__WEBPACK_IMPORTED_MODULE_28__.apiRequest)(`/admin/users/search?isBanned=${isBanned ? 1 : 0}&${id ? `id=${id}` : `t=${term}`}`)

            const json = await req.json();
            return json
        }
    });

    $('#screenshot').on('click', _utils_misc__WEBPACK_IMPORTED_MODULE_15__.makeScreenshot);

    $('#showPrevWipes').on('click', () => {
        const wipesWin = new _Window__WEBPACK_IMPORTED_MODULE_12__["default"]({
            title: (0,_utils_strings__WEBPACK_IMPORTED_MODULE_14__.capitalize)((0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('prevWipesWinTitle'))
        });
        if (!wipesWin.created) return;

        wipesWin.body.style.maxHeight = '200px';

        if (!_globals__WEBPACK_IMPORTED_MODULE_5__["default"].mobile) {
            wipesWin.moveTo(
                toolWin.right + 5,
                toolWin.top
            );
        } else {
            wipesWin.moveToCenter();
        }

        const createWipeRow = function (wipeName) {
            return [`<button data-name="${wipeName}" class="showWipeBtn">${wipeName}</button>`];
        }
        const table = generateTable(Object.keys(_history__WEBPACK_IMPORTED_MODULE_6__.wipes).map(createWipeRow));
        $(wipesWin.body).append(table);

        $('.showWipeBtn', wipesWin.body).on('click', el => {
            const name = el.target.dataset.name;
            (0,_history__WEBPACK_IMPORTED_MODULE_6__.showHistoryCanvas)(name);
        });

        const oldCloseFunc = wipesWin.close;
        wipesWin.close = (...args) => {
            (0,_history__WEBPACK_IMPORTED_MODULE_6__.unloadHistoryCanvas)();

            oldCloseFunc.call(wipesWin, ...args);
        }
    })
}

function authWindow() {
    const win = new _Window__WEBPACK_IMPORTED_MODULE_12__["default"]({
        title: (0,_utils_strings__WEBPACK_IMPORTED_MODULE_14__.capitalize)((0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('LOG IN')),
        center: true
    });
    if (!win.created) return;

    const tableArr = [
        [`<a href="/api/auth/vk"><img src="${_img_vk_logo_svg__WEBPACK_IMPORTED_MODULE_22__["default"]}" class="authLogo">VK</a>`],
        [`<a href="/api/auth/discord"><img src="${_img_discord_logo_circle_svg__WEBPACK_IMPORTED_MODULE_20__["default"]}" class="authLogo">DISCORD</a>`],
        [`<a href="/api/auth/google"><img src="${_img_gg_logo_svg__WEBPACK_IMPORTED_MODULE_21__["default"]}" class="authLogo">GOOGLE</a>`]
    ]

    const table = generateTable(tableArr);

    $('td', table).css('text-align', 'left');
    $('a', table).css('margin-left', '15px');

    $(win.body).append(table);
}


function help() {
    const helpWin = new _Window__WEBPACK_IMPORTED_MODULE_12__["default"]({
        title: (0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('help'),
        center: true
    });
    if (!helpWin.created) return;

    helpWin.body.style.maxWidth = '800px';
    helpWin.body.style.width = '90vw';
    helpWin.body.style.height = '90vh';

    const desktopIconMacro = `<img class="smallSvgIcon" src="${_img_icon_desktop_svg__WEBPACK_IMPORTED_MODULE_17__["default"]}">`;
    const mobileIconMacro = `<img class="smallSvgIcon" src="${_img_icon_phone_svg__WEBPACK_IMPORTED_MODULE_18__["default"]}">`;

    // TODO move this to translations
    const intro = createCollapsibleBlock((0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.introHeader'),
        `<div style="width:100%;text-align:center;"><img src="./img/goroxels.png" style="vertical-align: middle;">${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.desc')}</div><br><br>
    ${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.desc2')}`, false);

    const howto = createCollapsibleBlock((0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('how to play?'),
        `<div style="display:inline-flex">
            <div>${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.howToPlayDecs')}</div>
            <div style="padding-left: 10px;">
                <div class="desktop">
                <video autoplay loop muted style="height:196px"><source src="./video/clickerMouse.webm" type="video/webm"></video>
                </div>
                <div class="mobile">
                <video autoplay loop muted style="height:196px"><source src="./video/phoneDrawing.mp4" type="video/mp4"></video>
                </div>
            </div>
        </div>`);

    const tools = createCollapsibleBlock((0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('tools'),
        `${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.toolsDecs')}<br><br>
    <div class="helpWithVideoCont">
        <div>${desktopIconMacro}${mobileIconMacro}${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.toolsClicker')}<br><br></div>
        <div class="desktop">
            <video autoplay loop muted style="height:196px"><source src="./video/clicker.webm" type="video/webm"></video>
        </div>
    </div><br>
    <div class="helpWithVideoCont">
        <div>${desktopIconMacro}${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.toolsAS')}<br><br></div>
        <div class="desktop">
            <video autoplay loop muted style="height:196px"><source src="./video/as.webm" type="video/webm"></video>
        </div>
    </div><br>
    <div class="helpWithVideoCont">
        <div>${desktopIconMacro}${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.toolC')}<br><br></div>
        <div class="desktop">
            <video autoplay loop muted style="height:196px"><source src="./video/toolC.webm" type="video/webm"></video>
        </div>
    </div><br>
    <div class="helpWithVideoCont">
        <div>${desktopIconMacro}${mobileIconMacro}${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.brush')}<br><br></div>
        <div class="desktop">
            <video autoplay loop muted style="height:196px"><source src="./video/brush2.webm" type="video/webm"></video>
        </div>
    </div><br>
    <div class="helpWithVideoCont">
        <div>${desktopIconMacro}${mobileIconMacro}${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.line')}<br><br></div>
        <div class="desktop">
            <video autoplay loop muted style="height:196px"><source src="./video/line.webm" type="video/webm"></video>
        </div>
    </div><br>
    <div class="helpWithVideoCont">
        <div>${desktopIconMacro}${mobileIconMacro}${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.flood')}<br><br></div>
        <div class="desktop">
            <video autoplay loop muted style="height:196px"><source src="./video/flood.webm" type="video/webm"></video>
        </div>
    </div><br>
    <div class="helpWithVideoCont">
        <div>${desktopIconMacro}${mobileIconMacro}${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.grid')}<br><br></div>
        <div class="desktop">
            <img src="./img/unavailable.png" style="height:196px">
        </div>
    </div><br>
    <div class="helpWithVideoCont">
        <div>${desktopIconMacro}${mobileIconMacro}${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.ctrlZ')}<br><br></div>
        <div class="desktop">
            <video autoplay loop muted style="height:196px"><source src="./video/ctrlZ.webm" type="video/webm"></video>
        </div>
    </div><br>
    ${desktopIconMacro}${mobileIconMacro}${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.resetColors')}<br>`);

    const tools2 = createCollapsibleBlock((0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.tools2header'),
        `<div style="width:100%;text-align:center;"><b>${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.tools2desc')}</b></div><br><br>
    ${desktopIconMacro}${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.toolsHiders')}<br><br>
    ${desktopIconMacro}${mobileIconMacro}${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.multicol')}<br>
    ${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.multicol2')}<br>
    ${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.multicol3')}<br><br>
    ${desktopIconMacro}${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.sendCoords')}<br><br>
    ${desktopIconMacro}${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.templateTools')}<br>`);

    const template = createCollapsibleBlock((0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('template'),
        `<div style="width:100%;text-align:center;"><b>${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.templateIntro')}</b></div><br><br>
    ${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.templateDesc')}<br><br>
    ${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.templateDescConvert')}<br><br>
    <div class="helpWithVideoCont mobile">
        <video autoplay loop muted style="height:196px"><source src="./video/patternDemo.webm" type="video/webm"></video>
    </div>
    <div class="helpWithVideoCont">
        <div>${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.templateDescReminder')}<br><br></div>
        <div class="desktop">
            <video autoplay loop muted style="height:196px"><source src="./video/patternDemo.webm" type="video/webm"></video>
        </div>
    </div><br>`);

    const author = createCollapsibleBlock((0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.authorHeader'),
        `${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.authorText')}<br>
        ${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.authorContacts')}<br>
        ${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.telegram_channel')}: <a href="https://t.me/goroxels">t.me/goroxels</a><br>
        ${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('intro.my_boosty')} <a href="https://boosty.to/gorox">https://boosty.to/gorox</a>
        <div style="text-align:center"><img src="./img/3rdcf.png" title=" "></div>`);


    $(helpWin.body).append(intro, howto, tools, tools2, template, author);
}

function onlineViewWindow(json) {
    let win = new _Window__WEBPACK_IMPORTED_MODULE_12__["default"]({
        title: (0,_utils_strings__WEBPACK_IMPORTED_MODULE_14__.capitalize)((0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('online')),
        center: true,
        closeable: true
    });

    if (!win.created) {
        win = win.oldWindow;
    }

    win.body.style.width = '325px';
    win.moveToCenter();

    const tableArr = [];
    Object.keys(json).forEach(key => {
        if (key === 'TOTAL') {
            win.updateTitle((0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('online') + ` (${json[key]})`, true);
            return;
        }

        const firstEl = `<a href="/${key}" target="_shagorox"><h3>${key}<h3></a>`;
        const secondEl = `<h2>${json[key]}</h2>`;

        tableArr.push([firstEl, secondEl]);
    })

    const table = generateTable(tableArr);

    $('*', win.body).remove();
    $(win.body).append(table);
}

function templatesWindow(templatesJson) {
    let win = new _Window__WEBPACK_IMPORTED_MODULE_12__["default"]({
        title: (0,_utils_strings__WEBPACK_IMPORTED_MODULE_14__.capitalize)((0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('templates_title')),
        center: true,
        closeable: true
    });

    if (!win.created) {
        return;
    }

    win.body.classList.add('templatesBody');
    win.body.style.maxWidth = 'min(495px, 90vw)'; // 5 items
    if (_globals__WEBPACK_IMPORTED_MODULE_5__["default"].mobile) {
        win.body.style.justifyContent = 'space-evenly';
    }

    const templatesJsonSorted = templatesJson
        .slice()
        .sort((a, b) => {
            const aIsMine = _me__WEBPACK_IMPORTED_MODULE_7__["default"].id === a.userId;
            const bIsMine = _me__WEBPACK_IMPORTED_MODULE_7__["default"].id === b.userId;

            if (aIsMine !== bIsMine) {
                return aIsMine ? 1 : -1;
            }

            return new Date(a.createdAt) - new Date(b.createdAt);
        });

    const meAdmin = _me__WEBPACK_IMPORTED_MODULE_7__["default"].role === _constants__WEBPACK_IMPORTED_MODULE_3__.ROLE.ADMIN;
    for (const tempJson of templatesJsonSorted) {
        const meOwner = _me__WEBPACK_IMPORTED_MODULE_7__["default"].id === tempJson.userId;
        const canDelete = meOwner || meAdmin;

        const templateThumbLink = `api/template/img?t=thumb&f=${tempJson.thumb}`;

        const templateEl = $(
            `<div class="templateItem ${meOwner ? 'myTemplateItem' : ''}">
                <button class="templateBtn ${canDelete ? 'deleteBtn' : ''}"></button>
                <button class="templateBtn infoBtn">i</button>
                <img src="${templateThumbLink}" alt="thumbnail">
                <div class="templateName">${tempJson.name}</div>
            </div>`
        );

        $(win.body).prepend(templateEl);

        templateEl.find('.deleteBtn').on('click', async e => {
            e.stopPropagation();

            new _Window__WEBPACK_IMPORTED_MODULE_12__.ConfirmModal((0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('confirm_template_deletion'), async (confirmed) => {
                if (!confirmed) return;
                const resp = await (0,_utils_api__WEBPACK_IMPORTED_MODULE_28__.apiRequest)(`/template/del?name=${encodeURIComponent(tempJson.name)}`, { method: 'POST' });
                const data = await resp.json();
                if (data.success) {
                    templateEl.remove();
                }
            })
        });

        templateEl.find('.infoBtn').on('click', async e => {
            e.stopPropagation();

            let ownerName = '???';
            try {
                const resp = await (0,_utils_api__WEBPACK_IMPORTED_MODULE_28__.apiRequest)(`/userInfo?id=${tempJson.userId}`);
                const data = await resp.json();
                if (data && data.name) {
                    ownerName = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_15__.htmlspecialchars)(data.name);
                }
            } catch (e) {
                console.error('  userInfo', e);
            }

            const isMine = _me__WEBPACK_IMPORTED_MODULE_7__["default"].id === tempJson.userId;
            const createdDate = new Date(tempJson.createdAt).toLocaleString();

            const infoWin = new _Window__WEBPACK_IMPORTED_MODULE_12__["default"]({
                title: (0,_utils_strings__WEBPACK_IMPORTED_MODULE_14__.capitalize)((0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('template_info')),
                center: true,
                closeable: true
            });

            if (!infoWin.created) return;

            infoWin.body.style.width = '280px';
            infoWin.body.innerHTML = `
                <ul class="templateInfoList">
                    <li><b>${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('name')}:</b> ${tempJson.name}</li>
                    <li><b>${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('createdAt')}:</b> ${createdDate}</li>
                    <li><b>${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('owner')}:</b> ${ownerName}</li>
                    <li><b>${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('isMine')}:</b> ${isMine ? (0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('yes') : (0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('no')}</li>
                    <li><b>${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('public')}:</b> ${tempJson.public ? (0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('yes') : (0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('no')}</li>
                </ul>
            `;
        });


        templateEl.on('click', () => {
            let imgLink = `GRX/f=${tempJson.file}`;
            if (tempJson.origWidth) {
                imgLink += `&w=${tempJson.origWidth}`;
            }

            _ui_elements__WEBPACK_IMPORTED_MODULE_4__.urlInput.val(imgLink);
            (0,_template__WEBPACK_IMPORTED_MODULE_29__.updateTemplate)();
        })
    }
}



/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = __webpack_modules__;
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/amd define */
/******/ 	(() => {
/******/ 		__webpack_require__.amdD = function () {
/******/ 			throw new Error('define cannot be used indirect');
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/chunk loaded */
/******/ 	(() => {
/******/ 		var deferred = [];
/******/ 		__webpack_require__.O = (result, chunkIds, fn, priority) => {
/******/ 			if(chunkIds) {
/******/ 				priority = priority || 0;
/******/ 				for(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];
/******/ 				deferred[i] = [chunkIds, fn, priority];
/******/ 				return;
/******/ 			}
/******/ 			var notFulfilled = Infinity;
/******/ 			for (var i = 0; i < deferred.length; i++) {
/******/ 				var [chunkIds, fn, priority] = deferred[i];
/******/ 				var fulfilled = true;
/******/ 				for (var j = 0; j < chunkIds.length; j++) {
/******/ 					if ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {
/******/ 						chunkIds.splice(j--, 1);
/******/ 					} else {
/******/ 						fulfilled = false;
/******/ 						if(priority < notFulfilled) notFulfilled = priority;
/******/ 					}
/******/ 				}
/******/ 				if(fulfilled) {
/******/ 					deferred.splice(i--, 1)
/******/ 					var r = fn();
/******/ 					if (r !== undefined) result = r;
/******/ 				}
/******/ 			}
/******/ 			return result;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/compat get default export */
/******/ 	(() => {
/******/ 		// getDefaultExport function for compatibility with non-harmony modules
/******/ 		__webpack_require__.n = (module) => {
/******/ 			var getter = module && module.__esModule ?
/******/ 				() => (module['default']) :
/******/ 				() => (module);
/******/ 			__webpack_require__.d(getter, { a: getter });
/******/ 			return getter;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/publicPath */
/******/ 	(() => {
/******/ 		__webpack_require__.p = ".";
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/jsonp chunk loading */
/******/ 	(() => {
/******/ 		// no baseURI
/******/ 		
/******/ 		// object to store loaded and loading chunks
/******/ 		// undefined = chunk not loaded, null = chunk preloaded/prefetched
/******/ 		// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded
/******/ 		var installedChunks = {
/******/ 			"game": 0
/******/ 		};
/******/ 		
/******/ 		// no chunk on demand loading
/******/ 		
/******/ 		// no prefetching
/******/ 		
/******/ 		// no preloaded
/******/ 		
/******/ 		// no HMR
/******/ 		
/******/ 		// no HMR manifest
/******/ 		
/******/ 		__webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);
/******/ 		
/******/ 		// install a JSONP callback for chunk loading
/******/ 		var webpackJsonpCallback = (parentChunkLoadingFunction, data) => {
/******/ 			var [chunkIds, moreModules, runtime] = data;
/******/ 			// add "moreModules" to the modules object,
/******/ 			// then flag all "chunkIds" as loaded and fire callback
/******/ 			var moduleId, chunkId, i = 0;
/******/ 			if(chunkIds.some((id) => (installedChunks[id] !== 0))) {
/******/ 				for(moduleId in moreModules) {
/******/ 					if(__webpack_require__.o(moreModules, moduleId)) {
/******/ 						__webpack_require__.m[moduleId] = moreModules[moduleId];
/******/ 					}
/******/ 				}
/******/ 				if(runtime) var result = runtime(__webpack_require__);
/******/ 			}
/******/ 			if(parentChunkLoadingFunction) parentChunkLoadingFunction(data);
/******/ 			for(;i < chunkIds.length; i++) {
/******/ 				chunkId = chunkIds[i];
/******/ 				if(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {
/******/ 					installedChunks[chunkId][0]();
/******/ 				}
/******/ 				installedChunks[chunkId] = 0;
/******/ 			}
/******/ 			return __webpack_require__.O(result);
/******/ 		}
/******/ 		
/******/ 		var chunkLoadingGlobal = self["webpackChunkgoroxels_client"] = self["webpackChunkgoroxels_client"] || [];
/******/ 		chunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));
/******/ 		chunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module depends on other loaded chunks and execution need to be delayed
/******/ 	var __webpack_exports__ = __webpack_require__.O(undefined, ["vendors","penis"], () => (__webpack_require__("./src/js/main.js")))
/******/ 	__webpack_exports__ = __webpack_require__.O(__webpack_exports__);
/******/ 	
/******/ })()
;
//# sourceMappingURL=game.a59c560d88c38692f86b.bundle.js.map