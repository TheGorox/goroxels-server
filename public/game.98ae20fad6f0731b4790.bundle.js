/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./src/img/3rdcf.png":
/*!***************************!*\
  !*** ./src/img/3rdcf.png ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/3rdcf.png");

/***/ }),

/***/ "./src/img/admin-badge.svg":
/*!*********************************!*\
  !*** ./src/img/admin-badge.svg ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/admin-badge.svg");

/***/ }),

/***/ "./src/img/arrow.svg":
/*!***************************!*\
  !*** ./src/img/arrow.svg ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/arrow.svg");

/***/ }),

/***/ "./src/img/badges/badge0.png":
/*!***********************************!*\
  !*** ./src/img/badges/badge0.png ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/badge0.png");

/***/ }),

/***/ "./src/img/badges/badge1.png":
/*!***********************************!*\
  !*** ./src/img/badges/badge1.png ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/badge1.png");

/***/ }),

/***/ "./src/img/chunkPlaceholder.png":
/*!**************************************!*\
  !*** ./src/img/chunkPlaceholder.png ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/chunkPlaceholder.png");

/***/ }),

/***/ "./src/img/creator-badge.svg":
/*!***********************************!*\
  !*** ./src/img/creator-badge.svg ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/creator-badge.svg");

/***/ }),

/***/ "./src/img/cross.svg":
/*!***************************!*\
  !*** ./src/img/cross.svg ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/cross.svg");

/***/ }),

/***/ "./src/img/discord-logo-circle.svg":
/*!*****************************************!*\
  !*** ./src/img/discord-logo-circle.svg ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/discord-logo-circle.svg");

/***/ }),

/***/ "./src/img/dots.svg":
/*!**************************!*\
  !*** ./src/img/dots.svg ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/dots.svg");

/***/ }),

/***/ "./src/img/fb-logo.svg":
/*!*****************************!*\
  !*** ./src/img/fb-logo.svg ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/fb-logo.svg");

/***/ }),

/***/ "./src/img/goroxels.png":
/*!******************************!*\
  !*** ./src/img/goroxels.png ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/goroxels.png");

/***/ }),

/***/ "./src/img/mod-badge.svg":
/*!*******************************!*\
  !*** ./src/img/mod-badge.svg ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/mod-badge.svg");

/***/ }),

/***/ "./src/img/protectedPattern.png":
/*!**************************************!*\
  !*** ./src/img/protectedPattern.png ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/protectedPattern.png");

/***/ }),

/***/ "./src/img/stripes.png":
/*!*****************************!*\
  !*** ./src/img/stripes.png ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/stripes.png");

/***/ }),

/***/ "./src/img/telegram.svg":
/*!******************************!*\
  !*** ./src/img/telegram.svg ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/telegram.svg");

/***/ }),

/***/ "./src/img/toolIcons/clicker.png":
/*!***************************************!*\
  !*** ./src/img/toolIcons/clicker.png ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/clicker.png");

/***/ }),

/***/ "./src/img/toolIcons/floodfill.png":
/*!*****************************************!*\
  !*** ./src/img/toolIcons/floodfill.png ***!
  \*****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/floodfill.png");

/***/ }),

/***/ "./src/img/toolIcons/line.png":
/*!************************************!*\
  !*** ./src/img/toolIcons/line.png ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/line.png");

/***/ }),

/***/ "./src/img/toolIcons/move.png":
/*!************************************!*\
  !*** ./src/img/toolIcons/move.png ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/move.png");

/***/ }),

/***/ "./src/img/toolIcons/protect.png":
/*!***************************************!*\
  !*** ./src/img/toolIcons/protect.png ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/protect.png");

/***/ }),

/***/ "./src/img/toolIcons/revert.png":
/*!**************************************!*\
  !*** ./src/img/toolIcons/revert.png ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/revert.png");

/***/ }),

/***/ "./src/img/trash2.svg":
/*!****************************!*\
  !*** ./src/img/trash2.svg ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/trash2.svg");

/***/ }),

/***/ "./src/img/unavailable.png":
/*!*********************************!*\
  !*** ./src/img/unavailable.png ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/unavailable.png");

/***/ }),

/***/ "./src/img/user.svg":
/*!**************************!*\
  !*** ./src/img/user.svg ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/user.svg");

/***/ }),

/***/ "./src/img/user2.png":
/*!***************************!*\
  !*** ./src/img/user2.png ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/user2.png");

/***/ }),

/***/ "./src/img/vk-logo.svg":
/*!*****************************!*\
  !*** ./src/img/vk-logo.svg ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/vk-logo.svg");

/***/ }),

/***/ "./src/img/winamp/bg.png":
/*!*******************************!*\
  !*** ./src/img/winamp/bg.png ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/bg.png");

/***/ }),

/***/ "./src/img/winamp/bg2.png":
/*!********************************!*\
  !*** ./src/img/winamp/bg2.png ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/bg2.png");

/***/ }),

/***/ "./src/img/winamp/digits.png":
/*!***********************************!*\
  !*** ./src/img/winamp/digits.png ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/digits.png");

/***/ }),

/***/ "./src/img/winamp/hr-slider-btn-small.png":
/*!************************************************!*\
  !*** ./src/img/winamp/hr-slider-btn-small.png ***!
  \************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/hr-slider-btn-small.png");

/***/ }),

/***/ "./src/img/winamp/slider-btn.png":
/*!***************************************!*\
  !*** ./src/img/winamp/slider-btn.png ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/img/slider-btn.png");

/***/ }),

/***/ "./src/video/as.webm":
/*!***************************!*\
  !*** ./src/video/as.webm ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/video/as.webm");

/***/ }),

/***/ "./src/video/brush.webm":
/*!******************************!*\
  !*** ./src/video/brush.webm ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/video/brush.webm");

/***/ }),

/***/ "./src/video/brush2.webm":
/*!*******************************!*\
  !*** ./src/video/brush2.webm ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/video/brush2.webm");

/***/ }),

/***/ "./src/video/clicker.webm":
/*!********************************!*\
  !*** ./src/video/clicker.webm ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/video/clicker.webm");

/***/ }),

/***/ "./src/video/clickerMouse.webm":
/*!*************************************!*\
  !*** ./src/video/clickerMouse.webm ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/video/clickerMouse.webm");

/***/ }),

/***/ "./src/video/ctrlZ.webm":
/*!******************************!*\
  !*** ./src/video/ctrlZ.webm ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/video/ctrlZ.webm");

/***/ }),

/***/ "./src/video/flood.webm":
/*!******************************!*\
  !*** ./src/video/flood.webm ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/video/flood.webm");

/***/ }),

/***/ "./src/video/line.webm":
/*!*****************************!*\
  !*** ./src/video/line.webm ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/video/line.webm");

/***/ }),

/***/ "./src/video/patternDemo.webm":
/*!************************************!*\
  !*** ./src/video/patternDemo.webm ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/video/patternDemo.webm");

/***/ }),

/***/ "./src/video/toolC.webm":
/*!******************************!*\
  !*** ./src/video/toolC.webm ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/video/toolC.webm");

/***/ }),

/***/ "./src/font/pixel/min5.png":
/*!*********************************!*\
  !*** ./src/font/pixel/min5.png ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/font/min5.png");

/***/ }),

/***/ "./src/font/pixel/min5.txt":
/*!*********************************!*\
  !*** ./src/font/pixel/min5.txt ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/font/min5.txt");

/***/ }),

/***/ "./src/font/pixel/winamp.png":
/*!***********************************!*\
  !*** ./src/font/pixel/winamp.png ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/font/winamp.png");

/***/ }),

/***/ "./src/font/pixel/winamp.txt":
/*!***********************************!*\
  !*** ./src/font/pixel/winamp.txt ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (__webpack_require__.p + "/font/winamp.txt");

/***/ }),

/***/ "./src/css/colorVars.css":
/*!*******************************!*\
  !*** ./src/css/colorVars.css ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/css/style.css":
/*!***************************!*\
  !*** ./src/css/style.css ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
// extracted by mini-css-extract-plugin


/***/ }),

/***/ "./src/img/winamp sync \\.png$":
/*!**************************************************!*\
  !*** ./src/img/winamp/ sync nonrecursive \.png$ ***!
  \**************************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

var map = {
	"./bg.png": "./src/img/winamp/bg.png",
	"./bg2.png": "./src/img/winamp/bg2.png",
	"./digits.png": "./src/img/winamp/digits.png",
	"./hr-slider-btn-small.png": "./src/img/winamp/hr-slider-btn-small.png",
	"./slider-btn.png": "./src/img/winamp/slider-btn.png"
};


function webpackContext(req) {
	var id = webpackContextResolve(req);
	return __webpack_require__(id);
}
function webpackContextResolve(req) {
	if(!__webpack_require__.o(map, req)) {
		var e = new Error("Cannot find module '" + req + "'");
		e.code = 'MODULE_NOT_FOUND';
		throw e;
	}
	return map[req];
}
webpackContext.keys = function webpackContextKeys() {
	return Object.keys(map);
};
webpackContext.resolve = webpackContextResolve;
module.exports = webpackContext;
webpackContext.id = "./src/img/winamp sync \\.png$";

/***/ }),

/***/ "./src/js/Bucket.js":
/*!**************************!*\
  !*** ./src/js/Bucket.js ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Bucket)
/* harmony export */ });
class Bucket{
    constructor(delay, max){
        this._allowance = 0;

        this.delay = delay;
        this.max = max;

        this.lastCheck = Date.now();
    }

    get allowance () {
        if(this.delay === 0) return Infinity;
        
        this._allowance += (Date.now() - this.lastCheck) / this.delay;

        this.lastCheck = Date.now();

        if(this._allowance > this.max) this._allowance = this.max;

        return this._allowance
    }

    set allowance(c){
        this._allowance = c;
    }

    spend(count){
        if(this.delay === 0) return true;

        let allow = this.allowance;

        if(allow < count) return false;

        this.allowance  = allow - count;

        return true
    }
}

/***/ }),

/***/ "./src/js/Chunk.js":
/*!*************************!*\
  !*** ./src/js/Chunk.js ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Chunk)
/* harmony export */ });
/* harmony import */ var _Pattern__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Pattern */ "./src/js/Pattern.js");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config */ "./src/js/config.js");
/* harmony import */ var _img_protectedPattern_png__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../img/protectedPattern.png */ "./src/img/protectedPattern.png");




class Chunk {
    constructor(x, y, buffer) {
        this.x = x;
        this.y = y;

        this.width = _config__WEBPACK_IMPORTED_MODULE_1__.chunkSize;
        this.height = _config__WEBPACK_IMPORTED_MODULE_1__.chunkSize;

        this.canvas = document.createElement('canvas');
        this.canvas.width = this.canvas.height = _config__WEBPACK_IMPORTED_MODULE_1__.chunkSize;

        this.ctx = this.canvas.getContext('2d');

        this.imgData = this.ctx.createImageData(_config__WEBPACK_IMPORTED_MODULE_1__.chunkSize, _config__WEBPACK_IMPORTED_MODULE_1__.chunkSize);
        this.view = new Uint32Array(this.imgData.data.buffer);

        // protected

        // chunksized means the canvas with sizes of the chunk, filled with "protected" pattern
        this.protectedPatternChunkSized = null;
        this._protectedPattern = new _Pattern__WEBPACK_IMPORTED_MODULE_0__["default"](_img_protectedPattern_png__WEBPACK_IMPORTED_MODULE_2__["default"]);
        this._protectedPattern.onload = () => {
            this.needRender = true;
            // pattern shift is an offset, to shift
            // the texture for current chunk, because it might not
            // be dividable by chunk size (pattern misjoint between chunks in result)
            const patternShift = [
                (this.x * this.width) % this._protectedPattern.canvas.width,
                (this.y * this.height) % this._protectedPattern.canvas.height
            ]

            this.protectedPatternChunkSized = this._protectedPattern.createFilledCanvas(this.width, this.height, patternShift[0], patternShift[1]);
        }

        this.pCanvas = document.createElement('canvas');
        this.pCanvas.width = this.pCanvas.height = _config__WEBPACK_IMPORTED_MODULE_1__.chunkSize;

        this.pCtx = this.pCanvas.getContext('2d');
        this.pImgData = this.pCtx.createImageData(_config__WEBPACK_IMPORTED_MODULE_1__.chunkSize, _config__WEBPACK_IMPORTED_MODULE_1__.chunkSize);
        this.pView = new Uint32Array(this.pImgData.data.buffer);

        this.needRender = true;

        this.fromBuffer(buffer);
    }

    render() {
        if (this.needRender) {
            this.needRender = false;
            this.ctx.putImageData(this.imgData, 0, 0);

            if (_config__WEBPACK_IMPORTED_MODULE_1__.game.showProtected) {
                this.ctx.globalAlpha = 0.7;

                this.pCtx.putImageData(this.pImgData, 0, 0);
                if(this.protectedPatternChunkSized !== null){
                    this.pCtx.globalCompositeOperation = 'source-in';
                    this.pCtx.drawImage(this.protectedPatternChunkSized, 0, 0);
                    this.pCtx.globalCompositeOperation = 'source-over'; // back to default
                }

                this.ctx.drawImage(this.pCanvas, 0, 0);

                this.ctx.globalAlpha = 1;
            }
        }
    }

    fromBuffer(buf) {
        let col, isProtected;
        for (let i = 0; i < buf.byteLength; i++) {
            col = buf[i];
            isProtected = col & 0x80;

            isProtected && (this.pView[i] = 0xFFFF0000);
            this.view[i] = _config__WEBPACK_IMPORTED_MODULE_1__.bgrPalette[col & 0x7F];
        }
    }

    get(x, y) {
        return this.view[x + y * _config__WEBPACK_IMPORTED_MODULE_1__.chunkSize]
    }

    set(x, y, c) {
        const i = x + y * _config__WEBPACK_IMPORTED_MODULE_1__.chunkSize

        this.view[i] = c;

        this.needRender = true;
    }

    setProtect(x, y, state) {
        const i = x + y * _config__WEBPACK_IMPORTED_MODULE_1__.chunkSize;
        this.pView[i] = state ? 0xFFFF0000 : 0;

        this.needRender = true;
    }

    getProtect(x, y) {
        const i = x + y * _config__WEBPACK_IMPORTED_MODULE_1__.chunkSize;
        return !!this.pView[i];
    }
}

/***/ }),

/***/ "./src/js/ChunkManager.js":
/*!********************************!*\
  !*** ./src/js/ChunkManager.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ ChunkManager)
/* harmony export */ });
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./globals */ "./src/js/globals.js");
/* harmony import */ var _Chunk__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Chunk */ "./src/js/Chunk.js");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./config */ "./src/js/config.js");
/* harmony import */ var _utils_conversions__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./utils/conversions */ "./src/js/utils/conversions.js");
/* harmony import */ var _actions__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./actions */ "./src/js/actions.js");
/* harmony import */ var pako__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! pako */ "./node_modules/pako/index.js");
/* harmony import */ var pako__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(pako__WEBPACK_IMPORTED_MODULE_5__);
/* harmony import */ var _TempChunkPlaceholder__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./TempChunkPlaceholder */ "./src/js/TempChunkPlaceholder.js");








class ChunkManager {
    constructor() {
        this.chunks = new Map();

        this.loadingChunks = new Set();

        // globals.socket.on('chunk', (cx, cy, cdata) => {
        //     let key = this.getChunkKey(cx, cy);
        //     if (this.loadingChunks.has(key)){
        //         this.loadingChunks.delete(key);
        //     }

        //     let chunk = new Chunk(cx, cy, cdata);
        //     this.chunks.set(key, chunk);

        //     globals.renderer.needRender = true;
        // })

        _globals__WEBPACK_IMPORTED_MODULE_0__["default"].socket.on('place', (x, y, col) => {
            this.setChunkPixel(x, y, col);

            _globals__WEBPACK_IMPORTED_MODULE_0__["default"].renderer.needRender = true;
        })

        _globals__WEBPACK_IMPORTED_MODULE_0__["default"].socket.on('protect', (x, y, state) => {
            this.setProtect(x, y, state);
            
            _globals__WEBPACK_IMPORTED_MODULE_0__["default"].renderer.needRender = true;
        })
    }

    getChunkKey(x, y) {
        return x << 4 | y
    }

    reloadChunks(){
        this.test = true;
        let loadQueue = [...this.chunks.values()];
        const interval = setInterval(() => {
            if(this.loadingChunks.size < 3){
                const chunk = loadQueue.pop();
                if(!chunk){
                    return clearInterval(interval);
                }
                this.loadChunk(chunk.x, chunk.y);
            }
        }, 30)
    }

    loadChunk(x, y) {
        let key = this.getChunkKey(x, y);

        if (_globals__WEBPACK_IMPORTED_MODULE_0__["default"].socket.connected && !this.loadingChunks.has(key) && this.loadingChunks.size < 5) {
            this.loadingChunks.add(key);
            // globals.socket.requestChunk(x, y);
            (0,_actions__WEBPACK_IMPORTED_MODULE_4__.apiRequest)(`/getchunk?canvas=${_config__WEBPACK_IMPORTED_MODULE_2__.canvasId}&x=${x}&y=${y}`).then(async (resp) => {
                
                let key = this.getChunkKey(x, y);
                if (this.loadingChunks.has(key)){
                    this.loadingChunks.delete(key);
                }

                // use pako only if chunk got from socket
                // const cdataCompressed = await resp.arrayBuffer();
                // const cdata = Pako.inflate(cdataCompressed);

                const cdata = await resp.arrayBuffer();

                let chunk = new _Chunk__WEBPACK_IMPORTED_MODULE_1__["default"](x, y, new Uint8Array(cdata));
                this.chunks.set(key, chunk);

                chunk.render(); // workaround because TempChunkPlaceholder getting zeroes until chunk is rendered once
                new _TempChunkPlaceholder__WEBPACK_IMPORTED_MODULE_6__["default"](x, y).save(chunk.canvas);

                _globals__WEBPACK_IMPORTED_MODULE_0__["default"].renderer.needRender = true;
            });
        }
    }

    clearLoadingChunks(){
        this.loadingChunks = new Set;
    }

    hasChunk(x, y) {
        let key = this.getChunkKey(x, y);

        return this.chunks.has(key);
    }

    getChunk(x, y) {
        let key = this.getChunkKey(x, y);

        if (!this.chunks.has(key)) {
            return 0
        }
        return this.chunks.get(key)
    }

    getChunkPixel(x, y) {
        let [cx, cy, offx, offy] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_3__.boardToChunk)(x, y);
        let chunk = this.getChunk(cx, cy);

        if (!chunk || x < 0 || y < 0) return -1

        let argb = chunk.get(offx, offy);

        return _config__WEBPACK_IMPORTED_MODULE_2__.argbToId[argb]
    }

    setChunkPixel(x, y, col) {
        let [cx, cy, offx, offy] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_3__.boardToChunk)(x, y);

        let key = this.getChunkKey(cx, cy);
        if (this.chunks.has(key)) {
            this.chunks.get(key).set(offx, offy, _config__WEBPACK_IMPORTED_MODULE_2__.bgrPalette[col])
        }
    }

    setProtect(x, y, state){
        let [cx, cy, offx, offy] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_3__.boardToChunk)(x, y);

        let key = this.getChunkKey(cx, cy);
        if (this.chunks.has(key)) {
            this.chunks.get(key).setProtect(offx, offy, state)
        }
    }

    getProtect(x, y){
        let [cx, cy, offx, offy] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_3__.boardToChunk)(x, y);
        let chunk = this.getChunk(cx, cy);
        if (!chunk) return -1

        return chunk.getProtect(offx, offy);
    }

    // for the screenshot function
    dumpAll(){
        const canvas = document.createElement('canvas');
        canvas.width = _config__WEBPACK_IMPORTED_MODULE_2__.boardWidth;
        canvas.height = _config__WEBPACK_IMPORTED_MODULE_2__.boardHeight;

        const ctx = canvas.getContext('2d');

        this.chunks.forEach(chunk => {
            if(!chunk.canvas) return;

            const offX = chunk.x * _config__WEBPACK_IMPORTED_MODULE_2__.chunkSize,
                offY = chunk.y * _config__WEBPACK_IMPORTED_MODULE_2__.chunkSize;
            
            ctx.drawImage(chunk.canvas, offX, offY)
        })
        return canvas
    }
}

/***/ }),

/***/ "./src/js/EventManager.js":
/*!********************************!*\
  !*** ./src/js/EventManager.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ EventManager)
/* harmony export */ });
/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! events */ "./node_modules/events/events.js");
/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(events__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var interactjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! interactjs */ "./node_modules/interactjs/dist/interact.min.js");
/* harmony import */ var interactjs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(interactjs__WEBPACK_IMPORTED_MODULE_1__);



function anyInputFocused() {
    return document.activeElement.tagName === 'INPUT' || document.activeElement.tagName === 'TEXTAREA'
}

class EventManager extends (events__WEBPACK_IMPORTED_MODULE_0___default()) {
    /**
     * 
     * @param {Element} element 
     */
    constructor(element) {
        super();

        this.el = element

        this._zoomed = false;

        // true from when two pointers started touch
        // until both of them off
        this.startedGesture = false,
            this.pointers = 0;
        function checkGesture(evName) {
            let wasGesture = this.startedGesture;
            if (evName === 'up') {
                this.pointers = Math.max(this.pointers - 1, 0);
                if (this.pointers == 0) this.startedGesture = false;
            } else if (evName === 'down') {
                if (++this.pointers >= 2)
                    wasGesture = this.startedGesture = true;
            }
            return wasGesture
        }
        checkGesture = checkGesture.bind(this)

        // some of my friends has an issue where 
        // event.movementX/Y sometimes was not present
        let pointerMovementWorkaround = {};

        const FFA_REPLACE_MOVEMENT = true;

        element.addEventListener('pointerdown', e => {
            e.gesture = checkGesture('down');
            this.emit('mousedown', e);
        });
        document.addEventListener('pointermove', e => {
            if (FFA_REPLACE_MOVEMENT || !e.movementX || !e.movementY) {
                // by default, movementX and movementY are read only
                Object.defineProperty(e, 'movementX', {
                    writable: true
                });
                Object.defineProperty(e, 'movementY', {
                    writable: true
                });

                let lastPos = pointerMovementWorkaround[e.pointerId];
                if (!lastPos) {
                    e.movementX = 0;
                    e.movementY = 0;
                } else {
                    e.movementX = e.clientX - lastPos[0];
                    e.movementY = e.clientY - lastPos[1];
                }

                pointerMovementWorkaround[e.pointerId] = [e.clientX, e.clientY];
            }
            // not emitted because Interactjs below will emit this correctly
            if (!checkGesture('move')) {
                this.emit('mousemove', e);
            }
        });
        document.addEventListener('pointerup', e => {
            let pointersCnt = this.pointers;
            e.gesture = checkGesture('up');

            // emit event only if 'pointerdown' event was on canvas
            if (pointersCnt)
                this.emit('mouseup', e);

            delete pointerMovementWorkaround[e.pointerId];
        });

        interactjs__WEBPACK_IMPORTED_MODULE_1___default()(element).gesturable({
            onmove: e => {
                // console.log(e);
                this.emit('zoom', e.ds);

                this.emit('mousemove', {
                    buttons: e.buttons,

                    clientX: e.clientX,
                    clientY: e.clientY,

                    movementX: e.dx * devicePixelRatio,
                    movementY: e.dy * devicePixelRatio,

                    gesture: true
                })
            }
        })

        this.tickLoop = setInterval(() => {
            this.emit('tick')
        }, 1000 / 60);

        document.addEventListener('keydown', e => {
            if (!anyInputFocused()) {
                this.emit('keydown', e)
            }
        });

        document.addEventListener('keyup', e => {
            if (!anyInputFocused()) {
                this.emit('keyup', e)
            }
        });

        element.addEventListener('wheel', e => this.emit('wheel', e))
        element.addEventListener('mouseleave', e => this.emit('mouseleave', e))
    }
}

/***/ }),

/***/ "./src/js/MiniWindow.js":
/*!******************************!*\
  !*** ./src/js/MiniWindow.js ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ MiniWindow)
/* harmony export */ });
/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! events */ "./node_modules/events/events.js");
/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(events__WEBPACK_IMPORTED_MODULE_0__);
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");


class MiniWindow extends (events__WEBPACK_IMPORTED_MODULE_0___default()){
    // 1=ok, 2=ok+cancel
    constructor(title='', closeButtons=1){
        super();

        this.title = title;

        this._closeButtons = closeButtons;

        this.element = null;
        this.bodyElement = null;

        this.closed = false;

        this._create();
    }

    _create(){
        const html = $(`
        <div class="miniWindow">
            <div class="miniWindowTitle">
                ${this.title}
            </div>
            <div class="miniWindowBody">
            </div>
            <div class="miniWindowButtons">
            </div>
        </div>
        `);

        const buttons = [];
        if(this._closeButtons >= 1){
            const okButton = $('<button>ok</button>');
            okButton.on('click', this.buttonHandler.bind(this, 'ok'));
            buttons.push(okButton);
        }
        if(this._closeButtons >= 2){
            const cancelButton = $('<button>cancel</button>');
            cancelButton.on('click', this.buttonHandler.bind(this, 'cancel'));
            buttons.push(cancelButton);
        }
        
        buttons.forEach(b => $('.miniWindowButtons', html).append(b));

        this.element = html;
        this.bodyElement = $('.miniWindowBody', html);
    }

    buttonHandler(buttonName){
        const event = {
            _cancelledClose: false,
            cancelClose: function(){ this._cancelledClose = true }
        }

        switch(buttonName){
            case 'ok':
                this.emit('okClicked', event);
                break;
            case 'cancel':
                this.emit('cancelClicked', event);
        }

        if(!event._cancelledClose){
            this.close();
        }
    }

    close(){
        this.removeAllListeners();
        this.element.remove();
        this.closed = true;
    }
}

/***/ }),

/***/ "./src/js/Pattern.js":
/*!***************************!*\
  !*** ./src/js/Pattern.js ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Pattern)
/* harmony export */ });
class Pattern{
    constructor(url){
        this.url = url;
        this.loaded = false;

        this.canvas = null

        this._load()
    }

    _load(){
        const canvas = document.createElement('canvas');
        
        const img = new Image();
        img.src = this.url;

        img.onload = () => {
            canvas.width = img.width;
            canvas.height = img.height;

            canvas.getContext('2d').drawImage(img, 0, 0);

            this.canvas = canvas;

            this.loaded = true;
            this.onload();
        }
    }

    createFilledCanvas(width, height, offsetX, offsetY){
        const ctx = this.canvas.getContext('2d');
        const pattern = ctx.createPattern(this.canvas, 'repeat');

        const filledCanvas = document.createElement('canvas');
        filledCanvas.width = width;
        filledCanvas.height = height;

        const filledCtx = filledCanvas.getContext('2d');
        
        filledCtx.fillStyle = pattern;
        
        // this "save restore" shit is copied from stackoverflow
        // it's needed to actually shift the pattern
        filledCtx.save();
        filledCtx.translate(offsetX, offsetY);
        filledCtx.fillRect(-offsetX, -offsetY, width, height);
        filledCtx.restore();

        return filledCanvas;
    }

    onload(){}
}

/***/ }),

/***/ "./src/js/Renderer.js":
/*!****************************!*\
  !*** ./src/js/Renderer.js ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Renderer)
/* harmony export */ });
/* harmony import */ var _img_chunkPlaceholder_png__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../img/chunkPlaceholder.png */ "./src/img/chunkPlaceholder.png");
/* harmony import */ var _camera__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./camera */ "./src/js/camera.js");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./config */ "./src/js/config.js");
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./globals */ "./src/js/globals.js");
/* harmony import */ var _Pattern__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./Pattern */ "./src/js/Pattern.js");
/* harmony import */ var _utils_camera__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./utils/camera */ "./src/js/utils/camera.js");
/* harmony import */ var _utils_misc__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./utils/misc */ "./src/js/utils/misc.js");
/* harmony import */ var _template__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./template */ "./src/js/template.js");
/* harmony import */ var _utils_shapes__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./utils/shapes */ "./src/js/utils/shapes.js");
/* harmony import */ var _player__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./player */ "./src/js/player.js");
/* harmony import */ var _TempChunkPlaceholder__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./TempChunkPlaceholder */ "./src/js/TempChunkPlaceholder.js");












const isMobile = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_6__.insanelyLongMobileBrowserCheck)();


class Renderer {
    /**
     * 
     * @param {CanvasRenderingContext2D} ctx 
     */
    constructor(ctx) {
        this.ctx = ctx;
        this.canvas = this.ctx.canvas;

        this.chunkPlaceholderPattern = new _Pattern__WEBPACK_IMPORTED_MODULE_4__["default"](_img_chunkPlaceholder_png__WEBPACK_IMPORTED_MODULE_0__["default"]);
        this.chunkPlaceholderPattern.onload = () => {
            this.needRender = true;
        }
        this.chunkPreviews = {};

        this.needRender = true;

        this.preRendered = {
            brush: {
                canvas: undefined,
                ctx: undefined,
                imageData: undefined,

                circle: undefined,
            }
        }

        this.preRender();
    }

    preRender(){
        this.preRenderBrush();
    }

    preRenderBrush(){
        // TODO make it render only before brush used
        // because it renders on every zoom
        const size = _player__WEBPACK_IMPORTED_MODULE_9__["default"].brushSize,
            zoom = _camera__WEBPACK_IMPORTED_MODULE_1__["default"].zoom;
        
        if(zoom < 1) return

        const canvas = document.createElement('canvas');
        canvas.width = canvas.height = zoom*(size+1);
        const ctx = canvas.getContext('2d');
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;

        const r = size/2;

        const circle = _utils_shapes__WEBPACK_IMPORTED_MODULE_8__["default"].filledCircle(0, 0, r);
        let circleMatrix = [];
        for(let y = 0; y < size+1; y++){
            circleMatrix.push((new Array(size+1)).fill(0))
        }
        
        circle.forEach(([x, y]) => {
            circleMatrix[x+r][y+r] = 1;
        })
        
        ctx.beginPath();
        ctx.lineWidth = zoom / 4;
        ctx.strokeStyle = _config__WEBPACK_IMPORTED_MODULE_2__.hexPalette[_player__WEBPACK_IMPORTED_MODULE_9__["default"].color];
        ctx.lineCap = 'square';

        ctx.fillStyle = 'blue';

        for(let x = 0; x < size; x++){
            for(let y = 0; y < size; y++){
                if(isBound(x, y)) continue;

                let upper = isBound(x, y-1),
                    left = isBound(x - 1, y),
                    right = isBound(x + 1, y),
                    bottom = isBound(x, y + 1);

                if(upper){
                    ctx.moveTo(x*zoom, y*zoom);
                    ctx.lineTo((x+1)*zoom, y*zoom);
                }
                if(left){
                    ctx.moveTo(x*zoom, y*zoom);
                    ctx.lineTo(x*zoom, (y+1)*zoom);
                }
                if(right){
                    ctx.moveTo((x+1)*zoom, y*zoom);
                    ctx.lineTo((x+1)*zoom, (y+1)*zoom);
                }
                if(bottom){
                    ctx.moveTo((x+1)*zoom, (y+1)*zoom);
                    ctx.lineTo(x*zoom, (y+1)*zoom);
                }
            }
        }

        ctx.stroke();
        ctx.closePath();

        function isBound(x, y){
            // check is pixel opaque/out of array

            if(x < 0 || x >= size || y < 0 || y >= size) return true;

            return !circleMatrix[x][y];
        }

        this.preRendered.brush.canvas = canvas;
        this.preRendered.brush.ctx = canvas;
        this.preRendered.brush.imageData = canvas;
        this.preRendered.brush.circle = circle;
    }

    requestRender(){
        if(this.needRender){
            this.needRender = false;

            this.render()
        }

        _globals__WEBPACK_IMPORTED_MODULE_3__["default"].fxRenderer.render();
    }

    correctSmoothing(){
        if(isMobile) return;

        if (_camera__WEBPACK_IMPORTED_MODULE_1__["default"].zoom < 1) {
            this.ctx.imageSmoothingEnabled = true;
            this.ctx.canvas.style.imageRendering = 'auto'
        } else {
            this.ctx.imageSmoothingEnabled = false;
            this.ctx.canvas.style.imageRendering = 'pixelated'
        }
    }

    render() {
        // smooth when zoom < 1, pixelated otherwise
        this.correctSmoothing();

        let visibleChunks = (0,_utils_camera__WEBPACK_IMPORTED_MODULE_5__.getVisibleChunks)();

        // clear veiwport
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

        let camX = _camera__WEBPACK_IMPORTED_MODULE_1__["default"].x + _utils_misc__WEBPACK_IMPORTED_MODULE_6__.halfMap[0] - ((this.canvas.width >> 1) / _camera__WEBPACK_IMPORTED_MODULE_1__["default"].zoom);
        let camY = _camera__WEBPACK_IMPORTED_MODULE_1__["default"].y + _utils_misc__WEBPACK_IMPORTED_MODULE_6__.halfMap[1] - ((this.canvas.height >> 1) / _camera__WEBPACK_IMPORTED_MODULE_1__["default"].zoom);

        let zoom = _camera__WEBPACK_IMPORTED_MODULE_1__["default"].zoom;

        if(zoom === 1){
            // for Firefox, to render normally at least on zoom 1
            camX = Math.floor(camX)
            camY = Math.floor(camY)
        }

        this.ctx.save();
        this.ctx.translate(Math.floor(-camX*zoom), Math.floor(-camY*zoom));
        this.ctx.scale(zoom, zoom);

        visibleChunks.forEach(chunkCord => {
            let [cx, cy] = chunkCord;

            let offX = cx * _config__WEBPACK_IMPORTED_MODULE_2__.chunkSize;
            let offY = cy * _config__WEBPACK_IMPORTED_MODULE_2__.chunkSize;


            if (!_globals__WEBPACK_IMPORTED_MODULE_3__["default"].chunkManager.hasChunk(cx, cy)){
                _globals__WEBPACK_IMPORTED_MODULE_3__["default"].chunkManager.loadChunk(cx, cy);

                // search for chunk preview placeholder
                let chunkPreview = this.chunkPreviews[`${cx}-${cy}`];
                if(!chunkPreview){
                    // create one if not found (one-time op)
                    chunkPreview = this.chunkPreviews[`${cx}-${cy}`] = {
                        loaded: false,
                        data: null
                    };
                    new _TempChunkPlaceholder__WEBPACK_IMPORTED_MODULE_10__["default"](cx, cy).load().then(imgData => {
                        chunkPreview.data = imgData;
                        chunkPreview.loaded = true;
                        this.needRender = true;
                    });
                }else if (chunkPreview.loaded && chunkPreview.data !== null){
                    // or, render it if it's loaded and found in db
                    this.ctx.drawImage(chunkPreview.data, offX, offY, _config__WEBPACK_IMPORTED_MODULE_2__.chunkSize, _config__WEBPACK_IMPORTED_MODULE_2__.chunkSize);

                    // also render default placeholder over it, to clarify we are dealing with preview
                    if(this.chunkPlaceholderPattern.loaded){
                        this.ctx.globalAlpha = 0.5;
                        this.ctx.drawImage(this.chunkPlaceholderPattern.canvas, offX, offY, _config__WEBPACK_IMPORTED_MODULE_2__.chunkSize, _config__WEBPACK_IMPORTED_MODULE_2__.chunkSize);
                        this.ctx.globalAlpha = 1;
                    }
                }else {

                    // fallback to default placeholder if available
                    if(this.chunkPlaceholderPattern.loaded)
                        this.ctx.drawImage(this.chunkPlaceholderPattern.canvas, offX, offY, _config__WEBPACK_IMPORTED_MODULE_2__.chunkSize, _config__WEBPACK_IMPORTED_MODULE_2__.chunkSize);
                }

                return
            }
            
            const chunk = _globals__WEBPACK_IMPORTED_MODULE_3__["default"].chunkManager.getChunk(cx, cy);

            chunk.render();
            this.ctx.drawImage(chunk.ctx.canvas, offX, offY);
        });

        this.ctx.restore();

        _template__WEBPACK_IMPORTED_MODULE_7__["default"].render()
    }
}

/***/ }),

/***/ "./src/js/Socket.js":
/*!**************************!*\
  !*** ./src/js/Socket.js ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Socket)
/* harmony export */ });
/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! events */ "./node_modules/events/events.js");
/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(events__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var pako__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! pako */ "./node_modules/pako/index.js");
/* harmony import */ var pako__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(pako__WEBPACK_IMPORTED_MODULE_1__);
/* harmony import */ var _protocol__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./protocol */ "./src/js/protocol.js");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./config */ "./src/js/config.js");
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./globals */ "./src/js/globals.js");
/* harmony import */ var _user__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./user */ "./src/js/user.js");
/* harmony import */ var _chat__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./chat */ "./src/js/chat.js");
/* harmony import */ var _windows__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./windows */ "./src/js/windows.js");
/* harmony import */ var _Window__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./Window */ "./src/js/Window.js");
/* harmony import */ var _player__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./player */ "./src/js/player.js");
/* harmony import */ var _actions__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./actions */ "./src/js/actions.js");
/* harmony import */ var _translate__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./translate */ "./src/js/translate.js");
/* provided dependency */ var toastr = __webpack_require__(/*! toastr */ "./node_modules/toastr/toastr.js");














class Socket extends (events__WEBPACK_IMPORTED_MODULE_0___default()) {
    constructor(port) {
        super();

        const scheme = location.protocol.startsWith('https') ? 'wss' : 'ws';
        const host = location.hostname || 'localhost';
        this.url = `${scheme}://${host}:${port}`;

        this.pendingPixels = {};

        this.connectedOnce = false;

        this.connect();
    }

    get connected() {
        return this.socket && this.socket.readyState === WebSocket.OPEN
    }

    connect() {
        this.socket = new WebSocket(this.url);
        this.socket.binaryType = 'arraybuffer';

        this.socket.onopen = () => {
            this.sendChatSubscribe('global', this.connectedOnce);
            this.sendChatSubscribe(_config__WEBPACK_IMPORTED_MODULE_3__.canvasName, this.connectedOnce);
            this.sendCanvas(_config__WEBPACK_IMPORTED_MODULE_3__.canvasId);

            this.emit('opened');
            console.log('Socket has been connected');

            if(!this.connectedOnce) this.connectedOnce = true;
        }

        this.socket.onmessage = this.onmessage.bind(this);

        this.socket.onclose = () => {
            this.emit('closed');
            Object.values(_globals__WEBPACK_IMPORTED_MODULE_4__["default"].users).forEach(u => u.close(u.id));
            _globals__WEBPACK_IMPORTED_MODULE_4__["default"].users = {};

            _globals__WEBPACK_IMPORTED_MODULE_4__["default"].chunkManager.clearLoadingChunks();

            setTimeout(() => {
                console.log('reconnect');
                this.reconnect();
            }, Math.random()*1000);
        }
    }

    close(){
        this.socket.close();
    }

    reconnect() {
        this.socket.onmessage = null;
        this.socket.onopen = null;
        this.socket.onclose = null;

        this.connect();
    }

    onmessage({
        data: message
    }) {
        if (typeof message === 'string') {
            this.onStringMessage(message);
        } else {
            // must be ping
            if (!message.byteLength) return;

            this.onBinaryMessage(message);
        }
    }

    onStringMessage(msg) {
        let decoded;
        try {
            decoded = JSON.parse(msg);
        } catch (e) {
            console.log('onStringMessage message decoding error: ' + e, 'message: ' + msg);
            return
        }

        switch (decoded.c) {
            case _protocol__WEBPACK_IMPORTED_MODULE_2__.STRING_OPCODES.userJoin: {
                const {
                    nick: name,
                    userId,
                    id,
                    registered,
                    role,
                    badges
                } = decoded;

                const badgesParsed = badges?.split('|').filter(x => x.length).map(x => +x);

                let sameUser;
                if(name){
                    sameUser = Object.values(_globals__WEBPACK_IMPORTED_MODULE_4__["default"].users).find(u => u.name === name);
                }

                if(sameUser){
                    _globals__WEBPACK_IMPORTED_MODULE_4__["default"].users[id] = sameUser;
                    sameUser.newConnection(id);
                }else{
                    _globals__WEBPACK_IMPORTED_MODULE_4__["default"].users[id] = new _user__WEBPACK_IMPORTED_MODULE_5__["default"](name, id, userId, registered, role, badgesParsed);
                }

                break
            }

            case _protocol__WEBPACK_IMPORTED_MODULE_2__.STRING_OPCODES.userLeave: {
                const id = decoded.id;

                if (_globals__WEBPACK_IMPORTED_MODULE_4__["default"].users[id]) _globals__WEBPACK_IMPORTED_MODULE_4__["default"].users[id].close(id);

                break
            }

            case _protocol__WEBPACK_IMPORTED_MODULE_2__.STRING_OPCODES.error: {
                decoded.errors.forEach(error => {
                    if(error === 'error.captcha'){
                        if(!_Window__WEBPACK_IMPORTED_MODULE_8__["default"].Exists('Captcha'))
                            (0,_windows__WEBPACK_IMPORTED_MODULE_7__.captchaModal)();
                    }
                    toastr.error(error, (0,_translate__WEBPACK_IMPORTED_MODULE_11__.translate)('Error from the Socket:'), {
                        preventDuplicates: true
                    });
                });

                break;
            }

            case _protocol__WEBPACK_IMPORTED_MODULE_2__.STRING_OPCODES.chatMessage: {
                _chat__WEBPACK_IMPORTED_MODULE_6__["default"].addMessage(decoded)

                break
            }

            case _protocol__WEBPACK_IMPORTED_MODULE_2__.STRING_OPCODES.alert: {
                // todo  
                toastr.info(decoded.msg, 'ALERT', {
                    timeOut: 1000*60*5,
                    extendedTimeOut: 1000*60*5
                })
                break
            }

            case _protocol__WEBPACK_IMPORTED_MODULE_2__.STRING_OPCODES.me: {
                _player__WEBPACK_IMPORTED_MODULE_9__["default"].id = decoded.id;
                break
            }

            case _protocol__WEBPACK_IMPORTED_MODULE_2__.STRING_OPCODES.reload: {
                location.reload();
                break
            }

            case _protocol__WEBPACK_IMPORTED_MODULE_2__.STRING_OPCODES.reloadChunks: {
                _globals__WEBPACK_IMPORTED_MODULE_4__["default"].chunkManager.reloadChunks();
                break
            }
        }
    }

    onBinaryMessage(msg) {
        const dv = new DataView(msg);

        switch (dv.getUint8(0)) {
            case _protocol__WEBPACK_IMPORTED_MODULE_2__.OPCODES.captcha: {
                (0,_windows__WEBPACK_IMPORTED_MODULE_7__.captchaModal)();
                break
            }
            case _protocol__WEBPACK_IMPORTED_MODULE_2__.OPCODES.chunk: {
                const cx = dv.getUint8(1);
                const cy = dv.getUint8(2);

                const chunkData = pako__WEBPACK_IMPORTED_MODULE_1___default().inflate(dv.buffer.slice(3));

                this.emit('chunk', cx, cy, chunkData);

                break
            }

            case _protocol__WEBPACK_IMPORTED_MODULE_2__.OPCODES.place: {
                const x = dv.getUint16(1);
                const y = dv.getUint16(3);
                const col = dv.getUint8(5);

                const id = dv.getUint32(5);

                this.onIncomingPixel([x, y, col], id);
                break
            }

            case _protocol__WEBPACK_IMPORTED_MODULE_2__.OPCODES.online: {
                const count = dv.getUint16(1);

                this.emit('online', count);
                break
            }

            case _protocol__WEBPACK_IMPORTED_MODULE_2__.OPCODES.pixels: {
                const isProtect = !!dv.getUint8(1),
                    uid = dv.getUint32(2, false);
                let x, y, col;
                for(let i = 6; i < dv.byteLength; i+=5){
                    x = dv.getUint16(i);
                    y = dv.getUint16(i+2);
                    col = dv.getUint8(i+4);
                    if(isProtect){
                        this.emit('protect', x, y, col);
                    }else{
                        this.emit('place', x, y, col, uid);
                    }
                }

                const user = _globals__WEBPACK_IMPORTED_MODULE_4__["default"].users[uid];
                if(user) user.updateCoords(col, x, y);
                
                break
            }

            case _protocol__WEBPACK_IMPORTED_MODULE_2__.OPCODES.ping: {
                this.socket.send(new Uint8Array([_protocol__WEBPACK_IMPORTED_MODULE_2__.OPCODES.ping]));
                break
            }

            case _protocol__WEBPACK_IMPORTED_MODULE_2__.OPCODES.placeBatch: {
                const PIXEL_LENGTH = 9;

                const totalPixels = (dv.byteLength-1) / PIXEL_LENGTH;
                if(totalPixels % 1 !== 0){
                    console.warn('TotalPixels length is not integer');
                }

                for(let off = 1; off < dv.byteLength; off += PIXEL_LENGTH){
                    const x = dv.getUint16(off);
                    const y = dv.getUint16(off+2);
                    const c = dv.getUint8(off+4);
                    const placerId = dv.getUint32(off+5);

                    this.onIncomingPixel([x, y, c], placerId);
                }
                break
            }

            case _protocol__WEBPACK_IMPORTED_MODULE_2__.OPCODES.updateRadio: {
                const type = dv.getUint8(1);
                this.emit('radio', type);
                break
            }
        }
    }

    onIncomingPixel([x, y, col], id){
        const user = _globals__WEBPACK_IMPORTED_MODULE_4__["default"].users[id];
        if(user) user.updateCoords(col, x, y);

        const key = x + ',' + y;
        let timeout = this.pendingPixels[key];
        if(timeout){
            clearTimeout(timeout);
            delete this.pendingPixels[key];
        }

        this.emit('place', x, y, col, id);

        // does not work, id is not player id
        if(id === _player__WEBPACK_IMPORTED_MODULE_9__["default"].id)
            (0,_actions__WEBPACK_IMPORTED_MODULE_10__.updatePlaced)(_player__WEBPACK_IMPORTED_MODULE_9__["default"].placedCount++);
    }

    requestChunk(x, y) {
        let dv = new DataView(new ArrayBuffer(1 + 1 + 1));
        dv.setUint8(0, _protocol__WEBPACK_IMPORTED_MODULE_2__.OPCODES.chunk);
        dv.setUint8(1, x);
        dv.setUint8(2, y);

        this.socket.send(dv.buffer)
    }

    sendPixel(x, y, c) {
        let dv = new DataView(new ArrayBuffer(1 + 5))

        dv.setUint8(0, _protocol__WEBPACK_IMPORTED_MODULE_2__.OPCODES.place);
        dv.setUint16(1, x);
        dv.setUint16(3, y);
        dv.setUint8(5, c);

        this.socket.send(dv.buffer);
    }

    sendPixels(pixels, isProtect=false) {
        let dv = new DataView(new ArrayBuffer(6 + pixels.length*5))

        dv.setUint8(0, _protocol__WEBPACK_IMPORTED_MODULE_2__.OPCODES.pixels);
        dv.setUint8(1, isProtect ? 1 : 0); // isProtect
        for(let i = 0; i < pixels.length; i++){
            let offset = i*5 + 6;
            const [x, y, col] = pixels[i];

            dv.setUint16(offset, x);
            dv.setUint16(offset+2, y);
            dv.setUint8(offset+4, col);
        }

        this.socket.send(dv.buffer)
    }

    sendCanvas(id) {
        const dv = new DataView(new ArrayBuffer(2));
        dv.setUint8(0, _protocol__WEBPACK_IMPORTED_MODULE_2__.OPCODES.canvas);
        dv.setUint8(1, id);

        this.socket.send(dv.buffer);
    }

    sendChatSubscribe(channel, isReconnect){
        const packet = {
            c: _protocol__WEBPACK_IMPORTED_MODULE_2__.STRING_OPCODES.subscribeChat,
            ch: channel,
            reconnect: isReconnect
        }

        this.socket.send(JSON.stringify(packet));
    }

    sendChatMessage(text, channel, whisper=false) {
        const packet = {
            c: _protocol__WEBPACK_IMPORTED_MODULE_2__.STRING_OPCODES.chatMessage,
            msg: text,
            ch: channel
        }

        if(whisper) packet.whisper = whisper;

        this.socket.send(JSON.stringify(packet));
    }

    sendChatWhisper(text, channel, whisperId){
        return this.sendChatMessage(text, channel, whisperId);
    }

    sendAlert(to, text){
        const packet = {
            c: _protocol__WEBPACK_IMPORTED_MODULE_2__.STRING_OPCODES.alert,
            to,
            msg: text
        }

        this.socket.send(JSON.stringify(packet));
    }
}

/***/ }),

/***/ "./src/js/TempChunkPlaceholder.js":
/*!****************************************!*\
  !*** ./src/js/TempChunkPlaceholder.js ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ TempChunkPlaceholder)
/* harmony export */ });
/* harmony import */ var _config_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./config.js */ "./src/js/config.js");
/* harmony import */ var _indexedDb_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./indexedDb.js */ "./src/js/indexedDb.js");
/* harmony import */ var _utils_misc__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./utils/misc */ "./src/js/utils/misc.js");
// this class is for loading/getting saved chunk placeholder,
// based on the previous loaded chunk image





class TempChunkPlaceholder {
    constructor(chunkX, chunkY) {
        this.x = chunkX;
        this.y = chunkY;
    }

    // load from localStorage
    async load() {
        return new Promise((res, rej) => {
            const dbKey = `${_config_js__WEBPACK_IMPORTED_MODULE_0__.canvasId}-${this.x}-${this.y}`;
            _indexedDb_js__WEBPACK_IMPORTED_MODULE_1__.addInitCallback(async () => {
                try {
                    const chunkData = await this._loadFromDb(dbKey);
                    const chunkCanvas = this._fromData(chunkData);

                    res(chunkCanvas);
                } catch (error) {
                    rej(error);
                }
            })
        })
    }

    async _loadFromDb(dbKey) {
        return new Promise((res, rej) => {
            let transaction = _indexedDb_js__WEBPACK_IMPORTED_MODULE_1__.database.transaction("chunkPlaceholders", "readonly");

            let request = transaction.objectStore("chunkPlaceholders").get(dbKey);
    
            request.onsuccess = function () {
                const chunk = request.result;

                if(chunk === undefined) return res(null);
                return res(chunk);
            };
    
            request.onerror = function (event) {
                rej(request.error);
            };
    
            transaction.onabort = function () {
                rej(request.error);
            };
        })
    }

    _fromData(savedChunk){
        const canvas = document.createElement('canvas');

        canvas.width = savedChunk.width;
        canvas.height = savedChunk.height;

        const ctx = canvas.getContext('2d');
        
        const imageData = ctx.createImageData(canvas.width, canvas.height);
        imageData.data.set(savedChunk.data);

        ctx.putImageData(imageData, 0, 0);

        return (0,_utils_misc__WEBPACK_IMPORTED_MODULE_2__.resizeCanvas)(canvas, _config_js__WEBPACK_IMPORTED_MODULE_0__.chunkSize, _config_js__WEBPACK_IMPORTED_MODULE_0__.chunkSize);
    }

    async save(chunkCanvas){
        return new Promise((res, rej) => {
            const dbKey = `${_config_js__WEBPACK_IMPORTED_MODULE_0__.canvasId}-${this.x}-${this.y}`;
            _indexedDb_js__WEBPACK_IMPORTED_MODULE_1__.addInitCallback(async () => {
                try {
                    await this._saveToDb(dbKey, chunkCanvas);

                    res();
                } catch (error) {
                    rej(error);
                }
            })
        })
    }

    async _saveToDb(dbKey, chunkCanvas){
        return new Promise((res, rej) => {
            // 50x50 is hardcoded size for all previews
            const resizedChunkCanvas = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_2__.resizeCanvas)(chunkCanvas, 50, 50);
            const resizedImgData = resizedChunkCanvas.getContext('2d').getImageData(0, 0, 50, 50);

            let transaction = _indexedDb_js__WEBPACK_IMPORTED_MODULE_1__.database.transaction("chunkPlaceholders", "readwrite");

            let request = transaction.objectStore("chunkPlaceholders").put({
                'chunk_key': dbKey,

                width: resizedImgData.width,
                height: resizedImgData.height,
                data: resizedImgData.data,
            });
    
            request.onsuccess = function () {
                res();
            };
    
            request.onerror = function (event) {
                rej(request.error);
            };
    
            transaction.onabort = function () {
                rej(request.error);
            };
        })
    }
}

/***/ }),

/***/ "./src/js/Tool.js":
/*!************************!*\
  !*** ./src/js/Tool.js ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ Tool)
/* harmony export */ });
/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! events */ "./node_modules/events/events.js");
/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(events__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./constants */ "./src/js/constants.js");



class Tool extends (events__WEBPACK_IMPORTED_MODULE_0___default()){
    constructor(name, defaultKey=null, iconURL=null, minRole=_constants__WEBPACK_IMPORTED_MODULE_1__.ROLE.GUEST){
        super();

        this.name = name;
        this.icon = iconURL;

        this.key = defaultKey ? defaultKey.toString() : undefined;

        this.requiredRole = minRole;
    }
}

/***/ }),

/***/ "./src/js/ToolManager.js":
/*!*******************************!*\
  !*** ./src/js/ToolManager.js ***!
  \*******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ ToolManager)
/* harmony export */ });
/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! events */ "./node_modules/events/events.js");
/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(events__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./globals */ "./src/js/globals.js");
/* harmony import */ var _tools__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./tools */ "./src/js/tools.js");
/* harmony import */ var _camera__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./camera */ "./src/js/camera.js");
/* harmony import */ var _player__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./player */ "./src/js/player.js");
/* harmony import */ var _utils_conversions__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./utils/conversions */ "./src/js/utils/conversions.js");
/* harmony import */ var _utils_misc__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./utils/misc */ "./src/js/utils/misc.js");
/* harmony import */ var _utils_localStorage__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./utils/localStorage */ "./src/js/utils/localStorage.js");
/* harmony import */ var _me__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./me */ "./src/js/me.js");
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* provided dependency */ var toastr = __webpack_require__(/*! toastr */ "./node_modules/toastr/toastr.js");










const coords = _globals__WEBPACK_IMPORTED_MODULE_1__["default"].elements.coords;

function updatePlayerCoords(clientX, clientY) {
    let [newX, newY] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_5__.screenToBoardSpace)(clientX, clientY);

    if (newX === _player__WEBPACK_IMPORTED_MODULE_4__["default"].x && newY === _player__WEBPACK_IMPORTED_MODULE_4__["default"].y) {
        return
    }

    _player__WEBPACK_IMPORTED_MODULE_4__["default"].x = newX;
    _player__WEBPACK_IMPORTED_MODULE_4__["default"].y = newY;

    coords.innerText = `(${_player__WEBPACK_IMPORTED_MODULE_4__["default"].x}, ${_player__WEBPACK_IMPORTED_MODULE_4__["default"].y})`

    if (_player__WEBPACK_IMPORTED_MODULE_4__["default"].color != -1 && _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom > 1)
        _globals__WEBPACK_IMPORTED_MODULE_1__["default"].renderer.needRender = true;
}

const isMobile = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_6__.insanelyLongMobileBrowserCheck)();

class ToolManager extends (events__WEBPACK_IMPORTED_MODULE_0___default()) {
    constructor() {
        super();

        this.tools = _tools__WEBPACK_IMPORTED_MODULE_2__["default"];
        this.tool = _tools__WEBPACK_IMPORTED_MODULE_2__["default"].mover;

        this._keyBinds = {};
        this._colorBinds = {};
        this.activeTools = {};

        this.addTools();
        this.loadBinds();
        this.initEvents();

        this.ctrlDown = false;
        this.altDown = false;

        _me__WEBPACK_IMPORTED_MODULE_8__["default"].callOnLoaded(this.filterTools.bind(this));
    }

    filterTools() {
        Object.keys(this.tools).forEach(name => {
            if (this.tools[name].requiredRole > _me__WEBPACK_IMPORTED_MODULE_8__["default"].role) {
                delete this._keyBinds[this.tools[name].key];

                if (isMobile) {
                    $(`#tool_${name}`).remove();
                }
            }
        })
    }

    addTools() {
        const toolsEl = document.getElementById('tools');

        Object.keys(this.tools).forEach(name => {
            const tool = this.tools[name];

            if (isMobile) {
                if (!tool.icon) return;

                let el = document.createElement('div');
                el.classList = 'toolContainer';
                el.id = `tool_${name}`;
                let img = document.createElement('img');
                img.className = 'toolIcon';
                img.src = tool.icon;

                el.appendChild(img);
                toolsEl.appendChild(el); // todo add click choosing etc

                el.addEventListener('pointerdown', choose.bind(this));

                function choose() {
                    let oldTool = document.getElementsByClassName('toolContainer selected')[0]
                    if (oldTool)
                        oldTool.className = 'toolContainer';

                    el.classList = ['toolContainer selected'];
                    this.tool = tool;
                }
                if (tool.name === 'mover')
                    choose.apply(this);
            } else {
                if (_player__WEBPACK_IMPORTED_MODULE_4__["default"])
                    this._keyBinds[tool.key] = tool;
            }
        })
    }

    initEvents() {
        let em = _globals__WEBPACK_IMPORTED_MODULE_1__["default"].eventManager;

        if (isMobile) {
            em.on('zoom', zoom => {
                _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom *= zoom + 1;
                _camera__WEBPACK_IMPORTED_MODULE_3__["default"].checkZoom();
                _globals__WEBPACK_IMPORTED_MODULE_1__["default"].renderer.needRender = true;
                _globals__WEBPACK_IMPORTED_MODULE_1__["default"].fxRenderer.needRender = true;
            });

            em.on('mousedown', e => {
                updatePlayerCoords(e.clientX, e.clientY);
            });

            em.on('mousemove', e => {
                updatePlayerCoords(e.clientX, e.clientY);
            });

            let events = [
                ['mousedown', 'down'],
                ['mousemove', 'move'],
                ['mouseup', 'up']
            ];

            events.forEach(event => {
                const [realEvent, myEvent] = event;
                em.on(realEvent, e => {
                    let tool = this.tool;
                    if (e && e.gesture) {
                        this.tool.emit('_gesture');
                        tool = this.tools.mover;
                    }
                    if (!tool) return

                    // emit to selected tool
                    tool.emit(myEvent, e);
                    // emit to other subscribers
                    this.emit(myEvent, e);
                });
            });
        } else {
            // TODO     eventManager
            em.on('mousedown', e => {
                this.tools.mover.emit('down', e)
            });
            em.on('mouseup', e => {
                if (e.button === 2) {
                    _player__WEBPACK_IMPORTED_MODULE_4__["default"].switchColor(-1);
                    _player__WEBPACK_IMPORTED_MODULE_4__["default"].switchSecondColor(-1);
                }
                this.tools.mover.emit('up', e);
            });
            em.on('mousemove', e => {
                if (e.buttons === 0 || _camera__WEBPACK_IMPORTED_MODULE_3__["default"].noMoving) {
                    updatePlayerCoords(e.clientX, e.clientY);
                }

                this.tool.emit('move', e)
                this.emit('move', e);
            });

            em.on('keydown', e => {
                let str = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_6__.stringifyKeyEvent)(e);
                if (!str) return;

                const tool = this._keyBinds[str];

                if (tool) {
                    // TODO
                    this.tool = tool; // , 
                    // ?   mousemove  down
                    //    up
                    tool.emit('down', e);
                }
            });

            em.on('keyup', e => {
                let str = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_6__.stringifyKeyEvent)(e);
                if (!str) return;

                const tool = this._keyBinds[str];

                for (let name of Object.keys(this.tools)) {
                    const tool2 = this.tools[name];

                    if (!tool2.key || tool2 === tool)
                        continue;

                    const key = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_6__.decodeKey)(tool2.key);
                    if (key.code === e.code) {
                        tool2.emit('up', e)
                    }
                }

                if (tool) {
                    e.preventDefault();
                    e.stopPropagation();

                    tool.emit('up', e);
                }
            });

            em.on('wheel', e => {
                const oldZoom = _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom;
                _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoomTo(e.deltaY);

                const dx = e.clientX - window.innerWidth / 2;
                const dy = e.clientY - window.innerHeight / 2;

                _camera__WEBPACK_IMPORTED_MODULE_3__["default"].moveTo((dx / oldZoom), (dy / oldZoom));
                _camera__WEBPACK_IMPORTED_MODULE_3__["default"].moveTo(-(dx / _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom), -(dy / _camera__WEBPACK_IMPORTED_MODULE_3__["default"].zoom));

                if(localStorage.getItem('iHaveProblems') === 'yes'){
                    _camera__WEBPACK_IMPORTED_MODULE_3__["default"].x = Math.round(_camera__WEBPACK_IMPORTED_MODULE_3__["default"].x); _camera__WEBPACK_IMPORTED_MODULE_3__["default"].y = Math.round(_camera__WEBPACK_IMPORTED_MODULE_3__["default"].y);
                    _globals__WEBPACK_IMPORTED_MODULE_1__["default"].renderer.needRender = true;
                }
            });
        }

        function specKeysHandlers(e){
            this.ctrlDown = e.ctrlKey;
            this.altDown = e.altKey;
        }

        em.on('keydown', specKeysHandlers.bind(this));
        em.on('keyup', specKeysHandlers.bind(this));

        // TODO: add listener directly to ToolManager, istead of tool itself, avoiding cyclic check
        em.on('tick', e => {
            Object.keys(this.tools).forEach(name => {
                const tool = this.tools[name];
                if (tool.listenerCount('tick') > 0) {
                    tool.emit('tick', e);
                }
            });
        });
    }

    changeKey(tool, key) {
        const oldKey = tool.key;
        delete this._keyBinds[oldKey];

        tool.key = key;
        this._keyBinds[key] = tool
    }

    loadBinds() {
        const str = (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_7__.getLS)('keyBinds');
        let newBinds;
        try {
            newBinds = JSON.parse(str);
            if (!newBinds)
                return;
        } catch {
            toastr.error('Error on parsing key binds from local storage');
            localStorage.removeItem('keyBinds');
            return
        }

        let toolname;
        for (let key of Object.keys(newBinds)) {
            if (toolname = this.findByName(key))
                this.changeKey(this.tools[toolname], newBinds[key]);
        }
    }

    findByName(name) {
        const keys = Object.keys(this.tools);
        return keys.find(key => this.tools[key].name === name)
    }

    initColorBinds(){

    }

    loadColorBinds(){

    }
}

/***/ }),

/***/ "./src/js/Window.js":
/*!**************************!*\
  !*** ./src/js/Window.js ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   Modal: () => (/* binding */ Modal),
/* harmony export */   "default": () => (/* binding */ Window)
/* harmony export */ });
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
/* harmony import */ var jquery__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(jquery__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _img_trash2_svg__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../img/trash2.svg */ "./src/img/trash2.svg");
/* harmony import */ var _img_cross_svg__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../img/cross.svg */ "./src/img/cross.svg");
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
// copied from template 3.0
// copyright GOROX





const deleteEl = document.createElement('div'); //    
deleteEl.style.cssText =
    `
    width: 80px;
    height: 80px;
    line-height: 80px;
    text-align: center;
    border: solid 2px white;
    border-radius: 50%;
    opacity: .5;
    position: absolute;
    z-index: 8;
    bottom: 10px;
    right: 10px;
    background-color: red;
    color: white;
    font-size: 68px;
    padding-left: 3px; /*  -    */
    display: none;
    user-select: none;
    transition: all .2s ease;
    background-image: url(${_img_trash2_svg__WEBPACK_IMPORTED_MODULE_1__["default"]});
`;

let deleteRange = document.createElement('div');
deleteRange.style.cssText =
    `
    opacity: .1;
    width: 300px;
    height: 300px;
    position: absolute;
    border-radius: 50%;
    z-index: 7;
    bottom: -100px;
    right: -100px;
    background-color: red;
    display: none;
`

deleteEl.onpointerenter = deleteRange.onpointerenter = () => {
    deleteEl.style.opacity = '1';
};

deleteEl.onpointerleave = deleteRange.onpointerleave = () => {
    deleteEl.style.opacity = '.5';
};

// disabled due new way to close
// document.body.appendChild(deleteEl);
// document.body.appendChild(deleteRange);

let windows = [];
window.windows = windows;

class Window {
    static Exists(title){
        return windows.some(x => x.title === title)
    }
    static Find(title){
        return windows.find(x => x.title === title)
    }
    constructor(config) {
        // all values also will be loaded from config few lines below

        // title can be passed instead of config
        if(typeof config == 'string')
            config = {title:config}

        this.created = false;

        this.x = 0;
        this.y = 0;

        this.title = "";

        this.parent = document.body;

        // do not set to false if closeable
        this.moveable = true;
        this.closeable = true;
        this.closed = false;

        this.center = false;

        // here
        Object.assign(this, config);

        if (Window.Exists(this.title)) {
            this.oldWindow = Window.Find(this.title);
            return
        }

        this.created = true;

        if(!this.block){ // for static windows like chat
            this.block = this.createParentBlock();
            this.moveTo(this.x, this.y); // user defined coordinates
            this.parent.appendChild(this.block);
        }

        if (this.center) {
            this.moveToCenter();
            // :    
            setTimeout(() => this.moveToCenter());
        }

        this.addFeatures();

        windows.push(this);
    }

    updateTitle(newTitle, temp=false){
        if(!temp){
            this.title = newTitle;
        }
        const head = $('.windowTitle', this.element);

        // this makes ".innerHtml = ..." of method below purposeless
        // since html is not saved here
        head.text(newTitle);
    }

    createParentBlock() {
        let el = document.createElement('div');
        el.className = 'window';
        this.element = el;

        let head = document.createElement('div');
        head.className = 'windowHeader'
        head.innerHTML = '<h3 class="windowTitle">' + this.title + '</h3>';
        el.appendChild(head);

        if(this.closeable){
            const closer = document.createElement('div');
            closer.className = 'closeWindow';
            closer.innerHTML = '<div></div>';

            closer.addEventListener('pointerdown', event => {
                // prevent window moving
                event.stopPropagation();
            });
            closer.addEventListener('click', this.close.bind(this));
            head.appendChild(closer);
        }

        let body = document.createElement('div');
        body.className = 'windowBody';
        el.appendChild(body);
        this.body = body;

        return el
    }

    moveTo(x, y) {
        const rect = this.block.getBoundingClientRect();
        const w = rect.width,
            h = rect.height;

        this.x = Math.max(-w+10, x);
        this.y = Math.max(-h+10, y);

        this.x = Math.min(window.innerWidth-10, this.x);
        this.y = Math.min(window.innerHeight-10, this.y);

        this.block.style.left = this.x + 'px';
        this.block.style.top = this.y + 'px';
    }

    moveBy(x, y) {
        this.moveTo(this.x + x, this.y + y);
    }

    moveToCenter() {
        let windowWidth = window.innerWidth,
            windowHeight = window.innerHeight;

        let blockWidth = this.block.offsetWidth,
            blockHeight = this.block.offsetHeight;

        this.moveTo(
            windowWidth / 2 - blockWidth / 2,
            windowHeight / 2 - blockHeight / 2
        );
    }

    addFeatures() {
        if (this.moveable) {
            const ratio = window.devicePixelRatio||1;

            $(this.block).on('pointerdown', () => {
                let self = this;

                jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).on('pointermove', moved)

                function moved(e) {
                    e = e.originalEvent;

                    let movedX = e.movementX/ratio,
                        movedY = e.movementY/ratio;

                    self.moveBy(movedX, movedY);
                }

                if (this.closeable) {
                    deleteEl.style.display = 'block';
                    deleteRange.style.display = 'block';

                    jquery__WEBPACK_IMPORTED_MODULE_0___default()([deleteEl, deleteRange]).one('pointerup', () => {
                        this.close();
                    })
                }

                jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).one('pointerup pointerleave', () => {
                    deleteEl.style.display = 'none';
                    deleteRange.style.display = 'none';

                    jquery__WEBPACK_IMPORTED_MODULE_0___default()([deleteEl, deleteRange]).off('pointerup');

                    jquery__WEBPACK_IMPORTED_MODULE_0___default()(document).off('pointermove', moved);
                });
            });

            $(this.body).on('pointerdown', e => {
                e.stopPropagation();
            })
        }

        // for window be in screen after
        // screen rotation
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                this.moveTo(this.x, this.y);
            }, 500);
        })
    }

    close() {
        jquery__WEBPACK_IMPORTED_MODULE_0___default()(this.block).remove();
        this.closed = true;
        windows.splice(windows.indexOf(this), 1);
    }
}

let Modal_exists = false;
class Modal{
    static get isRunning(){
        return Modal_exists
    }
    static set isRunning(val){
        return Modal_exists=val;
    }

    constructor(config={}){
        if(Modal.isRunning)
            throw new Error('Modal is running');

        this.body = null;

        Object.assign(this, config);
        this.init();

        Modal.isRunning = true;
    }

    init(){
        const els = 
        $(`<div class="modalBg">
            <div class="modalCont">
            </div>
        </div>`);

        this.bgEl = els[0];
        this.contEl = this.bgEl.children[0];

        $('#ui').append(els);
    }

    close(){
        this.bgEl.remove();
    }
}

/***/ }),

/***/ "./src/js/actions.js":
/*!***************************!*\
  !*** ./src/js/actions.js ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   apiRequest: () => (/* binding */ apiRequest),
/* harmony export */   changeSelector: () => (/* binding */ changeSelector),
/* harmony export */   fetchCaptcha: () => (/* binding */ fetchCaptcha),
/* harmony export */   fixChatPosition: () => (/* binding */ fixChatPosition),
/* harmony export */   fixColorsWidth: () => (/* binding */ fixColorsWidth),
/* harmony export */   getMyCooldown: () => (/* binding */ getMyCooldown),
/* harmony export */   initInputs: () => (/* binding */ initInputs),
/* harmony export */   initMobileMenuToggler: () => (/* binding */ initMobileMenuToggler),
/* harmony export */   initOtherCoolFeatures: () => (/* binding */ initOtherCoolFeatures),
/* harmony export */   makeScreenshot: () => (/* binding */ makeScreenshot),
/* harmony export */   placePixel: () => (/* binding */ placePixel),
/* harmony export */   placePixels: () => (/* binding */ placePixels),
/* harmony export */   removeOldKeybinds: () => (/* binding */ removeOldKeybinds),
/* harmony export */   setPaletteColorsSize: () => (/* binding */ setPaletteColorsSize),
/* harmony export */   setPaletteRows: () => (/* binding */ setPaletteRows),
/* harmony export */   showPatternsOnPalette: () => (/* binding */ showPatternsOnPalette),
/* harmony export */   showProtected: () => (/* binding */ showProtected),
/* harmony export */   solveCaptcha: () => (/* binding */ solveCaptcha),
/* harmony export */   toggleChat: () => (/* binding */ toggleChat),
/* harmony export */   toggleEmojis: () => (/* binding */ toggleEmojis),
/* harmony export */   toggleEverything: () => (/* binding */ toggleEverything),
/* harmony export */   togglePlaced: () => (/* binding */ togglePlaced),
/* harmony export */   toggleTopMenu: () => (/* binding */ toggleTopMenu),
/* harmony export */   unloadPalettePatterns: () => (/* binding */ unloadPalettePatterns),
/* harmony export */   updateBrush: () => (/* binding */ updateBrush),
/* harmony export */   updateEmojis: () => (/* binding */ updateEmojis),
/* harmony export */   updateMe: () => (/* binding */ updateMe),
/* harmony export */   updatePlaced: () => (/* binding */ updatePlaced),
/* harmony export */   updateTemplate: () => (/* binding */ updateTemplate)
/* harmony export */ });
/* harmony import */ var _me__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./me */ "./src/js/me.js");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config */ "./src/js/config.js");
/* harmony import */ var _player__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./player */ "./src/js/player.js");
/* harmony import */ var _utils_localStorage__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./utils/localStorage */ "./src/js/utils/localStorage.js");
/* harmony import */ var _utils_conversions__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./utils/conversions */ "./src/js/utils/conversions.js");
/* harmony import */ var _template__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./template */ "./src/js/template.js");
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./globals */ "./src/js/globals.js");
/* harmony import */ var _elements__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./elements */ "./src/js/elements.js");
/* harmony import */ var _windows__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./windows */ "./src/js/windows.js");
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./constants */ "./src/js/constants.js");
/* harmony import */ var _chat__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./chat */ "./src/js/chat.js");
/* harmony import */ var _Window__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./Window */ "./src/js/Window.js");
/* harmony import */ var _translate__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./translate */ "./src/js/translate.js");
/* harmony import */ var _utils_misc__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./utils/misc */ "./src/js/utils/misc.js");
/* harmony import */ var _convert_patterns__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./convert/patterns */ "./src/js/convert/patterns.js");
/* harmony import */ var _convert_patterns__WEBPACK_IMPORTED_MODULE_14___default = /*#__PURE__*/__webpack_require__.n(_convert_patterns__WEBPACK_IMPORTED_MODULE_14__);
/* harmony import */ var _utils_color__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./utils/color */ "./src/js/utils/color.js");
/* harmony import */ var _Chunk__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./Chunk */ "./src/js/Chunk.js");
/* harmony import */ var _winamp_player__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ./winamp/player */ "./src/js/winamp/player.js");
/* provided dependency */ var toastr = __webpack_require__(/*! toastr */ "./node_modules/toastr/toastr.js");
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");



















async function apiRequest(path, config = {}) {
    // handle json body of request
    if (config.body && typeof config.body === 'object') {
        if (!config.headers) config.headers = {};

        config.headers['Content-Type'] = 'application/json';
        config.body = JSON.stringify(config.body);
    }
    const response = await fetch('/api' + path, config);

    if (response.headers.get('Content-Type') && response.headers.get('Content-Type').includes('application/json')) {
        try {
            const json = await response.json()

            if (json.errors) {
                json.errors.forEach(error => {
                    toastr.error(error, undefined, {
                        preventDuplicates: true
                    });
                })
            }

            response.json = () => json;
        } catch (e) { }
    }

    return response
}

async function updateMe() {
    await _me__WEBPACK_IMPORTED_MODULE_0__["default"].load();

    _player__WEBPACK_IMPORTED_MODULE_2__["default"].updateBucket(getMyCooldown());
    if (_me__WEBPACK_IMPORTED_MODULE_0__["default"].registered) {
        _elements__WEBPACK_IMPORTED_MODULE_7__.chatInput.removeAttr('disabled');
        _elements__WEBPACK_IMPORTED_MODULE_7__.chatInput.val('');

        $('#loginButtons,.authBtn').hide();
        $('#chatNick,#chatChannels').show();
        $('#chatNick').text(_me__WEBPACK_IMPORTED_MODULE_0__["default"].name);
        $('#chatHeader').addClass('logged');
    } else {
        _elements__WEBPACK_IMPORTED_MODULE_7__.chatInput.attr('disabled');
        _elements__WEBPACK_IMPORTED_MODULE_7__.chatInput.val((0,_translate__WEBPACK_IMPORTED_MODULE_12__.translate)('login to chat'));

        // $('#chatNick').text('CHAT');
        $('#chatNick,#chatChannels').hide();
        $('#loginButtons,.authBtn').show();
        $('#chatHeader').removeClass('logged');
    }
}

function getMyCooldown() {
    const cooldowns = _config__WEBPACK_IMPORTED_MODULE_1__.cooldown;

    if (_constants__WEBPACK_IMPORTED_MODULE_9__.ROLE_I[_me__WEBPACK_IMPORTED_MODULE_0__["default"].role] == 'ADMIN') return [0, 32]
    return cooldowns[_constants__WEBPACK_IMPORTED_MODULE_9__.ROLE_I[_me__WEBPACK_IMPORTED_MODULE_0__["default"].role]] || _config__WEBPACK_IMPORTED_MODULE_1__.cooldown.GUEST;
}

function initInputs() {
    loadValues();
    initHandlers();
    initButtons();
    initChat();
}

function loadValues() {
    const urlVal = (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.getOrDefault)('template.url', 'https://i.imgur.com/4GQIMQ7.png', true);
    _elements__WEBPACK_IMPORTED_MODULE_7__.urlInput.val(urlVal);

    const xVal = (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.getOrDefault)('template.x', 0, true);
    _elements__WEBPACK_IMPORTED_MODULE_7__.xInput.val(parseInt(xVal, 10));

    const yVal = (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.getOrDefault)('template.y', 0, true);
    _elements__WEBPACK_IMPORTED_MODULE_7__.yInput.val(parseInt(yVal, 10));

    const opacVal = (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.getOrDefault)('template.opac', 0.5, true);
    _elements__WEBPACK_IMPORTED_MODULE_7__.opacInput.val(parseFloat(opacVal));
}

function saveTemplate() {
    (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.setLS)('template.x', _template__WEBPACK_IMPORTED_MODULE_5__["default"].x, true);
    (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.setLS)('template.y', _template__WEBPACK_IMPORTED_MODULE_5__["default"].y, true);
    (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.setLS)('template.url', _template__WEBPACK_IMPORTED_MODULE_5__["default"].url, true);
    (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.setLS)('template.opac', _template__WEBPACK_IMPORTED_MODULE_5__["default"].opacity, true);
}

function updateTemplate() {
    _template__WEBPACK_IMPORTED_MODULE_5__["default"].update();
    _template__WEBPACK_IMPORTED_MODULE_5__["default"].render();
    saveTemplate();
}

function initHandlers() {
    _elements__WEBPACK_IMPORTED_MODULE_7__.urlInput.on('input', updateTemplate);
    _elements__WEBPACK_IMPORTED_MODULE_7__.xInput.on('input', updateTemplate);
    _elements__WEBPACK_IMPORTED_MODULE_7__.yInput.on('input', updateTemplate);
    _elements__WEBPACK_IMPORTED_MODULE_7__.opacInput.on('input', updateTemplate);

    updateTemplate();
}

function initTemplateMoveByMouse() {
    $(document).on('mousedown', e => {
        if (!e.ctrlKey) return;

        e.stopPropagation();
        e.preventDefault();

        let lastCord = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_4__.screenToBoardSpace)(e.clientX, e.clientY).map(x => x |= 0);

        function mousemove(e) {
            e.stopPropagation();
            e.preventDefault();

            const boardPos = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_4__.screenToBoardSpace)(e.clientX, e.clientY);
            boardPos[0] |= 0;
            boardPos[1] |= 0;

            let [lastX, lastY] = boardPos;

            if (lastX === lastCord[0] && lastY === lastCord[1])
                return;

            // console.log(lastX, lastY, boardPos, lastCord)

            _elements__WEBPACK_IMPORTED_MODULE_7__.xInput.val(_template__WEBPACK_IMPORTED_MODULE_5__["default"].x -= lastCord[0] - lastX);
            _elements__WEBPACK_IMPORTED_MODULE_7__.yInput.val(_template__WEBPACK_IMPORTED_MODULE_5__["default"].y -= lastCord[1] - lastY);

            _template__WEBPACK_IMPORTED_MODULE_5__["default"].render();

            lastCord = boardPos;

            saveTemplate();
        }
        $(document).on('mousemove', mousemove);
        $(document).one('mouseup mouseleave', () => {
            $(document).off('mousemove', mousemove);
        })
    })
}

function initButtons() {
    $('#accountSettings').on('click', _windows__WEBPACK_IMPORTED_MODULE_8__.accountSettings);
    $('#toolBinds').on('click', _windows__WEBPACK_IMPORTED_MODULE_8__.keyBinds);
    $('#uiSettings').on('click', _windows__WEBPACK_IMPORTED_MODULE_8__.uiSettings);
    $('#canvasSettings').on('click', _windows__WEBPACK_IMPORTED_MODULE_8__.gameSettings);
    $('#toolsB').on('click', _windows__WEBPACK_IMPORTED_MODULE_8__.toolsWindow);
    $('.authBtn').on('click', _windows__WEBPACK_IMPORTED_MODULE_8__.authWindow);
}

function initChat() {
    $(document).on('keydown', e => {
        if (e.key !== 'Enter') return;

        if ($('#chatInput').is(':focus') || _globals__WEBPACK_IMPORTED_MODULE_6__["default"].mobile) {
            // send if focused
            const message = _elements__WEBPACK_IMPORTED_MODULE_7__.chatInput.val();
            if (!message.length)
                return _elements__WEBPACK_IMPORTED_MODULE_7__.chatInput.trigger('blur');

            _elements__WEBPACK_IMPORTED_MODULE_7__.chatInput.val('');

            _chat__WEBPACK_IMPORTED_MODULE_10__["default"].handleMessage(message);
        } else {
            // or focus if not
            $('#chatInput').trigger('focus');
        }
    });

    $('#chatChannels>div').on('click', (e) => {
        const ch = e.target.dataset.channel;
        _chat__WEBPACK_IMPORTED_MODULE_10__["default"].switchChannel(ch);
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.setLS)('chatChannel', ch);
    });

    resolveWhenConfigDownloaded().then(() => {
        _chat__WEBPACK_IMPORTED_MODULE_10__["default"].loadChannelElements();
        _chat__WEBPACK_IMPORTED_MODULE_10__["default"].switchChannel((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.getLS)('chatChannel') || 'global');
    })

    initChatHeightWorkaround();
}

async function resolveWhenConfigDownloaded(){
    if(_config__WEBPACK_IMPORTED_MODULE_1__.downloaded){
        return;
    }else{
        return new Promise(res => {
            const int = setInterval(() => {
                if(_config__WEBPACK_IMPORTED_MODULE_1__.downloaded){
                    clearInterval(int);
                    res();
                }
            }, 10);
        })
    }
}

function placePixels(pixels, store = true) {
    // does not checks pixels

    if (store) {
        pixels.forEach(([x, y]) => {
            _player__WEBPACK_IMPORTED_MODULE_2__["default"].placed.push([x, y, _globals__WEBPACK_IMPORTED_MODULE_6__["default"].chunkManager.getChunkPixel(x, y)]);
        })
    }
    _globals__WEBPACK_IMPORTED_MODULE_6__["default"].socket.sendPixels(pixels, false);
}

function placePixel(x, y, col, store = true) {
    const oldCol = _globals__WEBPACK_IMPORTED_MODULE_6__["default"].chunkManager.getChunkPixel(x, y),
        isProtected = _globals__WEBPACK_IMPORTED_MODULE_6__["default"].chunkManager.getProtect(x, y);

    if (oldCol !== col && (!isProtected || _me__WEBPACK_IMPORTED_MODULE_0__["default"].role >= _constants__WEBPACK_IMPORTED_MODULE_9__.ROLE.MOD) && _globals__WEBPACK_IMPORTED_MODULE_6__["default"].socket.connected) {
        if (store) {
            _player__WEBPACK_IMPORTED_MODULE_2__["default"].placed.push([x, y, _globals__WEBPACK_IMPORTED_MODULE_6__["default"].chunkManager.getChunkPixel(x, y)]);

            if (_player__WEBPACK_IMPORTED_MODULE_2__["default"].placed.length > _player__WEBPACK_IMPORTED_MODULE_2__["default"].maxPlaced * 2) {
                _player__WEBPACK_IMPORTED_MODULE_2__["default"].placed = _player__WEBPACK_IMPORTED_MODULE_2__["default"].placed.slice(-_player__WEBPACK_IMPORTED_MODULE_2__["default"].maxPlaced);
            }
        }

        _globals__WEBPACK_IMPORTED_MODULE_6__["default"].chunkManager.setChunkPixel(x, y, col);
        _globals__WEBPACK_IMPORTED_MODULE_6__["default"].socket.sendPixel(x, y, col);

        _globals__WEBPACK_IMPORTED_MODULE_6__["default"].socket.pendingPixels[x + ',' + y] = setTimeout(() => {
            _globals__WEBPACK_IMPORTED_MODULE_6__["default"].chunkManager.setChunkPixel(x, y, oldCol);
            _globals__WEBPACK_IMPORTED_MODULE_6__["default"].renderer.needRender = true;
        }, 3000)
    } else {
        if (isProtected && _me__WEBPACK_IMPORTED_MODULE_0__["default"].role < _constants__WEBPACK_IMPORTED_MODULE_9__.ROLE.MOD) {
            toastr.error((0,_translate__WEBPACK_IMPORTED_MODULE_12__.translate)('This pixel is protected.'), (0,_translate__WEBPACK_IMPORTED_MODULE_12__.translate)('Error!'), {
                preventDuplicates: true,
                timeOut: 750
            })
        }
    }
}

function toggleChat() {
    if (_elements__WEBPACK_IMPORTED_MODULE_7__.chat.css('display') === 'none') {
        _elements__WEBPACK_IMPORTED_MODULE_7__.chat.show();
        _elements__WEBPACK_IMPORTED_MODULE_7__.chat.css('left', '');
    } else {
        _elements__WEBPACK_IMPORTED_MODULE_7__.chat.css('left', -_elements__WEBPACK_IMPORTED_MODULE_7__.chat.width() - 30);
        setTimeout(() => _elements__WEBPACK_IMPORTED_MODULE_7__.chat.hide(), 500);
    }
}

function toggleTopMenu() {
    if (_elements__WEBPACK_IMPORTED_MODULE_7__.topMenu.css('display') === 'none') {
        _elements__WEBPACK_IMPORTED_MODULE_7__.topMenu.show();
        _elements__WEBPACK_IMPORTED_MODULE_7__.topMenu.css('margin-top', '');
    } else {
        _elements__WEBPACK_IMPORTED_MODULE_7__.topMenu.css('margin-top', -_elements__WEBPACK_IMPORTED_MODULE_7__.topMenu.height() - 30);
        setTimeout(() => _elements__WEBPACK_IMPORTED_MODULE_7__.topMenu.hide(), 500);
    }
}

function toggleEverything() {
    // $('#ui>div>div').each((_, el) => {
    //     if(el.style.getPropertyPriority('display') == 'important')
    //         return;

    //     if (el.style.display === 'none') {
    //         $(el).css('display', '')
    //     } else {
    //         $(el).css('display', 'none')
    //     }
    // })
    $('#ui').fadeToggle(100);
    fixChatPosition();
}

function showProtected(show = true) {
    _config__WEBPACK_IMPORTED_MODULE_1__.game.showProtected = show;
    _globals__WEBPACK_IMPORTED_MODULE_6__["default"].chunkManager.chunks.forEach(chunk => {
        chunk.needRender = true;
    });
    _globals__WEBPACK_IMPORTED_MODULE_6__["default"].renderer.needRender = true;
}

function initModMenu() {
    initSliding();
    initSendAlerts();

    function initSliding() {
        $('#modMenu .title').on('click', e => {
            const m = $('#modMenu');
            if (m.data('state') === 'open') {
                m.data('state', 'close');
                m.css('right', '');
            } else {
                m.data('state', 'open');
                m.css('right', $('#modMenu .body').css('width'));
            }
        })
    }

    function initSendAlerts() {
        $('#sendAlerts').on('click', () => {
            const val = $('#sendAlertsText').val();
            if (val.length == 0 || val.length > 2000) return;

            $('#sendAlertsText').val('');
            _globals__WEBPACK_IMPORTED_MODULE_6__["default"].socket.sendAlert('all', val);
        })
    }
}

async function fetchCaptcha() {
    const resp = await apiRequest('/captcha/get');
    return await resp.text()
}

async function solveCaptcha(answer) {
    const resp = await apiRequest('/captcha/solve', {
        method: 'POST',
        body: { answer }
    });

    const json = await resp.json();

    if (json.success !== undefined)
        return json.success;

    return false
}

// an old analog for setPaletteColorsSize
function setPaletteRows(rows) {
    let width = (window.innerWidth / 100) * rows;

    $('#palette').css('max-width', width);
}


function setPaletteColorsSize(size) {
    if (size === undefined) {
        size = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_13__.getRecommendedColorSize)();
    }
    $('.paletteColor').css('width', size).css('height', size);
}

// you can't just change css se..
function changeSelector(selector, obj) {
    let el;
    if (!(el = document.getElementById('REPLACE-' + selector))) {
        el = document.createElement('style');
        el.id = 'REPLACE-' + selector;
    }

    let styleArr = Object.keys(obj).map(prop => prop + ':' + obj[prop]);
    el.innerText = `${selector}{${styleArr.join(';')}}`;

    document.head.appendChild(el);
}

function initMobileMenuToggler() {
    $('.showMenu,.hideMenu').on('click', toggleTopMenu)
}

function toggleEmojis(state) {
    state ? $('#emotions').show() : $('#emotions').hide();
}

function updateEmojis(list) {
    const container = $('#emotions');
    let html = '';

    for (let el of list) {
        html += `<div class="emotion">${el}</div>`;
    }

    container.html(html);

    $('div', container).on('click', e => {
        $('#chatInput')[0].value += e.target.innerText;
        $('#chatInput').trigger('focus');
    })
}

function updateBrush(size) {
    _player__WEBPACK_IMPORTED_MODULE_2__["default"].brushSize = +size;
    _globals__WEBPACK_IMPORTED_MODULE_6__["default"].fxRenderer.needRender = true;

    _globals__WEBPACK_IMPORTED_MODULE_6__["default"].renderer.preRenderBrush();

    $('#brushSizeCounter').text(size - 1);
}

function togglePlaced(state) {
    state ? $('#placedPixels').show() : $('#placedPixels').hide();
}

function updatePlaced(count, handCount) {
    // FIXME: move it to interval?
    $('#placedPixels').text(count);
    if (handCount)
        $('#placedPixels').attr('title', handCount);
}

let lastPlaced = _player__WEBPACK_IMPORTED_MODULE_2__["default"].placedCount;
setInterval(() => {
    if (lastPlaced !== _player__WEBPACK_IMPORTED_MODULE_2__["default"].placedCount) {
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.setLS)('placedCount', _player__WEBPACK_IMPORTED_MODULE_2__["default"].placedCount, true);
        lastPlaced = _player__WEBPACK_IMPORTED_MODULE_2__["default"].placedCount;
    }
}, 3000)

function fixColorsWidth() {
    const savedWidth = (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.getLS)('colorSize', true);
    const calculated = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_13__.getRecommendedColorSize)();

    const colSize = +savedWidth || calculated
    setPaletteColorsSize(colSize);
    fixChatPosition();
}

function initUISettings() {
    fixColorsWidth();
    toggleEmojis((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.getLS)('hideEmojis') != 1);
    updateEmojis((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.getOrDefault)('emojis', '        ').split(' '));
    togglePlaced(!+(0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.getOrDefault)('hidePlaced', 1))
    updatePlaced((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.getLS)('placedCount', true));
    if ((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.getLS)('showPalettePatterns') == 1) {
        showPatternsOnPalette();
        _globals__WEBPACK_IMPORTED_MODULE_6__["default"].showPatterns = true;
    }
}

function initMobileChatToggle() {
    $('.showChat').on('click', () => {
        $('.showChat').removeClass('showChat-notify');
        _chat__WEBPACK_IMPORTED_MODULE_10__["default"].mobileShow()
    });
    $('#hideChat').on('click', () => {
        $('.showChat').removeClass('showChat-notify');
        _chat__WEBPACK_IMPORTED_MODULE_10__["default"].mobileHide()
    });
}

function initHelpButton() {
    $('.helpBtn').on('click', () => {
        (0,_windows__WEBPACK_IMPORTED_MODULE_8__.help)()
    })
}

function initOtherCoolFeatures() {
    initTemplateMoveByMouse();
    initModMenu();
    initMobileMenuToggler();
    initUISettings();
    initMobileChatToggle();
    initHelpButton();
    _player__WEBPACK_IMPORTED_MODULE_2__["default"].init();
    initCoordsClick();
    initOnlineViewer();
    initMenuResizer();
    showHelpIfFirstTime();
    startWinampRadio();
}

function initCoordsClick() {
    _globals__WEBPACK_IMPORTED_MODULE_6__["default"].elements.coords.addEventListener('click', function () {
        _globals__WEBPACK_IMPORTED_MODULE_6__["default"].elements.chatInput.value += this.innerText;
        _globals__WEBPACK_IMPORTED_MODULE_6__["default"].elements.chatInput.focus();
    })
}

function makeScreenshot() {
    const canvas = _globals__WEBPACK_IMPORTED_MODULE_6__["default"].chunkManager.dumpAll();

    const link = document.createElement('a');
    link.download = `GX ${_config__WEBPACK_IMPORTED_MODULE_1__.canvasName} ${(0,_utils_misc__WEBPACK_IMPORTED_MODULE_13__.getPathsafeDate)()}.png`;
    link.href = canvas.toDataURL()
    link.click();
}

// beta and probably temprorary
// purposely not optimised
function showPatternsOnPalette() {
    unloadPalettePatterns();

    _config__WEBPACK_IMPORTED_MODULE_1__.palette.forEach(([r, g, b], i) => {
        const pat = _convert_patterns__WEBPACK_IMPORTED_MODULE_14__.patterns[i % _convert_patterns__WEBPACK_IMPORTED_MODULE_14__.patterns.length];

        const canvas = document.createElement('canvas');
        canvas.width = canvas.height = 14;
        const ctx = canvas.getContext('2d');

        ctx.fillStyle = _config__WEBPACK_IMPORTED_MODULE_1__.hexPalette[i];

        for (let i = 0; i < 7 * 7; i++) {
            if (!pat[i]) continue;
            const x = i % 7;
            const y = i / 7 | 0;

            ctx.fillRect(x * 2, y * 2, 2, 2);
        }

        function toI(x, y) {
            return (x + y * 14) * 4;
        }

        // draw contour
        let imd = ctx.getImageData(0, 0, 14, 14).data;
        if ((0,_utils_color__WEBPACK_IMPORTED_MODULE_15__.isDarkColor)(r, g, b)) {
            ctx.fillStyle = 'white';
            let coords = [];
            for (let x = 0; x < 14; x++) {
                for (let y = 0; y < 14; y++) {
                    if (imd[toI(x, y) + 3]) continue

                    const top = imd[toI(x, y - 1) + 3];
                    const bottom = imd[toI(x, y + 1) + 3];
                    const left = imd[toI(x - 1, y) + 3];
                    const right = imd[toI(x + 1, y) + 3];

                    const leftTop = imd[toI(x - 1, y - 1) + 3];
                    const rightTop = imd[toI(x + 1, y - 1) + 3];
                    const leftBottom = imd[toI(x - 1, y + 1) + 3];
                    const rightBottom = imd[toI(x + 1, y + 1) + 3];

                    if (top || bottom || left || right ||
                        leftTop || rightTop || leftBottom || rightBottom) {
                        ctx.fillRect(x, y, 1, 1);
                    }
                }
            }
        }


        imd = ctx.getImageData(0, 0, 14, 14).data;
        ctx.fillStyle = 'black';
        for (let i = 0; i < 14 * 14; i++) {
            if (!imd[i * 4 + 3])
                ctx.fillRect(i % 14, i / 14 | 0, 1, 1)
        }


        const dataurl = canvas.toDataURL();
        const img = document.createElement('img');
        img.src = dataurl;
        img.style.cssText =
            `position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        image-rendering: pixelated;
        width: inherit`;
        $(`#col${i}`).append(img);
    })
}

function unloadPalettePatterns() {
    $('.paletteColor>img').remove();
}

function removeOldKeybinds() {
    try {
        const str = (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.getLS)('keyBinds');
        const json = JSON.parse(str);
        for (let bind of Object.values(json)) {
            let key = bind.split('+').slice(-1);
            key = +key;
            if (!isNaN(key)) {
                localStorage.removeItem('keyBinds');
                return
            }
        }
    } catch { }
}

function initOnlineViewer() {
    $('#onlineColumn .columnHeader').on('click', async () => {
        let json;
        try {
            const resp = await fetch('/api/online');
            json = await resp.json();
        } catch (e) {
            toastr.error(e);
            return
        }

        (0,_windows__WEBPACK_IMPORTED_MODULE_8__.onlineViewWindow)(json);
    });
}

function initChatHeightWorkaround() {
    // -webkit-fill-available does not work since
    // the best way to define height that i know 
    // for the moment is through the script

    function fixChatHeight() {
        document.documentElement.style.setProperty('--gorox-chat-height', $(window).height() + 'px');
    }

    $(window).on('resize', fixChatHeight);
    fixChatHeight();
}

function fixChatPosition() {
    const paletteHeight = $('#palette').innerHeight();
    $('#chat').css('bottom', paletteHeight + 4);
}

function initMenuResizer() {
    const resizer = $('#menuResizer');
    const resizerStripes = $('#resizingStripes');

    let curHeight = +(0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.getLS)('columnHeight');
    if (isNaN(curHeight) || curHeight == 0) {
        curHeight = 123;
    } else if (curHeight < 0) {
        curHeight = 0;
    } else if (curHeight >= (window.screen.height - 250)) {
        curHeight = window.screen.height - 250;
    }
    $('.columnContent').css('height', curHeight);

    let resizeTimeout;
    let resizeLock = false;

    function unfade() {
        resizer.css('height', '7px');
        resizer.css('background-color', '#4c4c4c');
        resizerStripes.css('opacity', '1');
    }

    function fade() {
        clearTimeout(resizeTimeout);
        resizer.css('height', '');
        resizer.css('background-color', '');
        resizerStripes.css('opacity', '');
    }

    resizer.on('mouseover', () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
            unfade();
        }, 500)
    })

    resizer.on('mouseout', () => {
        if (resizeLock) return;

        fade();
    })

    function onmousedown() {
        resizeLock = true;
        unfade();

        function onmousemove(e) {
            curHeight += e.originalEvent.movementY;
            $('.columnContent').css('height', curHeight);
            (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.setLS)('columnHeight', curHeight);
        }
        function oncemouseup() {
            $(document).off('mousemove', onmousemove);
            resizeLock = false;
            fade();
        }

        $(document).on('mousemove', onmousemove)
        $(document).one('mouseup', oncemouseup)
    }
    resizer.on('mousedown', onmousedown);
}

function showHelpIfFirstTime() {
    const shownAlready = (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.getLS)('helpShown');
    if (!shownAlready) {
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.setLS)('helpShown', '1');
        (0,_windows__WEBPACK_IMPORTED_MODULE_8__.help)();
    }
}

function startWinampRadio(){
    const player = new _winamp_player__WEBPACK_IMPORTED_MODULE_17__["default"]();
    player.init();

    window.wPlayer = player;
}

/***/ }),

/***/ "./src/js/assets.js":
/*!**************************!*\
  !*** ./src/js/assets.js ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _css_colorVars_css__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../css/colorVars.css */ "./src/css/colorVars.css");
/* harmony import */ var _css_style_css__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../css/style.css */ "./src/css/style.css");
/* harmony import */ var _node_modules_toastr_build_toastr_css__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../node_modules/toastr/build/toastr.css */ "./node_modules/toastr/build/toastr.css");
/* harmony import */ var _img_vk_logo_svg__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../img/vk-logo.svg */ "./src/img/vk-logo.svg");
/* harmony import */ var _img_discord_logo_circle_svg__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../img/discord-logo-circle.svg */ "./src/img/discord-logo-circle.svg");
/* harmony import */ var _img_fb_logo_svg__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../img/fb-logo.svg */ "./src/img/fb-logo.svg");
/* harmony import */ var _img_stripes_png__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../img/stripes.png */ "./src/img/stripes.png");
/* harmony import */ var _img_dots_svg__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../img/dots.svg */ "./src/img/dots.svg");
/* harmony import */ var _img_goroxels_png__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../img/goroxels.png */ "./src/img/goroxels.png");
/* harmony import */ var _img_telegram_svg__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../img/telegram.svg */ "./src/img/telegram.svg");
/* harmony import */ var _video_clickerMouse_webm__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../video/clickerMouse.webm */ "./src/video/clickerMouse.webm");
/* harmony import */ var _video_clicker_webm__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../video/clicker.webm */ "./src/video/clicker.webm");
/* harmony import */ var _video_as_webm__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../video/as.webm */ "./src/video/as.webm");
/* harmony import */ var _video_toolC_webm__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../video/toolC.webm */ "./src/video/toolC.webm");
/* harmony import */ var _video_brush_webm__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../video/brush.webm */ "./src/video/brush.webm");
/* harmony import */ var _video_brush2_webm__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../video/brush2.webm */ "./src/video/brush2.webm");
/* harmony import */ var _video_line_webm__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../video/line.webm */ "./src/video/line.webm");
/* harmony import */ var _video_flood_webm__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../video/flood.webm */ "./src/video/flood.webm");
/* harmony import */ var _img_unavailable_png__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../img/unavailable.png */ "./src/img/unavailable.png");
/* harmony import */ var _video_ctrlZ_webm__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../video/ctrlZ.webm */ "./src/video/ctrlZ.webm");
/* harmony import */ var _video_patternDemo_webm__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ../video/patternDemo.webm */ "./src/video/patternDemo.webm");
/* harmony import */ var _img_3rdcf_png__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ../img/3rdcf.png */ "./src/img/3rdcf.png");


























/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({});

/***/ }),

/***/ "./src/js/camera.js":
/*!**************************!*\
  !*** ./src/js/camera.js ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./globals */ "./src/js/globals.js");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config */ "./src/js/config.js");
/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! events */ "./node_modules/events/events.js");
/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(events__WEBPACK_IMPORTED_MODULE_2__);
/* harmony import */ var _utils_localStorage__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./utils/localStorage */ "./src/js/utils/localStorage.js");





const camera = {
    x: null, y: null,
    zoom: null,
    minX: null, minY: null, 
    maxX: null, maxY: null,

    minZoom: 0.1,
    maxZoom: 64,

    // when it's needed to disable moving
    noMoving: false,

    init(){
        Object.assign(this, {
            x: +(0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.getOrDefault)('posX', 0, true),
            y: +(0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.getOrDefault)('posY', 0, true),

            zoom: +(0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.getOrDefault)('zoom', 1, true),

            minX: -_config__WEBPACK_IMPORTED_MODULE_1__.boardWidth/2,
            minY: -_config__WEBPACK_IMPORTED_MODULE_1__.boardHeight/2,
            maxX: _config__WEBPACK_IMPORTED_MODULE_1__.boardWidth/2,
            maxY: _config__WEBPACK_IMPORTED_MODULE_1__.boardHeight/2,
        })
        if(isNaN(this.x) || isNaN(this.y) || isNaN(this.zoom)){
            this.x = 0;
            this.y = 0;
            this.zoom = 1;
        }
    },

    centerOn(x, y){
        _globals__WEBPACK_IMPORTED_MODULE_0__["default"].renderer.needRender = true;
        if(this.noMoving) return;
        
        this.x = x - this.maxX;
        this.y = y - this.maxY;

        this.clampPos();
    },

    moveTo(movx, movy){
        _globals__WEBPACK_IMPORTED_MODULE_0__["default"].renderer.needRender = true;
        if(this.noMoving) return;

        this.x += movx;
        this.y += movy;

        this.clampPos();
    },

    clampPos(){
        this.x = Math.min(Math.max(this.x, this.minX), this.maxX);
        this.y = Math.min(Math.max(this.y, this.minY), this.maxY);
    },

    zoomTo(dir){
        if(dir < 0){
            this.zoom = this.zoom * 2 | 0 || 1;
        }else{
            this.zoom = this.zoom / 2;
        }
        this.checkZoom();

        this.emit('zoom', this.zoom);

        _globals__WEBPACK_IMPORTED_MODULE_0__["default"].renderer.needRender = true;
        _globals__WEBPACK_IMPORTED_MODULE_0__["default"].fxRenderer.needRender = true;

        _globals__WEBPACK_IMPORTED_MODULE_0__["default"].renderer.preRender();
    },

    checkZoom(){
        this.zoom = Math.min(Math.max(this.zoom, this.minZoom), this.maxZoom)
    }, 

    disableMove(){
        this.noMoving = true;
    },

    enableMove(){
        this.noMoving = false;
    },

    __proto__: new (events__WEBPACK_IMPORTED_MODULE_2___default())
}

let lastX, lastY, lastZ;
setInterval(() => {
    const newX = camera.x,
        newY = camera.y,
        newZ = camera.zoom;

    if(lastX != newX) (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.setLS)('posX', newX, true);
    if(lastY != newY) (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.setLS)('posY', newY, true);
    if(lastZ != newZ) (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_3__.setLS)('zoom', newZ, true);

    lastX = newX; lastY = newY; lastZ = newZ;
}, 3000);

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (window.camera = camera);

/***/ }),

/***/ "./src/js/chat.js":
/*!************************!*\
  !*** ./src/js/chat.js ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./config */ "./src/js/config.js");
/* harmony import */ var _elements__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./elements */ "./src/js/elements.js");
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./globals */ "./src/js/globals.js");
/* harmony import */ var _translate__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./translate */ "./src/js/translate.js");
/* harmony import */ var _utils_cssColorsList__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./utils/cssColorsList */ "./src/js/utils/cssColorsList.js");
/* harmony import */ var _utils_localStorage__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./utils/localStorage */ "./src/js/utils/localStorage.js");
/* harmony import */ var _utils_misc__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./utils/misc */ "./src/js/utils/misc.js");
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");








// currently chat supports only one channel
// but socket is designed to handle many

function pad(pad, str, padLeft) {
    if (typeof str === 'undefined')
        return pad;
    if (padLeft) {
        return (pad + str).slice(-pad.length);
    } else {
        return (str + pad).substring(0, pad.length);
    }
}

const colorRegEx = new RegExp(/\[(#?[A-Z0-9]{1,8})*?\]/gi);
                          // https : / / host.com/img .png       ? q=321123
const imgRegEx = new RegExp(/http?s:\/\/.+?\.(png|jpg|jpeg|gif)(\?\S+)?/i);

class Chat {
    constructor() {
        this.element = $('#chat');

        this.logElems = {};

        this.colorsEnabled = !JSON.parse((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_5__.getOrDefault)('disableColors', false));

        this.muted = JSON.parse((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_5__.getLS)('muted')) || [];

        this.channel = undefined;

        this.initChatEvents();
    }

    loadChannelElements(){
        [...$('#chatLog').children()].map(el => {
            let channel = el.dataset.channel;
            if(channel === 'local'){
                channel = _config__WEBPACK_IMPORTED_MODULE_0__.canvasName;
            }
            this.logElems[channel] = $(el);
        })
    }

    // mobile version of hide/show
    mobileShow() {
        this.element.css('top', '0');
    }

    mobileHide() {
        this.element.css('top', '-100vh');
    }

    setColors(state) {
        this.colorsEnabled = state;

        $('.chatColored').toggleClass('noColor', !state);
    }

    parseColors(str) {
        // colors should be formatted like: [RED]test or [#FF0000]te[]st

        let colorEntries = 0;

        let regIter = str.matchAll(colorRegEx);
        while (true) {
            let {
                value: entry,
                done
            } = regIter.next();
            if (done) break;

            let color = entry[1];

            if (color) {
                // test for "#" and mathing A-F a-f hex alphabet
                if (color.startsWith('#') && !/[G-Zg-z]/.test(color)) {
                    color = pad(color.slice(-1).repeat(6 + 1), color);
                } else if (!_utils_cssColorsList__WEBPACK_IMPORTED_MODULE_4__["default"][color]) continue;

                str = str.replace(entry[0],
                    `<div class="chatColored${this.colorsEnabled ? '' : ' noColor'}" style="color:${color}">`);
                colorEntries++;
            } else { // empty braces
                if (colorEntries > 0) {
                    str = str.replace(entry[0], '</div>');
                    colorEntries--;
                } else {
                    // "[" and "]"
                    str = str.replace(entry[0], '&#91;&#93;');
                }
            }
        }

        if (colorEntries > 0) str += '</div>'.repeat(colorEntries);

        return str
    }
    parseCoords(str) {
        return str.replace(/\((\d{1,5}), ?(\d{1,5})\)/g,
            `<a class="cordgo" onclick="camera.centerOn($1, $2)">$&</a>`)
    }
    parseImage(str) {
        let matching = str.match(imgRegEx);

        if (matching) {
            let src = matching[0];
            str = str.replace(src,
                `<span class="imageLink" onclick="globals.chat.toggleImage(this)">${src}</span>`) 
        }

        return str
    }
    toggleImage(target){
        const element = $(target);
        const parent = element.parent();

        const exists = !!$('img', parent).length;
        if(exists){
            $('.imageLink', parent).css('cursor', 'zoom-in')
            $('img', parent).remove();
        }else{
            $('.imageLink', parent).css('cursor', 'zoom-out');
            const img = $(`<img src="${element.text()}" class="chatImg" onclick="globals.chat.toggleImage(this)">`);
            img.on('load', this.scroll.bind(this, this.channel));
            parent.append(img);
        }
    }

    parseBB(str){
        // function does not checks for brackets order validity
        let openedTags = [];

        let regIter = str.matchAll(/\[(\/?[bi])\]/gi);
        while (true) {
            let {
                value: entry,
                done
            } = regIter.next();
            if (done) break;

            let tag = entry[1];
            str = str.replace(entry[0],
                `<${tag}>`);
            if(!tag.startsWith('/'))
                openedTags.push(tag);
            else{
                openedTags = openedTags.splice(openedTags.indexOf(tag.slice(1)));
            }
        }

        while(openedTags.length){
            str += `</${openedTags.shift()}>`
        }

        return str
    }

    addMessage(message) {
        $('.showChat').addClass('showChat-notify');

        const channel = message.ch;

        if (message.server)
            return this.addServerMessage(message.msg, channel);

        let text = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_6__.htmlspecialchars)(message.msg),
            nick = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_6__.htmlspecialchars)(message.nick);

        const realNick = nick;

        if (nick === 'Goroh') {
            nick = `<span style="text-shadow:0 0 3px">[#00f986]${nick}</span>`
        }

        try{
            text = this.parseColors(text);
            text = this.parseBB(text);
            text = this.parseCoords(text);
            text = this.parseImage(text);
    
            nick = this.parseColors(nick);
        }catch(e){
            console.log(e);
        }

        const isMuted = ~this.muted.indexOf(realNick);

        const msgEl = $(
            `<div class="chatMessage" ${isMuted ? 'style="display:none"' : ''}>
            <div class="messageNick" data-nick="${realNick}">${nick}:</div>
            <div class="messageText">${text}</div>
        </div>`);

        $('.messageNick', msgEl).on('click', function () {
            const visibleNick = this.innerText.slice(0, -1);
            _globals__WEBPACK_IMPORTED_MODULE_2__["default"].elements.chatInput.value += visibleNick + ', ';
            _globals__WEBPACK_IMPORTED_MODULE_2__["default"].elements.chatInput.focus();
        })

        this.logElems[channel].append(msgEl);

        this.afterAddingMessage(channel);
    }

    addLocalMessage(text, channel) {
        text = this.parseColors(text);
        text = this.parseBB(text);
        text = this.parseCoords(text);
        text = this.parseImage(text);

        const msgEl = $(
            `<div class="chatMessage">
                <div class="messageText">${text}</div>
            </div>`)

        this.logElems[channel].append(msgEl);

        this.afterAddingMessage(channel);
    }

    switchChannel(channel){
        if(this.channel === channel){
            return;
        }

        const channelAlias = channel;
        if(channel === 'local'){
            channel = _config__WEBPACK_IMPORTED_MODULE_0__.canvasName;
        }

        for(let ch of Object.values(this.logElems)){
            ch.hide();
        }
        this.logElems[channel].show();

        $(`#chatChannels>div`).removeClass('selected');
        $(`#chatChannels>div[data-channel="${channelAlias}"]`).addClass('selected');

        this.scroll(channel, true);

        this.channel = channel;
    }

    addServerMessage(text, channel) {
        this.addLocalMessage(text, channel);
    }

    afterAddingMessage(channel) {
        const el = this.logElems[channel];
        if (el.children().length > _config__WEBPACK_IMPORTED_MODULE_0__.game.chatLimit) {
            el.children()[0].remove();
        }
        this.scroll(channel);
    }

    // handles messages to send
    handleMessage(message) {
        if (message.startsWith('/')) {
            this.handleCommand(message);
        } else
        _globals__WEBPACK_IMPORTED_MODULE_2__["default"].socket.sendChatMessage(message, this.channel);
    }

    sendWhisper(target, message){
        _globals__WEBPACK_IMPORTED_MODULE_2__["default"].socket.sendChatWhisper(message, this.channel, target);
    }

    // handles chat commands
    handleCommand(command) {
        let args = command.split(' ');

        const cmd = args[0];
        args = args.slice(1);

        console.log(args);

        switch(cmd){
            case '/mute': {
                const nick = args.join(' ');
                this.mute(nick);

                break
            }
            case '/unmute': {
                const nick = args.join(' ');
                this.unmute(nick);

                break
            }
            case '/w': {
                if(args.length < 2){
                    return this.addLocalMessage('Usage: /w &lt;targetAccountId&gt; &lt;message&gt;');
                }
                const id = args[0];
                const msg = args.slice(1).join(' ');

                this.sendWhisper(id, msg);
                _elements__WEBPACK_IMPORTED_MODULE_1__.chatInput.val(`/w ${id} `);

                break
            }
        }
    }

    mute(nick) {
        const pref = '<b>mute:</b> ';

        if (!nick.length || nick.length > 32) {
            return this.addLocalMessage(pref + (0,_translate__WEBPACK_IMPORTED_MODULE_3__.translate)('Wrong nick length'))
        }
        if (~this.muted.indexOf(nick)) {
            return this.addLocalMessage(pref + (0,_translate__WEBPACK_IMPORTED_MODULE_3__.translate)('Player is already muted'))
        }

        this.muted.push(nick);
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_5__.setLS)('muted', JSON.stringify(this.muted));

        $('.messageNick').each((_, el) => {
            if (el.dataset.nick === nick) {
                el.parentElement.style.display = 'none';
            }
        })
    }

    unmute(nick) {
        let pref = '<b>unmute:</b> ', index;

        if (!nick.length || nick.length > 32) {
            return this.addLocalMessage(pref + (0,_translate__WEBPACK_IMPORTED_MODULE_3__.translate)('Wrong nick length'))
        }
        if (!~(index = this.muted.indexOf(nick))) {
            return this.addLocalMessage(pref + (0,_translate__WEBPACK_IMPORTED_MODULE_3__.translate)('Player is not muted'))
        }

        this.muted.splice(index, 1);
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_5__.setLS)('muted', JSON.stringify(this.muted));

        $('.messageNick').each((_, el) => {
            if (el.dataset.nick === nick) {
                el.parentElement.style.display = 'block';
            }
        })
    }

    initChatEvents() {
        _elements__WEBPACK_IMPORTED_MODULE_1__.chatInput.on('input', () => {
            const value = _elements__WEBPACK_IMPORTED_MODULE_1__.chatInput.val();
            if (imgRegEx.test(value)) {
                _elements__WEBPACK_IMPORTED_MODULE_1__.chatInput.css('color', 'white');
            } else {
                _elements__WEBPACK_IMPORTED_MODULE_1__.chatInput.css('color', '');
            }
        })
    }

    // this function scrolls only if player scrolled chat log to the end
    scroll(channel='global', force=false){
        const el$ = this.logElems[channel];
        const el = el$.parent()[0];
        const lastElemHeight = el$.children().slice(-1).innerHeight() || 0;
        // 2 is message margin and 5 is just for fun
        const scrolled = (el.scrollHeight - el.scrollTop - el.clientHeight - lastElemHeight) <= 2+5;
        if(scrolled || force){
            el.scrollBy(0, 999);
        }
    }
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (_globals__WEBPACK_IMPORTED_MODULE_2__["default"].chat = new Chat());

/***/ }),

/***/ "./src/js/constants.js":
/*!*****************************!*\
  !*** ./src/js/constants.js ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ROLE: () => (/* binding */ ROLE),
/* harmony export */   ROLE_I: () => (/* binding */ ROLE_I),
/* harmony export */   keys: () => (/* binding */ keys)
/* harmony export */ });
// key codes to human readable string
// !deprecated!
const keys = { // others are ok with charCodeAt
    8: "Backspace",
    9: "Tab",
    12: "Clear",
    13: "Enter",
    16: "Shift",
    17: "Control",
    18: "Alt",
    19: "Pause",
    20: "CapsLock",
    27: "Escape",
    32: "Space",
    33: "PageUp",
    34: "PageDown",
    35: "End",
    36: "Home",
    37: "ArrowLeft",
    38: "ArrowUp",
    39: "ArrowRight",
    40: "ArrowDown",
    45: "Insert",
    46: "Delete",
    112: "F1",
    113: "F2",
    114: "F3",
    115: "F4",
    116: "F5",
    117: "F6",
    118: "F7",
    119: "F8",
    120: "F9",
    121: "F10",
    122: "F11",
    123: "F12",
    144: "NumLock",
    145: "ScrollLock",
    48: "0",
    49: "1",
    50: "2",
    51: "3",
    52: "4",
    53: "5",
    54: "6",
    55: "7",
    56: "8",
    57: "9",
    106: "*",
    107: "+",
    109: "-",
    111: "/",
    186: ";",
    187: "=",
    188: ",",
    189: "-",
    190: ".",
    191: "/",
    192: "`",
    219: "[",
    220: "\\",
    221: "]",
    222: "'"
}

const ROLE = {
    BANNED: -1,
    GUEST: 0,
    USER: 1,
    TRUSTED: 2,
    MOD: 3,
    ADMIN: 4
}
const ROLE_I = {};
Object.keys(ROLE).forEach(x => ROLE_I[ROLE[x]] = x);

/***/ }),

/***/ "./src/js/elements.js":
/*!****************************!*\
  !*** ./src/js/elements.js ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   chat: () => (/* binding */ chat),
/* harmony export */   chatInput: () => (/* binding */ chatInput),
/* harmony export */   opacInput: () => (/* binding */ opacInput),
/* harmony export */   template: () => (/* binding */ template),
/* harmony export */   topMenu: () => (/* binding */ topMenu),
/* harmony export */   ui: () => (/* binding */ ui),
/* harmony export */   urlInput: () => (/* binding */ urlInput),
/* harmony export */   xInput: () => (/* binding */ xInput),
/* harmony export */   yInput: () => (/* binding */ yInput)
/* harmony export */ });
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");
const urlInput = $('#templateURL'),
    xInput = $('#templateX'),
    yInput = $('#templateY'),
    opacInput = $('#templateOpacity'),

    ui = $('#ui'),
    chat = $('#chat'),
    chatInput = $('#chatInput'),
    template = $('#template'),
    topMenu = $('#topMenu');

/***/ }),

/***/ "./src/js/fxcanvas.js":
/*!****************************!*\
  !*** ./src/js/fxcanvas.js ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   FX: () => (/* binding */ FX),
/* harmony export */   FXRenderer: () => (/* binding */ FXRenderer)
/* harmony export */ });
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./globals */ "./src/js/globals.js");


const NOT_FINISHED = 0,
    FINISHED = 1,
    DELETED = 2;

class FX {
    constructor(renderFunc) {
        this.renderFunc = renderFunc;

        this.removed = false;
    }

    render(ctx) {
        return this.renderFunc(ctx);
    }

    remove() {
        this.removed = true;
    }
}

class FXRenderer {
    constructor() {
        // three layers
        this.fxList = [[], [], []];
        this.ctx = _globals__WEBPACK_IMPORTED_MODULE_0__["default"].fxCtx;

        this.needRender = true;
        this.needClear = false;
    }

    add(fx, layer = 0) {
        this.fxList[layer].push(fx);

        this.needRender = true;
    }

    /*
      You can request it by returning zero in rendering
      functions or explicitly 
    */
    requestRender() {
        this.needRender = true;
    }

    render() {
        if (!this.needRender) return;

        this.ctx.clearRect(0, 0, window.innerWidth, window.innerHeight);

        this.needRender = false;

        for (let layer = 0; layer < this.fxList.length; layer++) {
            this.fxList[layer].forEach(fx => {
                if (fx.removed) return this.remove(fx);

                let r = fx.render(this.ctx);

                /*
                    0 - not finished yet
                    1 - finished but continue rendering
                    2 - finished
                */

                if (r == 2) {
                    this.remove(fx);
                } else if (r == 0) {
                    this.needRender = true;
                }
            })
        }
    }

    remove(fx) {
        for (let layer = 0; layer < this.fxList.length; layer++) {
            let idx = this.fxList[layer].indexOf(fx);
            if (idx != -1) {
                this.fxList[layer][idx].remove();
                this.fxList[layer].splice(idx, 1);
                this.needRender = true;
                break
            }
        }

    }
}

/***/ }),

/***/ "./src/js/globals.js":
/*!***************************!*\
  !*** ./src/js/globals.js ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! events */ "./node_modules/events/events.js");
/* harmony import */ var events__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(events__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _EventManager__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./EventManager */ "./src/js/EventManager.js");
/* harmony import */ var _utils_misc__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./utils/misc */ "./src/js/utils/misc.js");
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");





/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({
    socket: null,
    chunkManager: null,
    renderer: null,
    fxRenderer: null,
    player: null,
    toolManager: null,
    events: new (events__WEBPACK_IMPORTED_MODULE_0___default()),
    eventManager: new _EventManager__WEBPACK_IMPORTED_MODULE_1__["default"](document.getElementById('board')),
    mainCtx: document.getElementById('board').getContext('2d'),
    fxCtx: document.getElementById('fx').getContext('2d'),
    mobile: (0,_utils_misc__WEBPACK_IMPORTED_MODULE_2__.insanelyLongMobileBrowserCheck)(),
    users: {},
    elements: { // TODO move it to elements.js
        mainCanvas: $('#board')[0],
        fxCanvas: $('#fx')[0],
        palette: $('#palette')[0],
        online: $('#onlineCounter')[0],
        coords: $('#coords')[0],
        topMenu: $('#topMenu')[0],
        topMenuContent: $('#topMenu>.content')[0],
        chatInput: $('#chatInput')[0]
    }
});

/***/ }),

/***/ "./src/js/indexedDb.js":
/*!*****************************!*\
  !*** ./src/js/indexedDb.js ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   addInitCallback: () => (/* binding */ addInitCallback),
/* harmony export */   database: () => (/* binding */ database),
/* harmony export */   init: () => (/* binding */ init),
/* harmony export */   initiated: () => (/* binding */ initiated)
/* harmony export */ });
let initiated = false;
let database = null;

let deferredCallbacks = [];

function init() {
    let openRequest = indexedDB.open("db", 1);

    function onDone(){
        initiated = true;
        execCallbacks();
    }

    openRequest.onupgradeneeded = function () {
        database = openRequest.result;
        if (!database.objectStoreNames.contains('chunkPlaceholders')) {
            database.createObjectStore('chunkPlaceholders', { keyPath: 'chunk_key' });
        }

        onDone();
    };

    openRequest.onsuccess = () => {
        database = openRequest.result;
        onDone();
    };
}

function execCallbacks(){
    deferredCallbacks.forEach(cb => {
        try {
            cb(database);   
        } catch (error) {
            console.error(error);
        }
    })
    deferredCallbacks.length = 0;
}

function addInitCallback(cb) {
    if (initiated) {
        cb(database);
        return;
    }

    deferredCallbacks.push(cb);
}

/***/ }),

/***/ "./src/js/main.js":
/*!************************!*\
  !*** ./src/js/main.js ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony import */ var _assets__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./assets */ "./src/js/assets.js");
/* harmony import */ var _Socket__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./Socket */ "./src/js/Socket.js");
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./globals */ "./src/js/globals.js");
/* harmony import */ var _ChunkManager__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./ChunkManager */ "./src/js/ChunkManager.js");
/* harmony import */ var _Renderer__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./Renderer */ "./src/js/Renderer.js");
/* harmony import */ var _fxcanvas__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./fxcanvas */ "./src/js/fxcanvas.js");
/* harmony import */ var _player__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./player */ "./src/js/player.js");
/* harmony import */ var _ToolManager__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./ToolManager */ "./src/js/ToolManager.js");
/* harmony import */ var _utils_misc__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./utils/misc */ "./src/js/utils/misc.js");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./config */ "./src/js/config.js");
/* harmony import */ var _actions__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./actions */ "./src/js/actions.js");
/* harmony import */ var _translate__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./translate */ "./src/js/translate.js");
/* harmony import */ var _camera__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./camera */ "./src/js/camera.js");
/* harmony import */ var _Window__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./Window */ "./src/js/Window.js");
/* harmony import */ var _utils_localStorage__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./utils/localStorage */ "./src/js/utils/localStorage.js");
/* harmony import */ var _indexedDb__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ./indexedDb */ "./src/js/indexedDb.js");
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");



















(async () => {    
    _indexedDb__WEBPACK_IMPORTED_MODULE_15__.init();
    await _config__WEBPACK_IMPORTED_MODULE_9__.download();

    const {
        elements,
    } = _globals__WEBPACK_IMPORTED_MODULE_2__["default"];

    window.onresize = () => {
        elements.mainCanvas.width = window.innerWidth;
        elements.mainCanvas.height = window.innerHeight;

        elements.fxCanvas.width = window.innerWidth;
        elements.fxCanvas.height = window.innerHeight;

        const fxCtx = elements.fxCanvas.getContext('2d');

        ctx.imageSmoothingEnabled = fxCtx.imageSmoothingEnabled = false;
        ctx.webkitImageSmoothingEnabled = fxCtx.webkitImageSmoothingEnabled = false;
        ctx.mozImageSmoothingEnabled = fxCtx.mozImageSmoothingEnabled = false;
        ctx.msImageSmoothingEnabled = fxCtx.msImageSmoothingEnabled = false;
        ctx.oImageSmoothingEnabled = fxCtx.oImageSmoothingEnabled = false;

        renderer.needRender = true;
        fxRenderer.needRender = true;

        if (!_globals__WEBPACK_IMPORTED_MODULE_2__["default"].mobile) {
            (0,_utils_misc__WEBPACK_IMPORTED_MODULE_8__.calculateColumnSize)();
        }

        (0,_actions__WEBPACK_IMPORTED_MODULE_10__.fixColorsWidth)();
        (0,_actions__WEBPACK_IMPORTED_MODULE_10__.fixChatPosition)();
    }


    window.oncontextmenu = function (e) {
        if (e.target === _globals__WEBPACK_IMPORTED_MODULE_2__["default"].elements.mainCanvas ||
            e.target.classList[0] === 'paletteColor' ||
            e.path[1].classList[0] === 'paletteColor') {
            e.preventDefault();
        }
    }

    _camera__WEBPACK_IMPORTED_MODULE_12__["default"].init();
    (0,_utils_misc__WEBPACK_IMPORTED_MODULE_8__.initHalfmap)();

    _config__WEBPACK_IMPORTED_MODULE_9__.palette.forEach((color, id) => {
        const el = document.createElement('div');
        el.style.backgroundColor = `rgb(${color.join(',')})`;
        // el.classList = ['paletteColor ' + (isDarkColor(...color) ? 'dark' : 'light')];
        el.classList = ['paletteColor light'];
        el.id = 'col' + id;

        // detect long press
        let downtime = 0;

        var $el = $(el);

        $el.on('pointerdown', () => {
            downtime = Date.now();
        })

        $el.on('pointerleave', () => {
            downtime = 0;
        })

        el.onclick = e => {
            let isLong = false;
            if (downtime != 0) {
                if (Date.now() - downtime > 700) {
                    isLong = true;
                }
                downtime = 0;
            }

            let f = isLong ? _player__WEBPACK_IMPORTED_MODULE_6__["default"].switchSecondColor : _player__WEBPACK_IMPORTED_MODULE_6__["default"].switchColor;
            f.call(_player__WEBPACK_IMPORTED_MODULE_6__["default"], id);
        }

        el.oncontextmenu = () => {
            // right button click
            _player__WEBPACK_IMPORTED_MODULE_6__["default"].switchSecondColor(id);
        }

        elements.palette.appendChild(el);
    })

    const ctx = elements.mainCanvas.getContext('2d');
    ctx.imageSmoothingEnabled = false;

    const wsPort = location.protocol === 'https:' ? 443 : (location.port || 80);
    const socket = new _Socket__WEBPACK_IMPORTED_MODULE_1__["default"](wsPort);
    _globals__WEBPACK_IMPORTED_MODULE_2__["default"].socket = socket;

    const chunkManager = new _ChunkManager__WEBPACK_IMPORTED_MODULE_3__["default"]();
    _globals__WEBPACK_IMPORTED_MODULE_2__["default"].chunkManager = chunkManager;

    const renderer = window.renderer = new _Renderer__WEBPACK_IMPORTED_MODULE_4__["default"](ctx);
    _globals__WEBPACK_IMPORTED_MODULE_2__["default"].renderer = renderer;

    const fxRenderer = new _fxcanvas__WEBPACK_IMPORTED_MODULE_5__.FXRenderer();
    _globals__WEBPACK_IMPORTED_MODULE_2__["default"].fxRenderer = fxRenderer;

    _globals__WEBPACK_IMPORTED_MODULE_2__["default"].toolManager = new _ToolManager__WEBPACK_IMPORTED_MODULE_7__["default"](document.getElementById('board'));

    _globals__WEBPACK_IMPORTED_MODULE_2__["default"].player = _player__WEBPACK_IMPORTED_MODULE_6__["default"];

    const renderLoop = () => {
        requestAnimationFrame(() => {
            renderer.requestRender();
            renderLoop();
        })
    }
    renderLoop();

    window.onresize();

    socket.on('opened', () => { });
    socket.on('online', count => {
        $('.online').text(count);
    });
    socket.on('closed', () => {
        $('.online').text('offline');
    })

    window.globals = _globals__WEBPACK_IMPORTED_MODULE_2__["default"];

    // create nsfw modal
    _config__WEBPACK_IMPORTED_MODULE_9__.callOnLoad(() => {
        if (_config__WEBPACK_IMPORTED_MODULE_9__.canvasName !== 'nsfw') return;
        if ((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_14__.getLS)('modal18') == 'accepted') return;

        const m = new _Window__WEBPACK_IMPORTED_MODULE_13__.Modal;
        const mBody = $(
            `<div style="margin:0;padding:5px;text-align:center;">
                <h1>${(0,_translate__WEBPACK_IMPORTED_MODULE_11__.translate)('WARNING')}</h1>
                <p>${(0,_translate__WEBPACK_IMPORTED_MODULE_11__.translate)('This canvas may contain illustrations, inappropriate for people under age of 18, including:')}
                <br>${(0,_translate__WEBPACK_IMPORTED_MODULE_11__.translate)('Gore, furry, porn, hate, anime and all possible variations of these.')}</p>
                <p><b>${(0,_translate__WEBPACK_IMPORTED_MODULE_11__.translate)('Are you 18 y.o. and fully understanding what are you doing?')}</b></p>
                <button style="padding: 8px;">${(0,_translate__WEBPACK_IMPORTED_MODULE_11__.translate)('I am 18 years old and I take responsibility for my psyche on myself')}</button>
            </div>`)
        m.contEl.appendChild(mBody[0]);

        $('button', mBody).on('click', () => {
            m.close();
            (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_14__.setLS)('modal18', 'accepted');
        })
    });

    (0,_actions__WEBPACK_IMPORTED_MODULE_10__.updateMe)();
    (0,_translate__WEBPACK_IMPORTED_MODULE_11__.init)();
    (0,_actions__WEBPACK_IMPORTED_MODULE_10__.initInputs)();
    (0,_actions__WEBPACK_IMPORTED_MODULE_10__.initOtherCoolFeatures)();
})();

/***/ }),

/***/ "./src/js/me.js":
/*!**********************!*\
  !*** ./src/js/me.js ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _actions__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./actions */ "./src/js/actions.js");
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./constants */ "./src/js/constants.js");
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");



let loaded = false;
let cbs = [];

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({
    registered: false,
    name: null,
    id: null,
    role: _constants__WEBPACK_IMPORTED_MODULE_1__.ROLE.GUEST,
    update(newMe){
        this.registered = newMe.registered;
        if(newMe.registered){
            this.name = newMe.name;
            this.role = newMe.role;
            this.id = newMe.id;
        }

        this.updateRoleRelatedHtml();
    },

    updateRoleRelatedHtml(){
        $('.minrole-admin').hide();
        $('.minrole-mod').hide();
        $('.minrole-trusted').hide();
        $('.minrole-user').hide();

        switch(this.role){
            case _constants__WEBPACK_IMPORTED_MODULE_1__.ROLE.ADMIN:
                $('.minrole-admin').show();
            case _constants__WEBPACK_IMPORTED_MODULE_1__.ROLE.MOD:
                $('.minrole-mod').show();
            case _constants__WEBPACK_IMPORTED_MODULE_1__.ROLE.TRUSTED:
                $('.minrole-trusted').show();
            case _constants__WEBPACK_IMPORTED_MODULE_1__.ROLE.USER:
                $('.minrole-user').show();
        }
    },

    checkCanGetUserInfo(){
        return this.registered && this.role >= _constants__WEBPACK_IMPORTED_MODULE_1__.ROLE.TRUSTED
    },

    async load(){
        const response = await (0,_actions__WEBPACK_IMPORTED_MODULE_0__.apiRequest)('/me');
        const user = await response.json();

        this.update(user);

        loaded = true;
        this.callStacked();
    },

    callOnLoaded(cb){
        if(this.loaded)
            return cb();
        cbs.push(cb);
    },
    callStacked(){
        cbs.forEach(cb => cb());
        cbs = [];
    }
});

/***/ }),

/***/ "./src/js/player.js":
/*!**************************!*\
  !*** ./src/js/player.js ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _Bucket__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Bucket */ "./src/js/Bucket.js");
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./globals */ "./src/js/globals.js");
/* harmony import */ var _utils_localStorage__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./utils/localStorage */ "./src/js/utils/localStorage.js");
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");




/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({
    x: 0,
    y: 0,
    color: -1,
    brushSize: 1,
    secondCol: -1,
    id: -1,
    init(){
        this.loadColors();
        this.switchColor(this.color, true);
        this.switchSecondColor(this.secondCol, true);
    },
    loadColors(){
        this.color = +(0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_2__.getOrDefault)('color1', -1, true);
        this.secondCol = +(0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_2__.getOrDefault)('color2', -1, true);
    },
    switchColor(id, initial=false){
        if(this.color === id && !initial)
            id = this.color = -1;
        else
            this.color = id;
        _globals__WEBPACK_IMPORTED_MODULE_1__["default"].fxRenderer.needRender = true;
        _globals__WEBPACK_IMPORTED_MODULE_1__["default"].renderer.preRender();

        $('.paletteColor.selected').removeClass('selected');
        if(id !== -1){
            $('#col' + id).addClass('selected');
        }

        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_2__.setLS)('color1', id, true);
    },
    switchSecondColor(id, initial){
        if(this.secondCol === id && !initial)
            id = this.secondCol = -1;
        else
            this.secondCol = id;
        _globals__WEBPACK_IMPORTED_MODULE_1__["default"].fxRenderer.needRender = true;
        _globals__WEBPACK_IMPORTED_MODULE_1__["default"].renderer.preRender();

        $('.paletteColor.selectedSecond').removeClass('selectedSecond');
        if(id !== -1){
            $('#col' + id).addClass('selectedSecond');
        }

        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_2__.setLS)('color2', id, true);
    },
    swapColors(){
        const temp = this.color;
        this.switchColor(this.secondCol);
        this.switchSecondColor(temp);
    },
    resetColors(){
        this.switchColor(-1);
        this.switchSecondColor(-1);
    },
    bucket: null,
    updateBucket([delay, max]) {
        this.bucket = new _Bucket__WEBPACK_IMPORTED_MODULE_0__["default"](delay, max);
    },
    placed: [],
    maxPlaced: isNaN(+localStorage['maxPlaced']) ? 5000 : +localStorage['maxPlaced'],
    placedCount: +(0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_2__.getLS)('placedCount', true) || 0
});

/***/ }),

/***/ "./src/js/protocol.js":
/*!****************************!*\
  !*** ./src/js/protocol.js ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   OPCODES: () => (/* binding */ OPCODES),
/* harmony export */   STRING_OPCODES: () => (/* binding */ STRING_OPCODES),
/* harmony export */   packPixel: () => (/* binding */ packPixel),
/* harmony export */   unpackPixel: () => (/* binding */ unpackPixel)
/* harmony export */ });
// change utils/recorder if changes

const OPCODES = {
    chunk:       0x0,
    place:       0x1,
    online:      0x2,
    canvas:      0x3,
    pixels:      0x4,
    captcha:     0x5,
    ping:        0x6,
    placeBatch:  0x7,
    updateRadio: 0x8
}

const STRING_OPCODES = {
    error: 'e',
    userJoin: 'u',
    userLeave: 'l',
    subscribeChat: 's',
    chatMessage: 'c',
    alert: 'a',
    me: 'm',
    reload: 'r',
    reloadChunks: 'rc'
}

// max coords is up to 4096
function packPixel(x, y, col) {
    return (x << 12 | y) << 7 | col
}

function unpackPixel(num) {
    return [
        num >>> 19,
        num >>> 7 & 0xFFF,
        num & 0b1111111
    ]
}

/***/ }),

/***/ "./src/js/template.js":
/*!****************************!*\
  !*** ./src/js/template.js ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _camera__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./camera */ "./src/js/camera.js");
/* harmony import */ var _utils_misc__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./utils/misc */ "./src/js/utils/misc.js");
/* harmony import */ var _elements__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./elements */ "./src/js/elements.js");



let winWid = window.innerWidth / 2,
    winHei = window.innerHeight / 2;

window.addEventListener('resize', () => {
    winWid = window.innerWidth / 2;
    winHei = window.innerHeight / 2;
})

;

const widthRegEx = /width=(\d+)$/;

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({
    element: document.getElementById('template'),

    x: 0,
    y: 0,

    render() {
        let camX = _camera__WEBPACK_IMPORTED_MODULE_0__["default"].x + _utils_misc__WEBPACK_IMPORTED_MODULE_1__.halfMap[0] - this.x - (winWid / _camera__WEBPACK_IMPORTED_MODULE_0__["default"].zoom);
        let camY = _camera__WEBPACK_IMPORTED_MODULE_0__["default"].y + _utils_misc__WEBPACK_IMPORTED_MODULE_1__.halfMap[1] - this.y - (winHei / _camera__WEBPACK_IMPORTED_MODULE_0__["default"].zoom);
        
        camX = Math.floor(-camX * _camera__WEBPACK_IMPORTED_MODULE_0__["default"].zoom);
        camY = Math.floor(-camY * _camera__WEBPACK_IMPORTED_MODULE_0__["default"].zoom);

        this.element.style.left = camX + 'px';
        this.element.style.top = camY + 'px';
        this.element.style.transform = 'scale(' + _camera__WEBPACK_IMPORTED_MODULE_0__["default"].zoom + ',' + _camera__WEBPACK_IMPORTED_MODULE_0__["default"].zoom + ')';
    },

    update(){
        this.x = parseInt(_elements__WEBPACK_IMPORTED_MODULE_2__.xInput.val(), 10);
        this.y = parseInt(_elements__WEBPACK_IMPORTED_MODULE_2__.yInput.val(), 10);

        this.element.style.opacity = _elements__WEBPACK_IMPORTED_MODULE_2__.opacInput.val();

        const url = _elements__WEBPACK_IMPORTED_MODULE_2__.urlInput.val();
        let match;
        if(match = url.match(widthRegEx)){
            this.element.style.width = match[1] + 'px';
        }else{
            this.element.style.width = 'unset';
        }

        this.element.src = url;
    },

    get url(){
        return _elements__WEBPACK_IMPORTED_MODULE_2__.urlInput.val()
    },

    get opacity(){
        return +_elements__WEBPACK_IMPORTED_MODULE_2__.opacInput.val()
    },
    set opacity(val){
        _elements__WEBPACK_IMPORTED_MODULE_2__.opacInput.val(val);
    }
});

/***/ }),

/***/ "./src/js/tools.js":
/*!*************************!*\
  !*** ./src/js/tools.js ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   PixelFont: () => (/* binding */ PixelFont),
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _Tool__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./Tool */ "./src/js/Tool.js");
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./globals */ "./src/js/globals.js");
/* harmony import */ var _utils_shapes__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./utils/shapes */ "./src/js/utils/shapes.js");
/* harmony import */ var _utils_camera__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./utils/camera */ "./src/js/utils/camera.js");
/* harmony import */ var _utils_conversions__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./utils/conversions */ "./src/js/utils/conversions.js");
/* harmony import */ var _player__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./player */ "./src/js/player.js");
/* harmony import */ var _fxcanvas__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./fxcanvas */ "./src/js/fxcanvas.js");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./config */ "./src/js/config.js");
/* harmony import */ var _camera__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./camera */ "./src/js/camera.js");
/* harmony import */ var _elements__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./elements */ "./src/js/elements.js");
/* harmony import */ var _actions__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./actions */ "./src/js/actions.js");
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./constants */ "./src/js/constants.js");
/* harmony import */ var _img_toolIcons_clicker_png__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../img/toolIcons/clicker.png */ "./src/img/toolIcons/clicker.png");
/* harmony import */ var _img_toolIcons_move_png__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../img/toolIcons/move.png */ "./src/img/toolIcons/move.png");
/* harmony import */ var _img_toolIcons_floodfill_png__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../img/toolIcons/floodfill.png */ "./src/img/toolIcons/floodfill.png");
/* harmony import */ var _img_toolIcons_line_png__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../img/toolIcons/line.png */ "./src/img/toolIcons/line.png");
/* harmony import */ var _img_toolIcons_protect_png__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../img/toolIcons/protect.png */ "./src/img/toolIcons/protect.png");
/* harmony import */ var _img_toolIcons_revert_png__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../img/toolIcons/revert.png */ "./src/img/toolIcons/revert.png");
/* harmony import */ var _template__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ./template */ "./src/js/template.js");
/* harmony import */ var _me__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ./me */ "./src/js/me.js");
/* harmony import */ var _utils_color__WEBPACK_IMPORTED_MODULE_20__ = __webpack_require__(/*! ./utils/color */ "./src/js/utils/color.js");
/* harmony import */ var _utils_localStorage__WEBPACK_IMPORTED_MODULE_21__ = __webpack_require__(/*! ./utils/localStorage */ "./src/js/utils/localStorage.js");
/* harmony import */ var _utils_misc__WEBPACK_IMPORTED_MODULE_22__ = __webpack_require__(/*! ./utils/misc */ "./src/js/utils/misc.js");
/* harmony import */ var _Bucket__WEBPACK_IMPORTED_MODULE_23__ = __webpack_require__(/*! ./Bucket */ "./src/js/Bucket.js");
/* harmony import */ var _utils_math__WEBPACK_IMPORTED_MODULE_24__ = __webpack_require__(/*! ./utils/math */ "./src/js/utils/math.js");
/* harmony import */ var _font_pixel_min5_png__WEBPACK_IMPORTED_MODULE_25__ = __webpack_require__(/*! ../font/pixel/min5.png */ "./src/font/pixel/min5.png");
/* harmony import */ var _font_pixel_min5_txt__WEBPACK_IMPORTED_MODULE_26__ = __webpack_require__(/*! ../font/pixel/min5.txt */ "./src/font/pixel/min5.txt");
/* harmony import */ var _MiniWindow__WEBPACK_IMPORTED_MODULE_27__ = __webpack_require__(/*! ./MiniWindow */ "./src/js/MiniWindow.js");
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");


















// import pipetteIcon from '../img/toolIcons/pipette.png'
















const mobile = _globals__WEBPACK_IMPORTED_MODULE_1__["default"].mobile;

function getPixel(x, y) {
    return _globals__WEBPACK_IMPORTED_MODULE_1__["default"].chunkManager.getChunkPixel(x, y)
}

function getProtect(x, y) {
    return _globals__WEBPACK_IMPORTED_MODULE_1__["default"].chunkManager.getProtect(x, y)
}

function isOdd(x, y) {
    return ((x + y) % 2) === 0
}

function getCurCol() {
    if (_player__WEBPACK_IMPORTED_MODULE_5__["default"].secondCol === -1) {
        return ~_player__WEBPACK_IMPORTED_MODULE_5__["default"].color ? _player__WEBPACK_IMPORTED_MODULE_5__["default"].color : -1;
    }
    if (_player__WEBPACK_IMPORTED_MODULE_5__["default"].color === -1) return _player__WEBPACK_IMPORTED_MODULE_5__["default"].secondCol;

    return isOdd(_player__WEBPACK_IMPORTED_MODULE_5__["default"].x, _player__WEBPACK_IMPORTED_MODULE_5__["default"].y) ? _player__WEBPACK_IMPORTED_MODULE_5__["default"].color : _player__WEBPACK_IMPORTED_MODULE_5__["default"].secondCol
}

function getColByCord(x, y, first = _player__WEBPACK_IMPORTED_MODULE_5__["default"].color, second = _player__WEBPACK_IMPORTED_MODULE_5__["default"].secondCol) {
    if (second === -1) return first;
    if (first === -1) return second;

    return isOdd(x, y) ? first : second
}

function checkBounds(x, y) {
    return (x >= 0 && x < _config__WEBPACK_IMPORTED_MODULE_7__.boardWidth && y >= 0 && y < _config__WEBPACK_IMPORTED_MODULE_7__.boardHeight)
}

let tmLoaded = false;
let onTMID = setInterval(() => {
    if (_globals__WEBPACK_IMPORTED_MODULE_1__["default"].toolManager) {
        clearInterval(onTMID);
        _onTmLoaded();
    }
}, 5);
let tmCallbacks = [];
function _onTmLoaded() {
    tmLoaded = true;
    tmCallbacks.forEach(cb => cb(_globals__WEBPACK_IMPORTED_MODULE_1__["default"].toolManager));
    tmCallbacks = [];
}
function onToolManager(cb) {
    if (tmLoaded) cb(_globals__WEBPACK_IMPORTED_MODULE_1__["default"].toolManager);
    else tmCallbacks.push(cb)
}

// fxRenderer is loaded later then tools
// so here is workaround
let _deferredFX = [];
function addFX(fx, layer) {
    if (_globals__WEBPACK_IMPORTED_MODULE_1__["default"].fxRenderer) {
        _globals__WEBPACK_IMPORTED_MODULE_1__["default"].fxRenderer.add(fx, layer);
    } else _deferredFX.push([fx, layer]);
}

function removeFX(fx) {
    _globals__WEBPACK_IMPORTED_MODULE_1__["default"].fxRenderer.remove(fx);
}

let fxi = setInterval(() => {
    if (_globals__WEBPACK_IMPORTED_MODULE_1__["default"].fxRenderer) {
        clearInterval(fxi);
        for (let [fx, layer] of _deferredFX) {
            addFX(fx, layer);
        }
        _deferredFX = [];
    }
}, 5);

function renderFX() {
    _globals__WEBPACK_IMPORTED_MODULE_1__["default"].fxRenderer.needRender = true;
}

function protectPixels(pixels) {
    _globals__WEBPACK_IMPORTED_MODULE_1__["default"].socket.sendPixels(pixels, true);
}

class Clicker extends _Tool__WEBPACK_IMPORTED_MODULE_0__["default"] {
    constructor(...args) {
        super(...args);

        this._pendingPixels = {};
        this.minZoom = 2;

        this.on('down', this.down)
        this.on('up', this.up)
        this.on('move', this.move)
        this.on('leave', this.up)
        this.on('_gesture', this.ongesture);

        onToolManager(() => {
            // mobile is already subscribed to pointer events
            // so this will duplicate them
            if (!mobile) {
                _globals__WEBPACK_IMPORTED_MODULE_1__["default"].eventManager.on('mousedown', this.mousedown.bind(this));
                _globals__WEBPACK_IMPORTED_MODULE_1__["default"].eventManager.on('mouseup', this.mouseup.bind(this));
            }
        })

        this.clrInterval = setInterval(() => {
            if (this.clearPending())
                renderFX();
        }, 250);

        // pending pixels debug visualizer
        this.fx = new _fxcanvas__WEBPACK_IMPORTED_MODULE_6__.FX(this.render.bind(this));
        //addFX(this.fx);
    }

    // mouse zone
    mousedown(e) {
        if (e.button !== 0) return;
        this.screenPos = [e.clientX, e.clientY];
    }
    mouseup(e) {
        if (e.button !== 0 || !this.screenPos) return;
        const dx = Math.abs(e.clientX - this.screenPos[0]);
        const dy = Math.abs(e.clientY - this.screenPos[1]);
        if (dx > 5 || dy > 5) return;

        const [x, y] = [_player__WEBPACK_IMPORTED_MODULE_5__["default"].x, _player__WEBPACK_IMPORTED_MODULE_5__["default"].y];
        const color = getColByCord(x, y);
        if (this.checkPixel(x, y) && ~color)
            (0,_actions__WEBPACK_IMPORTED_MODULE_10__.placePixel)(_player__WEBPACK_IMPORTED_MODULE_5__["default"].x, _player__WEBPACK_IMPORTED_MODULE_5__["default"].y, getColByCord(x, y));
    }
    // end of mouse zone

    down(e) {
        this.lastPos = [_player__WEBPACK_IMPORTED_MODULE_5__["default"].x, _player__WEBPACK_IMPORTED_MODULE_5__["default"].y];
        this.screenPos = [e.clientX, e.clientY];

        if (this.mouseIsDown || _camera__WEBPACK_IMPORTED_MODULE_8__["default"].zoom < this.minZoom) return;

        this.mouseIsDown = true;

        if (!mobile)
            this.emit('move', {});
        else {
            this.pointerId = e.pointerId;
        }
    }
    up(e) {
        if (this.mouseIsDown) {
            if (mobile)
                this.emit('move', e, true);
            this.mouseIsDown = false;
        }
    }

    ongesture() {
        this.mouseIsDown = false;
        this.lastPos = null;
    }

    checkPixel(x, y) {
        const key = `${x},${y}`;
        const myColor = getColByCord(x, y);

        const pixel = getPixel(x, y),
            isProtected = getProtect(x, y);
        if (pixel === myColor || pixel === -1 || (isProtected && _me__WEBPACK_IMPORTED_MODULE_19__["default"].role < _constants__WEBPACK_IMPORTED_MODULE_11__.ROLE.MOD)) return;

        if (this._pendingPixels[key] && this._pendingPixels[key][0] === myColor) return;
        this._pendingPixels[key] = [myColor, Date.now()];

        return true
    }

    /*
    */
    move(e, isUp = false) {
        if (e.gesture) {
            // if gesture is started, we reset mousedown state
            this.ongesture();
            return
        }
        if (!this.mouseIsDown ||
            e.gesture ||
            getCurCol() === -1) return;

        // mobile and same pointerid as at down but also not initiated by 'up' event
        if (mobile && this.pointerId !== e.pointerId)
            return

        const screenX = e.clientX,
            screenY = e.clientY;

        const dx = Math.abs(screenX - this.screenPos[0]);
        const dy = Math.abs(screenY - this.screenPos[1]);

        if (dx < 5 && dy < 5 && !isUp) {
            return;
        }

        let [x, y] = [_player__WEBPACK_IMPORTED_MODULE_5__["default"].x, _player__WEBPACK_IMPORTED_MODULE_5__["default"].y];

        let line = _utils_shapes__WEBPACK_IMPORTED_MODULE_2__["default"].line(this.lastPos[0], this.lastPos[1], x, y);
        this.lastPos = [x, y];

        let circle = [[0, 0]];
        if (_player__WEBPACK_IMPORTED_MODULE_5__["default"].brushSize !== 1) {
            circle = _globals__WEBPACK_IMPORTED_MODULE_1__["default"].renderer.preRendered.brush.circle;
        }

        for (let [x, y] of line) {
            let pixels = [];

            if (!this.checkAllowance(circle.length)) return;
            circle.forEach(([cx, cy]) => {
                let _x = x + cx;
                let _y = y + cy;
                if (this.checkPixel(_x, _y)) {
                    const myColor = getColByCord(_x, _y); // duplicate
                    pixels.push([_x, _y, myColor]);
                }
            })

            this.place(pixels);
        }
    }

    checkAllowance(count) {
        if (_player__WEBPACK_IMPORTED_MODULE_5__["default"].bucket.allowance < count) {
            return false
        }
        return true
    }

    place(pixels) {
        if (pixels.length === 0) return;

        _player__WEBPACK_IMPORTED_MODULE_5__["default"].bucket.spend(pixels.length)

        if (pixels.length == 1) {
            (0,_actions__WEBPACK_IMPORTED_MODULE_10__.placePixel)(...pixels[0])
        } else
            (0,_actions__WEBPACK_IMPORTED_MODULE_10__.placePixels)(pixels);
    }

    render(ctx) {
        const zoom = _camera__WEBPACK_IMPORTED_MODULE_8__["default"].zoom;
        ctx.lineWidth = zoom / 5;
        ctx.globalAlpha = .5;

        for (let key of Object.keys(this._pendingPixels)) {
            let [x, y] = key.split(',').map(x => parseInt(x, 10));

            const color = this._pendingPixels[key][0];
            ctx.strokeStyle = '#000000';
            ctx.fillStyle = _config__WEBPACK_IMPORTED_MODULE_7__.hexPalette[color];

            const [scrX, scrY] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_4__.boardToScreenSpace)(x, y);


            ctx.strokeRect(scrX, scrY, zoom, zoom);
        }

        ctx.globalAlpha = 1;

        return 1
    }

    clearPending() {
        let deletedSome = false;
        Object.keys(this._pendingPixels).forEach(key => {
            let timestamp = this._pendingPixels[key][1];

            if (Date.now() - timestamp > 500) {
                delete this._pendingPixels[key];
                deletedSome = true;
            }
        })

        return deletedSome;
    }
}
const clicker = new Clicker('clicker', 'Space', _img_toolIcons_clicker_png__WEBPACK_IMPORTED_MODULE_12__["default"]);

class Protector extends Clicker {
    constructor(...args) {
        super(...args);

        this.minZoom = 1;

        // is this unprotector
        this._alt = false;
        // first touch determines whether protect or not (for full down-move-up):
        // protected => unprotect; unprotected => protect,
        // i.e. inverts pixel state
        this._mobileIsProtect = null;
    }

    getProtectState() {
        if (mobile)
            return this._mobileIsProtect;
        else
            return this._alt ? false : true;

    }

    // override Clicker's mouse events
    mousedown() { }
    mouseup() { }

    down(e) {
        if (this.mouseIsDown) return;

        super.down(e);

        (0,_actions__WEBPACK_IMPORTED_MODULE_10__.showProtected)(); // force protect visibility
        this._mobileIsProtect = !getProtect(...this.lastPos);
    }

    checkPixel(x, y) {
        const key = `${x},${y}`;
        const state = this.getProtectState();

        const curState = getProtect(x, y);
        if (curState === state) return;

        if (this._pendingPixels[key] && this._pendingPixels[key][0] === state) return;
        this._pendingPixels[key] = [state, Date.now()];

        return true
    }

    checkAllowance() { return true }

    place(pixels) {
        // now we should replace colors from
        // clicker's move func with protect state
        const state = this.getProtectState();
        pixels.forEach(p => p[2] = state);
        if (!pixels.length) return;

        protectPixels(pixels);
    }

    render() { }
}
const protector = new Protector('protector', 'KeyV', _img_toolIcons_protect_png__WEBPACK_IMPORTED_MODULE_16__["default"], _constants__WEBPACK_IMPORTED_MODULE_11__.ROLE.MOD);

const altProtector = new Protector('alt protector', 'ALT+KeyV', null, _constants__WEBPACK_IMPORTED_MODULE_11__.ROLE.MOD);
altProtector._alt = true;

class Mover extends _Tool__WEBPACK_IMPORTED_MODULE_0__["default"] {
    constructor(...args) {
        super(...args);

        this.handlers();

        this.downPos = [0, 0];
        this.lastPos = [0, 0];

        this.lastPlayerPos = [0, 0];

        if (!mobile) {
            this.fx = new _fxcanvas__WEBPACK_IMPORTED_MODULE_6__.FX(this.renderCursor);

            addFX(this.fx);
        }
    }

    handlers() {
        // 
        onToolManager(() => {
            this.on('down', this.down);
            this.on('up', this.up);
            // bind to toolManager for handling not only on canvas
            _globals__WEBPACK_IMPORTED_MODULE_1__["default"].toolManager.on('move', this.move.bind(this));
            this.on('leave', this.up);
        })
    }

    renderCursor(ctx) {
        const zoom = _camera__WEBPACK_IMPORTED_MODULE_8__["default"].zoom;

        const color = getCurCol();

        if (~color && zoom > 1) {
            if (_player__WEBPACK_IMPORTED_MODULE_5__["default"].brushSize == 1) {
                let [x, y] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_4__.boardToScreenSpace)(_player__WEBPACK_IMPORTED_MODULE_5__["default"].x, _player__WEBPACK_IMPORTED_MODULE_5__["default"].y);
                ctx.strokeStyle = _config__WEBPACK_IMPORTED_MODULE_7__.hexPalette[color];
                //ctx.fillStyle = hexPalette[player.color];
                ctx.lineWidth = zoom / 5;

                let w, h;
                let halfLineWid = ctx.lineWidth / 2;

                x += halfLineWid;
                y += halfLineWid;

                w = zoom - ctx.lineWidth;
                h = w;

                //ctx.fillRect(x, y, zoom, zoom);
                ctx.strokeRect(x, y, w + 1, h + 1);

                //renderFX();
            } else {
                const [x, y] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_4__.boardToScreenSpace)(_player__WEBPACK_IMPORTED_MODULE_5__["default"].x - _player__WEBPACK_IMPORTED_MODULE_5__["default"].brushSize / 2, _player__WEBPACK_IMPORTED_MODULE_5__["default"].y - _player__WEBPACK_IMPORTED_MODULE_5__["default"].brushSize / 2);
                ctx.drawImage(_globals__WEBPACK_IMPORTED_MODULE_1__["default"].renderer.preRendered.brush.canvas, x, y)
            }
        }

        return 1
    }

    down(e) {
        if (e.ctrlKey) return;

        this.mousedown = true;

        // little workaround to keep any ui text
        // unselected while canvas moves
        // guess it's uneffictive
        (0,_actions__WEBPACK_IMPORTED_MODULE_10__.changeSelector)('#ui>div>*', { 'pointer-events': 'none' })

        if (!mobile) {
            this.downPos = this.lastPos = [e.clientX, e.clientY]
        }
    }
    up(e) {
        if (e.ctrlKey) return;

        this.mousedown = false;
        (0,_actions__WEBPACK_IMPORTED_MODULE_10__.changeSelector)('#ui>div>*', { 'pointer-events': 'all' })

        if (!mobile && this.moveThresold() && e.type !== 'mouseleave') {
            // right/middle/anything
            if (e instanceof MouseEvent && e.button != 0) return;
        }
    }

    move(e) {
        // for template mover
        if (e.ctrlKey) return;

        // idk what was purpose of this
        // but i actually need to render fx on mobiles
        // if (!mobile) {
        if (this.lastPlayerPos[0] != _player__WEBPACK_IMPORTED_MODULE_5__["default"].x ||
            this.lastPlayerPos[1] != _player__WEBPACK_IMPORTED_MODULE_5__["default"].y ||
            this.mousedown) {
            renderFX();
        }

        this.lastPlayerPos = [_player__WEBPACK_IMPORTED_MODULE_5__["default"].x, _player__WEBPACK_IMPORTED_MODULE_5__["default"].y];
        // }

        if (!this.mousedown) return;

        if (!mobile) {
            this.lastPos = [e.clientX, e.clientY]

            if (this.moveThresold())
                return
        }

        // now works without pixel ratio, i'll keep it here if not
        _camera__WEBPACK_IMPORTED_MODULE_8__["default"].moveTo(-e.movementX / _camera__WEBPACK_IMPORTED_MODULE_8__["default"].zoom /* / devicePixelRatio */, -e.movementY / _camera__WEBPACK_IMPORTED_MODULE_8__["default"].zoom /* / devicePixelRatio */);
    }

    moveThresold() {
        return (Math.abs(this.downPos[0] - this.lastPos[0]) < 5 &&
            Math.abs(this.downPos[1] - this.lastPos[1]) < 5)
    }
}
const mover = new Mover('mover', null, _img_toolIcons_move_png__WEBPACK_IMPORTED_MODULE_13__["default"]);

class FloodFill extends _Tool__WEBPACK_IMPORTED_MODULE_0__["default"] {
    constructor(...args) {
        super(...args);

        this.on('up', this.up);
        this.on('down', this.down);
        this.on('leave', this.up);

        this.on('tick', this.tick);

        this.previewing = false;
        this.fx = null;
        this.prevStack = [];
    }

    up(e, isCancel) {
        if (this.active) { // stop and return
            this.active = false;
            return
        }

        if (this.previewing) {
            this.fx.remove();
            renderFX();
            this.previewing = false;
        } else return; // means that key wasn't pressed


        if (isCancel)
            return;

        const cord = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_4__.screenToBoardSpace)(e.clientX, e.clientY);
        if (getColByCord(...cord) === -1 || !(0,_utils_camera__WEBPACK_IMPORTED_MODULE_3__.inBounds)(...cord) || e.type === 'mouseleave') {
            return
        }

        this.active = true;

        this.stack = [
            [_player__WEBPACK_IMPORTED_MODULE_5__["default"].x, _player__WEBPACK_IMPORTED_MODULE_5__["default"].y]
        ];

        this.playerCol = _player__WEBPACK_IMPORTED_MODULE_5__["default"].color;
        this.secondPlayerCol = _player__WEBPACK_IMPORTED_MODULE_5__["default"].secondCol;
        this.fillingCol = getPixel(_player__WEBPACK_IMPORTED_MODULE_5__["default"].x, _player__WEBPACK_IMPORTED_MODULE_5__["default"].y);
    }

    down(e) {
        // preview floodfill
        if (e.repeat || this.previewing || this.active) {
            return
        }

        const cord = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_4__.screenToBoardSpace)(e.clientX, e.clientY);
        if (getColByCord(...cord) === -1 || !(0,_utils_camera__WEBPACK_IMPORTED_MODULE_3__.inBounds)(...cord)) {
            return
        }
        let _lastX, _lastY;

        restart.apply(this);

        this.showedPixels = [];
        this.fillingCol = getPixel(_player__WEBPACK_IMPORTED_MODULE_5__["default"].x, _player__WEBPACK_IMPORTED_MODULE_5__["default"].y);

        let fx = new _fxcanvas__WEBPACK_IMPORTED_MODULE_6__.FX(tick.bind(this));
        addFX(fx, 0);

        this.fx = fx;

        //globals.renderer.needRender = true;

        this.previewing = true;

        function restart() {
            this.prevStack = [
                [_player__WEBPACK_IMPORTED_MODULE_5__["default"].x, _player__WEBPACK_IMPORTED_MODULE_5__["default"].y]
            ];
            this.showedPixels = [];

            _lastX = _player__WEBPACK_IMPORTED_MODULE_5__["default"].x;
            _lastY = _player__WEBPACK_IMPORTED_MODULE_5__["default"].y;

            this.playerCol = _player__WEBPACK_IMPORTED_MODULE_5__["default"].color;
            this.secondPlayerCol = _player__WEBPACK_IMPORTED_MODULE_5__["default"].secondCol;
            this.fillingCol = getPixel(_player__WEBPACK_IMPORTED_MODULE_5__["default"].x, _player__WEBPACK_IMPORTED_MODULE_5__["default"].y);
        }

        function paint() {
            if (!this.prevStack.length) return 1;

            let [x, y] = this.prevStack.pop();

            let color = getColByCord(x, y, this.playerCol, this.secondPlayerCol);
            let tileCol = getPixel(x, y);
            let painted = this.showedPixels.indexOf(x + ',' + y) !== -1;

            if (painted || tileCol === color || tileCol !== this.fillingCol || !(0,_utils_camera__WEBPACK_IMPORTED_MODULE_3__.inBounds)(x, y)) {
                return 0
            }

            this.showedPixels.push(x + ',' + y);

            let top = this.checkP(x, y - 1);
            let bottom = this.checkP(x, y + 1);
            let left = this.checkP(x - 1, y);
            let right = this.checkP(x + 1, y);
            if (top && left) {
                this.checkP(x - 1, y - 1);
            }
            if (top && right) {
                this.checkP(x + 1, y - 1);
            }
            if (bottom && left) {
                this.checkP(x - 1, y + 1);
            }
            if (bottom && right) {
                this.checkP(x + 1, y + 1);
            }

            return 0
        }

        function tick(ctx) {
            if (_globals__WEBPACK_IMPORTED_MODULE_1__["default"].mobile && _globals__WEBPACK_IMPORTED_MODULE_1__["default"].toolManager.tool !== this) {
                this.up({}, true);
                return 1;
            }
            if (_player__WEBPACK_IMPORTED_MODULE_5__["default"].x != _lastX || _player__WEBPACK_IMPORTED_MODULE_5__["default"].y != _lastY) {
                restart.call(this);
            }
            if (getCurCol() === -1) return 1;

            let res = 0;
            for (let i = 0; i < 700 && res == 0; i++)
                res = paint.call(this);


            ctx.strokeWidth = _camera__WEBPACK_IMPORTED_MODULE_8__["default"].zoom;
            ctx.clearRect(0, 0, window.innerWidth, window.innerHeight)

            this.showedPixels.forEach((p, i) => {
                let [x, y] = p.split(',').map(x => parseInt(x, 10));

                let alpha = 1;
                let len = this.showedPixels.length
                if (len >= 100 && i < len / 2) {
                    alpha = 1 - (((len / 2) - i) / (len / 2))
                    if (alpha <= 0) return;
                }
                ctx.globalAlpha = alpha;

                const color = getColByCord(x, y, this.playerCol, this.secondPlayerCol);
                ctx.strokeStyle = _config__WEBPACK_IMPORTED_MODULE_7__.hexPalette[color];

                let [absX, absY] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_4__.boardToScreenSpace)(x, y);
                ctx.strokeRect(absX, absY, _camera__WEBPACK_IMPORTED_MODULE_8__["default"].zoom, _camera__WEBPACK_IMPORTED_MODULE_8__["default"].zoom);
            });

            return res
        }
    }

    checkP(x, y) {
        if (getPixel(x, y) !== this.fillingCol) return false;
        this.prevStack.unshift([x, y]);
        return true
    }

    tick() {
        if (!this.active) return;

        for (let i = 0; i < 15 && this.stack.length; i++) {
            let nextX = this.stack[this.stack.length - 1][0];

            if (!_player__WEBPACK_IMPORTED_MODULE_5__["default"].bucket.spend(1)) break;

            let [x, y] = this.stack.pop();

            let color = getColByCord(x, y, this.playerCol, this.secondPlayerCol);
            let tileCol = getPixel(x, y);

            if (tileCol === color || tileCol !== this.fillingCol || !(0,_utils_camera__WEBPACK_IMPORTED_MODULE_3__.inBounds)(x, y)) {
                continue
            }

            //this.stack.push([x, y]);

            let top = this.check(x, y - 1);
            let bottom = this.check(x, y + 1);
            let left = this.check(x - 1, y);
            let right = this.check(x + 1, y);
            if (top && left) {
                this.check(x - 1, y - 1);
            }
            if (top && right) {
                this.check(x + 1, y - 1);
            }
            if (bottom && left) {
                this.check(x - 1, y + 1);
            }
            if (bottom && right) {
                this.check(x + 1, y + 1);
            }

            (0,_actions__WEBPACK_IMPORTED_MODULE_10__.placePixel)(x, y, color);
        }

        if (!this.stack.length) return this.active = false;
    }

    check(x, y) {
        if (getPixel(x, y) !== this.fillingCol) return false;
        this.stack.unshift([x, y]);
        return true
    }
}
const floodfill = new FloodFill('floodfill', 'KeyF', _img_toolIcons_floodfill_png__WEBPACK_IMPORTED_MODULE_14__["default"]);

class Pipette extends _Tool__WEBPACK_IMPORTED_MODULE_0__["default"] {
    constructor(...args) {
        super(...args);

        if (mobile) {
            return
            this.on('down', this.mobileDown.bind(this));
            this.on('up', this.mobileUp.bind(this));
        } else
            this.on('down', this.down);
    }

    down(e) {
        const color = getPixel(_player__WEBPACK_IMPORTED_MODULE_5__["default"].x, _player__WEBPACK_IMPORTED_MODULE_5__["default"].y);

        if (color === -1) return;

        if (e.__alt)
            _player__WEBPACK_IMPORTED_MODULE_5__["default"].switchSecondColor(color);
        else
            _player__WEBPACK_IMPORTED_MODULE_5__["default"].switchColor(color);

        renderFX();
    }

    // separate handlers for handling both
    // primary and seconary colors on mobiles

    // DISABLED FOR THE MOMENT
    // is pipette really need in game
    // with restricted palette .. ?
    mobileDown() {
        this.downCord = [_player__WEBPACK_IMPORTED_MODULE_5__["default"].x, _player__WEBPACK_IMPORTED_MODULE_5__["default"].y];
        this.downTime = Date.now();
    }

    mobileUp() {
        let lastCord = [_player__WEBPACK_IMPORTED_MODULE_5__["default"].x, _player__WEBPACK_IMPORTED_MODULE_5__["default"].y];
        let lastTime = Date.now();

        this.downCord = null;
        this.downTime = null;
    }
}
const pipette = new Pipette('pipette', 'KeyC', /*pipetteIcon*/);

const altPipette = new Pipette('alt pipette', 'ALT+KeyC');
altPipette.off('down', altPipette.down);
altPipette.on('down', (e) => {
    e.__alt = true;
    altPipette.down.call(altPipette, e)
});

class Line extends _Tool__WEBPACK_IMPORTED_MODULE_0__["default"] {
    constructor(...args) {
        super(...args);

        this.drawLength = JSON.parse((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_21__.getOrDefault)('drawLineLen', false));;

        onToolManager(() => {
            this.handlers();
        })
    }

    handlers() {
        let startCoords, endCoords, lastCoords = [],
            fx, isDown = false,
            line,
            startColor1, startColor2, startCircleSize;

        function down() {
            if (isDown) return;
            isDown = true;

            startCoords = [_player__WEBPACK_IMPORTED_MODULE_5__["default"].x, _player__WEBPACK_IMPORTED_MODULE_5__["default"].y];

            [startColor1, startColor2] = [_player__WEBPACK_IMPORTED_MODULE_5__["default"].color, _player__WEBPACK_IMPORTED_MODULE_5__["default"].secondCol];

            startCircleSize = 1;
            if (_player__WEBPACK_IMPORTED_MODULE_5__["default"].brushSize !== 1) {
                startCircleSize = _globals__WEBPACK_IMPORTED_MODULE_1__["default"].renderer.preRendered.brush.circle.length;
            }

            //this.emit('move');
        }

        function move(e) {
            if (!isDown || !startCoords) return;
            if (e.gesture) {
                isDown = false;
                return startCoords = null;
            };

            endCoords = [_player__WEBPACK_IMPORTED_MODULE_5__["default"].x, _player__WEBPACK_IMPORTED_MODULE_5__["default"].y];

            if (_player__WEBPACK_IMPORTED_MODULE_5__["default"].color === -1 && _player__WEBPACK_IMPORTED_MODULE_5__["default"].secondCol === -1) {
                fx && removeFX(fx);
                return;
            }
            if (endCoords[0] != lastCoords[0] || endCoords[1] != lastCoords[1]) {
                lastCoords = endCoords;

                const line = buildLine(...startCoords, ...endCoords)

                fx && removeFX(fx);
                fx = new _fxcanvas__WEBPACK_IMPORTED_MODULE_6__.FX((ctx) => {
                    ctx.globalAlpha = .5;

                    // draw line pixel by pixel
                    line.forEach(([x, y]) => {
                        const color = getColByCord(x, y);
                        ctx.fillStyle = _config__WEBPACK_IMPORTED_MODULE_7__.hexPalette[color];

                        let [screenX, screenY] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_4__.boardToScreenSpace)(x, y);
                        ctx.fillRect(screenX, screenY, _camera__WEBPACK_IMPORTED_MODULE_8__["default"].zoom, _camera__WEBPACK_IMPORTED_MODULE_8__["default"].zoom);
                    });

                    // draw (non pixelated) black line over the line
                    ctx.strokeStyle = '#000000';
                    ctx.lineWidth = _camera__WEBPACK_IMPORTED_MODULE_8__["default"].zoom / 5;

                    const startScreen = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_4__.boardToScreenSpace)(...line[0]);
                    const endScreen = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_4__.boardToScreenSpace)(...line[line.length - 1]);

                    ctx.beginPath();
                    ctx.lineCap = 'round'
                    ctx.moveTo(...startScreen.map(z => z += _camera__WEBPACK_IMPORTED_MODULE_8__["default"].zoom / 2));
                    ctx.lineTo(...endScreen.map(z => z += _camera__WEBPACK_IMPORTED_MODULE_8__["default"].zoom / 2));

                    // draw line length text

                    function angle(cx, cy, ex, ey) {
                        var dy = ey - cy;
                        var dx = ex - cx;
                        var theta = Math.atan2(dy, dx); // range (-PI, PI]
                        theta *= 180 / Math.PI; // rads to degs, range (-180, 180]
                        //if (theta < 0) theta = 360 + theta; // range [0, 360)
                        return theta;
                    }

                    function toRadians(angle) {
                        return angle * (Math.PI / 180);
                    }

                    if (this.drawLength && line.length > 1) {
                        let [startPosX, startPosY] = startScreen;
                        let [endPosX, endPosY] = endScreen;

                        let minX = Math.min(startPosX, endPosX);
                        let minY = Math.min(startPosY, endPosY);
                        let maxX = Math.max(startPosX, endPosX);
                        let maxY = Math.max(startPosY, endPosY);

                        let [midPosX, midPosY] = [maxX - Math.abs(maxX - minX) / 2, maxY - Math.abs(maxY - minY) / 2];

                        // append half-pixel offset to center text in the middle
                        midPosX += _camera__WEBPACK_IMPORTED_MODULE_8__["default"].zoom * 0.5;
                        midPosY += _camera__WEBPACK_IMPORTED_MODULE_8__["default"].zoom * 0.5;

                        let lineAngle = angle(startPosX, startPosY, endPosX, endPosY);
                        if (lineAngle > 90) {
                            lineAngle -= 180;
                        } else if (lineAngle < -90) {
                            lineAngle += 180;
                        }

                        let lineRads = toRadians(lineAngle);
                        let offsetX = 40 * Math.sin(lineRads);
                        let offsetY = 40 * Math.cos(lineRads);

                        midPosX += offsetX;
                        midPosY -= offsetY;



                        ctx.save();
                        ctx.globalAlpha = .7;

                        const fontHei = 20//camera.zoom / 1.5;
                        ctx.font = fontHei + 'px sans-serif';
                        ctx.fillStyle = 'black'
                        ctx.strokeStyle = 'white';

                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.lineWidth = fontHei / 6;

                        const text = line.length;
                        const [x, y] = [midPosX, midPosY];

                        ctx.strokeText(text, x, y);
                        ctx.fillText(text, x, y);

                        ctx.restore();
                    }

                    ctx.stroke();

                    ctx.globalAlpha = 1;

                    return 1
                })
                addFX(fx)
            }
        }

        function buildLine(x1, y1, x2, y2) {
            let circle = [[0, 0]];
            if (_player__WEBPACK_IMPORTED_MODULE_5__["default"].brushSize !== 1) {
                circle = _globals__WEBPACK_IMPORTED_MODULE_1__["default"].renderer.preRendered.brush.circle;
            }

            const w = _config__WEBPACK_IMPORTED_MODULE_7__.boardWidth;

            // to not repeat already added pixels
            const placed = new Set();

            const bruhLinePixels = [];
            const linePixels = _utils_shapes__WEBPACK_IMPORTED_MODULE_2__["default"].line(x1, y1, x2, y2);

            // starting from the end and then
            // reversing brushed array will
            // make pixels rendering looking more brush-like
            for (let i = linePixels.length - 1; i >= 0; i--) {
                const [x, y] = linePixels[i]
                circle.forEach(([offX, offY]) => {
                    const absX = x + offX;
                    const absY = y + offY;

                    const encoded = absX + absY * w;

                    if (placed.has(encoded)) return;
                    placed.add((encoded));

                    bruhLinePixels.push([absX, absY]);
                })
            }

            return bruhLinePixels.reverse();
        }

        function up() {
            this.off('tick', tick);

            if (!isDown || !startCoords) return;
            isDown = false;

            fx && fx.remove();

            if (!endCoords) endCoords = [_player__WEBPACK_IMPORTED_MODULE_5__["default"].x, _player__WEBPACK_IMPORTED_MODULE_5__["default"].y];

            line = buildLine(...startCoords, ...endCoords);
            startCoords = null;
            endCoords = null;

            renderFX();
            this.on('tick', tick);
        }

        function tick() {
            if (_player__WEBPACK_IMPORTED_MODULE_5__["default"].color === -1 && _player__WEBPACK_IMPORTED_MODULE_5__["default"].secondCol === -1) {
                // assume player cancelled line
                line = null;
            }

            let placed = 0;
            while (true) {
                if (!line || !line.length) {
                    this.off('tick', tick);
                    return;
                }

                const [x, y] = line.pop();
                const col = getColByCord(x, y, startColor1, startColor2);

                if (col === undefined || col === -1) return this.off('tick', tick);
                if (!checkBounds(x, y) || getPixel(x, y) === col) continue;

                if (!_player__WEBPACK_IMPORTED_MODULE_5__["default"].bucket.spend(1)) return line.push([x, y]);

                (0,_actions__WEBPACK_IMPORTED_MODULE_10__.placePixel)(x, y, col);
                placed++;
                if (placed >= startCircleSize / 2) {
                    return
                }
            }
        }

        down = down.bind(this);
        move = move.bind(this);
        up = up.bind(this);

        tick = tick.bind(this);

        this.on('down', down);
        // TODO maybe it's too many listeners
        // so it'd be good to make some sort of local signal
        // that there was gesture (this listener is only for e.gesture to reset start coords)
        _globals__WEBPACK_IMPORTED_MODULE_1__["default"].toolManager.on('move', move);
        this.on('up', up);
    }
}
const line = new Line('line', 'ShiftLeft', _img_toolIcons_line_png__WEBPACK_IMPORTED_MODULE_15__["default"]);

const cordAdd = new _Tool__WEBPACK_IMPORTED_MODULE_0__["default"]('coords to chat', 'KeyU');
cordAdd.on('up', function () {
    const cords = $('#coords').text();
    if (!cords.length) return;
    _elements__WEBPACK_IMPORTED_MODULE_9__.chatInput[0].value += cords + ' ';
    _elements__WEBPACK_IMPORTED_MODULE_9__.chatInput.trigger('focus');
});

const colorSwap = new _Tool__WEBPACK_IMPORTED_MODULE_0__["default"]('swap colors', 'KeyX');
colorSwap.on('up', _player__WEBPACK_IMPORTED_MODULE_5__["default"].swapColors.bind(_player__WEBPACK_IMPORTED_MODULE_5__["default"]));

const colorDec = new _Tool__WEBPACK_IMPORTED_MODULE_0__["default"]('left color', 'KeyA');
colorDec.on('down', function () {
    let color = _player__WEBPACK_IMPORTED_MODULE_5__["default"].color;
    if (--color < 0) color = _config__WEBPACK_IMPORTED_MODULE_7__.hexPalette.length - 1;

    _player__WEBPACK_IMPORTED_MODULE_5__["default"].switchColor(color);
});

const colorInc = new _Tool__WEBPACK_IMPORTED_MODULE_0__["default"]('right color', 'KeyS');
colorInc.on('down', function () {
    let color = _player__WEBPACK_IMPORTED_MODULE_5__["default"].color;
    if (++color >= _config__WEBPACK_IMPORTED_MODULE_7__.hexPalette.length) color = 0;

    _player__WEBPACK_IMPORTED_MODULE_5__["default"].switchColor(color);
});

const chatOpac = new _Tool__WEBPACK_IMPORTED_MODULE_0__["default"]('toggle chat', 'KeyK');
chatOpac.on('down', function () {
    (0,_actions__WEBPACK_IMPORTED_MODULE_10__.toggleChat)();
});

const menuOpac = new _Tool__WEBPACK_IMPORTED_MODULE_0__["default"]('toggle menu', 'KeyL');
menuOpac.on('down', function () {
    (0,_actions__WEBPACK_IMPORTED_MODULE_10__.toggleTopMenu)();
});

const allOpac = new _Tool__WEBPACK_IMPORTED_MODULE_0__["default"]('toggle everything', 'Semicolon' /* ; */);
allOpac.on('down', function () {
    (0,_actions__WEBPACK_IMPORTED_MODULE_10__.toggleEverything)();
});

class CtrlZ extends _Tool__WEBPACK_IMPORTED_MODULE_0__["default"] {
    constructor(...args) {
        super(...args);

        this.handlers();
    }

    handlers() {
        let isDown = false;

        function reset() {
            isDown = false;

            this.off('tick', tick);
            tickTime = tickMax;
            lastTick = 0;
        }
        reset = reset.bind(this);

        const down = function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (e.gesture) {
                return reset();
            }

            // i know about e.repeat
            if (isDown) return;
            isDown = true;

            tick();
            this.on('tick', tick);
        }.bind(this);

        const move = function (e) {
            if (e.gesture) {
                reset();
            }
        }.bind(this);

        const up = function () {
            reset();
        }.bind(this);

        const tickMax = 500;
        const tickMin = 50;

        const nocdMinTick = 2;
        // ticknow = ticknow - (ts / nocdStepFactor)
        // i.e ms passed since last tick divided by this factor
        const nocdStepFactor = 100;

        const step = 1.5;
        let tickTime = tickMax;

        let lastTick = 0;
        const tick = function () {
            const ts = Date.now() - lastTick;
            if (ts < tickTime) return;
            let multiTicks = ts / tickTime | 0;
            // when lastTick is 0 (tool is just activated)
            if (multiTicks < 0) multiTicks = 1;

            lastTick = Date.now();

            do {
                // if (tickTime <= tickMin) {
                //     if(player.bucket.delay < tickMin){
                //         tickTime = Math.max(nocdMinTick, tickTime-(ts/nocdStepFactor))
                //     }
                // }else{
                //     tickTime /= step;
                // }

                // instead of speeding up we'll do it only if alt pressed
                const altFactor = _globals__WEBPACK_IMPORTED_MODULE_1__["default"].toolManager.altDown ? 0.2 : 1;
                tickTime = Math.max(tickTime / step, tickMin * altFactor);

                if (_player__WEBPACK_IMPORTED_MODULE_5__["default"].placed.length > _player__WEBPACK_IMPORTED_MODULE_5__["default"].maxPlaced) {
                    _player__WEBPACK_IMPORTED_MODULE_5__["default"].placed = _player__WEBPACK_IMPORTED_MODULE_5__["default"].placed.slice(-_player__WEBPACK_IMPORTED_MODULE_5__["default"].maxPlaced);
                }
                if (!_player__WEBPACK_IMPORTED_MODULE_5__["default"].placed.length) return;
                if (!_player__WEBPACK_IMPORTED_MODULE_5__["default"].bucket.spend(1)) return;

                const [x, y, c] = _player__WEBPACK_IMPORTED_MODULE_5__["default"].placed.pop();

                (0,_actions__WEBPACK_IMPORTED_MODULE_10__.placePixel)(x, y, c, false);
            }
            while (--multiTicks)
        }.bind(this);

        this.on('down', down);
        _globals__WEBPACK_IMPORTED_MODULE_1__["default"].eventManager.on('mousemove', move);
        this.on('up', up);
    }
}
const ctrlZ = new CtrlZ('ctrlZ', 'KeyZ', _img_toolIcons_revert_png__WEBPACK_IMPORTED_MODULE_17__["default"]);

class Grid extends _Tool__WEBPACK_IMPORTED_MODULE_0__["default"] {
    constructor(...args) {
        super(...args);

        this.state = 0;
        this.fx = null;

        this.isLight = JSON.parse((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_21__.getOrDefault)('lightGrid', false));
        this.pattern = null;

        _camera__WEBPACK_IMPORTED_MODULE_8__["default"].on('zoom', () => {
            if (this.state == 1) {
                this.tryRender();
            }
        });

        this.on('down', this.pressed.bind(this));
        if (JSON.parse((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_21__.getOrDefault)('enableGrid', false))) {
            this.show();
        }
    }

    pressed(e) {
        if (e.repeat) return;
        this.toggle();
    }

    /**@param {CanvasRenderingContext2D} ctx*/
    drawGrid(ctx) {
        let [x, y] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_4__.screenToBoardSpace)(0, 0),
            [clientX, clientY] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_4__.boardToScreenSpace)(x, y);

        let { width, height } = ctx.canvas;
        const zoom = _camera__WEBPACK_IMPORTED_MODULE_8__["default"].zoom;

        // ctx.fillStyle = this.isLight ? 'white' : 'black';
        ctx.fillStyle = 'rgb(127,127,127)'
        ctx.globalAlpha = 0.8;

        let thickInterval;
        if (_config__WEBPACK_IMPORTED_MODULE_7__.chunkSize % 16 == 0) thickInterval = 16;
        else if (_config__WEBPACK_IMPORTED_MODULE_7__.chunkSize % 10 == 0) thickInterval = 10;
        else thickInterval = null;

        // finally, i decided to disable this feature
        thickInterval = null;

        let wid = 1;

        // kostyl
        x--; y--;

        // pixels lines
        for (; clientX < width; clientX += zoom) {
            x++
            if (x % thickInterval == 0) wid = .7;
            else wid = .7;

            if (x % _config__WEBPACK_IMPORTED_MODULE_7__.chunkSize == 0) wid = 1;

            ctx.fillRect(clientX, 0, wid, height);
        }

        for (; clientY < height; clientY += zoom) {
            y++
            if (y % thickInterval == 0) wid = .7;
            else wid = .7;

            if (y % _config__WEBPACK_IMPORTED_MODULE_7__.chunkSize == 0) wid = 1;

            ctx.fillRect(0, clientY, width, wid);
        }

        ctx.globalAlpha = 1;
    }

    tryRender() {
        if (!this.fx || this.fx.removed) {
            this.fx = new _fxcanvas__WEBPACK_IMPORTED_MODULE_6__.FX(this.render.bind(this));
            addFX(this.fx, 2);
        }
    }

    toggle() {
        if (this.state == 0) this.show();
        else this.hide();
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_21__.setLS)('enableGrid', (!!this.state).toString())
    }

    show() {
        this.state = 1;
        this.tryRender();
    }

    hide() {
        this.state = 0;
        this.fx && removeFX(this.fx);
    }

    render(ctx) {
        if (_camera__WEBPACK_IMPORTED_MODULE_8__["default"].zoom <= 4) return 1;

        this.drawGrid(ctx);
    }
}
const grid = new Grid('grid', 'KeyG');

// WARNING: it's not supposed to be a bot
// so it won't check for connection or re-check image
// write your own bots please 
class Paste extends _Tool__WEBPACK_IMPORTED_MODULE_0__["default"] {
    constructor(...args) {
        super(...args);

        // 0 - idle
        // 1 - choosing
        // 2 - placing
        // 3 - drawing
        this.state = 0;

        this.moveFX = null;
        this.drawInterval = null;

        this.initListeners();
    }

    initListeners() {
        this.on('down', this.down.bind(this));
    }

    async down() {
        if (this.state == 0 || this.state == 1) {
            this.state = 1;

            try {
                const canvas = await this.getImage();
                this.startPlace(canvas);
            } catch {
                this.state = 0;
            }
        } else if (this.state == 2) {
            // this.state = 0
            // this.stopPlace();
        } else if (this.state == 3) {
            this.state = 0;
            this.stopDraw();
        }
    }

    async getImage() {
        // get file from system
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/png';

        input.click();

        return new Promise((res, rej) => {
            input.onchange = () => {
                input.onchange = null;

                if (!input.files.length || input.files[0] == "") {
                    return rej();
                }

                // read first file with filereader
                const reader = new FileReader();
                reader.readAsDataURL(input.files[0]);

                reader.onload = () => {
                    // load image with "img" tag
                    const img = new Image();
                    img.src = reader.result;
                    img.onload = () => {
                        // draw image on canvas to get its data
                        const canvas = document.createElement('canvas');
                        canvas.width = img.width;
                        canvas.height = img.height;

                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0);

                        res(canvas);
                    }
                    img.onerror = rej;
                }
                reader.onerror = rej;
            }
        })
    }

    startPlace(canvas) {
        _player__WEBPACK_IMPORTED_MODULE_5__["default"].resetColors();
        this.state = 2;

        let xPos = _player__WEBPACK_IMPORTED_MODULE_5__["default"].x,
            yPos = _player__WEBPACK_IMPORTED_MODULE_5__["default"].y;

        function render(ctx) {
            const [x, y] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_4__.boardToScreenSpace)(xPos, yPos);
            const z = _camera__WEBPACK_IMPORTED_MODULE_8__["default"].zoom;

            const opacity = (0,_utils_math__WEBPACK_IMPORTED_MODULE_24__.map)(Math.sin(Date.now() / 400), -1, 1, 0.5, 1);
            ctx.globalAlpha = opacity;

            ctx.save();
            ctx.scale(z, z);
            ctx.drawImage(canvas, x / z, y / z);
            ctx.restore();

            ctx.globalAlpha = 1;
            return 0
        }

        const fx = this.moveFX = new _fxcanvas__WEBPACK_IMPORTED_MODULE_6__.FX(render);
        addFX(fx);

        function move() {
            let newX = _player__WEBPACK_IMPORTED_MODULE_5__["default"].x,
                newY = _player__WEBPACK_IMPORTED_MODULE_5__["default"].y;
            if (newX == xPos && newY == yPos)
                return;

            xPos = newX;
            yPos = newY;
        }

        let lastX, lastY;
        let down = function (e) {
            lastX = e.clientX;
            lastY = e.clientY;
        }

        let up = function (e) {
            if (e.button == 2) {
                this.state = 0;
                this.stopPlace(); off();
                return;
            };

            let [x, y] = [e.clientX, e.clientY];
            if (Math.abs(x - lastX) > 5 || Math.abs(y - lastY) > 5) return;

            off();

            this.stopPlace();
            this.startDraw(canvas, xPos, yPos);
        }
        up = up.bind(this);

        function off() {
            _globals__WEBPACK_IMPORTED_MODULE_1__["default"].eventManager.off('mousedown', down);
            _globals__WEBPACK_IMPORTED_MODULE_1__["default"].eventManager.off('mouseup', up);
            _globals__WEBPACK_IMPORTED_MODULE_1__["default"].toolManager.off('move', move);
        }

        _globals__WEBPACK_IMPORTED_MODULE_1__["default"].eventManager.on('mousedown', down);
        _globals__WEBPACK_IMPORTED_MODULE_1__["default"].eventManager.on('mouseup', up);
        _globals__WEBPACK_IMPORTED_MODULE_1__["default"].toolManager.on('move', move);
    }

    stopPlace() {
        removeFX(this.moveFX);
        this.removeAllListeners('move');
    }

    startDraw(canvas, offx, offy) {
        this.state = 3;

        const ctx = canvas.getContext('2d');
        const { width: w } = canvas;

        let imgdata = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
        let offset = -4;

        function draw() {
            let allowance = Math.floor(_player__WEBPACK_IMPORTED_MODULE_5__["default"].bucket.allowance);
            if (allowance == 0) return;

            let pixels = [];

            let max = 13106;
            if ((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_21__.getLS)('ya', false) === 'polkovnik') {
                max = 52441;
            }
            while (allowance > 0 && offset < imgdata.length - 4 && pixels.length < 13106) {
                offset += 4;

                let rgba = [
                    imgdata[offset],
                    imgdata[offset + 1],
                    imgdata[offset + 2],
                    imgdata[offset + 3],
                ]

                if (rgba[3] < 127) continue;

                let off = offset / 4;
                const x = off % w,
                    y = off / w | 0;

                const boardX = offx + x,
                    boardY = offy + y;
                if (boardX < 0 || boardX >= _config__WEBPACK_IMPORTED_MODULE_7__.boardWidth ||
                    boardY < 0 || boardY >= _config__WEBPACK_IMPORTED_MODULE_7__.boardHeight)
                    continue

                const color = (0,_utils_color__WEBPACK_IMPORTED_MODULE_20__.closestColor)(rgba, _config__WEBPACK_IMPORTED_MODULE_7__.palette);
                const oldCol = _globals__WEBPACK_IMPORTED_MODULE_1__["default"].chunkManager.getChunkPixel(boardX, boardY);
                if (oldCol == color) continue;

                allowance--;

                pixels.push([boardX, boardY, color]);
            }

            if (pixels.length) {
                _player__WEBPACK_IMPORTED_MODULE_5__["default"].bucket.spend(pixels.length);
                _globals__WEBPACK_IMPORTED_MODULE_1__["default"].socket.sendPixels(pixels);
            }

            if (offset >= imgdata.length - 4) {
                this.state = 0;
                this.stopDraw();
            }
        }

        this.drawInterval = setInterval(draw.bind(this), 50);
    }

    stopDraw() {
        clearInterval(this.drawInterval);
    }
}
const paste = new Paste('paste', 'CTRL+KeyV', null, _constants__WEBPACK_IMPORTED_MODULE_11__.ROLE.MOD);

// TODO move it to config or globals
let tempOpacity = parseFloat((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_21__.getOrDefault)('template.opacity', 0.5, true));
const templateOp1 = new _Tool__WEBPACK_IMPORTED_MODULE_0__["default"]('template 0/N opaq', 'KeyO');
templateOp1.on('down', () => {
    if (_template__WEBPACK_IMPORTED_MODULE_18__["default"].opacity == 0) {
        _template__WEBPACK_IMPORTED_MODULE_18__["default"].opacity = tempOpacity;
    } else {
        tempOpacity = _template__WEBPACK_IMPORTED_MODULE_18__["default"].opacity
        _template__WEBPACK_IMPORTED_MODULE_18__["default"].opacity = 0;
    }
    (0,_actions__WEBPACK_IMPORTED_MODULE_10__.updateTemplate)();
});

const templateOp2 = new _Tool__WEBPACK_IMPORTED_MODULE_0__["default"]('template 1/N opaq', 'KeyP');
templateOp2.on('down', () => {
    if (_template__WEBPACK_IMPORTED_MODULE_18__["default"].opacity == 1) {
        _template__WEBPACK_IMPORTED_MODULE_18__["default"].opacity = tempOpacity;
    } else {
        tempOpacity = _template__WEBPACK_IMPORTED_MODULE_18__["default"].opacity
        _template__WEBPACK_IMPORTED_MODULE_18__["default"].opacity = 1;
    }
    (0,_actions__WEBPACK_IMPORTED_MODULE_10__.updateTemplate)();
});

class Square extends _Tool__WEBPACK_IMPORTED_MODULE_0__["default"] {
    constructor(...args) {
        super(...args);

        this.handlers();
    }

    handlers() {
        let startCoords, endCoords, lastCoords = [],
            fx, isDown = false,
            square,
            color, color2;

        function down() {
            if (isDown) return;
            isDown = true;

            startCoords = [_player__WEBPACK_IMPORTED_MODULE_5__["default"].x, _player__WEBPACK_IMPORTED_MODULE_5__["default"].y];

            [color, color2] = [_player__WEBPACK_IMPORTED_MODULE_5__["default"].color, _player__WEBPACK_IMPORTED_MODULE_5__["default"].secondCol];

            this.emit('move');
        }

        function move() {
            if (!isDown || !startCoords) return;

            endCoords = [_player__WEBPACK_IMPORTED_MODULE_5__["default"].x, _player__WEBPACK_IMPORTED_MODULE_5__["default"].y];

            if (endCoords[0] != lastCoords[0] || endCoords[1] != lastCoords[1]) {
                lastCoords = endCoords;

                const pixels = _utils_shapes__WEBPACK_IMPORTED_MODULE_2__["default"].square(...startCoords, ...endCoords)

                fx && removeFX(fx);
                fx = new _fxcanvas__WEBPACK_IMPORTED_MODULE_6__.FX((ctx) => {
                    ctx.globalAlpha = .5;

                    for (let [x, y] of pixels) {
                        const [sx, sy] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_4__.boardToScreenSpace)(x, y);
                        const color = getColByCord(x, y);
                        ctx.fillStyle = _config__WEBPACK_IMPORTED_MODULE_7__.hexPalette[color];
                        ctx.fillRect(sx, sy, _camera__WEBPACK_IMPORTED_MODULE_8__["default"].zoom, _camera__WEBPACK_IMPORTED_MODULE_8__["default"].zoom);
                    }

                    ctx.globalAlpha = 1;

                    return 1
                })
                addFX(fx)
            }
        }

        function up() {
            this.off('tick', tick);
            isDown = false;

            if (!startCoords) return;

            fx && fx.remove();

            if (!endCoords) endCoords = [_player__WEBPACK_IMPORTED_MODULE_5__["default"].x, _player__WEBPACK_IMPORTED_MODULE_5__["default"].y];

            square = _utils_shapes__WEBPACK_IMPORTED_MODULE_2__["default"].square(...startCoords, ...endCoords);

            renderFX();

            if (square.length <= 1) return;
            this.on('tick', tick);
        }

        function tick() {
            let infCd = (_player__WEBPACK_IMPORTED_MODULE_5__["default"].bucket.allowance === Infinity);

            if (!this.lastTick) this.lastTick = Date.now();

            if (infCd && Date.now() - this.lastTick < 50) return;
            this.lastTick = Date.now();

            //   0
            let counter = 0;
            let toSend = [];
            while (counter < 1000) {
                if (!square || !square.length) {
                    this.off('tick', tick);
                    break;
                }

                const [x, y] = square.pop();
                const col = getColByCord(x, y, color, color2);

                if (col === undefined || col === -1) return this.off('tick', tick);
                if (!checkBounds(x, y)) continue;
                if (getPixel(x, y) === col) continue;
                if (!_player__WEBPACK_IMPORTED_MODULE_5__["default"].bucket.spend(1)) return square.push([x, y]);

                counter++;

                if (infCd) {
                    toSend.push([x, y, col]);
                } else {
                    (0,_actions__WEBPACK_IMPORTED_MODULE_10__.placePixel)(x, y, col);
                }
            }

            if (toSend.length) {
                (0,_actions__WEBPACK_IMPORTED_MODULE_10__.placePixels)(toSend, true);
            }
        }

        down = down.bind(this);
        move = move.bind(this);
        up = up.bind(this);

        tick = tick.bind(this);

        this.on('down', down);
        this.on('move', move);
        this.on('up', up);
    }
}
const square = new Square('square', 'KeyJ');

const incBrush = new _Tool__WEBPACK_IMPORTED_MODULE_0__["default"]('+brush size', 'BracketRight'); // [
incBrush.on('down', () => {
    if (_player__WEBPACK_IMPORTED_MODULE_5__["default"].brushSize >= 100) return;
    if (_player__WEBPACK_IMPORTED_MODULE_5__["default"].brushSize == 1) return (0,_actions__WEBPACK_IMPORTED_MODULE_10__.updateBrush)(4);
    (0,_actions__WEBPACK_IMPORTED_MODULE_10__.updateBrush)(_player__WEBPACK_IMPORTED_MODULE_5__["default"].brushSize + 2);
});

const decBrush = new _Tool__WEBPACK_IMPORTED_MODULE_0__["default"]('-brush size', 'BracketLeft'); // ]
decBrush.on('down', () => {
    if (_player__WEBPACK_IMPORTED_MODULE_5__["default"].brushSize <= 4) return (0,_actions__WEBPACK_IMPORTED_MODULE_10__.updateBrush)(1);
    (0,_actions__WEBPACK_IMPORTED_MODULE_10__.updateBrush)(_player__WEBPACK_IMPORTED_MODULE_5__["default"].brushSize - 2);
})

class Copy extends _Tool__WEBPACK_IMPORTED_MODULE_0__["default"] {
    constructor(...args) {
        super(...args);

        // 0 - idle
        // 1 - started selection
        this.state = 0;

        this.selectFX = null;

        this.initListeners();
    }

    initListeners() {
        this.on('down', this.down.bind(this));
    }

    down(e) {
        if (this.state > 0 || paste.state > 0)
            return

        // since default key is ctrl+c
        const isTextSelected = (window.getSelection().type === 'Range');
        if (isTextSelected) return;

        e.preventDefault();
        e.stopPropagation();

        _camera__WEBPACK_IMPORTED_MODULE_8__["default"].disableMove();
        _player__WEBPACK_IMPORTED_MODULE_5__["default"].resetColors();
        _globals__WEBPACK_IMPORTED_MODULE_1__["default"].elements.mainCanvas.style.cursor = 'crosshair';

        this.state = 1;

        let fx;
        let startX, startY, endX, endY;

        let altPressed = false,
            lassoMode = false,
            lassoPoints = [];
        function keydown(e) {
            if (e.key === 'Alt')
                altPressed = true;
        }
        // function keyup(e) {
        //     // tf is this ... ???
        //     if (e.key === 'Alt')
        //         altPressed = false;
        // }

        function mousedown() {
            if (altPressed) {
                lassoMode = true;
                lassoPoints = [[_player__WEBPACK_IMPORTED_MODULE_5__["default"].x, _player__WEBPACK_IMPORTED_MODULE_5__["default"].y]];
            } else {
                startX = _player__WEBPACK_IMPORTED_MODULE_5__["default"].x;
                startY = _player__WEBPACK_IMPORTED_MODULE_5__["default"].y;
            }
        }
        function mousemove() {
            if (lassoMode) {
                let x = _player__WEBPACK_IMPORTED_MODULE_5__["default"].x,
                    y = _player__WEBPACK_IMPORTED_MODULE_5__["default"].y;

                lassoPoints.push([x, y]);
            } else {
                endX = _player__WEBPACK_IMPORTED_MODULE_5__["default"].x + 1;
                endY = _player__WEBPACK_IMPORTED_MODULE_5__["default"].y + 1;
            }
        }
        function mouseup() {
            // area is selected and we can tell Paste tool to draw it
            _globals__WEBPACK_IMPORTED_MODULE_1__["default"].elements.mainCanvas.style.cursor = '';

            removeFX(fx);

            _globals__WEBPACK_IMPORTED_MODULE_1__["default"].eventManager.off('keydown', keydown);
            // globals.eventManager.off('keyup', keyup);
            _globals__WEBPACK_IMPORTED_MODULE_1__["default"].eventManager.off('mousedown', mousedown);
            _globals__WEBPACK_IMPORTED_MODULE_1__["default"].eventManager.off('mousemove', mousemove);
            _globals__WEBPACK_IMPORTED_MODULE_1__["default"].eventManager.off('mouseup', mouseup);

            this.state = 0;

            _camera__WEBPACK_IMPORTED_MODULE_8__["default"].enableMove();

            onSelected();
        }

        function render(ctx) {
            ctx.save();

            ctx.strokeStyle = 'gray';
            ctx.lineWidth = 2;
            ctx.setLineDash([3, 3]);
            ctx.globalAlpha = 1;

            if (lassoMode) {
                ctx.beginPath();
                const firstCord = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_4__.boardToScreenSpace)(lassoPoints[0][0], lassoPoints[0][1]);
                ctx.moveTo(...firstCord);
                for (let i = 1; i < lassoPoints.length; i++) {
                    const point = lassoPoints[i];
                    ctx.lineTo(...(0,_utils_conversions__WEBPACK_IMPORTED_MODULE_4__.boardToScreenSpace)(...point))
                }
                ctx.closePath();
                ctx.stroke();
            } else {
                const [x1, y1] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_4__.boardToScreenSpace)(startX, startY);
                const [x2, y2] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_4__.boardToScreenSpace)(endX, endY);
                ctx.strokeRect(x1, y1, x2 - x1, y2 - y1);
            }

            ctx.restore();
            return 1
        }
        fx = new _fxcanvas__WEBPACK_IMPORTED_MODULE_6__.FX(render);
        addFX(fx);

        keydown = keydown.bind(this);
        // keyup = keyup.bind(this);
        mousedown = mousedown.bind(this);
        mousemove = mousemove.bind(this);
        mouseup = mouseup.bind(this);

        _globals__WEBPACK_IMPORTED_MODULE_1__["default"].eventManager.on('keydown', keydown);
        // globals.eventManager.on('keyup', keyup);
        _globals__WEBPACK_IMPORTED_MODULE_1__["default"].eventManager.on('mousedown', mousedown);
        _globals__WEBPACK_IMPORTED_MODULE_1__["default"].eventManager.on('mousemove', mousemove);
        _globals__WEBPACK_IMPORTED_MODULE_1__["default"].eventManager.on('mouseup', mouseup);


        function onSelected() {
            let minX, maxX, minY, maxY;
            if (lassoMode) {
                minX = maxX = lassoPoints[0][0];
                minY = maxY = lassoPoints[0][1];
                for (let i = 0; i < lassoPoints.length; i++) {
                    const point = lassoPoints[i];
                    if (point[0] < minX)
                        minX = point[0];
                    if (point[0] > maxX)
                        maxX = point[0];
                    if (point[1] < minY)
                        minY = point[1];
                    if (point[1] > maxY)
                        maxY = point[1];
                }
            } else {
                if ([startX, startY, endX, endY].some(x => x === undefined))
                    return;

                minX = Math.min(startX, endX);
                maxX = Math.max(startX, endX) + 1;
                minY = Math.min(startY, endY);
                maxY = Math.max(startY, endY) + 1;
            }

            // normalize coordinates
            minX = Math.max(minX, 0);
            maxX = Math.min(maxX, _config__WEBPACK_IMPORTED_MODULE_7__.boardWidth);
            minY = Math.max(minY, 0);
            maxY = Math.min(maxY, _config__WEBPACK_IMPORTED_MODULE_7__.boardHeight);

            const w = maxX - minX;
            const h = maxY - minY;

            const canvas = document.createElement('canvas');
            canvas.width = w;
            canvas.height = h;

            const ctx = canvas.getContext('2d');
            const data = ctx.createImageData(w, h);

            // poly x coordinates and y coordinates arrays
            let vertx, verty;
            if (lassoMode) {
                vertx = new Array(lassoPoints.length);
                verty = new Array(lassoPoints.length);

                for (let i = 0; i < lassoPoints.length; i++) {
                    const point = lassoPoints[i];
                    vertx[i] = point[0];
                    verty[i] = point[1];
                }
            }

            // local canvas coordinates
            for (let x = 0; x < w; x++) {
                for (let y = 0; y < h; y++) {
                    const i = (x + y * w) * 4;

                    // absolute board coordinates
                    const cx = minX + x;
                    const cy = minY + y;

                    if (lassoMode && !(0,_utils_misc__WEBPACK_IMPORTED_MODULE_22__.testPointInPolygon)(lassoPoints.length, vertx, verty, cx, cy)) {
                        continue
                    }

                    const colId = _globals__WEBPACK_IMPORTED_MODULE_1__["default"].chunkManager.getChunkPixel(cx, cy);
                    const col = _config__WEBPACK_IMPORTED_MODULE_7__.palette[colId];

                    data.data[i] = col[0];
                    data.data[i + 1] = col[1];
                    data.data[i + 2] = col[2];
                    data.data[i + 3] = 255;
                }
            }

            ctx.putImageData(data, 0, 0);

            // let the Paste tool do other stuff
            paste.startPlace(canvas);
        }
    }
}
const copy = new Copy('copy', 'CTRL+KeyC', null, _constants__WEBPACK_IMPORTED_MODULE_11__.ROLE.MOD);

const pixelInfo = new _Tool__WEBPACK_IMPORTED_MODULE_0__["default"]('pixel info', 'KeyI');

let last = null, pinfoFx = null
function removeLast() {
    if (last) {
        last.remove();
        last = null;
    }
    if (pinfoFx) {
        pinfoFx.remove();
        pinfoFx = null;
    }
}
_globals__WEBPACK_IMPORTED_MODULE_1__["default"].eventManager.on('mouseup', removeLast);

pixelInfo.on('up', async () => {
    removeLast()

    const [x, y] = [_player__WEBPACK_IMPORTED_MODULE_5__["default"].x, _player__WEBPACK_IMPORTED_MODULE_5__["default"].y];

    const resp = await (0,_actions__WEBPACK_IMPORTED_MODULE_10__.apiRequest)(`/pixelInfo?canvas=${_config__WEBPACK_IMPORTED_MODULE_7__.canvasId}&x=${x}&y=${y}`);
    const data = await resp.json();
    if (!data || !data.type) return;

    const el = $('<div class="infoBubble"><span style="user-select:text"></span></div>');
    last = el;

    const coordsLegend = $('<div>');
    coordsLegend[0].style.cssText =
        `position: absolute;
    top: -7px;
    left: 0;
    width: 100%;
    font-size: 14px;
    font-weight: bold;
    text-shadow: rgb(255 255 255) -1px 1px 0px, rgb(255 255 255) 1px 1px 0px, rgb(255 255 255) 1px -1px 0px, rgb(255 255 255) -1px -1px 0px;
    text-align: center;`
    coordsLegend.text(`(${x}, ${y})`)

    el.append(coordsLegend);

    let text = '';

    if (data.type === 'UID') {
        const sanitizedName = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_22__.htmlspecialchars)(data.placer.nick);

        text += '<b>UID</b>&nbsp;' + data.placer.id + '<br>',
            text += '<b>name</b>&nbsp;' + sanitizedName;
    } else {
        text += `<b>${data.type}</b>`;
        if (data.placer) {
            text += '&nbsp;' + data.placer
        }
    }

    $('span', el).html(text);

    $('body').append(el);

    const w = el[0].clientWidth;
    const h = el[0].clientHeight;

    function fixPos() {
        const [clientX, clientY] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_4__.boardToScreenSpace)(x, y);
        const posX = clientX + (_camera__WEBPACK_IMPORTED_MODULE_8__["default"].zoom / 2) - (w / 2)
        const posY = clientY - h - 11;

        el.css('top', posY).css('left', posX);

        return 1;
    }
    fixPos();


    pinfoFx = new _fxcanvas__WEBPACK_IMPORTED_MODULE_6__.FX(() => {
        fixPos();
    })
    addFX(pinfoFx, 2);
});

class PixelFont {
    static defaultVSpacing = 1;

    constructor(imagePath, infoPath) {
        this.imagePath = imagePath;
        this.infoPath = infoPath;

        this.defaultWidth = null;
        this.defaultHeight = null;
        this.letters = {};

        this.loaded = false;
        this._isLoading = false;
    }

    async load() {
        if (this._isLoading) return;
        this._isLoading = true;

        try {
            const fontCanvas = await new Promise((res, rej) => {
                const img = new Image();

                img.onload = () => {
                    const canvas = document.createElement('canvas');

                    canvas.width = img.width;
                    canvas.height = img.height;

                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0);

                    res(canvas);
                }

                img.onerror = rej;

                img.src = this.imagePath;
            })

            const fontInfoResp = await fetch(this.infoPath);
            const fontInfo = await fontInfoResp.json();

            const defaultWidth = fontInfo.defaultWidth;
            this.defaultWidth = defaultWidth;
            const height = fontInfo.fixedHeight;
            this.defaultHeight = height;

            const fontCanvasCtx = fontCanvas.getContext('2d');
            this.letters = {};

            let offsetX = 0;
            for (let letter of fontInfo.letters) {
                const {
                    letter: letterSymbol,
                    width = defaultWidth
                } = letter;

                const slice = fontCanvasCtx.getImageData(offsetX, 0, width, height);
                this.letters[letterSymbol] = slice;

                // extra 1 because it's one white pixel before each next letter
                offsetX += width + 1;
            }
        } catch (error) {
            this._isLoading = false;
            throw error
        }

        this._isLoading = false;
        this.loaded = true;
    }

    drawText(text, color='black') {
        if(!this.loaded) throw new Error('font not loaded');

        text = text.toUpperCase();

        const {
            width: textWidth,
            height: textHeight
        } = this.measureText(text);

        if(textWidth == 0 || textHeight == 0){
            return null;
        }

        const colorCanvas = document.createElement('canvas');
        const textCanvas = document.createElement('canvas');

        colorCanvas.width = textCanvas.width = textWidth;
        colorCanvas.height = textCanvas.height = textHeight;

        const colorCanvasCtx = colorCanvas.getContext('2d');
        const textCanvasCtx = textCanvas.getContext('2d');

        const textLetters = text.split('');
        let cursorX = 0, cursorY = 0;
        for(let letter of textLetters){
            if(letter == '\n'){
                cursorY += this.defaultHeight + PixelFont.defaultVSpacing;
                cursorX = 0;
                continue
            }

            if(letter == ' '){
                cursorX += this.defaultWidth;
                continue
            }

            let letterImData = this.letters[letter];
            if(!letterImData){
                cursorX += this.defaultWidth;
                continue
            }

            textCanvasCtx.putImageData(letterImData, cursorX, cursorY);
            cursorX += letterImData.width + 1; // 1 is the constant spacing
        }

        // first, we draw text canvas shaped, colored rect 
        // then we will put the text on top of it, using
        // globalComposite property.
        // this will keep only those pixels of colored rect, in which
        // letters are. this will "color" the letters in the color of the rect
        colorCanvasCtx.fillStyle = color;
        colorCanvasCtx.fillRect(0, 0, textWidth, textHeight);

        colorCanvasCtx.globalCompositeOperation = 'destination-atop';
        colorCanvasCtx.drawImage(textCanvas, 0, 0);

        return colorCanvas;
    }

    measureText(text){
        if(!this.loaded) throw new Error('font not loaded');

        text = text.toUpperCase();

        const textLetters = text.split('');
        let curWidth = 0, maxWidth = 0, height = this.defaultHeight;

        for(let letter of textLetters){
            if(letter == '\n'){
                height += this.defaultHeight + PixelFont.defaultVSpacing;
                maxWidth = Math.max(curWidth, maxWidth);
                curWidth = 0;
                continue
            }

            if(letter == ' '){
                curWidth += this.defaultWidth;
                continue
            }

            if(this.letters[letter]){
                curWidth += (this.letters[letter].width || this.defaultWidth) + 1;
            }
        }

        return {
            width: Math.max(curWidth, maxWidth), height
        }
    }
}

class Text extends _Tool__WEBPACK_IMPORTED_MODULE_0__["default"] {
    constructor(...args) {
        super(...args);

        this.fonts = [
            new PixelFont(_font_pixel_min5_png__WEBPACK_IMPORTED_MODULE_25__["default"], _font_pixel_min5_txt__WEBPACK_IMPORTED_MODULE_26__["default"])
        ];
        this.fonts.forEach(f => f.load());

        this.miniWindow = null;

        this.on('down', this.down.bind(this));
    }

    down(e){
        if(this.miniWindow && !this.miniWindow.closed) return;

        this.miniWindow = new _MiniWindow__WEBPACK_IMPORTED_MODULE_27__["default"]('Draw text', 2);
        const winEl = this.miniWindow.element;
        if(mobile){
            winEl.css('left', 0).css('top', 0);
        }else{
            winEl.css('left', window.screen.width/3).css('top', window.screen.height/3);
        }

        const innerHtml = $(`
            <textarea style="width: 100%;"></textarea>
            <div style="display:flex; margin: 2px 0">
                <div style="display: flex">
                    <div>x:</div> <input type="number" class="textXCord" style="width: 100%">
                </div>
                <div style="display: flex; margin-left: 2px">
                    <div>y:</div> <input type="number" class="textYCord" style="width: 100%">
                </div>
            </div>
        `);

        this.miniWindow.bodyElement.css('max-width', 200).css('display', 'flex').css('flex-direction', 'column');
        this.miniWindow.bodyElement.append(innerHtml);
        document.body.appendChild(winEl[0]);

        const textInput = $('textarea', this.miniWindow.bodyElement);
        const xCordInput = $('.textXCord', this.miniWindow.bodyElement);
        const yCordInput = $('.textYCord', this.miniWindow.bodyElement);

        const lastCord = [_player__WEBPACK_IMPORTED_MODULE_5__["default"].x, _player__WEBPACK_IMPORTED_MODULE_5__["default"].y];
        xCordInput.val(lastCord[0]);
        yCordInput.val(lastCord[1]);

        const font = this.fonts[0];

        let lastText = null, lastColor = _player__WEBPACK_IMPORTED_MODULE_5__["default"].color, lastTextCanvas = null
        const previewFx = new _fxcanvas__WEBPACK_IMPORTED_MODULE_6__.FX((ctx) => {
            const text = textInput.val();
            if(!text) return 0;

            if(!font.loaded){
                return 0;
            }

            // remap the sine value based on the time
            // to the min-max opacity borders
            ctx.globalAlpha = (0,_utils_math__WEBPACK_IMPORTED_MODULE_24__.map)(Math.sin(Date.now()/400), -1, 1, 0.2, 0.9);

            const x = xCordInput.val();
            const y = yCordInput.val();

            if(lastText !== text || lastColor !== _player__WEBPACK_IMPORTED_MODULE_5__["default"].color){
                lastText = text;
                lastColor = _player__WEBPACK_IMPORTED_MODULE_5__["default"].color;
                lastTextCanvas = font.drawText(lastText, _config__WEBPACK_IMPORTED_MODULE_7__.hexPalette[lastColor]);
            }

            const [screenX, screenY] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_4__.boardToScreenSpace)(x, y);

            
            ctx.save();
            ctx.scale(_camera__WEBPACK_IMPORTED_MODULE_8__["default"].zoom, _camera__WEBPACK_IMPORTED_MODULE_8__["default"].zoom);

            ctx.imageSmoothingEnabled = false;

            const deZoomedX = screenX/_camera__WEBPACK_IMPORTED_MODULE_8__["default"].zoom;
            const deZoomedY = screenY/_camera__WEBPACK_IMPORTED_MODULE_8__["default"].zoom;

            if(~_player__WEBPACK_IMPORTED_MODULE_5__["default"].secondCol){
                ctx.fillStyle = _config__WEBPACK_IMPORTED_MODULE_7__.hexPalette[_player__WEBPACK_IMPORTED_MODULE_5__["default"].secondCol];
                ctx.fillRect(deZoomedX, deZoomedY, lastTextCanvas.width, lastTextCanvas.height);
            }
            ctx.drawImage(lastTextCanvas, deZoomedX, deZoomedY);

            ctx.restore();

            return 0
        })
        addFX(previewFx);

        this.miniWindow.on('okClicked', () => {
            removeFX(previewFx);

            const text = textInput.val();
            if(!text || !lastTextCanvas) return;

            // add background if second color is selected
            if(~_player__WEBPACK_IMPORTED_MODULE_5__["default"].secondCol){
                const ctx = lastTextCanvas.getContext('2d');
                // draw only on opaque pixels
                ctx.globalCompositeOperation = 'destination-over';
                ctx.fillStyle = _config__WEBPACK_IMPORTED_MODULE_7__.hexPalette[_player__WEBPACK_IMPORTED_MODULE_5__["default"].secondCol];
                ctx.fillRect(0, 0, lastTextCanvas.width, lastTextCanvas.height);
            }
            
            const x = +xCordInput.val();
            const y = +yCordInput.val();

            paste.startDraw(lastTextCanvas, x, y);
        });

        this.miniWindow.on('cancelClicked', () => {
            removeFX(previewFx);
        });
    }
}
const text = new Text('text', 'KeyT', null, _constants__WEBPACK_IMPORTED_MODULE_11__.ROLE.TRUSTED)

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({
    clicker,
    mover,
    floodfill,
    pipette, altPipette,
    line,
    colorInc, colorDec,
    colorSwap,
    chatOpac, menuOpac, allOpac,
    ctrlZ,
    protector, altProtector,
    grid,
    copy,
    paste,
    cordAdd,
    templateOp1, templateOp2,
    square,
    incBrush, decBrush,
    pixelInfo,
    text
});


/***/ }),

/***/ "./src/js/user.js":
/*!************************!*\
  !*** ./src/js/user.js ***!
  \************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (/* binding */ User)
/* harmony export */ });
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./config */ "./src/js/config.js");
/* harmony import */ var _camera__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./camera */ "./src/js/camera.js");
/* harmony import */ var _windows__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./windows */ "./src/js/windows.js");
/* harmony import */ var _Window__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./Window */ "./src/js/Window.js");
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./globals */ "./src/js/globals.js");
/* harmony import */ var _me__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./me */ "./src/js/me.js");
/* harmony import */ var _img_user_svg__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../img/user.svg */ "./src/img/user.svg");
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./constants */ "./src/js/constants.js");
/* harmony import */ var _actions__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./actions */ "./src/js/actions.js");
/* harmony import */ var _utils_ip__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ./utils/ip */ "./src/js/utils/ip.js");
/* harmony import */ var _translate__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./translate */ "./src/js/translate.js");
/* harmony import */ var _img_mod_badge_svg__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../img/mod-badge.svg */ "./src/img/mod-badge.svg");
/* harmony import */ var _img_admin_badge_svg__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../img/admin-badge.svg */ "./src/img/admin-badge.svg");
/* harmony import */ var _img_creator_badge_svg__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ../img/creator-badge.svg */ "./src/img/creator-badge.svg");
/* harmony import */ var _utils_misc__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ./utils/misc */ "./src/js/utils/misc.js");
/* harmony import */ var _img_badges_badge0_png__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../img/badges/badge0.png */ "./src/img/badges/badge0.png");
/* harmony import */ var _img_badges_badge1_png__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ../img/badges/badge1.png */ "./src/img/badges/badge1.png");
/* provided dependency */ var toastr = __webpack_require__(/*! toastr */ "./node_modules/toastr/toastr.js");
const $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");








// import userImg from '../img/user2.png';











// need to find a way for importing links dynamically


const badgeLinks = [
    _img_badges_badge0_png__WEBPACK_IMPORTED_MODULE_15__["default"],
    _img_badges_badge1_png__WEBPACK_IMPORTED_MODULE_16__["default"]
]

const usersContainer = $('#usersTable');

class User {
    // create user window from given object
    // tempId is a temporary id for connection
    static async CreateWindow(info, tempId) {
        const win = new _Window__WEBPACK_IMPORTED_MODULE_3__["default"]({
            center: true,
            title: `${info.name || (0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('PLAYER') + ' ' + (tempId || info.id)}`
        });

        if (info.ip) {
            if (info.cc && info.cc !== 'XX') {
                // adds a flag near the ip address
                info._ip = info.ip;

                const cc = info.cc;
                info.ip += ` [${cc}]`;
                info.ip += `<img src="${location.protocol}//www.countryflagicons.com/FLAT/16/${cc}.png" style="margin-bottom:-5px;margin-left:1px;">`;

                delete info['cc'];
            }
        }

        if (info.role !== undefined && _me__WEBPACK_IMPORTED_MODULE_5__["default"].role === _constants__WEBPACK_IMPORTED_MODULE_7__.ROLE.ADMIN && _me__WEBPACK_IMPORTED_MODULE_5__["default"].id !== info.id) {
            const role = info.role;
            let str = '';
            Object.keys(_constants__WEBPACK_IMPORTED_MODULE_7__.ROLE).forEach(text => {
                str += `<option ${(text === role) ? 'selected' : ''}>${text}</option>`
            })
            info.role = `<select type="role">${str}<select>`
        }

        let infoArr = Object.keys(info).map(key => [key, info[key]]), misc = [];
        infoArr = infoArr.filter(x => !x[0].startsWith('_')); // for shit like _ip

        if (_me__WEBPACK_IMPORTED_MODULE_5__["default"].role >= _constants__WEBPACK_IMPORTED_MODULE_7__.ROLE.MOD) {
            misc = [
                [`<input class="alertInput">`, `<button class="sendAlert">${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('Send Alert')}</button>`],
                [`<button class="banByIp">${(0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('Ban by ip')}</button>`]
            ];
        }

        let together = infoArr.concat(misc);

        $(win.body).append((0,_windows__WEBPACK_IMPORTED_MODULE_2__.generateTable)(together));

        $('select[type=role]', win.body).on('change', async e => {
            const role = e.target.value,
                userId = info.id;
            const resp = await fetch('/api/admin/changerole', {
                method: 'POST',
                body: JSON.stringify({
                    id: userId,
                    role
                }),
                headers: {
                    'Content-Type': 'application/json'
                }
            });
            const body = await resp.json();
            if (body.errors) {
                body.errors.forEach(error => {
                    toastr.error(error, (0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('ERROR'));
                })
            } else {
                toastr.success((0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('Changed role to') + ' ' + role);
            }
        })


        $('.sendAlert', win.body).on('click', () => {
            const val = $('.alertInput', win.body).val();

            if (val.length == 0) return;

            $('.alertInput', win.body).val('');
            _globals__WEBPACK_IMPORTED_MODULE_4__["default"].socket.sendAlert(tempId, val);
        });

        $('.banByIp', win.body).on('click', async () => {
            const ip = info._ip || info.ip;
            if (!ip) return toastr.error((0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('No ip!'))

            const resp = await (0,_actions__WEBPACK_IMPORTED_MODULE_8__.apiRequest)(`/admin/banPlayer?ip=${ip}`);
            const success = (await resp.json()).success;
            if (success)
                toastr.success((0,_translate__WEBPACK_IMPORTED_MODULE_10__.translate)('Success'));
        });
    }


    constructor(name, id, userId, registered, role, badges) {
        if (!name) name = 'ID ' + id;

        this.name = name;
        this.id = id;
        this.userId = userId;

        this.registered = registered;

        this.role = role;

        this.conns = [id];

        this.badges = badges;


        const safeName = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_14__.htmlspecialchars)(this.name);
        let displayName = _globals__WEBPACK_IMPORTED_MODULE_4__["default"].chat.parseColors(safeName).replace(/<[^>]*>/g, '');

        const roleBadgeProps = this.getRoleBadgeAndTitle();
        const badgeImagesHtml = this.getAchieveBadgesHtml();

        this.element = $(
            `<tr class="tableRow">
                <td title="id ${id}" class="user">
                    ${roleBadgeProps ? `<img src="${roleBadgeProps.icon}" title="${roleBadgeProps.tooltip}" class="roleBadge">` : ''}
                    <button class="userInfoBtn minrole-trusted"><img style="height: 20px" src="${_img_user_svg__WEBPACK_IMPORTED_MODULE_6__["default"]}"></button>
                    <span class="name">${displayName}</span>
                    <span class="badges">${badgeImagesHtml}</span>
                    <span class="xConns"></span>
                </td>
                <td></td>
            </tr>`);

        this.nameEl = $('.name', this.element);
        this.coordsEl = $(this.element.children()[1]);

        this.nameEl.on('click', function () {
            const visibleNick = this.innerText;
            _globals__WEBPACK_IMPORTED_MODULE_4__["default"].elements.chatInput.value += visibleNick + ', ';
            _globals__WEBPACK_IMPORTED_MODULE_4__["default"].elements.chatInput.focus();
        })


        $('.userInfoBtn', this.element).on('click', async () => {
            const isReg = this.registered;
            const id = isReg ? this.userId : this.id;

            const req = await fetch(`/api/userInfo?id=${id}${isReg ? '' : '&unreg=1'}`);
            const info = await req.json();
            await User.CreateWindow(info, this.id);
        });

        this.coordsEl.on('click', () => {
            const [x, y] = this.coordsEl.text()
                .slice(1, -1)
                .split(', ')
                .map(x => parseInt(x, 10));

            if (Number.isInteger(x) && Number.isInteger(y))
                _camera__WEBPACK_IMPORTED_MODULE_1__["default"].centerOn(x, y);
        })

        usersContainer[0].appendChild(this.element[0]);

        _me__WEBPACK_IMPORTED_MODULE_5__["default"].updateRoleRelatedHtml();
    }

    getAchieveBadgesHtml(){
        if(!this.badges) return '';

        let html = '';
        for(let badgeId of this.badges){
            html += `<img src="${badgeLinks[badgeId]}">`
        }
        return html
    }

    getRoleBadgeAndTitle() {
        if (!this.role) return null;

        let tooltip, icon;

        switch (this.role) {
            case 'MOD':
                tooltip = 'mod';
                icon = _img_mod_badge_svg__WEBPACK_IMPORTED_MODULE_11__["default"];
                break
            case 'ADMIN':
                tooltip = 'admin';
                icon = _img_admin_badge_svg__WEBPACK_IMPORTED_MODULE_12__["default"];
                break
            default:
                return null
        }

        // if (this.userId == 1) {
        //     tooltip = 'creator';
        //     icon = creatorBadge;
        // }

        return {
            tooltip,
            icon
        }
    }

    updateCoords(color, x, y) {
        this.coordsEl.css('color', _config__WEBPACK_IMPORTED_MODULE_0__.hexPalette[color]);
        this.coordsEl.text(`(${x}, ${y})`);
    }

    close(clientId) {
        this.conns.splice(this.conns.indexOf(clientId), 1);
        if (this.conns.length === 0)
            this.destroy();
        else
            this.updateX();

        delete _globals__WEBPACK_IMPORTED_MODULE_4__["default"].users[clientId]
    }

    destroy() {
        this.element.remove();
    }

    newConnection(clientId) {
        this.conns.push(clientId);
        this.updateX();
    }

    updateX() {
        const text = (this.conns.length > 1) ? `[x${this.conns.length}]` : '';
        $('.xConns', this.element).text(text);
    }
}

/***/ }),

/***/ "./src/js/utils/camera.js":
/*!********************************!*\
  !*** ./src/js/utils/camera.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   getVisibleChunks: () => (/* binding */ getVisibleChunks),
/* harmony export */   inBounds: () => (/* binding */ inBounds),
/* harmony export */   isAreaVisible: () => (/* binding */ isAreaVisible)
/* harmony export */ });
/* harmony import */ var _camera__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../camera */ "./src/js/camera.js");
/* harmony import */ var _misc__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./misc */ "./src/js/utils/misc.js");
/* harmony import */ var _conversions__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./conversions */ "./src/js/utils/conversions.js");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../config */ "./src/js/config.js");





function isAreaVisible(x, y, w, h){
    let sx = _camera__WEBPACK_IMPORTED_MODULE_0__["default"].x + _misc__WEBPACK_IMPORTED_MODULE_1__.halfMap[0],
        sy = _camera__WEBPACK_IMPORTED_MODULE_0__["default"].y + _misc__WEBPACK_IMPORTED_MODULE_1__.halfMap[1];
    
    let ex = sx + window.innerWidth / _camera__WEBPACK_IMPORTED_MODULE_0__["default"].zoom,
        ey = sy + window.innerHeight / _camera__WEBPACK_IMPORTED_MODULE_0__["default"].zoom;

    return x + w >= sx && x < ex &&
           y + h >= sy && y < ey
}

function getVisibleChunks() {
    // todo rework it
    // rn it checks left top chunk and right bottom chunk

    let [sx, sy] = (0,_conversions__WEBPACK_IMPORTED_MODULE_2__.screenToBoardSpace)(0, 0);
    let [ex, ey] = (0,_conversions__WEBPACK_IMPORTED_MODULE_2__.screenToBoardSpace)(window.innerWidth, window.innerHeight);


    let startX = sx / _config__WEBPACK_IMPORTED_MODULE_3__.chunkSize | 0, // math floor
        endX = ex / _config__WEBPACK_IMPORTED_MODULE_3__.chunkSize + 1 | 0; // math ceil

    let startY = sy / _config__WEBPACK_IMPORTED_MODULE_3__.chunkSize | 0,
        endY = ey / _config__WEBPACK_IMPORTED_MODULE_3__.chunkSize + 1 | 0;

    let arr = []
    for (let x = Math.max(startX, 0); x < Math.min(endX, _config__WEBPACK_IMPORTED_MODULE_3__.boardChunkWid); x++) {
        for (let y = Math.max(startY, 0); y < Math.min(endY, _config__WEBPACK_IMPORTED_MODULE_3__.boardChunkHei); y++) {
            arr.push([x, y]);
        }
    }

    return arr
}

function inBounds(x, y){
    if(x < 0 || x >= _config__WEBPACK_IMPORTED_MODULE_3__.boardWidth || y < 0 || y >= _config__WEBPACK_IMPORTED_MODULE_3__.boardHeight) return false;
    return true;
}

/***/ }),

/***/ "./src/js/utils/conversions.js":
/*!*************************************!*\
  !*** ./src/js/utils/conversions.js ***!
  \*************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   boardToChunk: () => (/* binding */ boardToChunk),
/* harmony export */   boardToScreenSpace: () => (/* binding */ boardToScreenSpace),
/* harmony export */   chunkToBoard: () => (/* binding */ chunkToBoard),
/* harmony export */   screenToBoardSpace: () => (/* binding */ screenToBoardSpace)
/* harmony export */ });
/* harmony import */ var _camera__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../camera */ "./src/js/camera.js");
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../globals */ "./src/js/globals.js");
/* harmony import */ var _misc__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./misc */ "./src/js/utils/misc.js");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../config */ "./src/js/config.js");





function screenToBoardSpace(clientX, clientY) {
    let screenOffsetX = (clientX - (_globals__WEBPACK_IMPORTED_MODULE_1__["default"].renderer.canvas.width >> 1)) / _camera__WEBPACK_IMPORTED_MODULE_0__["default"].zoom;
    let screenOffsetY = (clientY - (_globals__WEBPACK_IMPORTED_MODULE_1__["default"].renderer.canvas.height >> 1)) / _camera__WEBPACK_IMPORTED_MODULE_0__["default"].zoom;

    let boardOffsetX = _camera__WEBPACK_IMPORTED_MODULE_0__["default"].x + _misc__WEBPACK_IMPORTED_MODULE_2__.halfMap[0];
    let boardOffsetY = _camera__WEBPACK_IMPORTED_MODULE_0__["default"].y + _misc__WEBPACK_IMPORTED_MODULE_2__.halfMap[1];

    let x = boardOffsetX + screenOffsetX,
        y = screenOffsetY + boardOffsetY;

    return [x | 0, y | 0]
}

function boardToScreenSpace(x, y) {
    x -= _camera__WEBPACK_IMPORTED_MODULE_0__["default"].x + _misc__WEBPACK_IMPORTED_MODULE_2__.halfMap[0];
    y -= _camera__WEBPACK_IMPORTED_MODULE_0__["default"].y + _misc__WEBPACK_IMPORTED_MODULE_2__.halfMap[1];

    x *= _camera__WEBPACK_IMPORTED_MODULE_0__["default"].zoom;
    y *= _camera__WEBPACK_IMPORTED_MODULE_0__["default"].zoom;

    x += _globals__WEBPACK_IMPORTED_MODULE_1__["default"].renderer.canvas.width >> 1; // x >> 1 = x / 2
    y += _globals__WEBPACK_IMPORTED_MODULE_1__["default"].renderer.canvas.height >> 1;

    return [Math.floor(x), Math.floor(y)]
}

function boardToChunk(x, y) {
    let cx = x / _config__WEBPACK_IMPORTED_MODULE_3__.chunkSize | 0;
    let cy = y / _config__WEBPACK_IMPORTED_MODULE_3__.chunkSize | 0;

    let offx = x % _config__WEBPACK_IMPORTED_MODULE_3__.chunkSize;
    let offy = y % _config__WEBPACK_IMPORTED_MODULE_3__.chunkSize;

    return [
        cx,
        cy,
        offx,
        offy
    ]
}

function chunkToBoard(cx, cy, offx, offy) {
    return [cx * _config__WEBPACK_IMPORTED_MODULE_3__.chunkSize + offx, cy * _config__WEBPACK_IMPORTED_MODULE_3__.chunkSize + offy]
}

/***/ }),

/***/ "./src/js/utils/cssColorsList.js":
/*!***************************************!*\
  !*** ./src/js/utils/cssColorsList.js ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({
    "ALICEBLUE": "#F0F8FF",
    "ANTIQUEWHITE": "#FAEBD7",
    "AQUA": "#00FFFF",
    "AQUAMARINE": "#7FFFD4",
    "AZURE": "#F0FFFF",
    "BEIGE": "#F5F5DC",
    "BISQUE": "#FFE4C4",
    "BLACK": "#000000",
    "BLANCHEDALMOND": "#FFEBCD",
    "BLUE": "#0000FF",
    "BLUEVIOLET": "#8A2BE2",
    "BROWN": "#A52A2A",
    "BURLYWOOD": "#DEB887",
    "CADETBLUE": "#5F9EA0",
    "CHARTREUSE": "#7FFF00",
    "CHOCOLATE": "#D2691E",
    "CORAL": "#FF7F50",
    "CORNFLOWERBLUE": "#6495ED",
    "CORNSILK": "#FFF8DC",
    "CRIMSON": "#DC143C",
    "CYAN": "#00FFFF",
    "DARKBLUE": "#00008B",
    "DARKCYAN": "#008B8B",
    "DARKGOLDENROD": "#B8860B",
    "DARKGRAY": "#A9A9A9",
    "DARKGREY": "#A9A9A9",
    "DARKGREEN": "#006400",
    "DARKKHAKI": "#BDB76B",
    "DARKMAGENTA": "#8B008B",
    "DARKOLIVEGREEN": "#556B2F",
    "DARKORANGE": "#FF8C00",
    "DARKORCHID": "#9932CC",
    "DARKRED": "#8B0000",
    "DARKSALMON": "#E9967A",
    "DARKSEAGREEN": "#8FBC8F",
    "DARKSLATEBLUE": "#483D8B",
    "DARKSLATEGRAY": "#2F4F4F",
    "DARKSLATEGREY": "#2F4F4F",
    "DARKTURQUOISE": "#00CED1",
    "DARKVIOLET": "#9400D3",
    "DEEPPINK": "#FF1493",
    "DEEPSKYBLUE": "#00BFFF",
    "DIMGRAY": "#696969",
    "DIMGREY": "#696969",
    "DODGERBLUE": "#1E90FF",
    "FIREBRICK": "#B22222",
    "FLORALWHITE": "#FFFAF0",
    "FORESTGREEN": "#228B22",
    "FUCHSIA": "#FF00FF",
    "GAINSBORO": "#DCDCDC",
    "GHOSTWHITE": "#F8F8FF",
    "GOLD": "#FFD700",
    "GOLDENROD": "#DAA520",
    "GRAY": "#808080",
    "GREY": "#808080",
    "GREEN": "#008000",
    "GREENYELLOW": "#ADFF2F",
    "HONEYDEW": "#F0FFF0",
    "HOTPINK": "#FF69B4",
    "INDIANRED": "#CD5C5C",
    "INDIGO": "#4B0082",
    "IVORY": "#FFFFF0",
    "KHAKI": "#F0E68C",
    "LAVENDER": "#E6E6FA",
    "LAVENDERBLUSH": "#FFF0F5",
    "LAWNGREEN": "#7CFC00",
    "LEMONCHIFFON": "#FFFACD",
    "LIGHTBLUE": "#ADD8E6",
    "LIGHTCORAL": "#F08080",
    "LIGHTCYAN": "#E0FFFF",
    "LIGHTGOLDENRODYELLOW": "#FAFAD2",
    "LIGHTGRAY": "#D3D3D3",
    "LIGHTGREY": "#D3D3D3",
    "LIGHTGREEN": "#90EE90",
    "LIGHTPINK": "#FFB6C1",
    "LIGHTSALMON": "#FFA07A",
    "LIGHTSEAGREEN": "#20B2AA",
    "LIGHTSKYBLUE": "#87CEFA",
    "LIGHTSLATEGRAY": "#778899",
    "LIGHTSLATEGREY": "#778899",
    "LIGHTSTEELBLUE": "#B0C4DE",
    "LIGHTYELLOW": "#FFFFE0",
    "LIME": "#00FF00",
    "LIMEGREEN": "#32CD32",
    "LINEN": "#FAF0E6",
    "MAGENTA": "#FF00FF",
    "MAROON": "#800000",
    "MEDIUMAQUAMARINE": "#66CDAA",
    "MEDIUMBLUE": "#0000CD",
    "MEDIUMORCHID": "#BA55D3",
    "MEDIUMPURPLE": "#9370DB",
    "MEDIUMSEAGREEN": "#3CB371",
    "MEDIUMSLATEBLUE": "#7B68EE",
    "MEDIUMSPRINGGREEN": "#00FA9A",
    "MEDIUMTURQUOISE": "#48D1CC",
    "MEDIUMVIOLETRED": "#C71585",
    "MIDNIGHTBLUE": "#191970",
    "MINTCREAM": "#F5FFFA",
    "MISTYROSE": "#FFE4E1",
    "MOCCASIN": "#FFE4B5",
    "NAVAJOWHITE": "#FFDEAD",
    "NAVY": "#000080",
    "OLDLACE": "#FDF5E6",
    "OLIVE": "#808000",
    "OLIVEDRAB": "#6B8E23",
    "ORANGE": "#FFA500",
    "ORANGERED": "#FF4500",
    "ORCHID": "#DA70D6",
    "PALEGOLDENROD": "#EEE8AA",
    "PALEGREEN": "#98FB98",
    "PALETURQUOISE": "#AFEEEE",
    "PALEVIOLETRED": "#DB7093",
    "PAPAYAWHIP": "#FFEFD5",
    "PEACHPUFF": "#FFDAB9",
    "PERU": "#CD853F",
    "PINK": "#FFC0CB",
    "PLUM": "#DDA0DD",
    "POWDERBLUE": "#B0E0E6",
    "PURPLE": "#800080",
    "REBECCAPURPLE": "#663399",
    "RED": "#FF0000",
    "ROSYBROWN": "#BC8F8F",
    "ROYALBLUE": "#4169E1",
    "SADDLEBROWN": "#8B4513",
    "SALMON": "#FA8072",
    "SANDYBROWN": "#F4A460",
    "SEAGREEN": "#2E8B57",
    "SEASHELL": "#FFF5EE",
    "SIENNA": "#A0522D",
    "SILVER": "#C0C0C0",
    "SKYBLUE": "#87CEEB",
    "SLATEBLUE": "#6A5ACD",
    "SLATEGRAY": "#708090",
    "SLATEGREY": "#708090",
    "SNOW": "#FFFAFA",
    "SPRINGGREEN": "#00FF7F",
    "STEELBLUE": "#4682B4",
    "TAN": "#D2B48C",
    "TEAL": "#008080",
    "THISTLE": "#D8BFD8",
    "TOMATO": "#FF6347",
    "TURQUOISE": "#40E0D0",
    "VIOLET": "#EE82EE",
    "WHEAT": "#F5DEB3",
    "WHITE": "#FFFFFF",
    "WHITESMOKE": "#F5F5F5",
    "YELLOW": "#FFFF00",
    "YELLOWGREEN": "#9ACD32"
});

/***/ }),

/***/ "./src/js/utils/ip.js":
/*!****************************!*\
  !*** ./src/js/utils/ip.js ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
function isLocal(ip){
    return ip.startsWith('127.0') || ip.startsWith('192.168') || ip.startsWith('::')
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({
    isLocal
});

/***/ }),

/***/ "./src/js/utils/math.js":
/*!******************************!*\
  !*** ./src/js/utils/math.js ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   avrg: () => (/* binding */ avrg),
/* harmony export */   clamp: () => (/* binding */ clamp),
/* harmony export */   dist: () => (/* binding */ dist),
/* harmony export */   map: () => (/* binding */ map),
/* harmony export */   mod: () => (/* binding */ mod)
/* harmony export */ });
function mod(n, m) {
    return ((n % m) + m) % m;
}

function dist(x1, y1, x2, y2) {
    return Math.hypot(x2 - x1, y2 - y1)
}

function avrg(...values) {
    return values.reduce((a, b) => a + b) / values.length
}

function map(value, inputMin, inputMax, outputMin, outputMax) {
    return (value - inputMin) * (outputMax - outputMin) / (inputMax - inputMin) + outputMin;
}

function clamp(value, min, max){
    return Math.max(Math.min(value, max), min)
}

/***/ }),

/***/ "./src/js/utils/misc.js":
/*!******************************!*\
  !*** ./src/js/utils/misc.js ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   calculateColumnSize: () => (/* binding */ calculateColumnSize),
/* harmony export */   decodeKey: () => (/* binding */ decodeKey),
/* harmony export */   getPathsafeDate: () => (/* binding */ getPathsafeDate),
/* harmony export */   getRecommendedColorSize: () => (/* binding */ getRecommendedColorSize),
/* harmony export */   halfMap: () => (/* binding */ halfMap),
/* harmony export */   htmlspecialchars: () => (/* binding */ htmlspecialchars),
/* harmony export */   initHalfmap: () => (/* binding */ initHalfmap),
/* harmony export */   insanelyLongMobileBrowserCheck: () => (/* binding */ insanelyLongMobileBrowserCheck),
/* harmony export */   loadImage: () => (/* binding */ loadImage),
/* harmony export */   resizeCanvas: () => (/* binding */ resizeCanvas),
/* harmony export */   stringifyKeyEvent: () => (/* binding */ stringifyKeyEvent),
/* harmony export */   testPointInPolygon: () => (/* binding */ testPointInPolygon)
/* harmony export */ });
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../config */ "./src/js/config.js");
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../globals */ "./src/js/globals.js");
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");



let halfMap = [null, null]
function initHalfmap() {
    halfMap = [
        _config__WEBPACK_IMPORTED_MODULE_0__.boardWidth / 2,
        _config__WEBPACK_IMPORTED_MODULE_0__.boardHeight / 2
    ]
}

function insanelyLongMobileBrowserCheck() {
    let check = false;
    (function (a) {
        if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0, 4))) check = true;
    })(navigator.userAgent || navigator.vendor || window.opera);
    return check;
}

function decodeKey(str) {
    let config = {
        alt: false,
        ctrl: false,
        code: null
    }

    str.split('+').forEach(param => {
        if (param === 'CTRL') {
            config.ctrl = true;
        } else if (param === 'ALT') {
            config.alt = true;
        } else {
            config.code = param;
        }
    })

    return config
}

function stringifyKeyEvent(ev) {
    let out = '';
    if (ev.altKey) {
        out += 'ALT+'
    }
    if (ev.ctrlKey) {
        out += 'CTRL+'
    }
    return out + ev.code
}

function calculateColumnSize() {
    const columns = $('.column', _globals__WEBPACK_IMPORTED_MODULE_1__["default"].elements.topMenuContent);
    const windowWidth = window.innerWidth;

    const colWidth = windowWidth / columns.length;

    $('.column', _globals__WEBPACK_IMPORTED_MODULE_1__["default"].elements.topMenuContent).css('width', colWidth);
}

function htmlspecialchars(text) {
    return text
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
}

function getRecommendedColorSize() {
    if(_globals__WEBPACK_IMPORTED_MODULE_1__["default"].mobile) return 24;
    const max = 30;
    const p = $('#palette');
    // 14 is for palette padding 
    let size = Math.floor((window.innerWidth - 14) / p.children().length);
    size = Math.min(size, max);

    return size
}

function getPathsafeDate() {
    const date = new Date;

    const day = date.getDate().toString().padStart(2, '0'); // convert "1"s to "01"s
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const year = date.getFullYear();

    const today = `${day}.${month}.${year}`;

    const hours = date.getHours().toString().padStart(2, '0');
    const minutes = date.getMinutes().toString().padStart(2, '0');
    const seconds = date.getSeconds().toString().padStart(2, '0');

    const time = `${hours}-${minutes}-${seconds}`;

    return `${today} - ${time}`
}

function testPointInPolygon(nvert, vertx, verty, testx, testy) {
    // copied and translated to js from some stackoverflow
    let i, j, c = 0;
    for (i = 0, j = nvert - 1; i < nvert; j = i++) {
        if (((verty[i] > testy) != (verty[j] > testy)) &&
            (testx < (vertx[j] - vertx[i]) * (testy - verty[i]) / (verty[j] - verty[i]) + vertx[i]))
            c = !c;
    }
    return c;
}

function resizeCanvas(canvas, newWidth, newHeight) {
    const tempCanvas = document.createElement('canvas');
    const tempCtx = tempCanvas.getContext('2d');

    tempCanvas.width = newWidth;
    tempCanvas.height = newHeight;

    tempCtx.imageSmoothingEnabled = false;
    tempCtx.drawImage(canvas, 0, 0, newWidth, newHeight);

    const resizedCanvas = document.createElement('canvas');

    resizedCanvas.width = newWidth;
    resizedCanvas.height = newHeight;

    const resizedCtx = resizedCanvas.getContext('2d');

    resizedCtx.imageSmoothingEnabled = false;
    resizedCtx.drawImage(tempCanvas, 0, 0, newWidth, newHeight);

    return resizedCanvas;
}

function loadImage(url){
    return new Promise((res, rej) => {
        const img = new Image();
        img.src = url;

        img.onerror = rej;
        img.onload = () => res(img);
    })
}

/***/ }),

/***/ "./src/js/utils/shapes.js":
/*!********************************!*\
  !*** ./src/js/utils/shapes.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ({
    line: function (x, y, x2, y2) {
        let pointArr = [];

        let steep = Math.abs(y2 - y) > Math.abs(x2 - x);
        if (steep) {
            [x, y] = [y, x];
            [x2, y2] = [y2, x2];
        }
        let reverseFlag = false;
        if (x > x2) {
            [y, y2] = [y2, y];
            [x, x2] = [x2, x];
            reverseFlag = true;
        }
        let dist = {
            x: x2 - x,
            y: Math.abs(y2 - y)
        }
        let err = dist.x / 2;
        let stepY = (y < y2) ? 1 : -1;
        for (; x <= x2; x++) {
            pointArr.push([steep ? y : x, steep ? x : y]);
            err -= dist.y;
            if (err < 0) {
                y += stepY;
                err += dist.x;
            }
        }
        if (reverseFlag) pointArr.reverse();

        pointArr.reverse();

        return pointArr;
    },

    filledCircle: function (centerX, centerY, r) {
        let pixels = [];

        const squareR = r * r;

        for (let _x = -r + centerX; _x < r + centerX; _x++) {
            for (let _y = -r + centerY; _y < r + centerY; _y++) {
                if (isIn(_x, _y)) {
                    pixels.push([_x, _y])
                }
            }
        }

        function isIn(_x, _y) {
            let dx = _x - centerX,
                dy = _y - centerY;

            if (dx * dx + dy * dy <= squareR * 0.8)
                return true
            return false
        }

        return pixels
    },

    square(x1, y1, x2, y2) {
        const minX = Math.min(x1, x2),
            minY = Math.min(y1, y2),
            maxX = Math.max(x1, x2),
            maxY = Math.max(y1, y2);

        let pixels = [];
        for (let y = minY; y < maxY+1; y++) {
            for (let x = minX; x < maxX+1; x++) {
                pixels.push([x, y]);
            }
        }

        return pixels
    }
});

/***/ }),

/***/ "./src/js/utils/strings.js":
/*!*********************************!*\
  !*** ./src/js/utils/strings.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   capitalize: () => (/* binding */ capitalize)
/* harmony export */ });
function capitalize(str) {
    return str.replace(
      /[-\w]+/g,
      function(txt) {
        return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
      }
    );
  }

/***/ }),

/***/ "./src/js/winamp/PcmPlayer.js":
/*!************************************!*\
  !*** ./src/js/winamp/PcmPlayer.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/*
    A modified version of the https://github.com/samirkumardas/pcm-player/blob/master/pcm-player.js
*/

function PCMPlayer(option) {
    this.init(option);
}

PCMPlayer.prototype.init = function(option) {
    var defaults = {
        encoding: '16bitInt',
        channels: 1,
        sampleRate: 8000,
        flushingTime: 1000
    };
    this.option = Object.assign({}, defaults, option);
    this.samples = new Float32Array();
    this.flush = this.flush.bind(this);
    this.interval = setInterval(this.flush, this.option.flushingTime);
    this.maxValue = this.getMaxValue();
    this.typedArray = this.getTypedArray();
    this.createContext();
};

PCMPlayer.prototype.getMaxValue = function () {
    var encodings = {
        '8bitInt': 128,
        '16bitInt': 32768,
        '32bitInt': 2147483648,
        '32bitFloat': 1
    }

    return encodings[this.option.encoding] ? encodings[this.option.encoding] : encodings['16bitInt'];
};

PCMPlayer.prototype.getTypedArray = function () {
    var typedArrays = {
        '8bitInt': Int8Array,
        '16bitInt': Int16Array,
        '32bitInt': Int32Array,
        '32bitFloat': Float32Array
    }

    return typedArrays[this.option.encoding] ? typedArrays[this.option.encoding] : typedArrays['16bitInt'];
};

PCMPlayer.prototype.createContext = function() {
    this.audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    // context needs to be resumed on iOS and Safari (or it will stay in "suspended" state)
    this.audioCtx.resume();
    this.audioCtx.onstatechange = () => console.log(this.audioCtx.state);   // if you want to see "Running" state in console and be happy about it
    
    this.gainNode = this.audioCtx.createGain();
    this.gainNode.gain.value = 1;

    this.balanceNode = this.audioCtx.createStereoPanner();
    this.balanceNode.pan.value = 0;

    this.gainNode.connect(this.balanceNode);
    this.balanceNode.connect(this.audioCtx.destination);


    this.startTime = this.audioCtx.currentTime;
};

PCMPlayer.prototype.isTypedArray = function(data) {
    return (data.byteLength && data.buffer && data.buffer.constructor == ArrayBuffer);
};

PCMPlayer.prototype.feed = function(data) {
    if (!this.isTypedArray(data)) return;
    data = this.getFormatedValue(data);
    var tmp = new Float32Array(this.samples.length + data.length);
    tmp.set(this.samples, 0);
    tmp.set(data, this.samples.length);
    this.samples = tmp;
};

PCMPlayer.prototype.getFormatedValue = function(data) {
    var data = new this.typedArray(data.buffer),
        float32 = new Float32Array(data.length),
        i;

    for (i = 0; i < data.length; i++) {
        float32[i] = data[i] / this.maxValue;
    }
    return float32;
};

PCMPlayer.prototype.volume = function(volume) {
    this.gainNode.gain.value = volume;
};

PCMPlayer.prototype.balance = function(hrBalance) {
    this.balanceNode.pan.value = hrBalance;
};

PCMPlayer.prototype.destroy = function() {
    if (this.interval) {
        clearInterval(this.interval);
    }
    this.samples = null;
    this.audioCtx.close();
    this.audioCtx = null;
};

PCMPlayer.prototype.flush = function() {
    if (!this.samples.length) return;
    var bufferSource = this.audioCtx.createBufferSource(),
        length = this.samples.length / this.option.channels,
        audioBuffer = this.audioCtx.createBuffer(this.option.channels, length, this.option.sampleRate),
        audioData,
        channel,
        offset,
        i,
        decrement;

    for (channel = 0; channel < this.option.channels; channel++) {
        audioData = audioBuffer.getChannelData(channel);
        offset = channel;
        decrement = 50;
        for (i = 0; i < length; i++) {
            audioData[i] = this.samples[offset];
            /* fadein */
            if (i < 50) {
                audioData[i] =  (audioData[i] * i) / 50;
            }
            /* fadeout*/
            if (i >= (length - 51)) {
                audioData[i] =  (audioData[i] * decrement--) / 50;
            }
            offset += this.option.channels;
        }
    }
    
    if (this.startTime < this.audioCtx.currentTime) {
        this.startTime = this.audioCtx.currentTime;
    }

    bufferSource.buffer = audioBuffer;
    bufferSource.connect(this.gainNode);
    bufferSource.start(this.startTime);
    this.startTime += audioBuffer.duration;
    this.samples = new Float32Array();
};

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (PCMPlayer);

/***/ }),

/***/ "./src/js/winamp/player.js":
/*!*********************************!*\
  !*** ./src/js/winamp/player.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "default": () => (__WEBPACK_DEFAULT_EXPORT__)
/* harmony export */ });
/* harmony import */ var _PcmPlayer__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./PcmPlayer */ "./src/js/winamp/PcmPlayer.js");
/* harmony import */ var _utils_localStorage__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../utils/localStorage */ "./src/js/utils/localStorage.js");
/* harmony import */ var _utils_misc__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../utils/misc */ "./src/js/utils/misc.js");
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../globals */ "./src/js/globals.js");
/* harmony import */ var _utils_conversions__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../utils/conversions */ "./src/js/utils/conversions.js");
/* harmony import */ var _fxcanvas__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../fxcanvas */ "./src/js/fxcanvas.js");
/* harmony import */ var _utils_math__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../utils/math */ "./src/js/utils/math.js");
/* harmony import */ var _camera__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../camera */ "./src/js/camera.js");
/* harmony import */ var _player__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../player */ "./src/js/player.js");
/* harmony import */ var _actions__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../actions */ "./src/js/actions.js");
/* harmony import */ var _font_pixel_winamp_png__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../font/pixel/winamp.png */ "./src/font/pixel/winamp.png");
/* harmony import */ var _font_pixel_winamp_txt__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../font/pixel/winamp.txt */ "./src/font/pixel/winamp.txt");
/* harmony import */ var _tools__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../tools */ "./src/js/tools.js");
/* provided dependency */ var toastr = __webpack_require__(/*! toastr */ "./node_modules/toastr/toastr.js");
















async function importMaterials() {
    __webpack_require__("./src/img/winamp sync \\.png$")
    const images = {
        bg: await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! ../../img/winamp/bg2.png */ "./src/img/winamp/bg2.png")),
        hrSlider: await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! ../../img/winamp/hr-slider-btn-small.png */ "./src/img/winamp/hr-slider-btn-small.png")),
        hrSliderBig: await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! ../../img/winamp/slider-btn.png */ "./src/img/winamp/slider-btn.png")),
        digits: await Promise.resolve(/*! import() */).then(__webpack_require__.bind(__webpack_require__, /*! ../../img/winamp/digits.png */ "./src/img/winamp/digits.png")),
    }

    const wFont = new _tools__WEBPACK_IMPORTED_MODULE_12__.PixelFont(_font_pixel_winamp_png__WEBPACK_IMPORTED_MODULE_10__["default"], _font_pixel_winamp_txt__WEBPACK_IMPORTED_MODULE_11__["default"]);
    await wFont.load();

    return {
        images,
        fonts: {
            winamp: wFont
        }
    }
}

class UIRect {
    constructor(x, y, w, h) {
        Object.assign(this, {
            x, y, w, h
        });
    }
}

let tempColors;
function preserveColors() {
    tempColors = [_player__WEBPACK_IMPORTED_MODULE_8__["default"].color, _player__WEBPACK_IMPORTED_MODULE_8__["default"].secondCol];

    _player__WEBPACK_IMPORTED_MODULE_8__["default"].switchColor(-1);
    _player__WEBPACK_IMPORTED_MODULE_8__["default"].switchSecondColor(-1);
}
function restoreColors() {
    _player__WEBPACK_IMPORTED_MODULE_8__["default"].switchColor(tempColors[0]);
    _player__WEBPACK_IMPORTED_MODULE_8__["default"].switchSecondColor(tempColors[1]);
}

class WinampPlayer {
    constructor() {
        this.canvas = document.createElement('canvas');
        this.ctx = this.canvas.getContext('2d');

        this.playerPosition = JSON.parse((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_1__.getLS)('winamp.position', true) || '[0,0]');
        this.sndBalance = 0; // -1; 1
        this.volumeLvl = +((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_1__.getLS)('winamp.volume', true) || '0.001'); // 0; 1

        this.queue = null;
        this.currentTrack = null;

        this.images = null;
        this.needRender = true;

        this.pcmPlayer = null;

        this.config = {
            width: 275,
            height: 348,

            headerRect: new UIRect(2, 2, 262, 12),
            closeBtnRect: new UIRect(265, 4, 7, 7),
            volumeBoundsRect: new UIRect(108, 61, 63, 4),
            soundBalanceBoundsRect: new UIRect(178, 61, 35, 4),

            // needs calculation
            volumeSliderRect: new UIRect(-1, -1, -1, -1),
            balanceSliderRect: new UIRect(-1, -1, -1, -1),

            titleRect: new UIRect(111, 24, 155, 12),

            kbpsRect: new UIRect(111, 41, 16, 10),
            khzRect: new UIRect(156, 41, 11, 10),

            // big mm:ss clock
            mm1Rect: new UIRect(48, 26, 9, 13),
            mm2Rect: new UIRect(60, 26, 9, 13),
            ss1Rect: new UIRect(78, 26, 9, 13),
            ss2Rect: new UIRect(90, 26, 9, 13),

            progressSliderBndRect: new UIRect(16, 72, 249, 10),

            queueBoxRect: new UIRect(18, 257, 238, 48)
        }

        this._cache = {};

        this._holdingButton = null;
        this._lastHoldPos = null;

        this._destroyed = false;
        this.noFeed = false;

        this.title = null;
        this.visibleTitle = null;
    }

    rebuildPcmPlayer(sampleRate) {
        if (this.pcmPlayer) {
            this.pcmPlayer.destroy();
        }

        this.pcmPlayer = new _PcmPlayer__WEBPACK_IMPORTED_MODULE_0__["default"]({
            inputCodec: 'Int16',
            channels: 2,
            sampleRate,
            flushTime: 2000
        })

        this.pcmPlayer.volume(this.volumeLvl);
        this.pcmPlayer.balance(this.sndBalance);
    }

    async init() {
        await this.loadMaterials();
        this.recalculateButtons();
        this.initTouchControls();

        this.setTitle('Goroxels Radio 1.0 alpha');

        this.canvas.width = this.config.width;
        this.canvas.height = this.config.height;

        _globals__WEBPACK_IMPORTED_MODULE_3__["default"].fxRenderer.add(new _fxcanvas__WEBPACK_IMPORTED_MODULE_5__.FX(this.render.bind(this)), 2);

        await this.updateSong();
        await this.updateQueue();
        this.startPolling();

        _globals__WEBPACK_IMPORTED_MODULE_3__["default"].socket.on('radio', type => {
            switch(type){
                case 0:
                    this.updateSong();
                case 1:
                    this.updateQueue();
            }
        });

        _globals__WEBPACK_IMPORTED_MODULE_3__["default"].socket.on('opened', () => {
            this.updateSong();
            this.updateQueue();
        })

        this.ackRender();
        this.initAutoRender();
    }

    initAutoRender() {
        setInterval(() => {
            this.ackRender();
        }, 1000);
    }

    initTouchControls() {
        _globals__WEBPACK_IMPORTED_MODULE_3__["default"].eventManager.on('mousedown', e => {
            if(this._destroyed) return;

            if (e.gesture) return mouseup(e);

            mousedown(e);
        });
        _globals__WEBPACK_IMPORTED_MODULE_3__["default"].eventManager.on('mouseup', e => {
            if(this._destroyed) return;

            mouseup(e);
        });
        _globals__WEBPACK_IMPORTED_MODULE_3__["default"].eventManager.on('mousemove', e => {
            if(this._destroyed) return;

            if (e.gesture) return;

            mousemove(e);
        });

        const self = this;

        function mousedown(e) {
            if (self._holdingButton) mouseup(e);


            let obj = self.getObjectAtPosition(e.clientX, e.clientY);
            if (obj) {
                preserveColors();

                _camera__WEBPACK_IMPORTED_MODULE_7__["default"].disableMove();

                self.onObjMousedown.call(self, obj, e);
                self._lastHoldPos = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_4__.screenToBoardSpace)(e.clientX, e.clientY);
            }
        }
        function mouseup(e) {
            self._lastHoldPos = null;

            _camera__WEBPACK_IMPORTED_MODULE_7__["default"].enableMove();

            if (self._holdingButton) {
                self.onObjMouseup.call(self, self._holdingButton, e);

                self._holdingButton = false;

                setTimeout(restoreColors);
            }
        }
        function mousemove(e) {
            if (self._holdingButton) {
                self.onObjMousemove.call(self, self._holdingButton, e);

                self._lastHoldPos = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_4__.screenToBoardSpace)(e.clientX, e.clientY);
            }
        }
    }

    getObjectAtPosition(screenX, screenY) {
        const objsToCheck = [
            this.config.headerRect,
            this.config.closeBtnRect,
            this.config.volumeSliderRect,
            this.config.balanceSliderRect,
        ];

        const [boardX, boardY] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_4__.screenToBoardSpace)(screenX, screenY);
        const [playerX, playerY] = this.getRelPos(boardX, boardY);

        for (let obj of objsToCheck) {
            if (playerX >= obj.x && playerX < obj.x + obj.w &&
                playerY >= obj.y && playerY < obj.y + obj.h) {
                return obj;
            }
        }
    }

    onObjMousedown(obj) {
        this._holdingButton = obj;
    }
    onObjMouseup(obj, e) {
        switch(obj){
            case this.config.closeBtnRect: {
                if(this.getObjectAtPosition(e.clientX, e.clientY) === this.config.closeBtnRect){
                    this.close();
                }
            }
        }
    }
    onObjMousemove(obj, e) {
        const [movX, movY] = this.calcMovement(e);

        switch (obj) {
            case this.config.headerRect: {
                this.playerPosition[0] += movX;
                this.playerPosition[1] += movY;

                (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_1__.setLS)('winamp.position', JSON.stringify(this.playerPosition), true);

                this.ackRender();

                break;
            }
            case this.config.volumeSliderRect: {
                const [relX] = this.getRelPos(...(0,_utils_conversions__WEBPACK_IMPORTED_MODULE_4__.screenToBoardSpace)(e.clientX, e.clientY));

                const bndRect = this.config.volumeBoundsRect;
                const sliderImg = this.images.hrSlider;

                const [clampedX, clampedY] = this.clampHrSliderPos(relX, bndRect, sliderImg);

                this.config.volumeSliderRect.x = clampedX;
                this.config.volumeSliderRect.y = clampedY;

                const newValue = this.mapHrSliderPos(clampedX, bndRect, sliderImg, 0, 1);
                this.volumeLvl = newValue;

                this.pcmPlayer.volume(this.volumeLvl);

                (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_1__.setLS)('winamp.volume', this.volumeLvl.toString(), true);

                this.ackRender();

                break;
            }

            case this.config.balanceSliderRect: {
                const [relX] = this.getRelPos(...(0,_utils_conversions__WEBPACK_IMPORTED_MODULE_4__.screenToBoardSpace)(e.clientX, e.clientY));

                const bndRect = this.config.soundBalanceBoundsRect;
                const sliderImg = this.images.hrSlider;

                const [clampedX, clampedY] = this.clampHrSliderPos(relX, bndRect, sliderImg);

                this.config.balanceSliderRect.x = clampedX;
                this.config.balanceSliderRect.y = clampedY;

                const newValue = this.mapHrSliderPos(clampedX, bndRect, sliderImg, -1, 1);
                this.sndBalance = newValue;

                this.pcmPlayer.balance(this.sndBalance);

                this.ackRender();

                break;
            }
        }
    }

    // clamp mouse position to slider bounds
    clampHrSliderPos(relX, bndRect, sliderImg) {
        // center the slider to the mouse pos
        relX -= sliderImg.width / 2;

        const clampX = (0,_utils_math__WEBPACK_IMPORTED_MODULE_6__.clamp)(relX, bndRect.x, bndRect.x + bndRect.w - sliderImg.width);
        const constY = bndRect.y + (bndRect.h / 2) - (sliderImg.height / 2) + 1;

        return [clampX | 0, constY | 0];
    }

    // convert slider position to output value
    mapHrSliderPos(posX, bndRect, sliderImg, minValue, maxValue) {
        const minPosX = bndRect.x;
        const maxPosX = bndRect.x + bndRect.w - sliderImg.width;

        const mappedVal = (0,_utils_math__WEBPACK_IMPORTED_MODULE_6__.map)(posX, minPosX, maxPosX, minValue, maxValue);
        return mappedVal;
    }

    // convert value to position
    reverseMapHrSliderPos(value, bndRect, sliderImg, minValue, maxValue) {
        const minPosX = bndRect.x;
        const maxPosX = bndRect.x + bndRect.w - sliderImg.width;

        const mappedPosX = (0,_utils_math__WEBPACK_IMPORTED_MODULE_6__.map)(value, minValue, maxValue, minPosX, maxPosX);
        return mappedPosX | 0;
    }

    // convert global board position to local canvas position
    getRelPos(boardX, boardY) {
        const playerX = boardX - this.playerPosition[0];
        const playerY = boardY - this.playerPosition[1];

        return [playerX, playerY];
    }

    // getHrSliderPos(minX, maxX, )

    calcMovement(e) {
        if (!this._lastHoldPos) {
            return null;
        }

        const curBoardPos = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_4__.screenToBoardSpace)(e.clientX, e.clientY);

        const diffX = curBoardPos[0] - this._lastHoldPos[0];
        const diffY = curBoardPos[1] - this._lastHoldPos[1];

        return [diffX, diffY];
    }

    async loadMaterials() {
        const {
            images: urlsObj,
            fonts
        } = await importMaterials();

        const imgObj = {};
        for (let key of Object.keys(urlsObj)) {
            let url = urlsObj[key].default;

            imgObj[key] = await (0,_utils_misc__WEBPACK_IMPORTED_MODULE_2__.loadImage)(url);
        }

        this.images = imgObj;
        this.fonts = fonts;
    }

    ackRender() {
        this.needRender = true;
        _globals__WEBPACK_IMPORTED_MODULE_3__["default"].fxRenderer.requestRender();
    }

    render(ctx) {
        if(this._destroyed) return 2;

        const [x, y] = (0,_utils_conversions__WEBPACK_IMPORTED_MODULE_4__.boardToScreenSpace)(this.playerPosition[0], this.playerPosition[1]);
        const z = _camera__WEBPACK_IMPORTED_MODULE_7__["default"].zoom;

        if(this.needRender)
            this.redraw();

        ctx.save();
        ctx.scale(z, z);
        ctx.drawImage(this.canvas, x / z, y / z);
        ctx.restore();

        return 1
    }

    generateQueueText() {
        if (!this.queue) return '';

        const queue = [
            ...this.queue.queue,
            ...this.queue.defaultQueue
        ].slice(0, 7);

        const str = queue.map(s => {
            let title = s.title;
            if(title.length > 42){
                title = title.slice(0, 42-3) + '...';
            }
            return `${s.id}. ${title} <${s.duration / 60 | 0}:${pad2(s.duration % 60 | 0)}>`
        }).join('\n');

        return str;
    }

    redraw() {
        this.needRender = false;

        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        this.ctx.drawImage(this.images.bg, 0, 0);
        this.ctx.drawImage(this.images.hrSlider, this.config.volumeSliderRect.x, this.config.volumeSliderRect.y);
        this.ctx.drawImage(this.images.hrSlider, this.config.balanceSliderRect.x, this.config.balanceSliderRect.y);

        this.drawTextInInput(this.title, this.config.titleRect, '#00E200');

        if (this.currentTrack) {
            const kbps = (2 * 2 * this.currentTrack.sampleRate) / 1000 | 0; // channels*sampleSize(16bit=2byte)*sampleRate
            const khz = this.currentTrack.sampleRate / 1000 | 0;

            this.drawTextInInput(kbps.toString(), this.config.kbpsRect, '#00E200');
            this.drawTextInInput(khz.toString(), this.config.khzRect, '#00E200');

            const sPassed = (Date.now() - this.currentTrack.startedAt) / 1000;

            const mmPassed = pad2((sPassed / 60 | 0).toString());
            const ssPassed = pad2((sPassed % 60 | 0).toString());

            this.drawBigDigit(this.config.mm1Rect, mmPassed[0]);
            this.drawBigDigit(this.config.mm2Rect, mmPassed[1]);
            this.drawBigDigit(this.config.ss1Rect, ssPassed[0]);
            this.drawBigDigit(this.config.ss2Rect, ssPassed[1]);

            const progressPosX = this.reverseMapHrSliderPos(sPassed, this.config.progressSliderBndRect, this.images.hrSliderBig, 0, this.currentTrack.duration);
            const progressPosY = this.config.progressSliderBndRect.y;

            this.ctx.drawImage(this.images.hrSliderBig, progressPosX, progressPosY);
        }

        // this shit eats a lot of cpu
        const queueText = this.generateQueueText();
        if(queueText && queueText !== this._cache.queueText){
            const qTextImg = this.fonts.winamp.drawText(queueText, '#00E200');
            if(qTextImg){
                this._cache.queueTextImg = qTextImg;
                this._cache.queueText = queueText;
                this.ctx.drawImage(qTextImg, this.config.queueBoxRect.x, this.config.queueBoxRect.y);
            }
        }else if(queueText){
            this.ctx.drawImage(this._cache.queueTextImg, this.config.queueBoxRect.x, this.config.queueBoxRect.y);
        }
    }

    drawBigDigit(rect, number) {
        const digitW = rect.w;
        this.ctx.drawImage(this.images.digits, digitW * number, 0, rect.w, rect.h, rect.x, rect.y, rect.w, rect.h);
    }

    drawTextInInput(text, inputRect, color) {
        const drawnText = this.fonts.winamp.drawText(text, color);
        this.ctx.drawImage(drawnText, 0, 0, inputRect.w, drawnText.height, inputRect.x, ((inputRect.y + inputRect.h / 2) - drawnText.height / 2) | 0, inputRect.w, drawnText.height);
    }

    recalculateButtons() {
        const smallSliderWidth = this.images.hrSlider.width;
        const smallSliderHeight = this.images.hrSlider.height;

        const volRect = this.config.volumeBoundsRect;
        const volSliderX = (0,_utils_math__WEBPACK_IMPORTED_MODULE_6__.map)(this.volumeLvl, 0, 1, volRect.x, (volRect.x + volRect.w) - smallSliderWidth);
        const volSliderY = ((volRect.y + volRect.h / 2) - smallSliderHeight / 2) + 1

        this.config.volumeSliderRect.x = volSliderX | 0;
        this.config.volumeSliderRect.y = volSliderY | 0;
        this.config.volumeSliderRect.w = smallSliderWidth;
        this.config.volumeSliderRect.h = smallSliderHeight;

        const balRect = this.config.soundBalanceBoundsRect;
        const balSliderX = (0,_utils_math__WEBPACK_IMPORTED_MODULE_6__.map)(this.sndBalance, -1, 1, balRect.x, (balRect.x + balRect.w) - smallSliderWidth);
        const balSliderY = ((balRect.y + balRect.h / 2) - smallSliderHeight / 2) + 1

        this.config.balanceSliderRect.x = balSliderX | 0;
        this.config.balanceSliderRect.y = balSliderY | 0;
        this.config.balanceSliderRect.w = smallSliderWidth;
        this.config.balanceSliderRect.h = smallSliderHeight;
    }

    close() {
        this.pcmPlayer.destroy();

        clearTimeout(this.__pollTimeout);
        clearInterval(this._titleRollerInterval);


        this._destroyed = true;
    }

    async startPolling() {
        try {
            const aborter = new AbortController();

            const resp = await fetch(`${location.protocol}//${location.hostname}/api/radio/stream`, {
                signal: aborter.signal
            });
            const reader = resp.body.getReader();

            let acc = new Uint8Array();

            while (1) {
                if(this._destroyed) {
                    aborter.abort('destroy');
                };
                const { done, value } = await reader.read();
                if (done) break;

                // this fuck sometimes causes an error like "new Uint16array length should divide by 2 bla bla bla"
                // i guess this is because of transmission issues, so let's workaround
                if(value.length % 2 !== 0 || acc.length > 0){
                    acc = joinByteArrays(acc, value);

                    if(acc.length % 2 == 0){
                        this.feed(acc.subarray());
                        acc = new Uint8Array();
                    }
                }else{
                    this.feed(value)
                }
            }

            function joinByteArrays(arr1, arr2){
                const mergedArray = new Uint8Array(arr1.length + arr2.length);
                mergedArray.set(arr1);
                mergedArray.set(arr2, arr1.length);

                return mergedArray;
            }
        } catch (error) {
            if(this._destroyed) return;

            console.error('player stream ERRORed, restart in 1s');
            clearTimeout(this.__pollTimeout);
            this.__pollTimeout = setTimeout(this.startPolling.bind(this), 1000);
            return;
        }

        console.warn('player stream stopped, restart in 10s');
        clearTimeout(this.__pollTimeout);
        this.__pollTimeout = setTimeout(this.startPolling.bind(this), 10000);
    }

    feed(data) {
        if (this.noFeed || !this.pcmPlayer) return;

        this.pcmPlayer.feed(data);
    }

    async updateSong() {
        this.noFeed = true;

        const song = await this.fetchCurTrack();
        if (!this.currentTrack || this.currentTrack.sampleRate != song.sampleRate) {
            this.rebuildPcmPlayer(song.sampleRate);
        }

        this.currentTrack = song;

        const curTrackMins = song.duration / 60 | 0;
        const curTrackSecs = song.duration % 60 | 0;
        this.setTitle(this.currentTrack.title + ` <${curTrackMins}:${pad2(curTrackSecs)}>`);


        this.noFeed = false;

        this.ackRender();
    }

    async updateQueue(){
        const queue = await this.fetchQueue();
        if(!queue) return;

        this.queue = queue;
        this.ackRender();
    }

    async fetchCurTrack() {
        const resp = await (0,_actions__WEBPACK_IMPORTED_MODULE_9__.apiRequest)('/radio/current-song');
        const json = await resp.json();
        if (!json.success) {
            toastr.error('cannot fetch current song! reload the page.');
            return
        }

        return json.song;
    }

    async fetchQueue() {
        const resp = await (0,_actions__WEBPACK_IMPORTED_MODULE_9__.apiRequest)('/radio/get-queue');
        const json = await resp.json();
        if (!json.success) {
            toastr.warn('cannot fetch song queue');
            return
        }

        return json.queues;
    }

    setTitle(title) {
        this._titleSet = Date.now();

        this.title = title;

        clearInterval(this._titleRollerInterval)

        // roll only if it exceeds input width
        if (this.fonts.winamp.measureText(this.title).width > this.config.titleRect.w) {
            this._titleRollerInterval = setInterval(() => {
                // rotate title by 1 char
                const titleArr = this.title.split('');
                titleArr.push(titleArr.shift());

                this.title = titleArr.join('');
                this.ackRender();
            }, 300);
        }
    }
}


function pad2(num) {
    return num.toString().padStart(2, '0');
}

/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (WinampPlayer);

/***/ }),

/***/ "./src/js/windows.js":
/*!***************************!*\
  !*** ./src/js/windows.js ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   accountSettings: () => (/* binding */ accountSettings),
/* harmony export */   authWindow: () => (/* binding */ authWindow),
/* harmony export */   captchaModal: () => (/* binding */ captchaModal),
/* harmony export */   gameSettings: () => (/* binding */ gameSettings),
/* harmony export */   generateTable: () => (/* binding */ generateTable),
/* harmony export */   help: () => (/* binding */ help),
/* harmony export */   keyBinds: () => (/* binding */ keyBinds),
/* harmony export */   onlineViewWindow: () => (/* binding */ onlineViewWindow),
/* harmony export */   toolsWindow: () => (/* binding */ toolsWindow),
/* harmony export */   uiSettings: () => (/* binding */ uiSettings)
/* harmony export */ });
/* harmony import */ var _constants__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./constants */ "./src/js/constants.js");
/* harmony import */ var _translate__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./translate */ "./src/js/translate.js");
/* harmony import */ var _Window__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./Window */ "./src/js/Window.js");
/* harmony import */ var _utils_misc__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./utils/misc */ "./src/js/utils/misc.js");
/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./config */ "./src/js/config.js");
/* harmony import */ var _globals__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./globals */ "./src/js/globals.js");
/* harmony import */ var _me__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./me */ "./src/js/me.js");
/* harmony import */ var _player__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./player */ "./src/js/player.js");
/* harmony import */ var _actions__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ./actions */ "./src/js/actions.js");
/* harmony import */ var toastr__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! toastr */ "./node_modules/toastr/toastr.js");
/* harmony import */ var toastr__WEBPACK_IMPORTED_MODULE_9___default = /*#__PURE__*/__webpack_require__.n(toastr__WEBPACK_IMPORTED_MODULE_9__);
/* harmony import */ var _tools__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ./tools */ "./src/js/tools.js");
/* harmony import */ var _chat__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ./chat */ "./src/js/chat.js");
/* harmony import */ var _utils_localStorage__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ./utils/localStorage */ "./src/js/utils/localStorage.js");
/* harmony import */ var _user__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! ./user */ "./src/js/user.js");
/* harmony import */ var _img_user2_png__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! ../img/user2.png */ "./src/img/user2.png");
/* harmony import */ var _img_arrow_svg__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! ../img/arrow.svg */ "./src/img/arrow.svg");
/* harmony import */ var _utils_strings__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./utils/strings */ "./src/js/utils/strings.js");
/* harmony import */ var _img_vk_logo_svg__WEBPACK_IMPORTED_MODULE_17__ = __webpack_require__(/*! ../img/vk-logo.svg */ "./src/img/vk-logo.svg");
/* harmony import */ var _img_discord_logo_circle_svg__WEBPACK_IMPORTED_MODULE_18__ = __webpack_require__(/*! ../img/discord-logo-circle.svg */ "./src/img/discord-logo-circle.svg");
/* harmony import */ var _img_fb_logo_svg__WEBPACK_IMPORTED_MODULE_19__ = __webpack_require__(/*! ../img/fb-logo.svg */ "./src/img/fb-logo.svg");
/* provided dependency */ var $ = __webpack_require__(/*! jquery */ "./node_modules/jquery/dist/jquery.js");


























function generateTable(arr = []) {
    const table = $('<table class="columnTable"></table>');
    arr.forEach(([title, content]) => {
        let tableBlock = $(`
                <tr>
                    ${content === void 0 ?
                `<td colspan="2">${title}</td>` :
                `<td>${title}</td>
                        <td>${content}</td>`
            }
                </tr>`);
        table.append(tableBlock)
    });

    return table
}

function accountSettings() {
    const settingsWin = new _Window__WEBPACK_IMPORTED_MODULE_2__["default"]({
        title: (0,_utils_strings__WEBPACK_IMPORTED_MODULE_16__.capitalize)((0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('account settings')),
        center: true
    });
    if (!settingsWin.created) return;

    let html = generateTable([
        [(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('role'), _constants__WEBPACK_IMPORTED_MODULE_0__.ROLE_I[_me__WEBPACK_IMPORTED_MODULE_6__["default"].role].toUpperCase()],
        [
            (0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('change name'),
            `<input type="text" id="name" style="width:50%"><button id="changeName">yes</button>`
        ],
        [
            `<button id="logout">${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('logout')}</button>`
        ],
        // [
        //     `<button id="deleteAccount">${tr('delete_account')}</button>`
        // ]

    ]);

    $(settingsWin.body).append(html);

    $('#name').val(_me__WEBPACK_IMPORTED_MODULE_6__["default"].name)
    $('#changeName').on('click', () => {
        const newName = $('#name').val();

        if (!_me__WEBPACK_IMPORTED_MODULE_6__["default"].registered) {
            return toastr__WEBPACK_IMPORTED_MODULE_9___default().error('Hey wtf', '0_o');
        }
        if (newName.length < 0 || newName.length > 32) {
            return toastr__WEBPACK_IMPORTED_MODULE_9___default().error('Name length is not 0 < length < 32', 'Name change')
        }
        if (_me__WEBPACK_IMPORTED_MODULE_6__["default"].name === newName) {
            return toastr__WEBPACK_IMPORTED_MODULE_9___default().error('Name is the same as was', 'Name change')
        }

        fetch('/api/changename', {
            method: 'POST',
            body: JSON.stringify({
                name: newName
            }),
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(async r => {
            const result = await r.json();
            if (!result.errors.length) {
                _globals__WEBPACK_IMPORTED_MODULE_5__["default"].socket.close();
                toastr__WEBPACK_IMPORTED_MODULE_9___default().success('Name successfully changed');
                (0,_actions__WEBPACK_IMPORTED_MODULE_8__.updateMe)();
            } else {
                result.errors.map(e => {
                    toastr__WEBPACK_IMPORTED_MODULE_9___default().error(e, 'Name change error')
                })
            }
        })
    })

    $('#logout').on('click', async () => {
        if (_me__WEBPACK_IMPORTED_MODULE_6__["default"].registered) {
            const req = await (0,_actions__WEBPACK_IMPORTED_MODULE_8__.apiRequest)('/auth/logout');
            const success = await req.json();
            if (success) {
                location.pathname = '/';
            } else {
                toastr__WEBPACK_IMPORTED_MODULE_9___default().error('Can\'t log out');
            }
        }
    })
}

function keyBinds() {
    const keysWin = new _Window__WEBPACK_IMPORTED_MODULE_2__["default"]({
        title: (0,_utils_strings__WEBPACK_IMPORTED_MODULE_16__.capitalize)((0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('toolbinds settings')),
        center: true
    });
    if (!keysWin.created) return;

    let table = generateTable();

    for (const tool of Object.values(_tools__WEBPACK_IMPORTED_MODULE_10__["default"])) {
        if (!tool.key) continue;
        if (tool.requiredRole > _me__WEBPACK_IMPORTED_MODULE_6__["default"].role) continue;

        const tableRow = $(
            `<tr>
            <td>${tool.name}</td>
            <td>
                <span id="MODS-${tool.name}"></span>
                <input id="KEY-${tool.name}" class="key" style="width:130px">
            </td>
        </tr>`);

        table.append(tableRow);

        const input = $('input', tableRow);
        const modsElement = $('span', tableRow);
        input.on('keydown', e => {
            e.preventDefault();

            if (!e.code || e.code === 'ControlLeft' || e.code === 'AltLeft') return

            const altUsed = e.altKey;
            const ctrlUsed = e.ctrlKey;

            let key = '';

            modsElement.text('');
            if (altUsed) {
                modsElement.text('ALT + ');
                key += 'ALT+'
            }
            if (ctrlUsed) {
                modsElement.text(modsElement.text() + 'CTRL + ');
                key += 'CTRL+'
            }
            key += e.code;
            input.val(e.code);

            // removing same values
            for (let _tool of Object.values(_tools__WEBPACK_IMPORTED_MODULE_10__["default"])) {
                if (tool.name != _tool.name && _tool.key == key) {
                    $('#MODS-' + _tool.name).text('')
                    $('#KEY-' + _tool.name).val('')
                }
            }

            _globals__WEBPACK_IMPORTED_MODULE_5__["default"].toolManager.changeKey(tool, key);
        });
        input.on('keyup', e => {
            e.preventDefault();
            if (!e.code || e.code === 'ControlLeft' || e.code === 'AltLeft') return

            // saving ALL key binds
            let toSave = {};

            for (const tool of Object.values(_tools__WEBPACK_IMPORTED_MODULE_10__["default"])) {
                if (!tool.key) continue;

                toSave[tool.name] = tool.key;
            }

            (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_12__.setLS)('keyBinds', JSON.stringify(toSave));
        });

        const parsed = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_3__.decodeKey)(tool.key);

        modsElement.text((parsed.alt ? 'ALT + ' : '') + (parsed.ctrl ? 'CTRL + ' : ''));

        input.val(parsed.code);
    }

    $(keysWin.body).append(table);
}

function uiSettings() {
    const setWin = new _Window__WEBPACK_IMPORTED_MODULE_2__["default"]({
        title: (0,_utils_strings__WEBPACK_IMPORTED_MODULE_16__.capitalize)((0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('ui settings')),
        center: true
    });
    if (!setWin.created) return;

    const table = generateTable([
        [(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('colors size'), '<input type="range" min="16", max="64" step="1" id="colSize"><div style="width:50px;"><div>'],
        [(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('hide emojis'), '<input type="checkbox" id="toggleEmojis">'],
        [(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('emoji list'), '<input type="text" id="emojiList">'],
        [`<button id="moreEmojis">${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('super secret button')}</button>`],
        [(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('show placed pixels'), '<input type="checkbox" id="togglePlaced">'],
        [(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('show patterns over the palette'), '<input type="checkbox" id="showPatterns">']
    ]);
    $(setWin.body).append(table);

    function colorSizeChanged() {
        const val = $('#colSize').val();
        (0,_actions__WEBPACK_IMPORTED_MODULE_8__.setPaletteColorsSize)(val);
        $('#colSize').next().text(val + 'px');
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_12__.setLS)('colorSize', val, true);
        (0,_actions__WEBPACK_IMPORTED_MODULE_8__.fixChatPosition)();
    }

    const colSizeVal = (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_12__.getOrDefault)('colorSize', 24, true);
    $('#colSize').next().text(colSizeVal);
    $('#colSize').val(colSizeVal)
    $('#colSize').on('input', colorSizeChanged);

    $('#toggleEmojis')[0].checked = (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_12__.getLS)('hideEmojis') == 1;
    $('#toggleEmojis').on('click', e => {
        const state = !e.target.checked;
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_12__.setLS)('hideEmojis', state ? 0 : 1);
        (0,_actions__WEBPACK_IMPORTED_MODULE_8__.toggleEmojis)(state);
    });

    $('#emojiList').val((0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_12__.getOrDefault)('emojis', '        '));
    $('#emojiList').on('change', e => {
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_12__.setLS)('emojis', e.target.value);
        (0,_actions__WEBPACK_IMPORTED_MODULE_8__.updateEmojis)(e.target.value.split(' '));
    })

    $('#moreEmojis').on('click', () => {
        const w = new _Window__WEBPACK_IMPORTED_MODULE_2__["default"]((0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('more emojis!'));
        if (!w.created) return;

        w.body.innerHTML = ''
        w.body.style.userSelect = 'text';
    });
    $('#togglePlaced')[0].checked = (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_12__.getOrDefault)('hidePlaced', 1) == 0;
    $('#togglePlaced').on('click', e => {
        const show = e.target.checked;
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_12__.setLS)('hidePlaced', show ? 0 : 1);
        (0,_actions__WEBPACK_IMPORTED_MODULE_8__.togglePlaced)(show);
    });

    $('#showPatterns')[0].checked = _globals__WEBPACK_IMPORTED_MODULE_5__["default"].showPatterns;
    $('#showPatterns').on('click', e => {
        const show = e.target.checked;
        _globals__WEBPACK_IMPORTED_MODULE_5__["default"].showPatterns = show;
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_12__.setLS)('showPalettePatterns', show ? '1' : '0');
        show ? (0,_actions__WEBPACK_IMPORTED_MODULE_8__.showPatternsOnPalette)() : (0,_actions__WEBPACK_IMPORTED_MODULE_8__.unloadPalettePatterns)();
    });
}

function gameSettings() {
    const win = new _Window__WEBPACK_IMPORTED_MODULE_2__["default"]({
        title: (0,_utils_strings__WEBPACK_IMPORTED_MODULE_16__.capitalize)((0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('game settings')),
        center: true
    });
    if (!win.created) return;

    // 1 for guests (packets disabled by server), 20 for admins, and 10 for others 
    let maxBrushSize = (_me__WEBPACK_IMPORTED_MODULE_6__["default"].role === _constants__WEBPACK_IMPORTED_MODULE_0__.ROLE.ADMIN ? 20 : (_me__WEBPACK_IMPORTED_MODULE_6__["default"].role < _constants__WEBPACK_IMPORTED_MODULE_0__.ROLE.USER ? 1 : 10))

    const table = generateTable([
        [
            (0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('show protected'),
            `<input type="checkbox" id="showProtected" ${_config__WEBPACK_IMPORTED_MODULE_4__.game.showProtected ? 'checked' : ''}>`
        ],
        [
            (0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('brush size'),
            `<input type="checkbox" id="customBrushSize" ${_player__WEBPACK_IMPORTED_MODULE_7__["default"].brushSize > 1 ? 'checked' : ''}>
            <input id="brushSize" type="range" value="${_player__WEBPACK_IMPORTED_MODULE_7__["default"].brushSize}" ` +
            `${_player__WEBPACK_IMPORTED_MODULE_7__["default"].brushSize == 1 ? 'disabled' : ''} min="2" ` +
            `max="${maxBrushSize}" step="2">` +
            `<span id="brushSizeCounter">${_player__WEBPACK_IMPORTED_MODULE_7__["default"].brushSize - 1}<span>`
        ],
        [
            (0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('max saved pixels'),
            `<input id="savePixelsInp" type="number" min="0" value="${_player__WEBPACK_IMPORTED_MODULE_7__["default"].maxPlaced}" style="width:4rem">`
        ],
        [
            (0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('disable chat colors'),
            `<input type="checkbox" id="disableChatColors" ${_chat__WEBPACK_IMPORTED_MODULE_11__["default"].colorsEnabled ? '' : 'checked'}>`
        ],
        [
            (0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('chat messages limit'),
            `<input type="number" id="chatLimit" value="${_config__WEBPACK_IMPORTED_MODULE_4__.game.chatLimit}" title="maximum messages in chat">`
        ],
        [
            (0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('light grid'),
            `<input type="checkbox" id="lightGridCB" ${_tools__WEBPACK_IMPORTED_MODULE_10__["default"].grid.isLight ? 'checked' : ''} title="will grid be light?">`
        ],
        [
            (0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('enable grid'),
            `<input type="checkbox" id="enableGridCB" ${_tools__WEBPACK_IMPORTED_MODULE_10__["default"].grid.state == 1 ? 'checked' : ''}>`
        ],
        [
            (0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('draw line length'),
            `<input type="checkbox" id="drawLineLenCB" ${_tools__WEBPACK_IMPORTED_MODULE_10__["default"].line.drawLength ? 'checked' : ''} title="draw line length near it">`
        ],
    ]);

    $(win.body).append(table);

    $('#showProtected').on('change', e => {
        const show = e.target.checked;
        _config__WEBPACK_IMPORTED_MODULE_4__.game.showProtected = show;
        (0,_actions__WEBPACK_IMPORTED_MODULE_8__.showProtected)(show);
    });

    $('#customBrushSize').on('change', e => {
        const use = e.target.checked;

        if (use) {
            // TODO thing below does not work
            $('#brushSize').removeAttr('disabled');
            (0,_actions__WEBPACK_IMPORTED_MODULE_8__.updateBrush)($('#brushSize').val());
        } else {
            $('#brushSize').attr('disabled');
            (0,_actions__WEBPACK_IMPORTED_MODULE_8__.updateBrush)(1);
        }
    });

    $('#brushSize').on('input', e => {
        (0,_actions__WEBPACK_IMPORTED_MODULE_8__.updateBrush)(e.target.value);
    });

    $('#savePixelsInp').on('change', e => {
        e = e.target;
        if (+e.value < 0) e.value = 0;

        _player__WEBPACK_IMPORTED_MODULE_7__["default"].maxPlaced = +e.value;
        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_12__.setLS)('maxPlaced', _player__WEBPACK_IMPORTED_MODULE_7__["default"].maxPlaced)
    });

    $('#disableChatColors').on('change', e => {
        const checked = e.target.checked

        ;(0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_12__.setLS)('disableColors', checked.toString());

        _chat__WEBPACK_IMPORTED_MODULE_11__["default"].setColors(!checked)
    });

    $('#chatLimit').on('change', e => {
        const value = parseInt(e.target.value, 10);
        if (isNaN(value) || value < 1) return;

        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_12__.setLS)('chatLimit', value.toString());

        _config__WEBPACK_IMPORTED_MODULE_4__.game.chatLimit = value;
    });

    $('#lightGridCB').on('change', e => {
        const checked = e.target.checked;

        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_12__.setLS)('lightGrid', checked.toString());

        _tools__WEBPACK_IMPORTED_MODULE_10__["default"].grid.isLight = checked;
    });

    $('#enableGridCB').on('change', e => {
        const checked = e.target.checked;

        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_12__.setLS)('enableGrid', checked.toString());

        if (checked) _tools__WEBPACK_IMPORTED_MODULE_10__["default"].grid.show();
        else _tools__WEBPACK_IMPORTED_MODULE_10__["default"].grid.hide();
    });

    $('#drawLineLenCB').on('change', e => {
        const checked = e.target.checked;

        (0,_utils_localStorage__WEBPACK_IMPORTED_MODULE_12__.setLS)('drawLineLen', checked.toString());

        _tools__WEBPACK_IMPORTED_MODULE_10__["default"].line.drawLength = checked;
    });
}

async function captchaModal() {
    let win = new _Window__WEBPACK_IMPORTED_MODULE_2__["default"]({
        title: (0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('Captcha'),
        center: true,
        closeable: false
    });

    if (win.created) {
        const [help, cont, inp] = $(
            `<div>${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('Case insensitive, 0/o i/l are same')}. <a href="#">${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('Can\'t recognize?')}</a></div>` +
            '<div class="captchaContainer"></div>' +
            '<input class="fullWidthInput" type="text"></input>'
        );

        help.children[0].onclick = captchaModal;

        const [line] = $(`<div style="display:flex;justify-content:center">${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('Captcha').toUpperCase()}:&nbsp;&nbsp;</div>`);
        line.appendChild(inp);

        win.body.appendChild(help)
        win.body.appendChild(cont);
        win.body.appendChild(line);

        inp.addEventListener('keydown', async e => {
            if (e.key === 'Enter') {
                if (inp.value.length == 0) return;
                let val = inp.value;
                inp.value = '';

                const success = await (0,_actions__WEBPACK_IMPORTED_MODULE_8__.solveCaptcha)(val);

                if (success) {
                    win.close();
                } else {
                    captchaModal();
                }
            }
        })
    } else win = win.oldWindow;

    let svg;
    try {
        svg = await (0,_actions__WEBPACK_IMPORTED_MODULE_8__.fetchCaptcha)();
    } catch (e) {
        console.error('error downloading captcha image: ' + e);

        _globals__WEBPACK_IMPORTED_MODULE_5__["default"].socket.close();
        return win.close();
    }

    // according to default dark theme
    svg = svg.replace('stroke="black"', 'stroke="white"');

    $('.captchaContainer', win.body).html(svg);

    win.moveToCenter();
    $('input', win.body).trigger('focus');
}

function toolsWindow() {
    const toolWin = new _Window__WEBPACK_IMPORTED_MODULE_2__["default"]({
        title: (0,_utils_strings__WEBPACK_IMPORTED_MODULE_16__.capitalize)((0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('tools')),
        center: true
    });
    if (!toolWin.created) return;

    const tableArr = [
        [`<a href="/convert" target="_blank">${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('convert image into palette')}</a>`],
        [`<button id="screenshot">${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('save canvas')}</button>`]
    ]

    if(_me__WEBPACK_IMPORTED_MODULE_6__["default"].role >= _constants__WEBPACK_IMPORTED_MODULE_0__.ROLE.MOD){
        tableArr.unshift([`<button id="searchUsersB">${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('search users')}</button>`])
    }

    const table = generateTable(tableArr);
    $(toolWin.body).append(table);

    $('#searchUsersB', table).on('click', () => {
        const win = new _Window__WEBPACK_IMPORTED_MODULE_2__["default"]({
            title: (0,_utils_strings__WEBPACK_IMPORTED_MODULE_16__.capitalize)((0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('search users')),
            center: true
        });
        if (!win.created) return;

        const table = generateTable([
            [`<input type="text" placeholder="nickname" id="userSearchText" max="32" style="width:250px"> ${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('OR')} ` +
                '<input type="text" placeholder="id" id="userSearchId" max="32" style="width:50px">' +
                `<input type="checkbox" id="searchIsBanned"><label for="searchIsBanned">${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('banned?')}</label>`],
            ['<div id="searchUsersBody">']
        ]);
        console.log(table)
        $(win.body).append(table);

        const input = $('#userSearchText');

        $('#userSearchId').on('input', async e => {
            let num = e.target.value.trim();
            num = +num;

            if (isNaN(num) || num < 1 || num > Number.MAX_SAFE_INTEGER) {
                return
            }

            const isBanned = $('#searchIsBanned')[0].checked;

            const searchResp = await search(null, num, isBanned);
            afterSearch(searchResp);
        })

        $('#userSearchText').on('input', async _ => {
            let text = input.val().trim();
            text = text.slice(0, 32);

            const isBanned = $('#searchIsBanned')[0].checked;

            const searchResp = await search(text, null, isBanned);
            afterSearch(searchResp);
        });

        function afterSearch(resp) {
            if (!resp || !resp.length) {
                // clean up if nothing found
                $('#searchUsersBody').html('');
                return
            };

            let table = document.createElement('table');
            table.className = 'innerTable';
            table.innerHTML += '<tr><th>NICK</th><th>ID</th><th>ROLE</th><th>&nbsp;</th></tr>'

            for (let user of resp) {
                const safeNick = (0,_utils_misc__WEBPACK_IMPORTED_MODULE_3__.htmlspecialchars)(user.name);

                // little workaround with click listener,
                // this might be shorter
                const uinfoButton = document.createElement('button');
                uinfoButton.className = 'userInfoBtn';
                uinfoButton.innerHTML = `<img src="${_img_user2_png__WEBPACK_IMPORTED_MODULE_14__["default"]}">`;
                uinfoButton.addEventListener('click', async () => {
                    const req = await (0,_actions__WEBPACK_IMPORTED_MODULE_8__.apiRequest)(`/userInfo?id=${user.id}`);
                    const info = await req.json();
                    await _user__WEBPACK_IMPORTED_MODULE_13__["default"].CreateWindow(info);
                })

                const row = $(
                    `<tr>
                        <td>${safeNick}</td><td>${user.id}</td>` +
                    `<td>${user.role}</td>` +
                    `<td></td>
                    </tr>`
                );

                row[0].lastElementChild.appendChild(uinfoButton);
                table.appendChild(row[0]);
            }

            $('#searchUsersBody').html(table);
        }

        async function search(term, id, isBanned) {
            if (!isBanned) {
                if (!term && !id) return;
            }
            if (term && id) return;

            if (term) {
                term = encodeURIComponent(term);
            }
            const req = await (0,_actions__WEBPACK_IMPORTED_MODULE_8__.apiRequest)(`/admin/users/search?isBanned=${isBanned ? 1 : 0}&${id ? `id=${id}` : `t=${term}`}`)

            const json = await req.json();
            return json
        }
    });

    $('#screenshot').on('click', _actions__WEBPACK_IMPORTED_MODULE_8__.makeScreenshot);
}

function authWindow() {
    const win = new _Window__WEBPACK_IMPORTED_MODULE_2__["default"]({
        title: (0,_utils_strings__WEBPACK_IMPORTED_MODULE_16__.capitalize)((0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('LOG IN')),
        center: true
    });
    if (!win.created) return;

    const tableArr = [
        [`<a href="/api/auth/vk"><img src="${_img_vk_logo_svg__WEBPACK_IMPORTED_MODULE_17__["default"]}" class="authLogo">VK</a>`],
        [`<a href="/api/auth/discord"><img src="${_img_discord_logo_circle_svg__WEBPACK_IMPORTED_MODULE_18__["default"]}" class="authLogo">DISCORD</a>`],
        [`<a href="/api/auth/facebook"><img src="${_img_fb_logo_svg__WEBPACK_IMPORTED_MODULE_19__["default"]}" class="authLogo">FACEBOOK</a>`]
    ]

    const table = generateTable(tableArr);

    $('td', table).css('text-align', 'left');
    $('a', table).css('margin-left', '15px');
    
    $(win.body).append(table);
}

function createCollapsibleBlock(title, bodyHtml, collapsed = true) {
    const head = $('<div>');
    head[0].style.cssText =
        `width: 100%;
    height: 30px;
    background-color: #5f5f5f;
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    user-select: none;
    cursor: pointer`

    head.append(`<div style="font-size:20px;text-transform:uppercase;">${title}</div>`)

    const arrow = $('<div>');
    arrow[0].style.cssText =
        `position: absolute;
    top: 50%;
    transform: translate(0, -50%);
    left: 5px;
    background-image: url(${_img_arrow_svg__WEBPACK_IMPORTED_MODULE_15__["default"]});
    background-size: 100%;
    background-repeat: no-repeat;
    transition: transform .2s ease-in-out;
    width: 20px;
    height: 20px;`

    head.append(arrow);

    const body = $('<div>');
    body[0].style.cssText =
        `max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s linear;
    font-size: 20px;`

    const innerBody = $('<div>');
    innerBody[0].style.cssText =
        `padding:8px`
    innerBody.html(bodyHtml);

    body.append(innerBody);

    const headBodyContainer = $('<div>');
    headBodyContainer[0].style.cssText =
        `margin-bottom: 1px;`
    headBodyContainer.append(head, body)

    let state = 0; // 0 - closed, 1 - opened
    function toggle() {
        if (state) {
            arrow.css('transform', 'translate(0px, -50%) rotate(0deg)');
            body.css('max-height', 0);
        } else {
            arrow.css('transform', 'translate(0px, -50%) rotate(180deg)');
            body.css('max-height', $(body)[0].scrollHeight);
        }

        // becomes true/false analog
        state = !state;
    }
    if (!collapsed) setTimeout(toggle);

    head.on('click', toggle);

    return headBodyContainer
}

function help() {
    const helpWin = new _Window__WEBPACK_IMPORTED_MODULE_2__["default"]({
        title: (0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('help'),
        center: true
    });
    if (!helpWin.created) return;

    helpWin.body.style.width = '90vw'
    helpWin.body.style.height = '90vh'

    // TODO move this to translations
    const intro = createCollapsibleBlock((0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.introHeader'),
        `<div style="width:100%;text-align:center;"><img src="./img/goroxels.png" style="vertical-align: middle;">${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.desc')}</div><br><br>
    ${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.desc2')}<br>
    ${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.desc3')}`, false);

    const howto = createCollapsibleBlock((0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('how to play?'),
        `<div style="display:inline-flex">
            <div>${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.howToPlayDecs')}</div>
            <div style="padding-left: 10px;">
                <video autoplay loop muted style="height:196px"><source src="./video/clickerMouse.webm" type="video/webm"></video>
            </div>
        </div>`, false);

    const tools = createCollapsibleBlock((0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('tools'),
        `${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.toolsDecs')}<br><br>
    <div class="helpWithVideoCont">
        <div>${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.toolsClicker')}<br><br></div>
        <div class="desktop">
            <video autoplay loop muted style="height:196px"><source src="./video/clicker.webm" type="video/webm"></video>
        </div>
    </div><br>
    <div class="helpWithVideoCont">
        <div>${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.toolsAS')}<br><br></div>
        <div class="desktop">
            <video autoplay loop muted style="height:196px"><source src="./video/as.webm" type="video/webm"></video>
        </div>
    </div><br>
    <div class="helpWithVideoCont">
        <div>${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.toolC')}<br><br></div>
        <div class="desktop">
            <video autoplay loop muted style="height:196px"><source src="./video/toolC.webm" type="video/webm"></video>
        </div>
    </div><br>
    <div class="helpWithVideoCont">
        <div>${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.brush')}<br><br></div>
        <div class="desktop">
            <video autoplay loop muted style="height:196px"><source src="./video/brush2.webm" type="video/webm"></video>
        </div>
    </div><br>
    <div class="helpWithVideoCont">
        <div>${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.line')}<br><br></div>
        <div class="desktop">
            <video autoplay loop muted style="height:196px"><source src="./video/line.webm" type="video/webm"></video>
        </div>
    </div><br>
    <div class="helpWithVideoCont">
        <div>${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.flood')}<br><br></div>
        <div class="desktop">
            <video autoplay loop muted style="height:196px"><source src="./video/flood.webm" type="video/webm"></video>
        </div>
    </div><br>
    <div class="helpWithVideoCont">
        <div>${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.grid')}<br><br></div>
        <div class="desktop">
            <img src="./img/unavailable.png" style="height:196px">
        </div>
    </div><br>
    <div class="helpWithVideoCont">
        <div>${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.ctrlZ')}<br><br></div>
        <div class="desktop">
            <video autoplay loop muted style="height:196px"><source src="./video/ctrlZ.webm" type="video/webm"></video>
        </div>
    </div><br>
    ${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.resetColors')}<br>`);

    const tools2 = createCollapsibleBlock((0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.tools2header'),
        `<div style="width:100%;text-align:center;"><b>${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.tools2desc')}</b></div><br><br>
    ${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.toolsHiders')}<br><br>
    ${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.multicol')}<br>
    ${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.multicol2')}<br>
    ${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.multicol3')}<br><br>
    ${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.sendCoords')}<br><br>
    ${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.templateTools')}<br>`);

    const template = createCollapsibleBlock((0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('template'),
        `<div style="width:100%;text-align:center;"><b>${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.templateIntro')}</b></div><br><br>
    ${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.templateDesc')}<br><br>
    ${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.templateDescConvert')}<br><br>
    <div class="helpWithVideoCont">
        <div>${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.templateDescReminder')}<br><br></div>
        <div class="desktop">
            <video autoplay loop muted style="height:196px"><source src="./video/patternDemo.webm" type="video/webm"></video>
        </div>
    </div><br>`);

    const author = createCollapsibleBlock((0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.authorHeader'),
        `${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.authorText')}<br>
        ${(0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('intro.authorContacts')}<br>
        <div style="text-align:center"><img src="./img/3rdcf.png" title=" "></div>`);


    $(helpWin.body).append(intro, howto, tools, tools2, template, author);
}

function onlineViewWindow(json){
    let win = new _Window__WEBPACK_IMPORTED_MODULE_2__["default"]({
        title: (0,_utils_strings__WEBPACK_IMPORTED_MODULE_16__.capitalize)((0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('online')),
        center: true,
        closeable: true
    });

    if (!win.created) {
        win = win.oldWindow;
    }

    win.body.style.width = '325px';
    win.moveToCenter();

    const tableArr = [];
    Object.keys(json).forEach(key => {
        if(key === 'TOTAL'){
            win.updateTitle((0,_translate__WEBPACK_IMPORTED_MODULE_1__.translate)('online') + ` (${json[key]})`, true);
            return;
        }

        const firstEl = `<a href="/${key}" target="_shagorox"><h3>${key}<h3></a>`;
        const secondEl = `<h2>${json[key]}</h2>`;

        tableArr.push([firstEl, secondEl]);
    })

    const table = generateTable(tableArr);

    $('*', win.body).remove();
    $(win.body).append(table);
}

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = __webpack_modules__;
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/amd define */
/******/ 	(() => {
/******/ 		__webpack_require__.amdD = function () {
/******/ 			throw new Error('define cannot be used indirect');
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/chunk loaded */
/******/ 	(() => {
/******/ 		var deferred = [];
/******/ 		__webpack_require__.O = (result, chunkIds, fn, priority) => {
/******/ 			if(chunkIds) {
/******/ 				priority = priority || 0;
/******/ 				for(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];
/******/ 				deferred[i] = [chunkIds, fn, priority];
/******/ 				return;
/******/ 			}
/******/ 			var notFulfilled = Infinity;
/******/ 			for (var i = 0; i < deferred.length; i++) {
/******/ 				var [chunkIds, fn, priority] = deferred[i];
/******/ 				var fulfilled = true;
/******/ 				for (var j = 0; j < chunkIds.length; j++) {
/******/ 					if ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {
/******/ 						chunkIds.splice(j--, 1);
/******/ 					} else {
/******/ 						fulfilled = false;
/******/ 						if(priority < notFulfilled) notFulfilled = priority;
/******/ 					}
/******/ 				}
/******/ 				if(fulfilled) {
/******/ 					deferred.splice(i--, 1)
/******/ 					var r = fn();
/******/ 					if (r !== undefined) result = r;
/******/ 				}
/******/ 			}
/******/ 			return result;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/compat get default export */
/******/ 	(() => {
/******/ 		// getDefaultExport function for compatibility with non-harmony modules
/******/ 		__webpack_require__.n = (module) => {
/******/ 			var getter = module && module.__esModule ?
/******/ 				() => (module['default']) :
/******/ 				() => (module);
/******/ 			__webpack_require__.d(getter, { a: getter });
/******/ 			return getter;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/publicPath */
/******/ 	(() => {
/******/ 		__webpack_require__.p = ".";
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/jsonp chunk loading */
/******/ 	(() => {
/******/ 		// no baseURI
/******/ 		
/******/ 		// object to store loaded and loading chunks
/******/ 		// undefined = chunk not loaded, null = chunk preloaded/prefetched
/******/ 		// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded
/******/ 		var installedChunks = {
/******/ 			"game": 0
/******/ 		};
/******/ 		
/******/ 		// no chunk on demand loading
/******/ 		
/******/ 		// no prefetching
/******/ 		
/******/ 		// no preloaded
/******/ 		
/******/ 		// no HMR
/******/ 		
/******/ 		// no HMR manifest
/******/ 		
/******/ 		__webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);
/******/ 		
/******/ 		// install a JSONP callback for chunk loading
/******/ 		var webpackJsonpCallback = (parentChunkLoadingFunction, data) => {
/******/ 			var [chunkIds, moreModules, runtime] = data;
/******/ 			// add "moreModules" to the modules object,
/******/ 			// then flag all "chunkIds" as loaded and fire callback
/******/ 			var moduleId, chunkId, i = 0;
/******/ 			if(chunkIds.some((id) => (installedChunks[id] !== 0))) {
/******/ 				for(moduleId in moreModules) {
/******/ 					if(__webpack_require__.o(moreModules, moduleId)) {
/******/ 						__webpack_require__.m[moduleId] = moreModules[moduleId];
/******/ 					}
/******/ 				}
/******/ 				if(runtime) var result = runtime(__webpack_require__);
/******/ 			}
/******/ 			if(parentChunkLoadingFunction) parentChunkLoadingFunction(data);
/******/ 			for(;i < chunkIds.length; i++) {
/******/ 				chunkId = chunkIds[i];
/******/ 				if(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {
/******/ 					installedChunks[chunkId][0]();
/******/ 				}
/******/ 				installedChunks[chunkId] = 0;
/******/ 			}
/******/ 			return __webpack_require__.O(result);
/******/ 		}
/******/ 		
/******/ 		var chunkLoadingGlobal = self["webpackChunkgoroxels_client"] = self["webpackChunkgoroxels_client"] || [];
/******/ 		chunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));
/******/ 		chunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module depends on other loaded chunks and execution need to be delayed
/******/ 	var __webpack_exports__ = __webpack_require__.O(undefined, ["vendors","penis"], () => (__webpack_require__("./src/js/main.js")))
/******/ 	__webpack_exports__ = __webpack_require__.O(__webpack_exports__);
/******/ 	
/******/ })()
;
//# sourceMappingURL=game.98ae20fad6f0731b4790.bundle.js.map