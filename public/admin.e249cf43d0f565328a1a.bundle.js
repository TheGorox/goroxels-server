(()=>{var e,t={58:(e,t,a)=>{"use strict";a.p;var n=a(673),o=a(530),r=a(836),c=a(901),s=a(755);let i;async function l(e,t,a=!1,o=!1){const r=n.stringify(t),s=await fetch("/api/"+e+"?"+r,{method:a?"POST":"GET"});if(s.headers.get("Content-Type").startsWith("plain/binary")||o)return await s.arrayBuffer();const i=await s.json();return i.errors?(i.errors.forEach((e=>c.error(e))),null):i}async function d(){async function e(e,t){const a=await l("admin/backup/getTimes",{canvas:e,day:t});if(!a)return!1;s("#timeSelect option").remove();for(let e of a){const t=`<option value="${e}">${e.replace(/-/g,":")}</option>`;s("#timeSelect").append(t)}return s("#timeSelect option:last-child").attr("selected",!0),a}let t={};async function a(e,a,n,r){let c=null;if(r){const o=s("#bkCanvasWrapper")[0];o&&(c=function(e){const t=s('<div class="waitContainer" style="opacity: 0">\n        <div class="waitElement">\n            <div class="waitShape"></div>\n            <div class="waitShape"></div>\n            <div class="waitShape"></div>\n            <div class="waitShape"></div>\n        </div>\n    </div>'),a=e.getBoundingClientRect();return s(e).append(t),t.css("top",a.top).css("left",a.left).css("width",a.width).css("height",a.height),setTimeout((()=>{t.css("opacity",1)})),()=>{t.remove()}}(o));let r=await l("admin/backup/getBackup",{canvas:e,day:a,time:n},!1,!0);if(!r)return;t=function(e){const t=new Uint8Array(e);let a,n=0;for(;0!==a;)if(a=t[n++],n>65535)throw new Error("Metadata length is too long, aborting");const o=(new TextDecoder).decode(t.subarray(0,n-1)),r=JSON.parse(o),c=r.chunkSize**2,s={};for(let e=0;e<r.width;e++)for(let a=0;a<r.height;a++){const o=`${e},${a}`,i=n+c*(e+a*r.width);s[o]=t.subarray(i,i+c)}return{metadata:r,chunks:s}}(r)}const i=Date.now();!function(e,t,a,n){const r=t.chunkSize;let c=r*t.width,i=r*t.height,l=0,d=0;null!==a&&(a.startX=Math.min(t.width,a.startX),a.startY=Math.min(t.height,a.startY),a.endX=Math.min(t.width,a.endX),a.endY=Math.min(t.height,a.endY),l=-a.startX*r,d=-a.startY*r,c=(a.endX+1-a.startX)*r,i=(a.endY+1-a.startY)*r);const p=t.palette.map((e=>(0,o.rgb2uint32)(e))),h=document.createElement("canvas");h.width=c,h.height=i;const u=h.getContext("2d"),f=u.createImageData(c,i),v=new Uint32Array(f.data.buffer);if(Object.keys(e).forEach((t=>{const[n,o]=t.split(",").map((e=>+e));if(null!==a&&(n<a.startX||n>a.endX||o<a.startY||o>a.endY))return;let s,i,h,u=e[t],f=0;const m=n*r+l,g=m+r,w=o*r+d,y=w+r;for(let e=w;e<y;e++){h=e*c;for(let t=m;t<g;t++)t<3&&0==e&&console.log({x:t,y:e,rdn:127&u[f],rd:u[f]}),s=p[127&u[f++]],i=t+h,v[i]=s}})),u.putImageData(f,0,0),n){u.beginPath(),u.strokeStyle="red",u.lineWidth=3,u.setLineDash([u.lineWidth/.75,u.lineWidth/.66666]);for(let e=r;e<i-1;e+=r)u.moveTo(0,e),u.lineTo(c-1,e);for(let e=r;e<c-1;e+=r)u.moveTo(e,0),u.lineTo(e,i-1);u.stroke(),u.closePath(),u.setLineDash([]);const e=r/2,t=r/4;u.font=t+"px sans-serif",u.fillStyle="red",u.strokeStyle="white",u.textAlign="center",u.textBaseline="middle",u.lineWidth=t/6;let n,o=0,s=0;a&&(o=a.startX||0,s=a.startY||0);const l=h.width/r,d=h.height/r;for(let t=0;t<d;t++)for(let a=0;a<l;a++){n=`(${a+o}, ${t+s})`;let c=a*r+e,i=t*r+e;u.strokeText(n,c,i),u.fillText(n,c,i)}}s("#backupContainer *").remove(),s("#backupContainer").append(s('<div id="bkCanvasWrapper">')),s("#bkCanvasWrapper").append(h),s("body").scrollTop(999)}(t.chunks,t.metadata,d(),s("#gridCB").is(":checked")),console.log("renderBackup in "+(Date.now()-i)),function(e){const t=100;s("#zoomedCanvasView").remove();const a=document.createElement("canvas");a.id="zoomedCanvasView",a.width=a.height=200,a.style.cssText="border: 1px solid black; \nposition: absolute; \ndisplay: none",document.body.appendChild(a);const n=a.getContext("2d"),o=e.getContext("2d"),r=e.getBoundingClientRect(),c=e.width/r.width,i=e.height/r.height;e.addEventListener("mousemove",(e=>{a.style.display="";const r=Math.max(e.offsetX,0),s=Math.max(e.offsetY,0),l=r*c,d=s*i;(function(e,t,a,r){const c=o.getImageData(e,t,a-e,r-t);n.putImageData(c,0,0)})(l-t,d-t,l+t,d+t),a.style.left=e.clientX+10+"px",a.style.top=e.clientY+10+"px"})),e.addEventListener("mouseleave",(()=>{a.style.display="none"}))}(s("#bkCanvasWrapper>canvas")[0]),c&&c()}function n(){return s("#buCanvasSelect").val()}function r(){return s("#dateSelect").val()}function i(){return s("#timeSelect").val()}function d(){if(!s("#cropCB").is(":checked"))return null;const e=function(){if(!s("#cropCB").is(":checked"))return s("#cropXStart,#cropYStart,#cropXEnd,#cropYEnd").removeAttr("placeholder"),null;let e=s("#cropXStart").val(),t=s("#cropYStart").val(),a=s("#cropXEnd").val(),n=s("#cropYEnd").val();return e.length||(e=0,s("#cropXStart").attr("placeholder",e)),t.length||(t=0,s("#cropYStart").attr("placeholder",t)),a.length||(a=e,s("#cropXEnd").attr("placeholder",a)),n.length||(n=t,s("#cropYEnd").attr("placeholder",n)),e=+e,a=+a,t=+t,n=+n,e<0||e>a||t<0||t>n?null:{cropXstart:e,cropXend:a,cropYstart:t,cropYend:n}}();if(!e)return null;const{cropXstart:t,cropXend:a,cropYstart:n,cropYend:o}=e;return{startX:t,startY:n,endX:a,endY:o}}function p(e){const t=n(),o=r(),c=i();[t,o,c].some((e=>""==e))||a(t,o,c,e)}async function h(){const t=n(),o=await async function(e){let t=await l("admin/backup/getDays",{canvas:e});if(!t)return!1;t=t.sort(((e,t)=>u(e)-u(t))),s("#dateSelect option").remove();for(let e of t){const t=`<option>${e}</option>`;s("#dateSelect").append(t)}return s("#dateSelect option:last-child").attr("selected",!0),t}(t),r=o[o.length-1],c=await e(t,r),i=c[c.length-1];await a(t,r,i,!0)}function u(e){const[t,a,n]=e.split(".").map((e=>parseInt(e,10)));let o=0;return o+=365*n,o+=31*a,o+=t,o}s("#gridCB, #cropCB, #timeSelect, .cropInput").on("change",(e=>{("cropInput"!=e.className||s("#cropCB").is(":checked"))&&p("timeSelect"===e.target.id)})),s("#cropCB").on("change",(()=>{s("#cropCB").is(":checked")?s("#cropRollbackCB").removeAttr("disabled"):s("#cropRollbackCB").attr("disabled","")})),s("#buCanvasSelect").on("change",h),s("#dateSelect").on("change",(async()=>{await e(n(),r()),p(!0)})),s("#rollback").on("click",(async()=>{const e=n(),t=r(),a=i(),o=d();if([e,t,a].some((e=>""==e)))return;const p=o&&s("#cropRollbackCB").is(":checked"),h=await l("/admin/backup/rollback",{canvas:e,day:t,time:a,crop:p?[o.startX,o.startY,o.endX,o.endY].join(","):""},!0),u=await h.json();u.success?c.success("Rollbacked!"):c.error(u.errors)})),async function(){await h()}().catch((e=>{console.error(e),c.error(e)}))}(async()=>{let e;try{e=await fetch("/api/me")}catch(e){return c.error(e),c.error("Error while fetching /api/me:")}const t=await e.json();if(t.role<r.ROLE.MOD)location.href="https://www.youtube.com/watch?v=dQw4w9WgXcQ";else{switch(i=(await async function(){const e=await fetch("/config.json");return await e.json()}()).canvases,t.role){case r.ROLE.ADMIN:s(".admin").show();case r.ROLE.MOD:s(".mod").show();default:1==t.id&&s(".superadmin").show()}for(let e=0;e<i.length;e++){const t=i[e];s(".canvasSelect").append(`<option value="${e}" ${0===e?"selected":""}>${t.name}</option>`)}d(),s("#sendIps").on("click",(async()=>{const e=s('input[name="ipAction"]:checked').val();let t=s("#ips").val();if(t=t.split("\n"),0==t.length)return void c.error("All ips are invalid");const a=await fetch("/api/admin/ip",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ips:t,action:e})}),n=await a.json();for(let e of n.errors)c.error(e);n.success?c.success("Success"):c.error("Bad luck")})),s("#sendCaptchaEnabled").on("click",(async()=>{const e=s("#captchaState")[0].checked,t=await fetch("/api/admin/config/captchaState",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({state:e})}),a=await t.json();a.success?c.success("Success"):(c.error("Failed"),console.log(a))})),s("#sendJoinDelay").on("click",(async()=>{const e=s("#joinDelay").val();if(!e)return;const t=parseInt(e,10);if(t<0||isNaN(t))return;const a=await fetch("/api/admin/config/afterJoinDelay",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:t})}),n=await a.json();n.success?c.success("Success"):(c.error("Failed"),console.log(n))})),function(){const e=s("#protectMaskFile");let t;e.on("change",(a=>{if(e[0].files.length){const a=e[0].files[0];t=a,s("label[for=protectMaskFile]").text(a.name)}else s("label[for=protectMaskFile]").text("Choose image")})),s("#submitProtectMask").on("click",(async()=>{if(!t)return;const e=+s("#protectMaskXOff").val(),a=+s("#protectMaskYOff").val();if([e,a].some((e=>isNaN(e)||e<0)))return;const n=s("#pmCanvasSelect").val(),o=new FormData;o.append("x",e),o.append("y",a),o.append("canvas",n),o.append("img",t);const r=await fetch("/api/admin/canvas/applyProtectMask",{method:"POST",body:o});(await r.json())?.errors?.forEach((e=>c.error(e)))}))}(),i.forEach(((e,t)=>{s("#selectActCanvas").append(`<option value="${t}">${e.name}</option>`)})),s("#canvasAction").on("change",(()=>{const e=s("#canvasAction").val();s(".hidden.enlargeConfig").addClass("hidden"),"enlarge"===e&&s(".hidden.enlargeConfig").removeClass("hidden")})),s("#doCanvasAction").on("click",(async()=>{const e=s("#canvasAction").val();if(!e)return;const t=s("#selectActCanvas").val();if(t&&("wipe"===e&&await async function(e){await l("admin/canvas/wipe",{canvas:e},!0),c.success("Canvas "+i[e].name+" wiped!")}(t),"enlarge"===e)){const e=s("#enTop").val(),a=s("#enRight").val(),n=s("#enBot").val(),o=s("#enLeft").val();if([e,a,n,o].some((e=>e>254)))return c.error("Max canvas size is 255!");if([e,a,n,o].some((e=>e<0)))return c.error("ENLARGE only, one way road");await async function(e,t,a,n,o){await l("admin/canvas/enlarge",{canvas:e,top:t,right:a,bottom:n,left:o},!0),c.success("Canvas "+i[e].name+" enlarged!")}(t,e,a,n,o)}}))}})()},836:e=>{const t=36e5,a={BANNED:-1,GUEST:0,USER:1,TRUSTED:2,MOD:3,ADMIN:4},n={};Object.keys(a).forEach((e=>n[a[e]]=e)),e.exports={SECOND:1e3,MINUTE:6e4,HOUR:t,DAY:864e5,WEEK:6048e5,MONTH:2592e6,ROLE:a,ROLE_I:n,chatBucket:{USER:[2e3,3],TRUSTED:[1e3,4],MOD:[500,5],ADMIN:[0,32]}}}},a={};function n(e){var o=a[e];if(void 0!==o)return o.exports;var r=a[e]={exports:{}};return t[e].call(r.exports,r,r.exports,n),r.exports}n.m=t,n.amdD=function(){throw new Error("define cannot be used indirect")},e=[],n.O=(t,a,o,r)=>{if(!a){var c=1/0;for(d=0;d<e.length;d++){for(var[a,o,r]=e[d],s=!0,i=0;i<a.length;i++)(!1&r||c>=r)&&Object.keys(n.O).every((e=>n.O[e](a[i])))?a.splice(i--,1):(s=!1,r<c&&(c=r));if(s){e.splice(d--,1);var l=o();void 0!==l&&(t=l)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[a,o,r]},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.p=".",(()=>{var e={328:0};n.O.j=t=>0===e[t];var t=(t,a)=>{var o,r,[c,s,i]=a,l=0;if(c.some((t=>0!==e[t]))){for(o in s)n.o(s,o)&&(n.m[o]=s[o]);if(i)var d=i(n)}for(t&&t(a);l<c.length;l++)r=c[l],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return n.O(d)},a=self.webpackChunkgoroxels_client=self.webpackChunkgoroxels_client||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var o=n.O(void 0,[216,163],(()=>n(58)));o=n.O(o)})();