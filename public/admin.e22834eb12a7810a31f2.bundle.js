(()=>{var e,t={6597:(e,t,a)=>{"use strict";a.p;var n=a(7186),o=a(8325),r=a(2115),s=a(7959),c=a(4692);let i;async function l(e,t,a=!1,o=!1){const r=n.stringify(t),c=await fetch("/api/"+e+"?"+r,{method:a?"POST":"GET"});if(c.headers.get("Content-Type").startsWith("plain/binary")||o)return await c.arrayBuffer();const i=await c.json();return i.errors?(i.errors.forEach((e=>s.error(e))),null):i}async function d(){async function e(e,t){const a=await l("admin/backup/getTimes",{canvas:e,day:t});if(!a)return!1;c("#timeSelect option").remove();for(let e of a){const t=`<option value="${e}">${e.replace(/-/g,":")}</option>`;c("#timeSelect").append(t)}return c("#timeSelect option:last-child").attr("selected",!0),a}let t={};async function a(e,a,n,r){let s=null;if(r){const o=c("#bkCanvasWrapper")[0];o&&(s=function(e){const t=c('<div class="waitContainer" style="opacity: 0">\n        <div class="waitElement">\n            <div class="waitShape"></div>\n            <div class="waitShape"></div>\n            <div class="waitShape"></div>\n            <div class="waitShape"></div>\n        </div>\n    </div>'),a=e.getBoundingClientRect();return c(e).append(t),t.css("top",a.top).css("left",a.left).css("width",a.width).css("height",a.height),setTimeout((()=>{t.css("opacity",1)})),()=>{t.remove()}}(o));let r=await l("admin/backup/getBackup",{canvas:e,day:a,time:n},!1,!0);if(!r)return;t=function(e){const t=new Uint8Array(e);let a,n=0;for(;0!==a;)if(a=t[n++],n>65535)throw new Error("Metadata length is too long, aborting");const o=(new TextDecoder).decode(t.subarray(0,n-1)),r=JSON.parse(o),s=r.chunkSize**2,c={};for(let e=0;e<r.width;e++)for(let a=0;a<r.height;a++){const o=`${e},${a}`,i=n+s*(e+a*r.width);c[o]=t.subarray(i,i+s)}return{metadata:r,chunks:c}}(r)}const i=Date.now();!function(e,t,a,n){const r=t.chunkSize;let s=r*t.width,i=r*t.height,l=0,d=0;null!==a&&(a.startX=Math.min(t.width,a.startX),a.startY=Math.min(t.height,a.startY),a.endX=Math.min(t.width,a.endX),a.endY=Math.min(t.height,a.endY),l=-a.startX*r,d=-a.startY*r,s=(a.endX+1-a.startX)*r,i=(a.endY+1-a.startY)*r);const p=t.palette.map((e=>(0,o.rgb2uint32)(e))),h=document.createElement("canvas");h.width=s,h.height=i;const u=h.getContext("2d"),f=u.createImageData(s,i),m=new Uint32Array(f.data.buffer);if(Object.keys(e).forEach((t=>{const[n,o]=t.split(",").map((e=>+e));if(null!==a&&(n<a.startX||n>a.endX||o<a.startY||o>a.endY))return;let c,i,h,u=e[t],f=0;const v=n*r+l,g=v+r,w=o*r+d,y=w+r;for(let e=w;e<y;e++){h=e*s;for(let t=v;t<g;t++)t<3&&0==e&&console.log({x:t,y:e,rdn:127&u[f],rd:u[f]}),c=p[127&u[f++]],i=t+h,m[i]=c}})),u.putImageData(f,0,0),n){u.beginPath(),u.strokeStyle="red",u.lineWidth=3,u.setLineDash([u.lineWidth/.75,u.lineWidth/.66666]);for(let e=r;e<i-1;e+=r)u.moveTo(0,e),u.lineTo(s-1,e);for(let e=r;e<s-1;e+=r)u.moveTo(e,0),u.lineTo(e,i-1);u.stroke(),u.closePath(),u.setLineDash([]);const e=r/2,t=r/4;u.font=t+"px sans-serif",u.fillStyle="red",u.strokeStyle="white",u.textAlign="center",u.textBaseline="middle",u.lineWidth=t/6;let n,o=0,c=0;a&&(o=a.startX||0,c=a.startY||0);const l=h.width/r,d=h.height/r;for(let t=0;t<d;t++)for(let a=0;a<l;a++){n=`(${a+o}, ${t+c})`;let s=a*r+e,i=t*r+e;u.strokeText(n,s,i),u.fillText(n,s,i)}}c("#backupContainer *").remove(),c("#backupContainer").append(c('<div id="bkCanvasWrapper">')),c("#bkCanvasWrapper").append(h),c("body").scrollTop(999)}(t.chunks,t.metadata,d(),c("#gridCB").is(":checked")),console.log("renderBackup in "+(Date.now()-i)),function(e){const t=100;c("#zoomedCanvasView").remove();const a=document.createElement("canvas");a.id="zoomedCanvasView",a.width=a.height=200,a.style.cssText="border: 1px solid black; \nposition: absolute; \ndisplay: none",document.body.appendChild(a);const n=a.getContext("2d"),o=e.getContext("2d"),r=e.getBoundingClientRect(),s=e.width/r.width,i=e.height/r.height;e.addEventListener("mousemove",(e=>{a.style.display="";const r=Math.max(e.offsetX,0),c=Math.max(e.offsetY,0),l=r*s,d=c*i;(function(e,t,a,r){const s=o.getImageData(e,t,a-e,r-t);n.putImageData(s,0,0)})(l-t,d-t,l+t,d+t),a.style.left=e.clientX+10+"px",a.style.top=e.clientY+10+"px"})),e.addEventListener("mouseleave",(()=>{a.style.display="none"}))}(c("#bkCanvasWrapper>canvas")[0]),s&&s()}function n(){return c("#buCanvasSelect").val()}function r(){return c("#dateSelect").val()}function i(){return c("#timeSelect").val()}function d(){if(!c("#cropCB").is(":checked"))return null;const e=function(){if(!c("#cropCB").is(":checked"))return c("#cropXStart,#cropYStart,#cropXEnd,#cropYEnd").removeAttr("placeholder"),null;let e=c("#cropXStart").val(),t=c("#cropYStart").val(),a=c("#cropXEnd").val(),n=c("#cropYEnd").val();return e.length||(e=0,c("#cropXStart").attr("placeholder",e)),t.length||(t=0,c("#cropYStart").attr("placeholder",t)),a.length||(a=e,c("#cropXEnd").attr("placeholder",a)),n.length||(n=t,c("#cropYEnd").attr("placeholder",n)),e=+e,a=+a,t=+t,n=+n,e<0||e>a||t<0||t>n?null:{cropXstart:e,cropXend:a,cropYstart:t,cropYend:n}}();if(!e)return null;const{cropXstart:t,cropXend:a,cropYstart:n,cropYend:o}=e;return{startX:t,startY:n,endX:a,endY:o}}function p(e){const t=n(),o=r(),s=i();[t,o,s].some((e=>""==e))||a(t,o,s,e)}async function h(){const t=n(),o=await async function(e){let t=await l("admin/backup/getDays",{canvas:e});if(!t)return!1;t=t.sort(((e,t)=>u(e)-u(t))),c("#dateSelect option").remove();for(let e of t){const t=`<option>${e}</option>`;c("#dateSelect").append(t)}return c("#dateSelect option:last-child").attr("selected",!0),t}(t),r=o[o.length-1],s=await e(t,r),i=s[s.length-1];await a(t,r,i,!0)}function u(e){const[t,a,n]=e.split(".").map((e=>parseInt(e,10)));let o=0;return o+=365*n,o+=31*a,o+=t,o}c("#gridCB, #cropCB, #timeSelect, .cropInput").on("change",(e=>{("cropInput"!=e.className||c("#cropCB").is(":checked"))&&p("timeSelect"===e.target.id)})),c("#cropCB").on("change",(()=>{c("#cropCB").is(":checked")?c("#cropRollbackCB").removeAttr("disabled"):c("#cropRollbackCB").attr("disabled","")})),c("#buCanvasSelect").on("change",h),c("#dateSelect").on("change",(async()=>{await e(n(),r()),p(!0)})),c("#rollback").on("click",(async()=>{const e=n(),t=r(),a=i(),o=d();if([e,t,a].some((e=>""==e)))return;const p=o&&c("#cropRollbackCB").is(":checked"),h=await l("/admin/backup/rollback",{canvas:e,day:t,time:a,crop:p?[o.startX,o.startY,o.endX,o.endY].join(","):""},!0),u=await h.json();u.success?s.success("Rollbacked!"):s.error(u.errors)})),async function(){await h()}().catch((e=>{console.error(e),s.error(e)}))}(async()=>{let e;try{e=await fetch("/api/me")}catch(e){return s.error(e),s.error("Error while fetching /api/me:")}const t=await e.json();if(t.role<r.ROLE.MOD)location.href="https://www.youtube.com/watch?v=dQw4w9WgXcQ";else{switch(i=(await async function(){const e=await fetch("/config.json");return await e.json()}()).canvases,t.role){case r.ROLE.ADMIN:c(".admin").show();case r.ROLE.MOD:c(".mod").show();default:1==t.id&&c(".superadmin").show()}for(let e=0;e<i.length;e++){const t=i[e];c(".canvasSelect").append(`<option value="${e}" ${0===e?"selected":""}>${t.name}</option>`)}d(),c("#sendIps").on("click",(async()=>{const e=c('input[name="ipAction"]:checked').val();let t=c("#ips").val();if(t=t.split("\n"),0==t.length)return void s.error("All ips are invalid");const a=await fetch("/api/admin/ip",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ips:t,action:e})}),n=await a.json();for(let e of n.errors)s.error(e);n.success?s.success("Success"):s.error("Bad luck")})),c("#sendCaptchaEnabled").on("click",(async()=>{const e=c("#captchaState")[0].checked,t=await fetch("/api/admin/config/captchaState",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({state:e})}),a=await t.json();a.success?s.success("Success"):(s.error("Failed"),console.log(a))})),c("#sendJoinDelay").on("click",(async()=>{const e=c("#joinDelay").val();if(!e)return;const t=parseInt(e,10);if(t<0||isNaN(t))return;const a=await fetch("/api/admin/config/afterJoinDelay",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:t})}),n=await a.json();n.success?s.success("Success"):(s.error("Failed"),console.log(n))})),function(){const e=c("#protectMaskFile");let t;e.on("change",(a=>{if(e[0].files.length){const a=e[0].files[0];t=a,c("label[for=protectMaskFile]").text(a.name)}else c("label[for=protectMaskFile]").text("Choose image")})),c("#submitProtectMask").on("click",(async()=>{if(!t)return;const e=+c("#protectMaskXOff").val(),a=+c("#protectMaskYOff").val();if([e,a].some((e=>isNaN(e)||e<0)))return;const n=c("#pmCanvasSelect").val(),o=await new Promise(((e,a)=>{const n=new FileReader;n.onload=t=>{const n=new Image;n.onload=()=>e(n),n.onerror=a,n.src=t.target.result},n.onerror=a,n.readAsDataURL(t)})),r=500,i=Math.ceil(o.width/r),l=Math.ceil(o.height/r),d=i*l;let p=0,h=s.info(`Uploading mask... (0 / ${d})`,"Mask Upload",{timeOut:0,extendedTimeOut:0,closeButton:!0,tapToDismiss:!1});const u=document.createElement("canvas"),f=u.getContext("2d");for(let t=0;t<l;t++)for(let c=0;c<i;c++){const i=c*r,l=t*r,m=Math.min(r,o.width-i),v=Math.min(r,o.height-l);u.width=m,u.height=v,f.clearRect(0,0,m,v),f.drawImage(o,i,l,m,v,0,0,m,v);const g=await new Promise((e=>u.toBlob(e,"image/png"))),w=new FormData;w.append("x",e+i),w.append("y",a+l),w.append("canvas",n),w.append("img",g,`chunk_${c}_${t}.png`);const y=await fetch("/api/admin/canvas/applyProtectMask",{method:"POST",body:w}),k=await y.json();k?.errors?.forEach((e=>s.error(e))),p++,h&&h.find(".toast-message").length&&h.find(".toast-message").text(`Uploading mask... (${p} / ${d})`)}h.remove(),h&&h.find(".toast-message").length&&h.find(".toast-message").text(`Upload complete! (${p} / ${d})`),s.success("Protect mask applied successfully")}))}(),i.forEach(((e,t)=>{c("#selectActCanvas").append(`<option value="${t}">${e.name}</option>`)})),c("#canvasAction").on("change",(()=>{const e=c("#canvasAction").val();c(".hidden.enlargeConfig").addClass("hidden"),"enlarge"===e&&c(".hidden.enlargeConfig").removeClass("hidden")})),c("#doCanvasAction").on("click",(async()=>{const e=c("#canvasAction").val();if(!e)return;const t=c("#selectActCanvas").val();if(t&&("wipe"===e&&await async function(e){await l("admin/canvas/wipe",{canvas:e},!0),s.success("Canvas "+i[e].name+" wiped!")}(t),"enlarge"===e)){const e=c("#enTop").val(),a=c("#enRight").val(),n=c("#enBot").val(),o=c("#enLeft").val();if([e,a,n,o].some((e=>e>254)))return s.error("Max canvas size is 255!");if([e,a,n,o].some((e=>e<0)))return s.error("ENLARGE only, one way road");await async function(e,t,a,n,o){await l("admin/canvas/enlarge",{canvas:e,top:t,right:a,bottom:n,left:o},!0),s.success("Canvas "+i[e].name+" enlarged!")}(t,e,a,n,o)}}))}})()},2115:e=>{const t=36e5,a=24*t,n=7*a,o=30*a,r={BANNED:-1,GUEST:0,USER:1,TRUSTED:2,MOD:3,ADMIN:4},s={};Object.keys(r).forEach((e=>s[r[e]]=e)),e.exports={SECOND:1e3,MINUTE:6e4,HOUR:t,DAY:a,WEEK:n,MONTH:o,ROLE:r,ROLE_I:s,chatBucket:{USER:[2e3,3],TRUSTED:[1e3,4],MOD:[500,5],ADMIN:[0,32]}}}},a={};function n(e){var o=a[e];if(void 0!==o)return o.exports;var r=a[e]={exports:{}};return t[e].call(r.exports,r,r.exports,n),r.exports}n.m=t,n.amdD=function(){throw new Error("define cannot be used indirect")},e=[],n.O=(t,a,o,r)=>{if(!a){var s=1/0;for(d=0;d<e.length;d++){for(var[a,o,r]=e[d],c=!0,i=0;i<a.length;i++)(!1&r||s>=r)&&Object.keys(n.O).every((e=>n.O[e](a[i])))?a.splice(i--,1):(c=!1,r<s&&(s=r));if(c){e.splice(d--,1);var l=o();void 0!==l&&(t=l)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[a,o,r]},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.p=".",(()=>{var e={884:0};n.O.j=t=>0===e[t];var t=(t,a)=>{var o,r,[s,c,i]=a,l=0;if(s.some((t=>0!==e[t]))){for(o in c)n.o(c,o)&&(n.m[o]=c[o]);if(i)var d=i(n)}for(t&&t(a);l<s.length;l++)r=s[l],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return n.O(d)},a=self.webpackChunkgoroxels_client=self.webpackChunkgoroxels_client||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var o=n.O(void 0,[96,200],(()=>n(6597)));o=n.O(o)})();